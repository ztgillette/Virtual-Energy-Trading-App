{"version":3,"sources":["../src/graphic/richtext/icon.ts"],"names":[],"mappings":"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","file":"icon.js","sourcesContent":["import type { IAABBBounds } from '@visactor/vutils';\nimport { isArray } from '@visactor/vutils';\nimport type { ICustomPath2D, IRichTextIcon, IRichTextIconGraphicAttribute } from '../../interface';\nimport { Image } from '../image';\nimport { DefaultImageAttribute } from '../config';\nimport { parsePadding } from '../../common/utils';\n\n// export const IMAGE_NUMBER_TYPE = genNumberType();\n\nexport class RichTextIcon extends Image implements IRichTextIcon {\n  // type: 'richtext-icon' = 'richtext-icon';\n  declare attribute: IRichTextIconGraphicAttribute;\n  richtextId?: string;\n  // 全局坐标，供外部用户pick后使用\n  globalX?: number;\n  globalY?: number;\n  _x: number = 0;\n  _y: number = 0;\n  _hovered: boolean = false;\n  _marginArray: [number, number, number, number] = [0, 0, 0, 0];\n\n  constructor(params: IRichTextIconGraphicAttribute) {\n    super(params);\n\n    if (params.backgroundShowMode === 'always') {\n      this._hovered = true;\n    }\n\n    if (params.margin) {\n      const marginArray = parsePadding(params.margin);\n      if (typeof marginArray === 'number') {\n        this._marginArray = [marginArray, marginArray, marginArray, marginArray];\n      } else {\n        this._marginArray = marginArray;\n      }\n    }\n\n    this.onBeforeAttributeUpdate = (val: any, attributes: any, key: null | string | string[]) => {\n      if ((isArray(key) && key.indexOf('margin') !== -1) || key === 'margin') {\n        if (attributes.margin) {\n          const marginArray = parsePadding(attributes.margin);\n          if (typeof marginArray === 'number') {\n            this._marginArray = [marginArray, marginArray, marginArray, marginArray];\n          } else {\n            this._marginArray = marginArray;\n          }\n        } else {\n          this._marginArray = [0, 0, 0, 0];\n        }\n      }\n      return undefined;\n    };\n  }\n  animationBackUps?: { from: Record<string, any>; to: Record<string, any> } | undefined;\n  incrementalAt?: number | undefined;\n  toCustomPath: (() => ICustomPath2D) | undefined;\n\n  get width(): number {\n    return (this.attribute.width ?? 0) + this._marginArray[1] + this._marginArray[3];\n  }\n\n  get height(): number {\n    return (this.attribute.height ?? 0) + this._marginArray[0] + this._marginArray[2];\n  }\n\n  protected tryUpdateAABBBounds(): IAABBBounds {\n    if (!this.shouldUpdateAABBBounds()) {\n      return this._AABBBounds;\n    }\n\n    this.doUpdateAABBBounds();\n\n    // 扩大范围\n    const { width = DefaultImageAttribute.width, height = DefaultImageAttribute.height } = this.attribute;\n    const { backgroundWidth = width, backgroundHeight = height } = this.attribute;\n    const expandX = (backgroundWidth - width) / 2;\n    const expandY = (backgroundHeight - height) / 2;\n    (this._AABBBounds as any).expand([0, expandX * 2, expandY * 2, 0]);\n\n    return this._AABBBounds;\n  }\n\n  setHoverState(hovered: boolean) {\n    if (this.attribute.backgroundShowMode === 'hover' && this._hovered !== hovered) {\n      this._hovered = hovered;\n    }\n  }\n}\n"]}