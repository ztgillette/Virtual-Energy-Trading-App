{"version":3,"sources":["../src/graphic/group.ts"],"names":[],"mappings":"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","file":"group.js","sourcesContent":["import type { IAABBBounds, Matrix } from '@visactor/vutils';\n// eslint-disable-next-line no-duplicate-imports\nimport { Point } from '@visactor/vutils';\nimport { application } from '../application';\nimport type {\n  IStage,\n  GraphicAttributeMap,\n  INode,\n  IGraphic,\n  ITheme,\n  IThemeSpec,\n  ILayer,\n  GraphicType\n} from '../interface';\nimport type { IGroup, IGroupGraphicAttribute } from '../interface/graphic/group';\nimport { Graphic, NOWORK_ANIMATE_ATTR } from './graphic';\nimport { getTheme, Theme } from './theme';\nimport { UpdateTag, IContainPointMode } from '../common/enums';\nimport { GROUP_NUMBER_TYPE } from './constants';\nimport { DefaultTransform } from './config';\n\n// Group更新AABBBounds的策略\nexport enum GroupUpdateAABBBoundsMode {\n  // Group较少的情况，不会批量设置所有父层的tag，而是每次都查找\n  LESS_GROUP = 0,\n  // Group较多的情况，每次都会设置tag到最顶层\n  MORE_GROUP = 1\n}\n\nexport class Group extends Graphic<IGroupGraphicAttribute> implements IGroup {\n  type: GraphicType = 'group';\n  parent: any = null;\n  isContainer: boolean = true;\n  // 子元素的更新标记\n  declare _childUpdateTag: number;\n\n  declare theme?: ITheme;\n\n  static NOWORK_ANIMATE_ATTR = NOWORK_ANIMATE_ATTR;\n\n  constructor(params: IGroupGraphicAttribute) {\n    super(params);\n    this.numberType = GROUP_NUMBER_TYPE;\n    this._childUpdateTag = UpdateTag.UPDATE_BOUNDS;\n    // this.theme = new Theme();\n  }\n\n  setMode(mode: '2d' | '3d') {\n    mode === '3d' ? this.set3dMode() : this.set2dMode();\n  }\n\n  set3dMode() {\n    this.in3dMode = true;\n    // this.forEachChildren((c: IGraphic) => {\n    //   c.setMode('3d');\n    // });\n  }\n  set2dMode() {\n    this.in3dMode = false;\n    // this.forEachChildren((c: IGraphic) => {\n    //   c.setMode('2d');\n    // });\n  }\n\n  setTheme(t: IThemeSpec) {\n    if (!this.theme) {\n      this.theme = new Theme();\n    }\n    return this.theme.setTheme(t, this);\n  }\n\n  createTheme() {\n    if (!this.theme) {\n      this.theme = new Theme();\n    }\n  }\n\n  visibleAll(visible: boolean) {\n    this.setAttribute('visible', visible);\n    this.forEachChildren((item: IGraphic) => {\n      if (item.isContainer && (item as any).visibleAll) {\n        (item as any).visibleAll(visible);\n      } else {\n        item.setAttribute('visible', visible);\n      }\n    });\n  }\n\n  hideAll() {\n    this.visibleAll(false);\n  }\n\n  showAll() {\n    this.visibleAll(true);\n  }\n\n  /**\n   * 是否包含某个点（点需要是全局坐标系）\n   * group containsPoint 只需要判断bounds\n   * TODO: group的shape判断\n   * @param x\n   * @param y\n   * @param mode\n   * @returns\n   */\n  containsPoint(x: number, y: number, mode: IContainPointMode): boolean {\n    if (mode === IContainPointMode.GLOBAL) {\n      // 转换x，y更精准\n      const point = new Point(x, y);\n      if (this.parent) {\n        this.parent.globalTransMatrix.transformPoint(point, point);\n      }\n      return this.AABBBounds.contains(point.x, point.y);\n    }\n    return this.AABBBounds.contains(x, y);\n  }\n\n  shouldUpdateAABBBounds(): boolean {\n    // 检索自己是否需要更新\n    if (super.shouldUpdateAABBBounds()) {\n      return true;\n    }\n    // 检索叶子节点是否有更新（如果children是叶子节点的话）\n    if (this._childUpdateTag & UpdateTag.UPDATE_BOUNDS) {\n      return true;\n    }\n    return false;\n    // // 检索是否子group需要更新\n    // let needUpdate = false;\n    // this.forEachChildren((node: IGraphic) => {\n    //   // 只查找group层级\n    //   if (node.isContainer && (node as Group).shouldUpdateAABBBounds()) {\n    //     needUpdate = true;\n    //     return true;\n    //   }\n    //   return false;\n    // });\n    // return needUpdate;\n  }\n\n  protected tryUpdateAABBBounds(): IAABBBounds {\n    if (!this.shouldUpdateAABBBounds()) {\n      return this._AABBBounds;\n    }\n    this.getGraphicService().beforeUpdateAABBBounds(this, this.stage, true, this._AABBBounds);\n    const selfChange = this.shouldSelfChangeUpdateAABBBounds();\n    const bounds = this.doUpdateAABBBounds();\n    this.addUpdateLayoutTag();\n    this.getGraphicService().afterUpdateAABBBounds(this, this.stage, this._AABBBounds, this, selfChange);\n    // 直接返回空Bounds，但是前面的流程还是要走\n    if (this.attribute.boundsMode === 'empty') {\n      bounds.clear();\n    }\n    return bounds;\n  }\n\n  /**\n   * 大部分group不需要更新matrix，这里特殊优化一下\n   * 更新局部matrix的具体函数\n   */\n  protected doUpdateLocalMatrix() {\n    const {\n      x = DefaultTransform.x,\n      y = DefaultTransform.y,\n      dx = DefaultTransform.dx,\n      dy = DefaultTransform.dy,\n      scaleX = DefaultTransform.scaleX,\n      scaleY = DefaultTransform.scaleY,\n      angle = DefaultTransform.angle,\n      postMatrix\n    } = this.attribute;\n    if (x === 0 && y === 0 && dx === 0 && dy === 0 && scaleX === 1 && scaleY === 1 && angle === 0 && !postMatrix) {\n      this._transMatrix.reset();\n      return;\n    }\n    return super.doUpdateLocalMatrix();\n  }\n\n  getGraphicTheme(): Required<IGroupGraphicAttribute> {\n    return getTheme(this).group;\n  }\n\n  protected updateAABBBounds(\n    attribute: IGroupGraphicAttribute,\n    groupTheme: Required<IGroupGraphicAttribute>,\n    aabbBounds: IAABBBounds\n  ) {\n    const originalAABBBounds = aabbBounds; // fix aabbbounds update error in flex layout\n    aabbBounds = aabbBounds.clone();\n\n    const { width, height, path, clip = groupTheme.clip } = attribute;\n    // 添加自身的fill或者clip\n    if (path && path.length) {\n      path.forEach(g => {\n        aabbBounds.union(g.AABBBounds);\n      });\n    } else if (width != null && height != null) {\n      aabbBounds.set(0, 0, Math.max(0, width), Math.max(0, height)); // fix bounds set when auto size in vtable\n    }\n    if (!clip) {\n      // 添加子节点\n      this.forEachChildren((node: IGraphic) => {\n        aabbBounds.union(node.AABBBounds);\n      });\n      // 如果没有clip的话，还需要加一下scroll\n      const { scrollX = 0, scrollY = 0 } = attribute;\n      aabbBounds.translate(scrollX, scrollY);\n    }\n    application.graphicService.updateTempAABBBounds(aabbBounds);\n\n    application.graphicService.transformAABBBounds(attribute, aabbBounds, groupTheme, false, this);\n\n    originalAABBBounds.copy(aabbBounds);\n    return originalAABBBounds;\n  }\n\n  protected doUpdateAABBBounds(): IAABBBounds {\n    this.updateAABBBoundsStamp++;\n    const bounds = super.doUpdateAABBBounds();\n\n    // 更新bounds之后需要设置父节点，否则tag丢失\n    this.parent && this.parent.addChildUpdateBoundTag();\n    this._emitCustomEvent('AAABBBoundsChange');\n\n    return bounds;\n  }\n\n  protected clearUpdateBoundTag() {\n    this._updateTag &= UpdateTag.CLEAR_BOUNDS;\n    this._childUpdateTag &= UpdateTag.CLEAR_BOUNDS;\n  }\n\n  addUpdateBoundTag() {\n    this._updateTag |= UpdateTag.UPDATE_BOUNDS; // for bounds\n    if (this.parent) {\n      this.parent.addChildUpdateBoundTag();\n    }\n  }\n\n  addChildUpdateBoundTag() {\n    // 如果已经设置过updateTag，那就不需要设置了\n    if (this._childUpdateTag & UpdateTag.UPDATE_BOUNDS) {\n      return;\n    }\n    // 如果没有设置过，那么继续向上设置\n    this._childUpdateTag |= UpdateTag.UPDATE_BOUNDS;\n    this.parent && this.parent.addChildUpdateBoundTag();\n  }\n\n  getTheme() {\n    return this.theme.getTheme(this);\n  }\n\n  /* 场景树结构 */\n  incrementalAppendChild(node: INode): INode | null {\n    const data = super.appendChild(node);\n    if (this.stage && data) {\n      (data as unknown as this).stage = this.stage;\n      (data as unknown as this).layer = this.layer;\n    }\n    this.addUpdateBoundTag();\n    this.getGraphicService().onAddIncremental(node as unknown as IGraphic, this, this.stage);\n    return data;\n  }\n  incrementalClearChild(): void {\n    super.removeAllChild();\n    this.addUpdateBoundTag();\n    this.getGraphicService().onClearIncremental(this, this.stage);\n    return;\n  }\n\n  protected _updateChildToStage(child: IGraphic) {\n    if (this.stage && child) {\n      child.setStage(this.stage, this.layer);\n    }\n    this.addUpdateBoundTag();\n    return child;\n  }\n  // TODO 代码优化\n  appendChild(node: INode, addStage: boolean = true): INode | null {\n    const data = super.appendChild(node);\n    if (addStage && this.stage && data) {\n      (data as unknown as this).setStage(this.stage, this.layer);\n    }\n    this.addUpdateBoundTag();\n    return data;\n  }\n  insertBefore(newNode: INode, referenceNode: INode): INode | null {\n    return this._updateChildToStage(super.insertBefore(newNode, referenceNode) as undefined as IGraphic);\n  }\n  insertAfter(newNode: INode, referenceNode: INode): INode | null {\n    return this._updateChildToStage(super.insertAfter(newNode, referenceNode) as undefined as IGraphic);\n  }\n  insertInto(newNode: INode, idx: number): INode | null {\n    return this._updateChildToStage(super.insertInto(newNode, idx) as undefined as IGraphic);\n  }\n\n  removeChild(child: IGraphic): IGraphic {\n    const data = super.removeChild(child);\n    this.getGraphicService().onRemove(child);\n    child.stage = null;\n    this.addUpdateBoundTag();\n    return data as IGraphic;\n  }\n\n  removeAllChild(deep: boolean = false): void {\n    this.forEachChildren((child: IGraphic) => {\n      this.getGraphicService().onRemove(child);\n      if (deep && child.isContainer) {\n        child.removeAllChild(deep);\n      }\n    });\n    super.removeAllChild();\n    this.addUpdateBoundTag();\n  }\n\n  setStage(stage?: IStage, layer?: ILayer) {\n    if (this.stage !== stage) {\n      this.stage = stage;\n      this.layer = layer;\n      this.setStageToShadowRoot(stage, layer);\n      this._onSetStage && this._onSetStage(this, stage, layer);\n      this.getGraphicService().onSetStage(this, stage);\n      this.forEachChildren(item => {\n        (item as any).setStage(stage, this.layer);\n      });\n    }\n  }\n  /**\n   * 更新位置tag，包括全局tag和局部tag\n   */\n  addUpdatePositionTag() {\n    super.addUpdatePositionTag();\n    // 批量设置底层group的global tag\n    this.forEachChildren((g: Group) => {\n      if (g.isContainer) {\n        g.addUpdateGlobalPositionTag();\n      }\n    });\n  }\n  /**\n   * 更新全局位置tag\n   */\n  addUpdateGlobalPositionTag() {\n    super.addUpdateGlobalPositionTag();\n    // 批量设置底层group的global tag\n    this.forEachChildren((g: Group) => {\n      if (g.isContainer) {\n        g.addUpdateGlobalPositionTag();\n      }\n    });\n  }\n  /**\n   * group更新全局的transMatrix\n   * @param clearTag\n   * @returns\n   */\n  protected tryUpdateGlobalTransMatrix(clearTag: boolean = true): Matrix {\n    if (this.shouldUpdateGlobalMatrix()) {\n      if (!this._globalTransMatrix) {\n        this._globalTransMatrix = this.parent\n          ? (this.parent as IGroup).globalTransMatrix.clone()\n          : this.transMatrix.clone();\n      } else if (this.parent) {\n        const m = (this.parent as IGroup).globalTransMatrix;\n        this._globalTransMatrix.setValue(m.a, m.b, m.c, m.d, m.e, m.f);\n      }\n      this.doUpdateGlobalMatrix();\n      clearTag && this.clearUpdateGlobalPositionTag();\n    }\n    return this._globalTransMatrix;\n  }\n  /**\n   * 查找自身更新global的tag，如果存在，就更新\n   * @returns\n   */\n  shouldUpdateGlobalMatrix(): boolean {\n    const shouldUpdate = !!(this._updateTag & UpdateTag.UPDATE_GLOBAL_MATRIX);\n    return shouldUpdate;\n  }\n\n  private _getChildByName<T extends INode = INode>(name: string, deep?: boolean): T | null {\n    return this.find(node => node.name === name, deep);\n  }\n\n  /**\n   * if graphic exist then update attributes, otherwise create a new instance\n   * @param graphicName the name of graphic\n   * @param attributes the attributes of graphic\n   * @param graphicType the type of graphic\n   * @returns the graphic instance\n   */\n  createOrUpdateChild<T extends keyof GraphicAttributeMap>(\n    graphicName: string,\n    attributes: GraphicAttributeMap[T],\n    graphicType: T\n  ): INode {\n    let graphic = this._getChildByName(graphicName) as IGraphic;\n    if (graphic) {\n      graphic.setAttributes(attributes);\n    } else {\n      graphic = application.graphicService.creator[graphicType](attributes as any);\n      graphic.name = graphicName;\n      this.add(graphic);\n    }\n\n    return graphic;\n  }\n\n  clone() {\n    return new Group({ ...this.attribute });\n  }\n\n  getNoWorkAnimateAttr(): Record<string, number> {\n    return Group.NOWORK_ANIMATE_ATTR;\n  }\n\n  release(all?: boolean) {\n    if (all) {\n      this.forEachChildren((g: IGraphic) => {\n        g.release(all);\n      });\n    }\n    super.release();\n  }\n}\n\nexport function createGroup(attributes: IGroupGraphicAttribute): IGroup {\n  return new Group(attributes);\n}\n"]}