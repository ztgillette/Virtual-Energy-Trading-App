{"version":3,"sources":["../src/graphic/graphic.ts"],"names":[],"mappings":"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","file":"graphic.js","sourcesContent":["import type { ICustomPath2D } from './../interface/path';\nimport type { Dict, IPointLike, IAABBBounds, IOBBBounds } from '@visactor/vutils';\nimport { isArray, max, OBBBounds } from '@visactor/vutils';\nimport {\n  AABBBounds,\n  Matrix,\n  normalTransform,\n  Point,\n  isNil,\n  has,\n  isString,\n  isValidUrl,\n  isBase64,\n  isObject\n} from '@visactor/vutils';\nimport type {\n  GraphicType,\n  IAnimateConfig,\n  IGraphicAttribute,\n  IGraphic,\n  IGraphicAnimateParams,\n  IGraphicJson,\n  ISetAttributeContext,\n  ITransform,\n  GraphicReleaseStatus\n} from '../interface/graphic';\nimport { Node } from './node-tree';\nimport type {\n  IAnimate,\n  IAnimateTarget,\n  IGlyphGraphicAttribute,\n  IGroup,\n  ILayer,\n  IPickerService,\n  IShadowRoot,\n  IStage,\n  IStep,\n  ISymbolClass\n} from '../interface';\nimport { EventTarget, CustomEvent } from '../event';\nimport { DefaultTransform } from './config';\nimport { application } from '../application';\nimport { interpolateColor } from '../color-string/interpolate';\nimport { CustomPath2D } from '../common/custom-path2d';\nimport { ResourceLoader } from '../resource-loader/loader';\nimport { AttributeUpdateType, IContainPointMode, UpdateTag } from '../common/enums';\nimport { BoundsContext } from '../common/bounds-context';\nimport { renderCommandList } from '../common/render-command-list';\nimport { parsePadding } from '../common/utils';\nimport { builtinSymbolsMap, builtInSymbolStrMap, CustomSymbolClass } from './builtin-symbol';\nimport { isSvg, XMLParser } from '../common/xml';\nimport { SVG_PARSE_ATTRIBUTE_MAP, SVG_PARSE_ATTRIBUTE_MAP_KEYS } from './constants';\nimport { DefaultStateAnimateConfig } from '../animate/config';\nimport { EmptyContext2d } from '../canvas';\n\nconst _tempBounds = new AABBBounds();\n/**\n * pathProxy参考自zrender\n * BSD 3-Clause License\n\n  Copyright (c) 2017, Baidu Inc.\n  All rights reserved.\n\n  Redistribution and use in source and binary forms, with or without\n  modification, are permitted provided that the following conditions are met:\n\n  * Redistributions of source code must retain the above copyright notice, this\n    list of conditions and the following disclaimer.\n\n  * Redistributions in binary form must reproduce the above copyright notice,\n    this list of conditions and the following disclaimer in the documentation\n    and/or other materials provided with the distribution.\n\n  * Neither the name of the copyright holder nor the names of its\n    contributors may be used to endorse or promote products derived from\n    this software without specific prior written permission.\n\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nconst tempMatrix = new Matrix();\nconst tempBounds = new AABBBounds();\n\nexport const PURE_STYLE_KEY = [\n  'stroke',\n  'opacity',\n  'strokeOpacity',\n  'lineDash',\n  'lineDashOffset',\n  'lineCap',\n  'lineJoin',\n  'miterLimit',\n  'fill',\n  'fillOpacity'\n];\n\nexport const GRAPHIC_UPDATE_TAG_KEY = [\n  'lineWidth',\n  // 'lineCap',\n  // 'lineJoin',\n  // 'miterLimit',\n  'scaleX',\n  'scaleY',\n  'angle',\n  'anchor',\n  'visible'\n];\n\nconst tempConstantXYKey = ['x', 'y'];\nconst tempConstantScaleXYKey = ['scaleX', 'scaleY'];\nconst tempConstantAngleKey = ['angle'];\n\nconst point = new Point();\n\nexport const NOWORK_ANIMATE_ATTR = {\n  strokeSeg: 1,\n  boundsPadding: 2,\n  pickMode: 1,\n  boundsMode: 1,\n  customPickShape: 1,\n  pickable: 1,\n  childrenPickable: 1,\n  visible: 1,\n  zIndex: 1,\n  layout: 1,\n  keepDirIn3d: 1,\n  globalZIndex: 1,\n\n  outerBorder: 1,\n  innerBorder: 1,\n  lineDash: 1,\n  lineCap: 1,\n  lineJoin: 1,\n  miterLimit: 2,\n  strokeBoundsBuffer: 2,\n\n  scaleCenter: 1,\n  anchor: 1,\n  anchor3d: 1,\n  postMatrix: 1,\n\n  backgroundMode: 2,\n  background: 1,\n  texture: 1,\n  cursor: 1,\n  html: 1\n};\n\n// function createTrackableObject(obj: any) {\n//   // const accessedProperties = new Set(); // 记录被读取的属性\n//   // const modifiedProperties = new Set(); // 记录被设置/修改的属性\n\n//   const handler = {\n//     get(target: any, property: any) {\n//       // accessedProperties.add(property); // 记录读取操作\n//       return Reflect.get(target, property);\n//     },\n//     set(target: any, property: any, value: any) {\n//       if (property === 'size' && !isFinite(value)) {\n//         console.log('set', property, value);\n//       }\n//       // modifiedProperties.add(property); // 记录设置/修改操作\n//       return Reflect.set(target, property, value);\n//     }\n//   };\n\n//   const proxy = new Proxy(obj, handler);\n\n//   // 提供方法获取被追踪的属性\n//   // proxy.getAccessedProperties = () => [...accessedProperties];\n//   // proxy.getModifiedProperties = () => [...modifiedProperties];\n\n//   return proxy;\n// }\n\n/**\n * globalTransMatrix更新逻辑\n * 1. group的transform修改，会下发到所有下层group，将所有下层的tag修改\n * 2. 叶子graphic每次获取globalTransMatrix都重新计算\n * 3. 所有节点的transform修改，或者globalTransform修改，都会下发到自己的shadowRoot上\n */\n\nexport abstract class Graphic<T extends Partial<IGraphicAttribute> = Partial<IGraphicAttribute>>\n  extends Node\n  implements IGraphic<T>, IAnimateTarget\n{\n  /**\n   * Mixes all enumerable properties and methods from a source object to Element.\n   * @param source - The source of properties and methods to mix in.\n   */\n  static mixin(source: Dict<any>): void {\n    // in ES8/ES2017, this would be really easy:\n    // Object.defineProperties(Element.prototype, Object.getOwnPropertyDescriptors(source));\n\n    // get all the enumerable property keys\n    const keys = Object.keys(source);\n\n    // loop through properties\n    for (let i = 0; i < keys.length; ++i) {\n      const propertyName = keys[i];\n\n      // Set the property using the property descriptor - this works for accessors and normal value properties\n      Object.defineProperty(\n        Graphic.prototype,\n        propertyName,\n        Object.getOwnPropertyDescriptor(source, propertyName) as PropertyDecorator\n      );\n    }\n  }\n\n  declare _events?: any;\n\n  // 保存语法上下文\n  declare context?: Record<string, any>;\n\n  static userSymbolMap: Record<string, ISymbolClass> = {};\n\n  declare onBeforeAttributeUpdate?: (\n    val: any,\n    attributes: Partial<T>,\n    key: null | string | string[],\n    context?: ISetAttributeContext\n  ) => T | undefined;\n  declare parent: any;\n\n  declare resources?: Map<\n    string | HTMLImageElement | HTMLCanvasElement,\n    { state: 'init' | 'loading' | 'success' | 'fail'; data?: HTMLImageElement | HTMLCanvasElement }\n  >;\n  declare backgroundImg?: boolean;\n\n  declare type: GraphicType;\n  declare prefixed: string;\n  declare numberType: number;\n  declare isContainer?: boolean;\n  declare valid: boolean;\n  declare stage?: IStage;\n  declare layer?: ILayer;\n  declare incremental?: number;\n  declare glyphHost?: IGraphic<IGlyphGraphicAttribute>;\n  declare _onSetStage?: (g: IGraphic, stage: IStage, layer: ILayer) => void;\n  // declare _beforeAttributeUpdate?: (key: string | string, value: any) => void;\n  // 标记是否是在3d模式下\n  declare in3dMode?: boolean;\n\n  // 不考虑transform的宽高，特殊情况下会使用到\n  declare widthWithoutTransform?: number;\n  declare heightWithoutTransform?: number;\n  declare x1WithoutTransform?: number;\n  declare y1WithoutTransform?: number;\n\n  // aabbBounds，所有图形都需要有，所以初始化即赋值\n  protected declare _AABBBounds: IAABBBounds;\n  get AABBBounds(): IAABBBounds {\n    return this.tryUpdateAABBBounds();\n  }\n  // 具有旋转的包围盒，部分图元需要，动态初始化\n  protected declare _OBBBounds?: IOBBBounds;\n  get OBBBounds(): IOBBBounds {\n    return this.tryUpdateOBBBounds();\n  }\n  protected declare _globalAABBBounds: IAABBBounds;\n  // 全局包围盒，部分图元需要，动态初始化，建议使用AABBBounds\n  get globalAABBBounds(): IAABBBounds {\n    return this.tryUpdateGlobalAABBBounds();\n  }\n  protected declare _transMatrix: Matrix;\n  get transMatrix(): Matrix {\n    return this.tryUpdateLocalTransMatrix(true);\n  }\n  protected declare _globalTransMatrix: Matrix;\n  get globalTransMatrix(): Matrix {\n    return this.tryUpdateGlobalTransMatrix(true);\n  }\n  protected declare _updateTag: number;\n\n  // 上次更新的stamp\n  declare stamp?: number;\n\n  declare attribute: T;\n\n  declare shadowRoot?: IShadowRoot;\n\n  declare releaseStatus?: GraphicReleaseStatus;\n\n  /** 记录state对应的图形属性 */\n  declare states?: Record<string, Partial<T>>;\n  /** 当前state值 */\n  declare currentStates?: string[];\n  /** TODO: state更新对应的动画配置 */\n  declare stateAnimateConfig?: IAnimateConfig;\n  /** 记录应用state之前，attribute对应的原始图形属性 */\n  declare normalAttrs?: Partial<T>;\n  /** 获取state图形属性的方法 */\n  declare stateProxy?: (stateName: string, targetStates?: string[]) => T;\n  declare animates: Map<string | number, IAnimate>;\n\n  declare animate?: () => IAnimate;\n\n  // declare nextAttrs?: T;\n  // declare prevAttrs?: T;\n  // declare finalAttrs?: T;\n\n  declare pathProxy?: ICustomPath2D;\n  // 依附于某个theme，如果该节点不存在parent，那么这个Theme就作为节点的Theme，避免添加到节点前计算属性\n  declare attachedThemeGraphic?: IGraphic;\n  protected updateAABBBoundsStamp: number;\n  protected updateOBBBoundsStamp?: number;\n  declare clipPathMap?: Map<string, ISymbolClass>;\n\n  constructor(params: T = {} as T) {\n    super();\n    this._AABBBounds = new AABBBounds();\n    this._updateTag = UpdateTag.INIT;\n    this.attribute = params;\n    this.valid = this.isValid();\n    this.updateAABBBoundsStamp = 0;\n    if (params.background) {\n      this.loadImage((params.background as any).background ?? params.background, true);\n    } else if (params.shadowGraphic) {\n      this.setShadowGraphic(params.shadowGraphic);\n    }\n    // this.attribute = createTrackableObject(this.attribute);\n  }\n\n  getGraphicService() {\n    return this.stage?.graphicService ?? application.graphicService;\n  }\n\n  getAttributes(): T {\n    return this.attribute;\n  }\n\n  setMode(mode: '2d' | '3d') {\n    mode === '3d' ? this.set3dMode() : this.set2dMode();\n  }\n\n  set3dMode() {\n    this.in3dMode = true;\n  }\n  set2dMode() {\n    this.in3dMode = false;\n  }\n  getOffsetXY(attr?: ITransform, includeScroll: boolean = false) {\n    const { dx = attr.dx, dy = attr.dy } = this.attribute;\n    if (includeScroll && this.parent) {\n      // const groupTheme = getTheme(this.parent).group;\n      const attribute = this.parent.attribute;\n      point.x = dx + (attribute.scrollX ?? 0);\n      point.y = dy + (attribute.scrollY ?? 0);\n    } else {\n      point.x = dx;\n      point.y = dy;\n    }\n    return point;\n  }\n\n  onAnimateBind(animate: IAnimate) {\n    this._emitCustomEvent('animate-bind', animate);\n  }\n\n  protected tryUpdateAABBBounds(): IAABBBounds {\n    const full = this.attribute.boundsMode === 'imprecise';\n    if (!this.shouldUpdateAABBBounds()) {\n      return this._AABBBounds;\n    }\n    if (!this.valid) {\n      this._AABBBounds.clear();\n      return this._AABBBounds;\n    }\n\n    this.getGraphicService().beforeUpdateAABBBounds(this, this.stage, true, this._AABBBounds);\n    const bounds = this.doUpdateAABBBounds(full);\n    // this.addUpdateLayoutTag();\n    this.getGraphicService().afterUpdateAABBBounds(this, this.stage, this._AABBBounds, this, true);\n\n    // 直接返回空Bounds，但是前面的流程还是要走\n    if (this.attribute.boundsMode === 'empty') {\n      bounds.clear();\n    }\n    return bounds;\n  }\n\n  protected tryUpdateOBBBounds(): IOBBBounds {\n    if (!this._OBBBounds) {\n      this._OBBBounds = new OBBBounds();\n    }\n    // 尝试更新AABBBounds\n    this.tryUpdateAABBBounds();\n    // 如果AABBBounds和OBBBounds不一致，则重新计算OBBBounds\n    if (this.updateOBBBoundsStamp === this.updateAABBBoundsStamp) {\n      return this._OBBBounds;\n    }\n    this.updateOBBBoundsStamp = this.updateAABBBoundsStamp;\n    if (!this.valid) {\n      this._OBBBounds.clear();\n      return this._OBBBounds;\n    }\n\n    const bounds = this.doUpdateOBBBounds();\n    return bounds;\n  }\n\n  protected combindShadowAABBBounds(bounds: IAABBBounds) {\n    // 合并shadowRoot的Bounds\n    if (this.shadowRoot) {\n      const b = this.shadowRoot.AABBBounds.clone();\n      bounds.union(b);\n    }\n  }\n\n  abstract getGraphicTheme(): T;\n\n  protected doUpdateOBBBounds(): IOBBBounds {\n    return this._OBBBounds;\n  }\n\n  protected abstract updateAABBBounds(\n    attribute: T,\n    symbolTheme: Required<T>,\n    aabbBounds: IAABBBounds,\n    full?: boolean\n  ): IAABBBounds;\n\n  getClipPath() {\n    const { clipConfig } = this.attribute;\n    if (!clipConfig) {\n      return null;\n    }\n    if (!this.clipPathMap) {\n      this.clipPathMap = new Map();\n    }\n\n    const { shape } = clipConfig;\n    let path = this.clipPathMap.get(shape) || null;\n    if (!path) {\n      // 即使清理，避免内存溢出\n      if (this.clipPathMap.size > 10) {\n        this.clipPathMap.clear();\n      }\n      path = this.parsePath(shape);\n      path && this.clipPathMap.set(shape, path);\n    }\n    return path;\n  }\n\n  parsePath(symbolType: string) {\n    if (!symbolType) {\n      return null;\n    }\n    let path = builtinSymbolsMap[symbolType];\n    if (path) {\n      return path;\n    }\n    path = Graphic.userSymbolMap[symbolType];\n    if (path) {\n      return path;\n    }\n    const _symbolType = builtInSymbolStrMap[symbolType];\n    symbolType = _symbolType || symbolType;\n    const valid = isSvg(symbolType);\n    if (valid === true) {\n      const parser = new XMLParser();\n      const { svg } = parser.parse(symbolType);\n      if (!svg) {\n        return null;\n      }\n      const path = isArray(svg.path) ? svg.path : [svg.path];\n      _tempBounds.clear();\n      const cacheList: { path: CustomPath2D; attribute: Record<string, any> }[] = [];\n      path.forEach((item: any) => {\n        const cache = new CustomPath2D().fromString(item.d);\n        const attribute: any = {};\n        SVG_PARSE_ATTRIBUTE_MAP_KEYS.forEach(k => {\n          if (item[k]) {\n            (attribute as any)[(SVG_PARSE_ATTRIBUTE_MAP as any)[k]] = item[k];\n          }\n        });\n        // 查找\n        cacheList.push({\n          path: cache,\n          attribute\n        });\n        _tempBounds.union(cache.bounds);\n      });\n      const width = _tempBounds.width();\n      const height = _tempBounds.height();\n      // 规范化到1\n      const maxWH = max(width, height);\n      const scale = 1 / maxWH;\n      cacheList.forEach(cache => cache.path.transform(0, 0, scale, scale));\n\n      const _parsedPath = new CustomSymbolClass(symbolType, cacheList, true);\n      Graphic.userSymbolMap[symbolType] = _parsedPath;\n      return _parsedPath;\n    }\n\n    const cache = new CustomPath2D().fromString(symbolType);\n    const width = cache.bounds.width();\n    const height = cache.bounds.height();\n    // 规范化到1\n    const maxWH = max(width, height);\n    const scale = 1 / maxWH;\n    cache.transform(0, 0, scale, scale);\n    const _parsedPath = new CustomSymbolClass(symbolType, cache);\n    Graphic.userSymbolMap[symbolType] = _parsedPath;\n    return _parsedPath;\n  }\n\n  protected doUpdateAABBBounds(full?: boolean): IAABBBounds {\n    this.updateAABBBoundsStamp++;\n    const graphicTheme = this.getGraphicTheme();\n    this._AABBBounds.clear();\n    const attribute = this.attribute;\n    const bounds = this.updateAABBBounds(attribute, graphicTheme as Required<T>, this._AABBBounds, full) as AABBBounds;\n\n    const { boundsPadding = graphicTheme.boundsPadding } = attribute;\n    const paddingArray = parsePadding(boundsPadding);\n    if (paddingArray) {\n      bounds.expand(paddingArray);\n    }\n\n    this.clearUpdateBoundTag();\n    return bounds;\n  }\n\n  updatePathProxyAABBBounds(aabbBounds: IAABBBounds): boolean {\n    const path = typeof this.pathProxy === 'function' ? (this.pathProxy as any)(this.attribute) : this.pathProxy;\n    if (!path) {\n      return false;\n    }\n    const boundsContext = new BoundsContext(aabbBounds);\n    renderCommandList(path.commandList, boundsContext, 0, 0);\n    return true;\n  }\n\n  protected tryUpdateGlobalAABBBounds(): IAABBBounds {\n    const b = this.AABBBounds;\n    if (!this._globalAABBBounds) {\n      this._globalAABBBounds = b.clone();\n    } else {\n      this._globalAABBBounds.setValue(b.x1, b.y1, b.x2, b.y2);\n    }\n    if (this._globalAABBBounds.empty()) {\n      return this._globalAABBBounds;\n    }\n    // 使用parent的grloalAABBBounds\n    // todo: 考虑是否需要性能优化\n    if (this.parent) {\n      this._globalAABBBounds.transformWithMatrix((this.parent as IGroup).globalTransMatrix);\n    }\n    return this._globalAABBBounds;\n  }\n\n  /**\n   * 这里都是叶子节点的UpdateGlobalTransMatrix函数，只要走进来就直接计算\n   * @param clearTag\n   * @returns\n   */\n  protected tryUpdateGlobalTransMatrix(clearTag: boolean = true): Matrix {\n    if (!this._globalTransMatrix) {\n      this._globalTransMatrix = this.parent\n        ? (this.parent as IGroup).globalTransMatrix.clone()\n        : this.transMatrix.clone();\n    } else if (this.parent) {\n      const m = (this.parent as IGroup).globalTransMatrix;\n      this._globalTransMatrix.setValue(m.a, m.b, m.c, m.d, m.e, m.f);\n    }\n    if (this.shouldUpdateGlobalMatrix()) {\n      this.doUpdateGlobalMatrix();\n    }\n    return this._globalTransMatrix;\n  }\n\n  shouldUpdateGlobalMatrix(): boolean {\n    return true;\n  }\n\n  protected tryUpdateLocalTransMatrix(clearTag: boolean = true) {\n    if (!this._transMatrix) {\n      this._transMatrix = new Matrix();\n    }\n    if (this.shouldUpdateLocalMatrix()) {\n      this.doUpdateLocalMatrix();\n      clearTag && this.clearUpdateLocalPositionTag();\n    }\n    return this._transMatrix;\n  }\n\n  shouldUpdateAABBBounds(): boolean {\n    // 如果存在shadowRoot，那么判断shadowRoot是否需要更新\n    if (this.shadowRoot) {\n      return (\n        (!!(this._updateTag & UpdateTag.UPDATE_BOUNDS) || this.shadowRoot.shouldUpdateAABBBounds()) &&\n        this.getGraphicService().validCheck(\n          this.attribute,\n          this.getGraphicTheme() as Required<T>,\n          this._AABBBounds,\n          this\n        )\n      );\n    }\n    return (\n      !!(this._updateTag & UpdateTag.UPDATE_BOUNDS) &&\n      this.getGraphicService().validCheck(this.attribute, this.getGraphicTheme() as Required<T>, this._AABBBounds, this)\n    );\n  }\n\n  // 自身变化导致的AABBBounds的变化\n  shouldSelfChangeUpdateAABBBounds(): boolean {\n    // 如果存在shadowRoot，那么判断shadowRoot是否需要更新\n    if (this.shadowRoot) {\n      return !!(this._updateTag & UpdateTag.UPDATE_BOUNDS) || this.shadowRoot.shouldUpdateAABBBounds();\n    }\n    return !!(this._updateTag & UpdateTag.UPDATE_BOUNDS);\n  }\n\n  protected shouldUpdateLocalMatrix(): boolean {\n    return !!(this._updateTag & UpdateTag.UPDATE_LOCAL_MATRIX);\n  }\n\n  isValid(): boolean {\n    const attribute = this.attribute;\n    return Number.isFinite((attribute.x ?? 0) + (attribute.y ?? 0));\n  }\n\n  protected _validNumber(num?: number) {\n    return num == null || Number.isFinite(num);\n  }\n\n  shouldUpdateShape(): boolean {\n    return !!(this._updateTag & UpdateTag.UPDATE_SHAPE);\n  }\n  clearUpdateShapeTag() {\n    this._updateTag &= UpdateTag.CLEAR_SHAPE;\n  }\n\n  /**\n   * 是否包含某个点（点需要是全局坐标系）\n   * @param x\n   * @param y\n   * @param mode\n   * @returns\n   */\n  containsPoint(x: number, y: number, mode: IContainPointMode, picker?: IPickerService): boolean {\n    if (!picker) {\n      return false;\n    }\n    if (mode === IContainPointMode.GLOBAL) {\n      // 转换x，y更精准\n      const point = new Point(x, y);\n      if (this.parent) {\n        this.parent.globalTransMatrix.transformPoint(point, point);\n      }\n      x = point.x;\n      y = point.y;\n    }\n    return picker.containsPoint(this, { x, y });\n  }\n\n  protected setWidthHeightWithoutTransform(aabbBounds: IAABBBounds) {\n    this.widthWithoutTransform = aabbBounds.x2 - aabbBounds.x1;\n    this.heightWithoutTransform = aabbBounds.y2 - aabbBounds.y1;\n  }\n  setAttributesAndPreventAnimate(\n    params: Partial<T>,\n    forceUpdateTag: boolean = false,\n    context?: ISetAttributeContext,\n    ignorePriority?: boolean\n  ) {\n    this.setAttributes(params, forceUpdateTag, context);\n    this.animates &&\n      this.animates.forEach(animate => {\n        // 优先级最高的动画（一般是循环动画），不屏蔽\n        if (animate.priority === Infinity && !ignorePriority) {\n          return;\n        }\n        Object.keys(params).forEach(key => {\n          animate.preventAttr(key);\n        });\n      });\n  }\n\n  setAttributes(params: Partial<T>, forceUpdateTag: boolean = false, context?: ISetAttributeContext) {\n    if (!params) {\n      return;\n    }\n    params =\n      (this.onBeforeAttributeUpdate && this.onBeforeAttributeUpdate(params, this.attribute, null, context)) || params;\n\n    if (params.background) {\n      this.loadImage(params.background, true);\n    } else if (params.shadowGraphic) {\n      this.setShadowGraphic(params.shadowGraphic);\n    }\n    this._setAttributes(params, forceUpdateTag, context);\n  }\n\n  _setAttributes(params: Partial<T>, forceUpdateTag: boolean = false, context?: ISetAttributeContext) {\n    const keys = Object.keys(params);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n\n      (this.attribute as any)[key] = (params as any)[key];\n    }\n    this.valid = this.isValid();\n    // 没有设置shape&bounds的tag\n    if (!this.updateShapeAndBoundsTagSetted() && (forceUpdateTag || this.needUpdateTags(keys))) {\n      this.addUpdateShapeAndBoundsTag();\n    } else {\n      this.addUpdateBoundTag();\n    }\n    this.addUpdatePositionTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n  }\n\n  setAttribute(key: string, value: any, forceUpdateTag?: boolean, context?: ISetAttributeContext) {\n    const params =\n      this.onBeforeAttributeUpdate && this.onBeforeAttributeUpdate({ [key]: value }, this.attribute, key, context);\n    if (!params) {\n      if (!isNil((this.normalAttrs as any)?.[key])) {\n        (this.normalAttrs as any)[key] = value;\n      } else {\n        (this.attribute as any)[key] = value;\n        this.valid = this.isValid();\n        if (!this.updateShapeAndBoundsTagSetted() && (forceUpdateTag || this.needUpdateTag(key))) {\n          this.addUpdateShapeAndBoundsTag();\n        } else {\n          this.addUpdateBoundTag();\n        }\n        this.addUpdatePositionTag();\n        this.addUpdateLayoutTag();\n        this.onAttributeUpdate(context);\n      }\n    } else {\n      this._setAttributes(params, forceUpdateTag, context);\n    }\n    if (key === 'background') {\n      this.loadImage(value, true);\n    } else if (key === 'shadowGraphic') {\n      this.setShadowGraphic(value);\n    }\n  }\n\n  protected needUpdateTags(keys: string[], k: string[] = GRAPHIC_UPDATE_TAG_KEY): boolean {\n    for (let i = 0; i < k.length; i++) {\n      const attrKey = k[i];\n      if (keys.indexOf(attrKey) !== -1) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  protected needUpdateTag(key: string, k: string[] = GRAPHIC_UPDATE_TAG_KEY): boolean {\n    for (let i = 0; i < k.length; i++) {\n      const attrKey = k[i];\n      if (key === attrKey) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  initAttributes(params: T) {\n    // this.setAttributes(params, true);\n    const context = { type: AttributeUpdateType.INIT };\n    params =\n      (this.onBeforeAttributeUpdate && this.onBeforeAttributeUpdate(params, this.attribute, null, context)) || params;\n    this.attribute = params;\n    if (params.background) {\n      this.loadImage(params.background, true);\n    } else if (params.shadowGraphic) {\n      this.setShadowGraphic(params.shadowGraphic);\n    }\n    this._updateTag = UpdateTag.INIT;\n    this.valid = this.isValid();\n    this.onAttributeUpdate(context);\n  }\n\n  translate(x: number, y: number) {\n    if (x === 0 && y === 0) {\n      return this;\n    }\n    const context = {\n      type: AttributeUpdateType.TRANSLATE\n    };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate({ x, y }, this.attribute, tempConstantXYKey, context);\n    if (params) {\n      x = params.x;\n      y = params.y;\n      delete params.x;\n      delete params.y;\n      this._setAttributes(params);\n    }\n    const attribute = this.attribute;\n    const postMatrix = attribute.postMatrix;\n    if (!postMatrix) {\n      attribute.x = (attribute.x ?? DefaultTransform.x) + x;\n      attribute.y = (attribute.y ?? DefaultTransform.y) + y;\n    } else {\n      application.transformUtil.fromMatrix(postMatrix, postMatrix).translate(x, y);\n    }\n\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  translateTo(x: number, y: number) {\n    const attribute = this.attribute;\n    if (attribute.x === x && attribute.y === y) {\n      return this;\n    }\n    const context = {\n      type: AttributeUpdateType.TRANSLATE_TO\n    };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate({ x, y }, this.attribute, tempConstantXYKey, context);\n    if (params) {\n      this._setAttributes(params, false, context);\n      return this;\n    }\n    attribute.x = x;\n    attribute.y = y;\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  scale(scaleX: number, scaleY: number, scaleCenter?: IPointLike) {\n    if (scaleX === 1 && scaleY === 1) {\n      return this;\n    }\n    const context = {\n      type: AttributeUpdateType.SCALE\n    };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate({ scaleX, scaleY, scaleCenter }, this.attribute, tempConstantScaleXYKey, context);\n    if (params) {\n      scaleX = params.scaleX;\n      scaleY = params.scaleY;\n      delete params.scaleX;\n      delete params.scaleY;\n      this._setAttributes(params);\n    }\n    const attribute = this.attribute;\n    if (!scaleCenter) {\n      attribute.scaleX = (attribute.scaleX ?? DefaultTransform.scaleX) * scaleX;\n      attribute.scaleY = (attribute.scaleY ?? DefaultTransform.scaleY) * scaleY;\n    } else {\n      let { postMatrix } = this.attribute;\n      if (!postMatrix) {\n        postMatrix = new Matrix();\n        attribute.postMatrix = postMatrix;\n      }\n      application.transformUtil.fromMatrix(postMatrix, postMatrix).scale(scaleX, scaleY, scaleCenter);\n    }\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  scaleTo(scaleX: number, scaleY: number) {\n    const attribute = this.attribute;\n    if (attribute.scaleX === scaleX && attribute.scaleY === scaleY) {\n      return this;\n    }\n    const context = {\n      type: AttributeUpdateType.SCALE_TO\n    };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate({ scaleX, scaleY }, this.attribute, tempConstantScaleXYKey, context);\n    if (params) {\n      this._setAttributes(params, false, context);\n      return this;\n    }\n    attribute.scaleX = scaleX;\n    attribute.scaleY = scaleY;\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  rotate(angle: number, rotateCenter?: IPointLike) {\n    if (angle === 0) {\n      return this;\n    }\n    const context = { type: AttributeUpdateType.ROTATE };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate({ angle, rotateCenter }, this.attribute, tempConstantAngleKey, context);\n    if (params) {\n      delete params.angle;\n      this._setAttributes(params, false, context);\n      // return this;\n    }\n    const attribute = this.attribute;\n    if (!rotateCenter) {\n      attribute.angle = (attribute.angle ?? DefaultTransform.angle) + angle;\n    } else {\n      let { postMatrix } = this.attribute;\n      if (!postMatrix) {\n        postMatrix = new Matrix();\n        attribute.postMatrix = postMatrix;\n      }\n      application.transformUtil.fromMatrix(postMatrix, postMatrix).rotate(angle, rotateCenter);\n    }\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  rotateTo(angle: number) {\n    const attribute = this.attribute;\n    if (attribute.angle === angle) {\n      return this;\n    }\n    const context = {\n      type: AttributeUpdateType.ROTATE_TO\n    };\n    const params =\n      this.onBeforeAttributeUpdate &&\n      this.onBeforeAttributeUpdate(angle, this.attribute, tempConstantAngleKey, context);\n    if (params) {\n      this._setAttributes(params, false, context);\n      return this;\n    }\n    attribute.angle = angle;\n    this.addUpdatePositionTag();\n    this.addUpdateBoundTag();\n    this.addUpdateLayoutTag();\n    this.onAttributeUpdate(context);\n    return this;\n  }\n\n  skewTo(b: number, c: number) {\n    return this;\n  }\n\n  onAttributeUpdate(context?: ISetAttributeContext) {\n    if (context && context.skipUpdateCallback) {\n      return;\n    }\n    this.getGraphicService().onAttributeUpdate(this);\n    this._emitCustomEvent('afterAttributeUpdate', context);\n  }\n\n  // hasListener(event: string) {\n  //   const prefix = this.prefixed;\n  //   var evt = prefix ? prefix + event : event;\n  //   return this._events[evt];\n  // }\n\n  update(d?: { bounds: boolean; trans: boolean }) {\n    if (d) {\n      d.bounds && this.tryUpdateAABBBounds();\n      d.trans && this.tryUpdateLocalTransMatrix();\n    } else {\n      this.tryUpdateAABBBounds();\n      this.tryUpdateLocalTransMatrix();\n    }\n  }\n\n  hasState(stateName?: string) {\n    if (!this.currentStates || !this.currentStates.length) {\n      return false;\n    }\n\n    if (!isNil(stateName)) {\n      return this.currentStates.includes(stateName);\n    }\n\n    return true;\n  }\n  getState(stateName: string) {\n    return this.states?.[stateName];\n  }\n\n  applyStateAttrs(attrs: Partial<T>, stateNames: string[], hasAnimation?: boolean, isClear?: boolean) {\n    // 应用状态的时候要停掉动画\n    if (hasAnimation) {\n      const keys = Object.keys(attrs);\n      const noWorkAttrs = this.getNoWorkAnimateAttr();\n      const animateAttrs: Partial<T> = {};\n      let noAnimateAttrs: Partial<T> | undefined;\n\n      keys.forEach(key => {\n        if (!noWorkAttrs[key]) {\n          (animateAttrs as any)[key] =\n            isClear && (attrs as any)[key] === undefined ? this.getDefaultAttribute(key) : (attrs as any)[key];\n        } else {\n          if (!noAnimateAttrs) {\n            noAnimateAttrs = {};\n          }\n          (noAnimateAttrs as any)[key] = (attrs as any)[key];\n        }\n      });\n\n      const stateAnimateConfig =\n        (this.context && this.context.stateAnimateConfig) ?? this.stateAnimateConfig ?? DefaultStateAnimateConfig;\n      // 需要注册动画\n      (this as any).applyAnimationState(\n        ['state'],\n        [\n          {\n            name: 'state',\n            animation: {\n              type: 'state',\n              to: animateAttrs,\n              duration: stateAnimateConfig.duration,\n              easing: stateAnimateConfig.easing\n            }\n          }\n        ]\n      );\n      // const animate = (this.animate as any)({ slience: true });\n      // (animate as any).stateNames = stateNames;\n      // animate.to(animateAttrs, stateAnimateConfig.duration, stateAnimateConfig.easing);\n      noAnimateAttrs && this.setAttributesAndPreventAnimate(noAnimateAttrs, false, { type: AttributeUpdateType.STATE });\n      // Object.assign((this as any).finalAttribute, attrs);\n    } else {\n      this.stopStateAnimates();\n      this.setAttributesAndPreventAnimate(attrs, false, { type: AttributeUpdateType.STATE });\n      if ((this as any).finalAttribute) {\n        Object.assign((this as any).finalAttribute, attrs);\n      }\n    }\n\n    this._emitCustomEvent('afterStateUpdate', { type: AttributeUpdateType.STATE });\n  }\n\n  updateNormalAttrs(stateAttrs: Partial<T>) {\n    const newNormalAttrs = {};\n    if (this.normalAttrs) {\n      Object.keys(stateAttrs).forEach(key => {\n        if (key in this.normalAttrs) {\n          (newNormalAttrs as any)[key] = (this.normalAttrs as any)[key];\n          delete (this.normalAttrs as any)[key];\n        } else {\n          (newNormalAttrs as any)[key] = this.getNormalAttribute(key);\n        }\n      });\n      Object.keys(this.normalAttrs).forEach(key => {\n        (stateAttrs as any)[key] = (this.normalAttrs as any)[key];\n      });\n    } else {\n      Object.keys(stateAttrs).forEach(key => {\n        (newNormalAttrs as any)[key] = this.getNormalAttribute(key);\n      });\n    }\n\n    this.normalAttrs = newNormalAttrs;\n  }\n\n  protected stopStateAnimates(type: 'start' | 'end' = 'end') {\n    if (this.animates) {\n      this.animates.forEach(animate => {\n        if ((animate as any).stateNames) {\n          animate.stop(type);\n          this.animates.delete(animate.id);\n        }\n      });\n    }\n  }\n\n  private getNormalAttribute(key: string) {\n    const value = (this.attribute as any)[key];\n\n    if (this.animates) {\n      // this.animates.forEach(animate => {\n      //   if ((animate as any).stateNames) {\n      //     const endProps = animate.getEndProps();\n      //     if (has(endProps, key)) {\n      //       value = endProps[key];\n      //     }\n      //   }\n      // });\n      // console.log(this.finalAttrs);\n      return (this as any).finalAttribute?.[key];\n    }\n\n    return value ?? (this as any).finalAttribute?.[key];\n  }\n\n  clearStates(hasAnimation?: boolean) {\n    if (this.hasState() && this.normalAttrs) {\n      this.currentStates = [];\n      this.applyStateAttrs(this.normalAttrs, this.currentStates, hasAnimation, true);\n    } else {\n      this.currentStates = [];\n    }\n    this.normalAttrs = null;\n  }\n\n  removeState(stateName: string | string[], hasAnimation?: boolean) {\n    if (this.currentStates) {\n      const filter = isArray(stateName) ? (s: string) => !stateName.includes(s) : (s: string) => s !== stateName;\n      const newStates = this.currentStates.filter(filter);\n\n      if (newStates.length !== this.currentStates.length) {\n        this.useStates(newStates, hasAnimation);\n      }\n    }\n  }\n\n  toggleState(stateName: string, hasAnimation?: boolean) {\n    if (this.hasState(stateName)) {\n      this.removeState(stateName, hasAnimation);\n    } else {\n      const index = this.currentStates ? this.currentStates.indexOf(stateName) : -1;\n      if (index < 0) {\n        const nextStates = this.currentStates ? this.currentStates.slice() : [];\n        nextStates.push(stateName);\n        this.useStates(nextStates, hasAnimation);\n      }\n    }\n  }\n\n  addState(stateName: string, keepCurrentStates?: boolean, hasAnimation?: boolean) {\n    if (\n      this.currentStates &&\n      this.currentStates.includes(stateName) &&\n      (keepCurrentStates || this.currentStates.length === 1)\n    ) {\n      return;\n    }\n\n    const newStates =\n      keepCurrentStates && this.currentStates?.length ? this.currentStates.concat([stateName]) : [stateName];\n\n    this.useStates(newStates, hasAnimation);\n  }\n\n  useStates(states: string[], hasAnimation?: boolean) {\n    if (!states.length) {\n      this.clearStates(hasAnimation);\n      return;\n    }\n\n    const isChange =\n      this.currentStates?.length !== states.length ||\n      states.some((stateName, index) => this.currentStates[index] !== stateName);\n\n    if (!isChange) {\n      return;\n    }\n\n    const stateAttrs = {};\n    states.forEach(stateName => {\n      const attrs = this.stateProxy ? this.stateProxy(stateName, states) : this.states?.[stateName];\n\n      if (attrs) {\n        Object.assign(stateAttrs, attrs);\n      }\n    });\n\n    this.updateNormalAttrs(stateAttrs);\n\n    this.currentStates = states;\n    this.applyStateAttrs(stateAttrs, states, hasAnimation);\n  }\n\n  addUpdateBoundTag() {\n    this._updateTag |= UpdateTag.UPDATE_BOUNDS; // for bounds\n    if (this.parent) {\n      this.parent.addChildUpdateBoundTag();\n    }\n    if (this.glyphHost) {\n      this.glyphHost.addUpdateBoundTag();\n    }\n  }\n\n  addUpdateShapeTag() {\n    this._updateTag |= UpdateTag.UPDATE_SHAPE; // for shape\n  }\n\n  addUpdateShapeAndBoundsTag() {\n    this._updateTag |= UpdateTag.UPDATE_SHAPE_AND_BOUNDS; // for shape&bounds\n    if (this.parent) {\n      this.parent.addChildUpdateBoundTag();\n    }\n    if (this.glyphHost) {\n      this.glyphHost.addUpdateBoundTag();\n    }\n  }\n\n  protected updateShapeAndBoundsTagSetted(): boolean {\n    return (this._updateTag & UpdateTag.UPDATE_SHAPE_AND_BOUNDS) === UpdateTag.UPDATE_SHAPE_AND_BOUNDS;\n  }\n\n  protected clearUpdateBoundTag() {\n    this._updateTag &= UpdateTag.CLEAR_BOUNDS;\n  }\n  /**\n   * 更新位置tag，包括全局tag和局部tag\n   */\n  addUpdatePositionTag() {\n    // 更新shadowRoot的全局位置\n    this.shadowRoot && this.shadowRoot.addUpdateGlobalPositionTag();\n    this._updateTag |= UpdateTag.UPDATE_GLOBAL_LOCAL_MATRIX;\n  }\n  /**\n   * 更新全局位置tag\n   */\n  addUpdateGlobalPositionTag() {\n    // 更新shadowRoot的全局位置\n    this.shadowRoot && this.shadowRoot.addUpdateGlobalPositionTag();\n    this._updateTag |= UpdateTag.UPDATE_GLOBAL_MATRIX;\n  }\n  /**\n   * 清除局部位置tag\n   */\n  protected clearUpdateLocalPositionTag() {\n    this._updateTag &= UpdateTag.CLEAR_LOCAL_MATRIX;\n  }\n  /**\n   * 清除全局位置tag\n   */\n  protected clearUpdateGlobalPositionTag() {\n    this._updateTag &= UpdateTag.CLEAR_GLOBAL_MATRIX;\n  }\n\n  addUpdateLayoutTag() {\n    this._updateTag |= UpdateTag.UPDATE_LAYOUT;\n  }\n\n  protected clearUpdateLayoutTag() {\n    this._updateTag &= UpdateTag.CLEAR_LAYOUT;\n  }\n\n  protected needUpdateLayout(): boolean {\n    return !!(this._updateTag & UpdateTag.UPDATE_LAYOUT);\n  }\n\n  protected getAnchor(anchor: [string | number, string | number], params: { b?: IAABBBounds }, resetScale?: boolean) {\n    const _anchor: [number, number] = [0, 0];\n    const getBounds = () => {\n      if (params.b) {\n        return params.b;\n      }\n      // 拷贝一份，避免计算bounds的过程中计算matrix，然后matrix又修改了bounds\n      const graphic = this.clone();\n      graphic.attribute.angle = 0;\n      graphic.attribute.scaleCenter = null;\n      if (resetScale) {\n        graphic.attribute.scaleX = 1;\n        graphic.attribute.scaleY = 1;\n      }\n      // @ts-ignore\n      // this.setAttributes({ angle: 0, scaleCenter: null });\n      params.b = graphic.AABBBounds;\n\n      return params.b;\n    };\n    if (typeof anchor[0] === 'string') {\n      const ratio = parseFloat(anchor[0]) / 100;\n      const bounds = getBounds();\n      _anchor[0] = bounds.x1 + (bounds.x2 - bounds.x1) * ratio;\n    } else {\n      _anchor[0] = anchor[0];\n    }\n    if (typeof anchor[1] === 'string') {\n      const ratio = parseFloat(anchor[1]) / 100;\n      const bounds = getBounds();\n      _anchor[1] = bounds.y1 + (bounds.y2 - bounds.y1) * ratio;\n    } else {\n      _anchor[1] = anchor[1];\n    }\n\n    return _anchor;\n  }\n\n  /**\n   * 更新局部matrix的具体函数\n   */\n  protected doUpdateLocalMatrix() {\n    const {\n      x = DefaultTransform.x,\n      y = DefaultTransform.y,\n      scaleX = DefaultTransform.scaleX,\n      scaleY = DefaultTransform.scaleY,\n      angle = DefaultTransform.angle,\n      scaleCenter,\n      anchor,\n      postMatrix\n    } = this.attribute;\n    let _anchor: [number, number] = [0, 0];\n    const params = {};\n    if (anchor && angle) {\n      _anchor = this.getAnchor(anchor, params);\n    }\n    if (scaleCenter && (scaleX !== 1 || scaleY !== 1)) {\n      const m = this._transMatrix;\n      m.reset();\n      m.translate(_anchor[0], _anchor[1]);\n      m.rotate(angle);\n      m.translate(-_anchor[0], -_anchor[1]);\n\n      m.translate(x, y);\n      // m.translate(scaleCenter[0] * scaleX, scaleCenter[1] * scaleY);\n      // 计算bounds\n      _anchor = this.getAnchor(scaleCenter, params, true);\n      application.transformUtil.fromMatrix(m, m).scale(scaleX, scaleY, { x: _anchor[0], y: _anchor[1] });\n      // m.translate(-scaleCenter[0], -scaleCenter[1]);\n    } else {\n      normalTransform(this._transMatrix, this._transMatrix.reset(), x, y, scaleX, scaleY, angle, anchor && _anchor);\n    }\n    const p = this.getOffsetXY(DefaultTransform);\n    this._transMatrix.e += p.x;\n    this._transMatrix.f += p.y;\n\n    if (postMatrix) {\n      const m1 = tempMatrix.setValue(\n        postMatrix.a,\n        postMatrix.b,\n        postMatrix.c,\n        postMatrix.d,\n        postMatrix.e,\n        postMatrix.f\n      );\n      const m2 = this._transMatrix;\n      m1.multiply(m2.a, m2.b, m2.c, m2.d, m2.e, m2.f);\n      m2.setValue(m1.a, m1.b, m1.c, m1.d, m1.e, m1.f);\n    }\n  }\n  /**\n   * 更新全局matrix的具体函数\n   */\n  protected doUpdateGlobalMatrix() {\n    // 基于parent的matrix修改\n    if (this.parent) {\n      this._globalTransMatrix.multiply(\n        this.transMatrix.a,\n        this.transMatrix.b,\n        this.transMatrix.c,\n        this.transMatrix.d,\n        this.transMatrix.e,\n        this.transMatrix.f\n      );\n      const { scrollX = 0, scrollY = 0 } = this.parent.attribute;\n      this._globalTransMatrix.translate(scrollX, scrollY);\n    }\n  }\n\n  setStage(stage?: IStage, layer?: ILayer) {\n    if (this.stage !== stage) {\n      this.stage = stage;\n      this.layer = layer;\n      this.setStageToShadowRoot(stage, layer);\n      if (this.animates && this.animates.size) {\n        // 设置timeline为所属的stage上的timeline，但如果timeline并不是默认的timeline，就不用覆盖\n        const timeline = stage.getTimeline();\n        this.animates.forEach(a => {\n          if (a.timeline.isGlobal) {\n            a.setTimeline(timeline);\n            timeline.addAnimate(a);\n          }\n        });\n      }\n      this._onSetStage && this._onSetStage(this, stage, layer);\n      this.getGraphicService().onSetStage(this, stage);\n    }\n  }\n\n  setStageToShadowRoot(stage?: IStage, layer?: ILayer) {\n    if (this.shadowRoot) {\n      this.shadowRoot.setStage(stage, layer);\n    }\n  }\n\n  onAddStep(step: IStep) {\n    return;\n  }\n  onStop(props?: Partial<T>): void {\n    if (props) {\n      this.setAttributes(props, false, { type: AttributeUpdateType.ANIMATE_END });\n    }\n  }\n\n  getDefaultAttribute(name: string) {\n    return (this.getGraphicTheme() as any)[name];\n  }\n\n  // 获取属性\n  getComputedAttribute(name: string) {\n    return (this.attribute as any)[name] ?? this.getDefaultAttribute(name);\n  }\n  /**\n   * 添加onSetStage钩子\n   * @param cb 回调函数\n   * @param immediate 是否立刻执行，如果在回调添加之前stage就已经绑定，那么如果第二个参数为true就立刻执行回调\n   */\n  onSetStage(cb: (g: IGraphic, stage: IStage) => void, immediate: boolean = false) {\n    this._onSetStage = cb;\n    if (immediate && this.stage) {\n      cb(this, this.stage);\n    }\n  }\n\n  /******************** shadow graphic *********************/\n  attachShadow(shadowRoot?: IShadowRoot) {\n    if (shadowRoot) {\n      shadowRoot.shadowHost = this;\n    }\n\n    this.shadowRoot = shadowRoot ?? application.graphicService.creator.shadowRoot(this);\n    this.addUpdateBoundTag();\n    this.shadowRoot.setStage(this.stage, this.layer);\n    return this.shadowRoot;\n  }\n\n  detachShadow() {\n    if (this.shadowRoot) {\n      this.addUpdateBoundTag();\n      this.shadowRoot.release(true);\n      this.shadowRoot = null;\n    }\n  }\n\n  toJson(): IGraphicJson {\n    return {\n      attribute: this.attribute,\n      _uid: this._uid,\n      type: this.type,\n      name: this.name,\n      children: this.children.map((item: IGraphic) => item.toJson())\n    };\n  }\n\n  createPathProxy(path?: string) {\n    if (isString(path, true)) {\n      this.pathProxy = new CustomPath2D().fromString(path as string);\n    } else {\n      this.pathProxy = new CustomPath2D();\n    }\n\n    return this.pathProxy;\n  }\n\n  loadImage(image: any, background: boolean = false) {\n    if (!image || (background && backgroundNotImage(image))) {\n      return;\n    }\n    const url = image;\n    if (!this.resources) {\n      this.resources = new Map();\n    }\n    const cache: {\n      state: 'loading' | 'success' | 'init' | 'fail';\n      data: any;\n    } = {\n      data: 'init',\n      state: null\n    };\n    this.resources.set(url, cache);\n    if (typeof image === 'string') {\n      cache.state = 'loading';\n      if (image.startsWith('<svg')) {\n        // TODO 封装isSvg到@visactor/vutils\n        ResourceLoader.GetSvg(image, this);\n        this.backgroundImg = this.backgroundImg || background;\n      } else if (isValidUrl(image) || image.includes('/') || isBase64(image)) {\n        ResourceLoader.GetImage(image, this);\n        this.backgroundImg = this.backgroundImg || background;\n      }\n    } else if (isObject(image)) {\n      (cache.state = 'success'), (cache.data = image);\n      this.backgroundImg = this.backgroundImg || background;\n    } else {\n      cache.state = 'fail';\n    }\n  }\n\n  setShadowGraphic(graphic: IGraphic) {\n    if (!graphic) {\n      this.detachShadow();\n    } else {\n      const root = this.attachShadow();\n      root.add(graphic);\n    }\n  }\n\n  imageLoadSuccess(url: string, image: HTMLImageElement, cb?: () => void) {\n    // 更新属性\n    // this.resourceState = 'success';\n    // this.resource = image;\n    if (!this.resources) {\n      return;\n    }\n    const res = this.resources.get(url);\n    if (!res) {\n      return;\n    }\n    res.state = 'success';\n    res.data = image;\n\n    cb && cb();\n\n    // 触发重绘\n    // 暂时全量，TODO 启动局部重绘\n    // this.stage.enableDirtyBounds();\n    // this.stage.dirty(this.AABBBounds);\n    this.addUpdateBoundTag(); // 添加bounds更新tag重绘才会绘制这个mark\n    this.stage && this.stage.renderNextFrame();\n  }\n\n  imageLoadFail(url: string, cb?: () => void) {\n    if (!this.resources) {\n      return;\n    }\n    const res = this.resources.get(url);\n    if (!res) {\n      return;\n    }\n    res.state = 'fail';\n\n    cb && cb();\n  }\n\n  private _stopAnimates(animates: Map<string | number, IAnimate>) {\n    if (animates) {\n      animates.forEach(animate => {\n        animate.stop();\n      });\n    }\n  }\n\n  stopAnimates(stopChildren: boolean = false) {\n    this._stopAnimates(this.animates);\n\n    if (this.shadowRoot) {\n      // 停止所有影子节点的动画\n      this.shadowRoot.stopAnimates(true);\n    }\n    if (this.isContainer && stopChildren) {\n      this.forEachChildren((c: IGraphic) => {\n        c.stopAnimates(stopChildren);\n      });\n    }\n  }\n\n  release(): void {\n    this.releaseStatus = 'released';\n    this.stopAnimates();\n    application.graphicService.onRelease(this);\n  }\n\n  protected _emitCustomEvent(type: string, context?: any) {\n    if (this._events && type in this._events) {\n      const changeEvent = new CustomEvent(type, context);\n      changeEvent.bubbles = false;\n\n      (changeEvent as any).manager = (this.stage as any)?.eventSystem?.manager;\n      this.dispatchEvent(changeEvent);\n    }\n  }\n\n  abstract getNoWorkAnimateAttr(): Record<string, number>;\n\n  abstract clone(): IGraphic<any>;\n\n  toCustomPath(): ICustomPath2D {\n    // throw new Error('暂不支持');\n    const renderer = (this.stage?.renderService || application.renderService)?.drawContribution?.getRenderContribution(\n      this\n    );\n    if (renderer) {\n      const context = new EmptyContext2d(null, 1);\n      renderer.drawShape(this, context, 0, 0, {} as any, {});\n      return context.path;\n    }\n    return null;\n  }\n}\n\nGraphic.mixin(EventTarget);\n\nfunction backgroundNotImage(image: any) {\n  if (image.fill || image.stroke) {\n    return true;\n  }\n  return false;\n}\n"]}