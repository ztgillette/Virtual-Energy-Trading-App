{"version":3,"sources":["../src/plugins/builtin-plugin/html-attribute-plugin.ts"],"names":[],"mappings":"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","file":"html-attribute-plugin.js","sourcesContent":["import { Generator } from '../../common/generator';\nimport type {\n  IGraphic,\n  IPlugin,\n  IPluginService,\n  IRenderService,\n  IGroup,\n  IStage,\n  CreateDOMParamsType,\n  CommonDomOptions,\n  SimpleDomStyleOptions,\n  IText,\n  ILayer\n} from '../../interface';\nimport { application } from '../../application';\nimport { getTheme } from '../../graphic/theme';\nimport { DefaultAttribute } from '../../graphic/config';\nimport { textAttributesToStyle } from '../../common/text';\nimport { isFunction, isNil, isObject, isString, styleStringToObject, calculateAnchorOfBounds } from '@visactor/vutils';\nimport { Factory } from '../../factory';\n\nexport class HtmlAttributePlugin implements IPlugin {\n  name: string = 'HtmlAttributePlugin';\n  activeEvent: 'onRegister' = 'onRegister';\n  pluginService: IPluginService;\n  _uid: number = Generator.GenAutoIncrementId();\n  key: string = this.name + this._uid;\n\n  htmlMap: Record<\n    string,\n    {\n      wrapContainer: HTMLElement;\n      nativeContainer: HTMLElement;\n      container: string | HTMLElement | null;\n      renderId: number;\n    }\n  > = {};\n  renderId: number = 0;\n\n  activate(context: IPluginService): void {\n    this.pluginService = context;\n    context.stage.hooks.afterRender.tap(this.key, stage => {\n      if (!(stage && stage === this.pluginService.stage)) {\n        return;\n      }\n\n      // 全量查找，因为可能会有只渲染交互层的情况\n      this.drawHTML([...(context.stage.getChildren() as any)]);\n    });\n  }\n  deactivate(context: IPluginService): void {\n    context.stage.hooks.afterRender.taps = context.stage.hooks.afterRender.taps.filter(item => {\n      return item.name !== this.key;\n    });\n    // application.graphicService.hooks.onRemove.unTap(this.key);\n    // application.graphicService.hooks.onRelease.unTap(this.key);\n    this.release();\n  }\n\n  getWrapContainer(stage: IStage, userContainer?: string | HTMLElement | null, domParams?: CreateDOMParamsType) {\n    let nativeContainer;\n    if (userContainer) {\n      if (typeof userContainer === 'string') {\n        nativeContainer = application.global.getElementById(userContainer);\n      } else {\n        nativeContainer = userContainer;\n      }\n    } else {\n      nativeContainer = stage.window.getContainer();\n    }\n    // 创建wrapGroup\n    return {\n      wrapContainer: application.global.createDom({ tagName: 'div', parent: nativeContainer, ...domParams }),\n      nativeContainer\n    };\n  }\n\n  parseDefaultStyleFromGraphic(graphic: IGraphic) {\n    const attrs: any = graphic.type === 'text' && graphic.attribute ? graphic.attribute : getTheme(graphic).text;\n\n    return textAttributesToStyle(attrs);\n  }\n\n  getTransformOfText(graphic: IText) {\n    const textTheme = getTheme(graphic).text;\n    const { textAlign = textTheme.textAlign, textBaseline = textTheme.textBaseline } = graphic.attribute;\n    const matrix = graphic.globalTransMatrix;\n    const cssAttrs = matrix.toTransformAttrs();\n    const { rotateDeg, scaleX, scaleY } = cssAttrs;\n    const translateMap: any = {\n      left: '0',\n      start: '0',\n      end: '-100%',\n      center: '-50%',\n      right: '-100%',\n      top: '0',\n      middle: '-50%',\n      bottom: '-100%',\n      alphabetic: '-79%'\n    };\n    const originMap: any = {\n      left: '0',\n      start: '0',\n      end: '100%',\n      center: '50%',\n      right: '100%',\n      top: '0',\n      middle: '50%',\n      bottom: '100%',\n      alphabetic: '79%'\n    };\n\n    return {\n      textAlign,\n      // textBaseline,\n      transform: `translate(${translateMap[textAlign]},${translateMap[textBaseline]}) rotate(${rotateDeg}deg) scaleX(${scaleX}) scaleY(${scaleY})`,\n      transformOrigin: `${originMap[textAlign]} ${originMap[textBaseline]}`\n    };\n  }\n\n  onWheel = (ev: Event) => {\n    try {\n      const newEvent = new (ev as any).constructor(ev.type, ev);\n      const canvas = this.pluginService.stage.window.getContext().getCanvas().nativeCanvas;\n      canvas.dispatchEvent(newEvent);\n    } catch (err) {\n      return;\n      // console.log(err);\n    }\n  };\n\n  updateStyleOfWrapContainer(\n    graphic: IGraphic,\n    stage: IStage,\n    wrapContainer: HTMLElement,\n    nativeContainer: HTMLElement,\n    options: SimpleDomStyleOptions & CommonDomOptions\n  ) {\n    const { pointerEvents, penetrateEventList = [] } = options;\n    let calculateStyle = this.parseDefaultStyleFromGraphic(graphic);\n\n    calculateStyle.display = graphic.attribute.visible !== false ? 'block' : 'none';\n    // 事件穿透\n    calculateStyle.pointerEvents = pointerEvents === true ? 'all' : pointerEvents ? pointerEvents : 'none';\n    if (calculateStyle.pointerEvents !== 'none') {\n      // 删除所有的事件\n      this.removeWrapContainerEventListener(wrapContainer);\n      // 监听所有的事件\n      penetrateEventList.forEach(event => {\n        if (event === 'wheel') {\n          wrapContainer.addEventListener('wheel', this.onWheel);\n        }\n      });\n    }\n\n    // 定位wrapGroup\n    if (!wrapContainer.style.position) {\n      wrapContainer.style.position = 'absolute';\n      nativeContainer.style.position = 'relative';\n    }\n    let left: number = 0;\n    let top: number = 0;\n    const b = graphic.globalAABBBounds;\n\n    let anchorType = options.anchorType;\n\n    if (isNil(anchorType)) {\n      anchorType = graphic.type === 'text' ? 'position' : 'boundsLeftTop';\n    }\n\n    if (anchorType === 'boundsLeftTop') {\n      // 兼容老的配置，统一配置\n      anchorType = 'top-left';\n    }\n    if (anchorType === 'position' || b.empty()) {\n      const matrix = graphic.globalTransMatrix;\n      left = matrix.e;\n      top = matrix.f;\n    } else {\n      const anchor = calculateAnchorOfBounds(b, anchorType);\n\n      left = anchor.x;\n      top = anchor.y;\n    }\n\n    // 查看wrapGroup的位置\n    // const wrapGroupTL = application.global.getElementTopLeft(wrapGroup, false);\n    const containerTL = application.global.getElementTopLeft(nativeContainer, false);\n    const windowTL = stage.window.getTopLeft(false);\n    const viewBox = stage.viewBox;\n    const offsetX = left + windowTL.left - containerTL.left + viewBox.x1;\n    const offsetTop = top + windowTL.top - containerTL.top + viewBox.y1;\n    // wrapGroup.style.transform = `translate(${offsetX}px, ${offsetTop}px)`;\n    calculateStyle.left = `${offsetX}px`;\n    calculateStyle.top = `${offsetTop}px`;\n\n    if (graphic.type === 'text' && anchorType === 'position') {\n      calculateStyle = {\n        ...calculateStyle,\n        ...this.getTransformOfText(graphic as IText)\n      };\n    }\n\n    if (isFunction(options.style)) {\n      const userStyle = options.style(\n        { top: offsetTop, left: offsetX, width: b.width(), height: b.height() },\n        graphic,\n        wrapContainer\n      );\n\n      if (userStyle) {\n        calculateStyle = { ...calculateStyle, ...userStyle };\n      }\n    } else if (isObject(options.style)) {\n      calculateStyle = { ...calculateStyle, ...options.style };\n    } else if (isString(options.style) && options.style) {\n      calculateStyle = { ...calculateStyle, ...styleStringToObject(options.style as string) };\n    }\n\n    // 更新样式\n    application.global.updateDom(wrapContainer, {\n      width: options.width,\n      height: options.height,\n      style: calculateStyle\n    });\n  }\n\n  protected clearCacheContainer() {\n    if (this.htmlMap) {\n      Object.keys(this.htmlMap).forEach(key => {\n        if (this.htmlMap[key] && this.htmlMap[key].renderId !== this.renderId) {\n          this.removeElement(key);\n        }\n      });\n    }\n\n    this.renderId += 1;\n  }\n\n  protected drawHTML(layers: ILayer[]) {\n    if (application.global.env === 'browser') {\n      layers\n        .sort((a, b) => {\n          return (a.attribute.zIndex ?? DefaultAttribute.zIndex) - (b.attribute.zIndex ?? DefaultAttribute.zIndex);\n        })\n        .forEach(group => {\n          this.renderGroupHTML(group as IGroup);\n        });\n\n      this.clearCacheContainer();\n    }\n  }\n\n  renderGroupHTML(group: IGroup) {\n    this.renderGraphicHTML(group);\n    group.forEachChildren((g: IGraphic) => {\n      if (g.isContainer) {\n        this.renderGroupHTML(g as IGroup);\n      } else {\n        this.renderGraphicHTML(g);\n      }\n    });\n  }\n\n  removeElement(id: string) {\n    if (!this.htmlMap || !this.htmlMap[id]) {\n      return;\n    }\n\n    const { wrapContainer } = this.htmlMap[id];\n    if (wrapContainer) {\n      application.global.removeDom(wrapContainer);\n    }\n\n    this.htmlMap[id] = null;\n  }\n\n  removeWrapContainerEventListener(wrapContainer: HTMLElement) {\n    wrapContainer.removeEventListener('wheel', this.onWheel);\n  }\n\n  renderGraphicHTML(graphic: IGraphic) {\n    const { html } = graphic.attribute;\n    if (!html) {\n      return;\n    }\n    const stage = graphic.stage;\n    if (!stage) {\n      return;\n    }\n    const { dom, container } = html;\n\n    if (!dom) {\n      return;\n    }\n    const id = isNil(html.id) ? `${graphic.id ?? graphic._uid}_react` : html.id;\n\n    if (this.htmlMap && this.htmlMap[id] && container && container !== this.htmlMap[id].container) {\n      this.removeElement(id);\n    }\n\n    if (!this.htmlMap || !this.htmlMap[id]) {\n      // createa a wrapper contianer to be the root of react element\n      const { wrapContainer, nativeContainer } = this.getWrapContainer(stage, container);\n\n      if (wrapContainer) {\n        // init append\n        if (typeof dom === 'string') {\n          wrapContainer.innerHTML = dom;\n        } else {\n          wrapContainer.appendChild(dom);\n        }\n\n        if (!this.htmlMap) {\n          this.htmlMap = {};\n        }\n\n        this.htmlMap[id] = { wrapContainer, nativeContainer, container, renderId: this.renderId };\n      }\n    } else {\n      if (typeof dom === 'string') {\n        this.htmlMap[id].wrapContainer.innerHTML = dom;\n      } else {\n        if (dom !== this.htmlMap[id].wrapContainer.firstChild) {\n          this.htmlMap[id].wrapContainer.removeChild(this.htmlMap[id].wrapContainer.firstChild);\n          this.htmlMap[id].wrapContainer.appendChild(dom);\n        }\n      }\n    }\n\n    if (!this.htmlMap || !this.htmlMap[id]) {\n      return;\n    }\n\n    const { wrapContainer, nativeContainer } = this.htmlMap[id];\n\n    this.updateStyleOfWrapContainer(graphic, stage, wrapContainer, nativeContainer, html);\n    this.htmlMap[id].renderId = this.renderId;\n  }\n\n  release() {\n    if (application.global.env === 'browser') {\n      this.removeAllDom(this.pluginService.stage.defaultLayer);\n    }\n  }\n  removeAllDom(g: IGraphic) {\n    if (this.htmlMap) {\n      Object.keys(this.htmlMap).forEach(key => {\n        this.removeElement(key);\n      });\n\n      this.htmlMap = null;\n    }\n  }\n}\n\nexport const registerHtmlAttributePlugin = () => {\n  Factory.registerPlugin('HtmlAttributePlugin', HtmlAttributePlugin);\n};\n"]}