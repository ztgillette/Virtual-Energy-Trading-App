{"version":3,"sources":["../src/plugins/builtin-plugin/flex-layout-plugin.ts"],"names":[],"mappings":"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","file":"flex-layout-plugin.js","sourcesContent":["import type { IGraphic, IGroup, IGroupAttribute, IStage } from '../../interface';\nimport { getTheme } from '../../graphic/theme';\nimport type { IPlugin, IPluginService } from '../../interface';\nimport { Generator } from '../../common/generator';\nimport type { IAABBBounds } from '@visactor/vutils';\nimport { AABBBounds } from '@visactor/vutils';\nimport { application } from '../../application';\nimport { Factory } from '../../factory';\n\nconst _tempBounds = new AABBBounds();\n\ntype IAnchorPosMap = {\n  'flex-start': number;\n  'flex-end': number;\n  center: number;\n};\n\nexport class FlexLayoutPlugin implements IPlugin {\n  name: 'FlexLayoutPlugin' = 'FlexLayoutPlugin';\n  activeEvent: 'onRegister' = 'onRegister';\n  pluginService: IPluginService;\n  id: number = Generator.GenAutoIncrementId();\n  key: string = this.name + this.id;\n  tempBounds: AABBBounds = new AABBBounds();\n  pause: boolean;\n  skipBoundsTrigger: boolean;\n\n  pauseLayout(p: boolean) {\n    this.pause = p;\n  }\n\n  tryLayoutChildren(graphic: IGraphic) {\n    if (graphic.firstChild) {\n      this.tryLayout(graphic.firstChild as IGraphic);\n    }\n  }\n\n  tryLayout(graphic: IGraphic, force: boolean = true) {\n    if (this.pause) {\n      return;\n    }\n    const p = graphic.parent;\n    if (!(force || (p && graphic.needUpdateLayout()))) {\n      return;\n    }\n    const theme = getTheme(p).group;\n    const { display = theme.display } = p.attribute;\n    if (display !== 'flex') {\n      return;\n    }\n    const {\n      // width,\n      // height,\n      flexDirection = theme.flexDirection,\n      flexWrap = theme.flexWrap,\n      alignItems = theme.alignItems,\n      clip = theme.clip\n    } = p.attribute;\n    const { alignContent = alignItems ?? theme.alignContent } = p.attribute;\n    // if (!(width && height)) {\n    //   return;\n    // }\n\n    let { width, height, justifyContent = theme.justifyContent } = p.attribute;\n    const children = p.getChildren() as IGraphic[];\n    if (width == null || height == null) {\n      // 计算子节点flex排列后的宽高\n      let childrenWidth = 0;\n      let childrenHeight = 0;\n      let boundsLegal = 0;\n      children.forEach((child: IGraphic) => {\n        const bounds = this.getAABBBounds(child);\n        if (bounds.empty()) {\n          return;\n        }\n        if (flexDirection === 'column' || flexDirection === 'column-reverse') {\n          childrenHeight += bounds.height();\n          childrenWidth = Math.max(childrenWidth, bounds.width());\n        } else {\n          childrenWidth += bounds.width();\n          childrenHeight = Math.max(childrenHeight, bounds.height());\n        }\n        boundsLegal += bounds.x1;\n        boundsLegal += bounds.y1;\n        boundsLegal += bounds.x2;\n        boundsLegal += bounds.y2;\n      });\n      // judgement children bounds legal\n      if (!isFinite(boundsLegal)) {\n        return;\n      }\n      width = childrenWidth;\n      height = childrenHeight;\n    }\n\n    if (p.attribute.width == null) {\n      p.attribute.width = width;\n    } else {\n      width = p.attribute.width;\n    }\n    if (p.attribute.height == null) {\n      p.attribute.height = height;\n    } else {\n      height = p.attribute.height;\n    }\n\n    // 这里使用p._AABBBounds可能会将非布局造成的bounds更新也会触发重新布局\n    // TODO: 增加layout前预处理，在非递归布局前将子节点及其全部父节点_AABBBounds更新\n    this.tempBounds.copy(p._AABBBounds);\n    const result = {\n      main: { len: width, field: 'x' },\n      cross: { len: height, field: 'y' }\n    };\n    const main = result.main;\n    const cross = result.cross;\n    if (flexDirection === 'column' || flexDirection === 'column-reverse') {\n      main.len = height;\n      cross.len = width;\n      main.field = 'y';\n      cross.field = 'x';\n    }\n    if (flexDirection === 'row-reverse' || flexDirection === 'column-reverse') {\n      if (justifyContent === 'flex-start') {\n        justifyContent = 'flex-end';\n      } else if (justifyContent === 'flex-end') {\n        justifyContent = 'flex-start';\n      } else {\n        children.reverse();\n      }\n    }\n\n    // 计算宽度\n    let mainLen = 0;\n    let crossLen = 0;\n    const mianLenArray: { mainLen: number; crossLen: number }[] = [];\n    children.forEach((c: IGraphic) => {\n      const b = this.getAABBBounds(c);\n      if (b.empty()) {\n        return;\n      }\n      const ml = main.field === 'x' ? b.width() : b.height();\n      const cl = cross.field === 'x' ? b.width() : b.height();\n      mianLenArray.push({ mainLen: ml, crossLen: cl });\n      mainLen += ml;\n      crossLen = Math.max(crossLen, cl);\n    });\n    // 解析main\n    const mainList: { idx: number; mainLen: number; crossLen: number }[] = [];\n    if (mainLen > main.len && flexWrap === 'wrap') {\n      let tempMainL = 0;\n      let tempCrossL = 0;\n      mianLenArray.forEach(({ mainLen, crossLen }, i) => {\n        if (tempMainL + mainLen > main.len) {\n          if (tempMainL === 0) {\n            mainList.push({ idx: i, mainLen: tempMainL + mainLen, crossLen });\n            tempMainL = 0;\n            tempCrossL = 0;\n          } else {\n            mainList.push({ idx: i - 1, mainLen: tempMainL, crossLen: tempCrossL });\n            tempMainL = mainLen;\n            tempCrossL = crossLen;\n          }\n        } else {\n          tempMainL += mainLen;\n          tempCrossL = Math.max(tempCrossL, crossLen);\n        }\n      });\n      mainList.push({ idx: mianLenArray.length - 1, mainLen: tempMainL, crossLen: tempCrossL });\n    } else {\n      mainList.push({ idx: mianLenArray.length - 1, mainLen: mainLen, crossLen });\n    }\n\n    // 布局main\n    let lastIdx: number = 0;\n    mainList.forEach(s => {\n      this.layoutMain(p, children, justifyContent, main, mianLenArray, lastIdx, s);\n      lastIdx = s.idx + 1;\n    });\n\n    crossLen = mainList.reduce((a, b) => a + b.crossLen, 0);\n\n    // 布局cross\n\n    if (mainList.length === 1) {\n      const anchorPosMap: IAnchorPosMap = {\n        'flex-start': 0,\n        'flex-end': cross.len,\n        center: cross.len / 2\n      };\n      this.layoutCross(children, alignItems, cross, anchorPosMap, mianLenArray, mainList[0], 0);\n    } else {\n      if (alignContent === 'flex-start') {\n        lastIdx = 0;\n        let anchorPos = 0;\n        mainList.forEach((s, i) => {\n          const anchorPosMap: IAnchorPosMap = {\n            'flex-start': anchorPos,\n            'flex-end': anchorPos + s.crossLen,\n            center: anchorPos + s.crossLen / 2\n          };\n          this.layoutCross(children, 'flex-start', cross, anchorPosMap, mianLenArray, mainList[i], lastIdx);\n          lastIdx = s.idx + 1;\n          anchorPos += s.crossLen;\n        });\n      } else if (alignContent === 'center') {\n        lastIdx = 0;\n        const padding = Math.max(0, (cross.len - crossLen) / 2);\n        let anchorPos = padding;\n        mainList.forEach((s, i) => {\n          const anchorPosMap: IAnchorPosMap = {\n            'flex-start': anchorPos,\n            'flex-end': anchorPos + s.crossLen,\n            center: anchorPos + s.crossLen / 2\n          };\n          this.layoutCross(children, 'center', cross, anchorPosMap, mianLenArray, mainList[i], lastIdx);\n          lastIdx = s.idx + 1;\n          anchorPos += s.crossLen;\n        });\n      } else if (alignContent === 'space-around') {\n        lastIdx = 0;\n        const padding = Math.max(0, (cross.len - crossLen) / mainList.length / 2);\n        let anchorPos = padding;\n        mainList.forEach((s, i) => {\n          const anchorPosMap: IAnchorPosMap = {\n            'flex-start': anchorPos,\n            'flex-end': anchorPos + s.crossLen,\n            center: anchorPos + s.crossLen / 2\n          };\n          this.layoutCross(children, 'flex-start', cross, anchorPosMap, mianLenArray, mainList[i], lastIdx);\n          lastIdx = s.idx + 1;\n          anchorPos += s.crossLen + padding * 2;\n        });\n      } else if (alignContent === 'space-between') {\n        lastIdx = 0;\n        const padding = Math.max(0, (cross.len - crossLen) / (mainList.length * 2 - 2));\n        let anchorPos = 0;\n        mainList.forEach((s, i) => {\n          const anchorPosMap: IAnchorPosMap = {\n            'flex-start': anchorPos,\n            'flex-end': anchorPos + s.crossLen,\n            center: anchorPos + s.crossLen / 2\n          };\n          this.layoutCross(children, 'flex-start', cross, anchorPosMap, mianLenArray, mainList[i], lastIdx);\n          lastIdx = s.idx + 1;\n          anchorPos += s.crossLen + padding * 2;\n        });\n      }\n    }\n\n    // update children\n    children.forEach((child, idx) => {\n      child.addUpdateBoundTag();\n      child.addUpdatePositionTag();\n      child.clearUpdateLayoutTag();\n    });\n\n    p.addUpdateLayoutTag();\n    // 更新父级元素的layout，直到存在clip\n    const b = this.getAABBBounds(p);\n    if (!clip && !this.tempBounds.equals(b)) {\n      // 判断父元素包围盒是否发生变化\n      this.tryLayout(p, false);\n    }\n  }\n\n  // 避免获取bounds的时候递归进行布局\n  getAABBBounds(graphic: IGraphic) {\n    this.skipBoundsTrigger = true;\n    const b = graphic.AABBBounds;\n    this.skipBoundsTrigger = false;\n    return b;\n  }\n\n  // 锚点并不一定总在左上角，根据位置和bounds的偏移进行定位\n  private updateChildPos(posBaseLeftTop: number, lastP: number | undefined, lastBP: number): number {\n    return posBaseLeftTop + (lastP ?? 0) - lastBP;\n  }\n\n  layoutMain(\n    p: IGroup,\n    children: IGraphic[],\n    justifyContent: IGroupAttribute['justifyContent'],\n    main: { len: number; field: string },\n    mianLenArray: { mainLen: number; crossLen: number }[],\n    lastIdx: number,\n    currSeg: { idx: number; mainLen: number; crossLen: number }\n  ) {\n    if (justifyContent === 'flex-start') {\n      let pos = 0;\n      for (let i = lastIdx; i <= currSeg.idx; i++) {\n        const posBaseLeftTop = pos + getPadding(children[i], main.field);\n        const b = this.getAABBBounds(children[i]);\n        !b.empty() &&\n          (children[i].attribute[main.field] = this.updateChildPos(\n            posBaseLeftTop,\n            children[i].attribute[main.field],\n            b[`${main.field}1`]\n          ));\n        pos += mianLenArray[i].mainLen;\n      }\n    } else if (justifyContent === 'flex-end') {\n      let pos = main.len;\n      for (let i = currSeg.idx; i >= lastIdx; i--) {\n        pos -= mianLenArray[i].mainLen;\n        const posBaseLeftTop = pos + getPadding(children[i], main.field);\n        const b = this.getAABBBounds(children[i]);\n        !b.empty() &&\n          (children[i].attribute[main.field] = this.updateChildPos(\n            posBaseLeftTop,\n            children[i].attribute[main.field],\n            b[`${main.field}1`]\n          ));\n      }\n    } else if (justifyContent === 'space-around') {\n      if (currSeg.mainLen >= main.len) {\n        let pos = 0;\n        for (let i = lastIdx; i <= currSeg.idx; i++) {\n          const posBaseLeftTop = pos + getPadding(children[i], main.field);\n          const b = this.getAABBBounds(children[i]);\n          !b.empty() &&\n            (children[i].attribute[main.field] = this.updateChildPos(\n              posBaseLeftTop,\n              children[i].attribute[main.field],\n              b[`${main.field}1`]\n            ));\n          pos += mianLenArray[i].mainLen;\n        }\n      } else {\n        const size = currSeg.idx - lastIdx + 1;\n        const padding = (main.len - currSeg.mainLen) / size / 2;\n        let pos = padding;\n        for (let i = lastIdx; i <= currSeg.idx; i++) {\n          const posBaseLeftTop = pos + getPadding(children[i], main.field);\n          const b = this.getAABBBounds(children[i]);\n          !b.empty() &&\n            (children[i].attribute[main.field] = this.updateChildPos(\n              posBaseLeftTop,\n              children[i].attribute[main.field],\n              b[`${main.field}1`]\n            ));\n          pos += mianLenArray[i].mainLen + padding * 2;\n        }\n      }\n    } else if (justifyContent === 'space-between') {\n      if (currSeg.mainLen >= main.len) {\n        let pos = 0;\n        for (let i = lastIdx; i <= currSeg.idx; i++) {\n          const posBaseLeftTop = pos + getPadding(children[i], main.field);\n          const b = this.getAABBBounds(children[i]);\n          !b.empty() &&\n            (children[i].attribute[main.field] = this.updateChildPos(\n              posBaseLeftTop,\n              children[i].attribute[main.field],\n              b[`${main.field}1`]\n            ));\n          pos += mianLenArray[i].mainLen;\n        }\n      } else {\n        const size = currSeg.idx - lastIdx + 1;\n        const padding = (main.len - currSeg.mainLen) / (size * 2 - 2);\n        let pos = 0;\n        for (let i = lastIdx; i <= currSeg.idx; i++) {\n          const posBaseLeftTop = pos + getPadding(children[i], main.field);\n          const b = this.getAABBBounds(children[i]);\n          !b.empty() &&\n            (children[i].attribute[main.field] = this.updateChildPos(\n              posBaseLeftTop,\n              children[i].attribute[main.field],\n              b[`${main.field}1`]\n            ));\n          pos += mianLenArray[i].mainLen + padding * 2;\n        }\n      }\n    } else if (justifyContent === 'center') {\n      let pos = (main.len - currSeg.mainLen) / 2;\n      for (let i = lastIdx; i <= currSeg.idx; i++) {\n        const posBaseLeftTop = pos + getPadding(children[i], main.field);\n        const b = this.getAABBBounds(children[i]);\n        !b.empty() &&\n          (children[i].attribute[main.field] = this.updateChildPos(\n            posBaseLeftTop,\n            children[i].attribute[main.field],\n            b[`${main.field}1`]\n          ));\n        pos += mianLenArray[i].mainLen;\n      }\n    }\n  }\n\n  layoutCross(\n    children: IGraphic[],\n    alignItem: IGroupAttribute['alignItems'],\n    cross: { len: number; field: string },\n    anchorPosMap: IAnchorPosMap,\n    lenArray: { mainLen: number; crossLen: number }[],\n    currSeg: { idx: number; mainLen: number; crossLen: number },\n    lastIdx: number\n  ) {\n    for (let i = lastIdx; i <= currSeg.idx; i++) {\n      const child = children[i];\n      let { alignSelf } = child.attribute;\n      if (!alignSelf || alignSelf === 'auto') {\n        alignSelf = alignItem;\n      }\n      const b = this.getAABBBounds(child);\n      const anchorPos = anchorPosMap[alignSelf] ?? anchorPosMap['flex-start'];\n      if (alignSelf === 'flex-end') {\n        !b.empty() &&\n          (child.attribute[cross.field] = this.updateChildPos(\n            anchorPos - lenArray[i].crossLen + getPadding(child, cross.field),\n            child.attribute[cross.field],\n            b[`${cross.field}1`]\n          ));\n      } else if (alignSelf === 'center') {\n        !b.empty() &&\n          (child.attribute[cross.field] = this.updateChildPos(\n            anchorPos - lenArray[i].crossLen / 2 + getPadding(child, cross.field),\n            child.attribute[cross.field],\n            b[`${cross.field}1`]\n          ));\n      } else {\n        !b.empty() &&\n          (child.attribute[cross.field] = this.updateChildPos(\n            anchorPos + getPadding(child, cross.field),\n            child.attribute[cross.field],\n            b[`${cross.field}1`]\n          ));\n      }\n    }\n    // if (alignItem === 'flex-end') {\n    //   for (let i = lastIdx; i <= currSeg.idx; i++) {\n    //     children[i].attribute[cross.field] = this.updateChildPos(\n    //       anchorPos - lenArray[i].crossLen + getPadding(children[i], cross.field),\n    //       children[i].attribute[cross.field],\n    //       children[i].AABBBounds[`${cross.field}1`]\n    //     );\n    //   }\n    // } else if (alignItem === 'center') {\n    //   for (let i = lastIdx; i <= currSeg.idx; i++) {\n    //     children[i].attribute[cross.field] = this.updateChildPos(\n    //       anchorPos - lenArray[i].crossLen / 2 + getPadding(children[i], cross.field),\n    //       children[i].attribute[cross.field],\n    //       children[i].AABBBounds[`${cross.field}1`]\n    //     );\n    //   }\n    // } else {\n    //   for (let i = lastIdx; i <= currSeg.idx; i++) {\n    //     children[i].attribute[cross.field] = this.updateChildPos(\n    //       anchorPos + getPadding(children[i], cross.field),\n    //       children[i].attribute[cross.field],\n    //       children[i].AABBBounds[`${cross.field}1`]\n    //     );\n    //   }\n    // }\n  }\n\n  activate(context: IPluginService): void {\n    this.pluginService = context;\n    const stage = this.pluginService.stage;\n    if (!stage) {\n      return;\n    }\n    // 属性更新\n    stage.graphicService.hooks.onAttributeUpdate.tap(this.key, graphic => {\n      if (graphic.glyphHost) {\n        graphic = graphic.glyphHost;\n      }\n      if (!(graphic.stage && graphic.stage === this.pluginService.stage)) {\n        return;\n      }\n      this.tryLayout(graphic, false);\n    });\n    // 包围盒更新（如果包围盒发生变化，就重新布局\n    stage.graphicService.hooks.beforeUpdateAABBBounds.tap(\n      this.key,\n      (graphic: IGraphic, stage: IStage, willUpdate: boolean, bounds: IAABBBounds) => {\n        if (graphic.glyphHost) {\n          graphic = graphic.glyphHost;\n        }\n        if (!(stage && stage === this.pluginService.stage)) {\n          return;\n        }\n        if (!graphic.isContainer || this.skipBoundsTrigger) {\n          return;\n        }\n        _tempBounds.copy(bounds);\n      }\n    );\n    stage.graphicService.hooks.afterUpdateAABBBounds.tap(\n      this.key,\n      (\n        graphic: IGraphic,\n        stage: IStage,\n        bounds: IAABBBounds,\n        params: { globalAABBBounds: IAABBBounds },\n        selfChange: boolean\n      ) => {\n        if (!(stage && stage === this.pluginService.stage)) {\n          return;\n        }\n        if (!graphic.isContainer || this.skipBoundsTrigger) {\n          return;\n        }\n        if (!_tempBounds.equals(bounds)) {\n          this.tryLayout(graphic, false);\n        }\n      }\n    );\n    // 添加到场景树\n    stage.graphicService.hooks.onSetStage.tap(this.key, graphic => {\n      if (graphic.glyphHost) {\n        graphic = graphic.glyphHost;\n      }\n      this.tryLayout(graphic, false);\n    });\n  }\n  deactivate(context: IPluginService): void {\n    const stage = this.pluginService.stage;\n    if (!stage) {\n      return;\n    }\n    stage.graphicService.hooks.onAttributeUpdate.taps = stage.graphicService.hooks.onAttributeUpdate.taps.filter(\n      item => {\n        return item.name !== this.key;\n      }\n    );\n    stage.graphicService.hooks.beforeUpdateAABBBounds.taps =\n      stage.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(item => {\n        return item.name !== this.key;\n      });\n    stage.graphicService.hooks.afterUpdateAABBBounds.taps =\n      stage.graphicService.hooks.afterUpdateAABBBounds.taps.filter(item => {\n        return item.name !== this.key;\n      });\n    stage.graphicService.hooks.onSetStage.taps = stage.graphicService.hooks.onSetStage.taps.filter(item => {\n      return item.name !== this.key;\n    });\n  }\n}\n\nfunction getPadding(graphic: IGraphic, field: string): number {\n  // if (!graphic.attribute.boundsPadding) {\n  //   return 0;\n  // } else if (isNumber(graphic.attribute.boundsPadding)) {\n  //   return graphic.attribute.boundsPadding as number;\n  // } else if (isArray(graphic.attribute.boundsPadding) && graphic.attribute.boundsPadding.length === 1) {\n  //   return graphic.attribute.boundsPadding[0];\n  // }\n  // const paddingArray = parsePadding(graphic.attribute.boundsPadding);\n  // if (field === 'x') {\n  //   return paddingArray[3];\n  // } else if (field === 'y') {\n  //   return paddingArray[0];\n  // }\n  return 0;\n}\n\nexport const registerFlexLayoutPlugin = () => {\n  Factory.registerPlugin('FlexLayoutPlugin', FlexLayoutPlugin);\n};\n"]}