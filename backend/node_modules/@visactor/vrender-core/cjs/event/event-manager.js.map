{"version":3,"sources":["../src/event/event-manager.ts"],"names":[],"mappings":"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","file":"event-manager.js","sourcesContent":["import type { Dict } from '@visactor/vutils';\nimport { EventEmitter, Logger, get } from '@visactor/vutils';\nimport { FederatedMouseEvent, FederatedPointerEvent, FederatedWheelEvent } from './federated-event';\nimport type { IEventTarget } from '../interface/event';\nimport { WILDCARD } from './constant';\nimport type { FederatedEvent } from './federated-event/base-event';\nimport { clock } from './util';\nimport type { Cursor, IGraphic } from '../interface';\n/**\n * 代码参考自 https://github.com/pixijs/pixijs\n * The MIT License\n\n  Copyright (c) 2013-2023 Mathew Groves, Chad Engler\n\n  Permission is hereby granted, free of charge, to any person obtaining a copy\n  of this software and associated documentation files (the \"Software\"), to deal\n  in the Software without restriction, including without limitation the rights\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the Software is\n  furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included in\n  all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n  THE SOFTWARE.\n */\n\n// The maximum iterations used in propagation. This prevent infinite loops.\nconst PROPAGATION_LIMIT = 2048;\n\ntype TrackingData = {\n  pressTargetsByButton: {\n    [id: number]: IEventTarget[];\n  };\n  clicksByButton: {\n    [id: number]: {\n      clickCount: number;\n      target: IEventTarget;\n      timeStamp: number;\n    };\n  };\n  overTargets: IEventTarget[];\n};\n\ntype EventManagerConfig = {\n  /**\n   * 多次点击之间的最大时间，默认为 200 ms\n   * @default 200\n   */\n  clickInterval?: number;\n  supportsTouchEvents?: boolean;\n};\n\ntype EmitterListener = { fn: (...args: any[]) => any; context: any; once: boolean };\ntype EmitterListeners = Record<string, EmitterListener | EmitterListener[]>;\n\nfunction isMouseLike(pointerType: string) {\n  return pointerType === 'mouse' || pointerType === 'pen';\n}\n\nconst DEFAULT_CLICK_INTERVAL = 200;\n\nexport class EventManager {\n  rootTarget: IEventTarget;\n\n  dispatch: any = new EventEmitter();\n\n  cursor: Cursor | string;\n  cursorTarget: IEventTarget | null = null;\n  pauseNotify: boolean = false;\n\n  protected mappingTable: Record<\n    string,\n    Array<{\n      fn: (e: FederatedEvent, target: IEventTarget) => void;\n      priority: number;\n    }>\n  >;\n\n  protected mappingState: Record<string, any> = {\n    trackingData: {}\n  };\n\n  protected eventPool: Map<typeof FederatedEvent, FederatedEvent[]> = new Map();\n\n  // 缓存上一个坐标点的拾取结果，用于优化在同一个点连续触发事件的拾取逻辑\n  private _prePointTargetCache: Dict<IEventTarget> & { stageRenderCount: number };\n\n  private _config: EventManagerConfig;\n\n  constructor(root: IEventTarget, config: EventManagerConfig) {\n    this.rootTarget = root;\n    this.mappingTable = {};\n    this._config = {\n      clickInterval: DEFAULT_CLICK_INTERVAL,\n      ...config\n    };\n    this.addEventMapping('pointerdown', this.onPointerDown);\n    this.addEventMapping('pointermove', this.onPointerMove);\n    this.addEventMapping('pointerout', this.onPointerOut);\n    this.addEventMapping('pointerleave', this.onPointerOut);\n    this.addEventMapping('pointerover', this.onPointerOver);\n    this.addEventMapping('pointerup', this.onPointerUp);\n    this.addEventMapping('pointerupoutside', this.onPointerUpOutside);\n    this.addEventMapping('wheel', this.onWheel);\n  }\n\n  addEventMapping(type: string, fn: (e: FederatedEvent, target: IEventTarget) => void): void {\n    if (!this.mappingTable[type]) {\n      this.mappingTable[type] = [];\n    }\n\n    this.mappingTable[type].push({\n      fn,\n      priority: 0\n    });\n    this.mappingTable[type].sort((a, b) => a.priority - b.priority);\n  }\n\n  dispatchEvent(e: FederatedEvent, type?: string): void {\n    e.propagationStopped = false;\n    e.propagationImmediatelyStopped = false;\n\n    this.propagate(e, type);\n    this.dispatch.emit(type || e.type, e);\n  }\n\n  mapEvent(e: FederatedEvent): void {\n    if (!this.rootTarget) {\n      return;\n    }\n    const mappers = this.mappingTable[e.type];\n\n    let target;\n    const cacheKey = `${e.canvasX}-${e.canvasY}`;\n    if (\n      this._prePointTargetCache?.[cacheKey] &&\n      (this._prePointTargetCache?.[cacheKey] as unknown as IGraphic)?.stage &&\n      (this._prePointTargetCache?.[cacheKey] as unknown as IGraphic)?.stage.renderCount ===\n        (this._prePointTargetCache?.stageRenderCount as number)\n    ) {\n      target = this._prePointTargetCache[cacheKey];\n    } else {\n      target = this.pickTarget(e.viewX, e.viewY, e);\n      // 缓存上一个坐标点的拾取结果，减少拾取的次数，如 pointermove pointerdown 和 pointerup 在同一个点触发\n      // 如果存在params，那么就不缓存\n      if (!(e as any).pickParams) {\n        this._prePointTargetCache = {\n          [cacheKey]: target,\n          stageRenderCount: target?.stage.renderCount ?? -1\n        };\n      }\n    }\n\n    if (mappers) {\n      for (let i = 0, j = mappers.length; i < j; i++) {\n        mappers[i].fn(e, target);\n      }\n    } else {\n      Logger.getInstance().warn(`[EventManager]: Event mapping not defined for ${e.type}`);\n    }\n  }\n\n  propagate(e: FederatedEvent, type?: string): void {\n    if (!e.target) {\n      return;\n    }\n\n    const composedPath = e.composedPath();\n\n    e.eventPhase = e.CAPTURING_PHASE;\n\n    for (let i = 0, j = composedPath.length - 1; i < j; i++) {\n      e.currentTarget = composedPath[i];\n\n      this.notifyTarget(e, type);\n\n      if (e.propagationStopped || e.propagationImmediatelyStopped) {\n        return;\n      }\n    }\n\n    e.eventPhase = e.AT_TARGET;\n    e.currentTarget = e.target;\n\n    this.notifyTarget(e, type);\n\n    if (e.propagationStopped || e.propagationImmediatelyStopped) {\n      return;\n    }\n\n    e.eventPhase = e.BUBBLING_PHASE;\n\n    for (let i = composedPath.length - 2; i >= 0; i--) {\n      e.currentTarget = composedPath[i];\n      this.notifyTarget(e, type);\n\n      if (e.propagationStopped || e.propagationImmediatelyStopped) {\n        return;\n      }\n    }\n  }\n\n  propagationPath(target: IEventTarget): IEventTarget[] {\n    const propagationPath = [target];\n\n    for (let i = 0; i < PROPAGATION_LIMIT && target !== this.rootTarget && target.parent; i++) {\n      if (!target.parent) {\n        throw new Error('Cannot find propagation path to disconnected target');\n      }\n\n      propagationPath.push(target.parent);\n\n      target = target.parent;\n    }\n\n    propagationPath.reverse();\n\n    return propagationPath;\n  }\n\n  protected notifyTarget(e: FederatedEvent, type?: string): void {\n    if (this.pauseNotify) {\n      return;\n    }\n    type = type ?? e.type;\n    const key = e.eventPhase === e.CAPTURING_PHASE || e.eventPhase === e.AT_TARGET ? `${type}capture` : type;\n\n    this.notifyListeners(e, key);\n\n    if (e.eventPhase === e.AT_TARGET) {\n      this.notifyListeners(e, type);\n    }\n  }\n\n  protected onPointerDown = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const e = this.createPointerEvent(from, from.type, target);\n\n    this.dispatchEvent(e, 'pointerdown');\n\n    if (e.pointerType === 'touch') {\n      this.dispatchEvent(e, 'touchstart');\n    } else if (isMouseLike(e.pointerType)) {\n      const isRightButton = e.button === 2;\n\n      this.dispatchEvent(e, isRightButton ? 'rightdown' : 'mousedown');\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n\n    trackingData.pressTargetsByButton[from.button] = e.composedPath();\n\n    this.freeEvent(e);\n  };\n\n  protected onPointerMove = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const e = this.createPointerEvent(from, from.type, target);\n    const isMouse = isMouseLike(e.pointerType);\n    const trackingData = this.trackingData(from.pointerId);\n    const outTarget = this.findMountedTarget(trackingData.overTargets);\n\n    if (trackingData.overTargets && outTarget && outTarget !== this.rootTarget && outTarget !== e.target) {\n      const outType = from.type === 'mousemove' ? 'mouseout' : 'pointerout';\n      const outEvent = this.createPointerEvent(from, outType, outTarget || undefined);\n\n      this.dispatchEvent(outEvent, 'pointerout');\n      if (isMouse) {\n        this.dispatchEvent(outEvent, 'mouseout');\n      }\n      if (!e.composedPath().includes(outTarget!)) {\n        const leaveEvent = this.createPointerEvent(from, 'pointerleave', outTarget || undefined);\n\n        leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n\n        while (leaveEvent.target && !e.composedPath().includes(leaveEvent.target)) {\n          leaveEvent.currentTarget = leaveEvent.target;\n\n          this.notifyTarget(leaveEvent);\n          if (isMouse) {\n            this.notifyTarget(leaveEvent, 'mouseleave');\n          }\n\n          leaveEvent.target = leaveEvent.target.parent as IEventTarget;\n        }\n\n        this.freeEvent(leaveEvent);\n      }\n\n      this.freeEvent(outEvent);\n    }\n\n    if (outTarget !== e.target) {\n      const overType = from.type === 'mousemove' ? 'mouseover' : 'pointerover';\n      const overEvent = this.clonePointerEvent(e, overType);\n\n      this.dispatchEvent(overEvent, 'pointerover');\n      if (isMouse) {\n        this.dispatchEvent(overEvent, 'mouseover');\n      }\n\n      let overTargetAncestor = outTarget?.parent;\n\n      while (overTargetAncestor && overTargetAncestor !== this.rootTarget.parent) {\n        if (overTargetAncestor === e.target) {\n          break;\n        }\n\n        overTargetAncestor = overTargetAncestor.parent;\n      }\n\n      const didPointerEnter = !overTargetAncestor || overTargetAncestor === this.rootTarget.parent;\n\n      if (didPointerEnter) {\n        const enterEvent = this.clonePointerEvent(e, 'pointerenter');\n\n        enterEvent.eventPhase = enterEvent.AT_TARGET;\n\n        let currentTarget = enterEvent.target;\n        // 预先计算 outTarget 的所有祖先\n        const outTargetAncestors = new Set<IEventTarget>();\n        let ancestor = outTarget;\n        while (ancestor && ancestor !== this.rootTarget) {\n          outTargetAncestors.add(ancestor);\n          ancestor = ancestor.parent;\n        }\n\n        while (currentTarget && currentTarget !== outTarget && currentTarget !== this.rootTarget.parent) {\n          // 检查 currentTarget 是否是 outTarget 的祖先\n          if (!outTargetAncestors.has(currentTarget)) {\n            enterEvent.currentTarget = currentTarget;\n\n            this.notifyTarget(enterEvent);\n            if (isMouse) {\n              this.notifyTarget(enterEvent, 'mouseenter');\n            }\n          }\n\n          currentTarget = currentTarget.parent as IEventTarget;\n        }\n\n        this.freeEvent(enterEvent);\n      }\n\n      this.freeEvent(overEvent);\n    }\n\n    const propagationMethod = 'dispatchEvent';\n\n    this[propagationMethod](e, 'pointermove');\n\n    if (e.pointerType === 'touch') {\n      this[propagationMethod](e, 'touchmove');\n    }\n\n    if (isMouse) {\n      this[propagationMethod](e, 'mousemove');\n      this.cursorTarget = e.target;\n      this.cursor = (e.target?.attribute?.cursor as Cursor) || this.rootTarget.getCursor();\n    }\n\n    trackingData.overTargets = e.composedPath();\n\n    this.freeEvent(e);\n  };\n\n  protected onPointerOver = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n    const e = this.createPointerEvent(from, from.type, target);\n    const isMouse = isMouseLike(e.pointerType);\n\n    this.dispatchEvent(e, 'pointerover');\n    if (isMouse) {\n      this.dispatchEvent(e, 'mouseover');\n    }\n    if (e.pointerType === 'mouse') {\n      this.cursorTarget = e.target;\n      this.cursor = (e.target?.attribute?.cursor as Cursor) || this.rootTarget.getCursor();\n    }\n\n    const enterEvent = this.clonePointerEvent(e, 'pointerenter');\n\n    enterEvent.eventPhase = enterEvent.AT_TARGET;\n\n    while (enterEvent.target && enterEvent.target !== this.rootTarget.parent) {\n      enterEvent.currentTarget = enterEvent.target;\n\n      this.notifyTarget(enterEvent);\n      if (isMouse) {\n        this.notifyTarget(enterEvent, 'mouseenter');\n      }\n\n      enterEvent.target = enterEvent.target.parent as IEventTarget;\n    }\n\n    trackingData.overTargets = e.composedPath();\n\n    this.freeEvent(e);\n    this.freeEvent(enterEvent);\n  };\n\n  protected onPointerOut = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n\n    if (trackingData.overTargets) {\n      const isMouse = isMouseLike(from.pointerType);\n      const outTarget = this.findMountedTarget(trackingData.overTargets);\n\n      const outEvent = this.createPointerEvent(from, 'pointerout', outTarget || undefined);\n\n      this.dispatchEvent(outEvent);\n      if (isMouse) {\n        this.dispatchEvent(outEvent, 'mouseout');\n      }\n\n      const leaveEvent = this.createPointerEvent(from, 'pointerleave', outTarget || undefined);\n\n      leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n\n      while (leaveEvent.target && leaveEvent.target !== this.rootTarget.parent) {\n        leaveEvent.currentTarget = leaveEvent.target;\n\n        this.notifyTarget(leaveEvent);\n        if (isMouse) {\n          this.notifyTarget(leaveEvent, 'mouseleave');\n        }\n\n        leaveEvent.target = leaveEvent.target.parent as IEventTarget;\n      }\n\n      trackingData.overTargets = [];\n\n      this.freeEvent(outEvent);\n      this.freeEvent(leaveEvent);\n    }\n\n    this.cursorTarget = null;\n    this.cursor = '';\n  };\n\n  protected onPointerUp = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const now = clock.now();\n    const e = this.createPointerEvent(from, from.type, target);\n\n    this.dispatchEvent(e, 'pointerup');\n\n    if (e.pointerType === 'touch') {\n      this.dispatchEvent(e, 'touchend');\n    } else if (isMouseLike(e.pointerType)) {\n      const isRightButton = e.button === 2;\n\n      this.dispatchEvent(e, isRightButton ? 'rightup' : 'mouseup');\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n    const pressTarget = this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);\n\n    let clickTarget = pressTarget;\n\n    if (pressTarget && !e.composedPath().includes(pressTarget)) {\n      let currentTarget = pressTarget;\n\n      while (currentTarget && !e.composedPath().includes(currentTarget)) {\n        e.currentTarget = currentTarget;\n\n        this.notifyTarget(e, 'pointerupoutside');\n\n        if (e.pointerType === 'touch') {\n          this.notifyTarget(e, 'touchendoutside');\n        } else if (isMouseLike(e.pointerType)) {\n          const isRightButton = e.button === 2;\n\n          this.notifyTarget(e, isRightButton ? 'rightupoutside' : 'mouseupoutside');\n        }\n\n        currentTarget = currentTarget.parent as IEventTarget;\n      }\n\n      delete trackingData.pressTargetsByButton[from.button];\n\n      clickTarget = currentTarget;\n    }\n\n    if (clickTarget) {\n      const clickEvent = this.clonePointerEvent(e, 'click');\n\n      clickEvent.target = clickTarget;\n      clickEvent.path = [];\n      clickEvent.detailPath = [];\n\n      if (!trackingData.clicksByButton[from.button]) {\n        trackingData.clicksByButton[from.button] = {\n          clickCount: 0,\n          target: clickEvent.target,\n          timeStamp: now\n        };\n      }\n\n      const clickHistory = trackingData.clicksByButton[from.button];\n      if (\n        clickHistory.target === clickEvent.target &&\n        now - clickHistory.timeStamp < (this._config.clickInterval ?? DEFAULT_CLICK_INTERVAL)\n      ) {\n        ++clickHistory.clickCount;\n      } else {\n        clickHistory.clickCount = 1;\n      }\n\n      clickHistory.target = clickEvent.target;\n      clickHistory.timeStamp = now;\n\n      clickEvent.detail = clickHistory.clickCount;\n\n      if (isMouseLike(clickEvent.pointerType)) {\n        this.dispatchEvent(clickEvent, 'click');\n\n        if (clickHistory.clickCount === 2) {\n          // 双击\n          this.dispatchEvent(clickEvent, 'dblclick');\n        }\n      } else if (clickEvent.pointerType === 'touch' && this._config.supportsTouchEvents) {\n        this.dispatchEvent(clickEvent, 'tap');\n        if (clickHistory.clickCount === 2) {\n          // 双击\n          this.dispatchEvent(clickEvent, 'dbltap');\n        }\n      }\n\n      this.dispatchEvent(clickEvent, 'pointertap');\n\n      this.freeEvent(clickEvent);\n    }\n\n    this.freeEvent(e);\n  };\n\n  protected onPointerUpOutside = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedPointerEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-pointer event as a pointer event');\n\n      return;\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n    const pressTarget = this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);\n    const e = this.createPointerEvent(from, from.type, target);\n\n    if (pressTarget) {\n      let currentTarget = pressTarget;\n\n      while (currentTarget) {\n        e.currentTarget = currentTarget;\n\n        this.notifyTarget(e, 'pointerupoutside');\n\n        if (e.pointerType === 'touch') {\n          this.notifyTarget(e, 'touchendoutside');\n        } else if (isMouseLike(e.pointerType)) {\n          this.notifyTarget(e, e.button === 2 ? 'rightupoutside' : 'mouseupoutside');\n        }\n\n        currentTarget = currentTarget.parent as IEventTarget;\n      }\n\n      delete trackingData.pressTargetsByButton[from.button];\n    }\n\n    this.freeEvent(e);\n  };\n\n  protected onWheel = (from: FederatedEvent, target: IEventTarget) => {\n    if (!(from instanceof FederatedWheelEvent)) {\n      Logger.getInstance().warn('EventManager cannot map a non-wheel event as a wheel event');\n\n      return;\n    }\n\n    const wheelEvent = this.createWheelEvent(from, target);\n\n    this.dispatchEvent(wheelEvent);\n    this.freeEvent(wheelEvent);\n  };\n\n  protected findMountedTarget(propagationPath: IEventTarget[] | null): IEventTarget | null {\n    if (!propagationPath) {\n      return null;\n    }\n\n    let currentTarget = propagationPath[0];\n\n    for (let i = 1; i < propagationPath.length; i++) {\n      if (propagationPath[i].parent === currentTarget) {\n        currentTarget = propagationPath[i];\n      } else {\n        break;\n      }\n    }\n\n    return currentTarget;\n  }\n\n  protected createPointerEvent(\n    from: FederatedPointerEvent,\n    type?: string,\n    target?: IEventTarget\n  ): FederatedPointerEvent {\n    const event = this.allocateEvent(FederatedPointerEvent);\n\n    this.copyPointerData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from;\n\n    if (target) {\n      event.target = target;\n    } else {\n      event.target = this.pickTarget(event.viewX ?? event.global.x, event.viewY ?? event.global.y, event);\n    }\n\n    if (typeof type === 'string') {\n      event.type = type;\n    }\n\n    return event;\n  }\n\n  protected createWheelEvent(from: FederatedWheelEvent, target?: IEventTarget): FederatedWheelEvent {\n    const event = this.allocateEvent(FederatedWheelEvent);\n\n    this.copyWheelData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from;\n    event.target = target || this.pickTarget(event.viewX ?? event.global.x, event.viewY ?? event.global.y, event);\n\n    return event;\n  }\n\n  protected clonePointerEvent(from: FederatedPointerEvent, type?: string): FederatedPointerEvent {\n    const event = this.allocateEvent(FederatedPointerEvent);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from.originalEvent;\n\n    this.copyPointerData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.target = from.target;\n    event.path = from.composedPath().slice();\n    const p = from.composedDetailPath();\n    event.detailPath = p && p.slice();\n    event.type = type ?? event.type;\n\n    return event;\n  }\n\n  copyWheelData(from: FederatedWheelEvent, to: FederatedWheelEvent): void {\n    to.deltaMode = from.deltaMode;\n    to.deltaX = from.deltaX;\n    to.deltaY = from.deltaY;\n    to.deltaZ = from.deltaZ;\n  }\n\n  copyPointerData(from: FederatedEvent, to: FederatedEvent): void {\n    if (!(from instanceof FederatedPointerEvent && to instanceof FederatedPointerEvent)) {\n      return;\n    }\n\n    to.pointerId = from.pointerId;\n    to.width = from.width;\n    to.height = from.height;\n    to.isPrimary = from.isPrimary;\n    to.pointerType = from.pointerType;\n    to.pressure = from.pressure;\n    to.tangentialPressure = from.tangentialPressure;\n    to.tiltX = from.tiltX;\n    to.tiltY = from.tiltY;\n    to.twist = from.twist;\n  }\n\n  copyMouseData(from: FederatedEvent, to: FederatedEvent): void {\n    if (!(from instanceof FederatedMouseEvent && to instanceof FederatedMouseEvent)) {\n      return;\n    }\n\n    to.altKey = from.altKey;\n    to.button = from.button;\n    to.buttons = from.buttons;\n    to.ctrlKey = from.ctrlKey;\n    to.shiftKey = from.shiftKey;\n    to.metaKey = from.metaKey;\n\n    ['client', 'movement', 'canvas', 'screen', 'global', 'offset', 'viewport'].forEach(key => {\n      to[key].x = from[key].x;\n      to[key].y = from[key].y;\n    });\n  }\n\n  copyData(from: FederatedEvent, to: FederatedEvent): void {\n    to.isTrusted = from.isTrusted;\n    to.srcElement = from.srcElement;\n    to.timeStamp = clock.now();\n    to.type = from.type;\n    to.detail = from.detail;\n    to.view = from.view;\n    to.which = from.which;\n\n    to.layer.x = from.layer.x;\n    to.layer.y = from.layer.y;\n\n    to.page.x = from.page.x;\n    to.page.y = from.page.y;\n\n    (to as any).pickParams = (from as any).pickParams;\n  }\n\n  protected trackingData(id: number): TrackingData {\n    if (!this.mappingState.trackingData[id]) {\n      this.mappingState.trackingData[id] = {\n        pressTargetsByButton: {},\n        clicksByButton: {},\n        overTarget: null\n      };\n    }\n\n    return this.mappingState.trackingData[id];\n  }\n\n  protected allocateEvent<T extends FederatedEvent>(constructor: { new (boundary: EventManager): T }): T {\n    if (!this.eventPool.has(constructor as any)) {\n      this.eventPool.set(constructor as any, []);\n    }\n\n    const event = (this.eventPool.get(constructor as any)?.pop() as T) || new constructor(this);\n\n    event.eventPhase = event.NONE;\n    event.currentTarget = null;\n    event.path = [];\n    event.detailPath = [];\n    event.target = null;\n\n    return event;\n  }\n\n  protected freeEvent<T extends FederatedEvent>(event: T): void {\n    if (event.manager !== this) {\n      throw new Error('It is illegal to free an event not managed by this EventManager!');\n    }\n\n    const constructor = event.constructor;\n\n    if (!this.eventPool.has(constructor as any)) {\n      this.eventPool.set(constructor as any, []);\n    }\n\n    this.eventPool.get(constructor as any)?.push(event);\n  }\n\n  private notifyListeners(e: FederatedEvent, type: string): void {\n    const events = (e.currentTarget as any)._events as EmitterListeners;\n    const listeners = events[type];\n\n    if (listeners) {\n      if ('fn' in listeners) {\n        if (listeners.once) {\n          e.currentTarget.removeEventListener(type, listeners.fn, { once: true });\n        }\n        listeners.fn.call(listeners.context, e);\n      } else {\n        for (let i = 0, j = listeners.length; i < j && !e.propagationImmediatelyStopped; i++) {\n          if (listeners[i].once) {\n            e.currentTarget.removeEventListener(type, listeners[i].fn, { once: true });\n          }\n          listeners[i].fn.call(listeners[i].context, e);\n        }\n      }\n    }\n    // 永远触发WILDCARD事件代理\n    this.emitDelegation(e, type);\n  }\n\n  private emitDelegation(e: FederatedEvent, type: string): void {\n    const events = (e.currentTarget as any)._events as EmitterListeners;\n    const listeners = events[WILDCARD];\n    if (listeners) {\n      if ('fn' in listeners) {\n        listeners.fn.call(listeners.context, e, type);\n      } else {\n        for (let i = 0, j = listeners.length; i < j && !e.propagationImmediatelyStopped; i++) {\n          listeners[i].fn.call(listeners[i].context, e, type);\n        }\n      }\n    }\n  }\n\n  private pickTarget(x: number, y: number, e: any) {\n    let target;\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const pickResult = this.rootTarget.pick(x, y);\n    if (pickResult && pickResult.graphic) {\n      target = pickResult.graphic;\n    } else if (pickResult && pickResult.group) {\n      target = pickResult.group;\n      // } else if (x >= 0 && x <= get(this.rootTarget, 'width') && y >= 0 && y <= get(this.rootTarget, 'height')) {\n    } else if ((this.rootTarget as unknown as IGraphic).AABBBounds.contains(x, y)) {\n      target = this.rootTarget;\n    } else {\n      target = null;\n    }\n    if (e) {\n      e.pickParams = pickResult.params;\n    }\n    return target;\n  }\n\n  release() {\n    this.dispatch.removeAllListeners();\n    this.eventPool.clear();\n    this.rootTarget = null;\n    this.mappingTable = null;\n    this.mappingState = null;\n    this.cursorTarget = null;\n  }\n}\n"]}