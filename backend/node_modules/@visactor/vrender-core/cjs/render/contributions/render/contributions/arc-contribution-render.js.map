{"version":3,"sources":["../src/render/contributions/render/contributions/arc-contribution-render.ts"],"names":[],"mappings":"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","file":"arc-contribution-render.js","sourcesContent":["import type {\n  IGraphicAttribute,\n  IContext2d,\n  IMarkAttribute,\n  IArc,\n  IArcGraphicAttribute,\n  IThemeAttribute,\n  IArcRenderContribution,\n  IDrawContext,\n  IBorderStyle\n} from '../../../../interface';\nimport { getScaledStroke } from '../../../../common/canvas-utils';\nimport { defaultBaseBackgroundRenderContribution } from './base-contribution-render';\nimport { drawArcPath } from '../utils';\nimport { BaseRenderContributionTime } from '../../../../common/enums';\nimport { defaultBaseTextureRenderContribution } from './base-texture-contribution-render';\n\nexport class DefaultArcRenderContribution implements IArcRenderContribution {\n  time: BaseRenderContributionTime = BaseRenderContributionTime.afterFillStroke;\n  useStyle: boolean = true;\n  order: number = 0;\n  drawShape(\n    arc: IArc,\n    context: IContext2d,\n    x: number,\n    y: number,\n    doFill: boolean,\n    doStroke: boolean,\n    fVisible: boolean,\n    sVisible: boolean,\n    arcAttribute: Required<IArcGraphicAttribute>,\n    drawContext: IDrawContext,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ) {\n    const { outerBorder, innerBorder } = arc.attribute;\n    const doOuterBorder = outerBorder && outerBorder.visible !== false;\n    const doInnerBorder = innerBorder && innerBorder.visible !== false;\n    if (!(doOuterBorder || doInnerBorder)) {\n      return;\n    }\n    const {\n      innerPadding = arcAttribute.innerPadding,\n      outerPadding = arcAttribute.outerPadding,\n      startAngle = arcAttribute.startAngle,\n      endAngle = arcAttribute.endAngle,\n      opacity = arcAttribute.opacity,\n      x: originX = arcAttribute.x,\n      y: originY = arcAttribute.y,\n      scaleX = arcAttribute.scaleX,\n      scaleY = arcAttribute.scaleY,\n      keepStrokeScale = arcAttribute.keepStrokeScale\n    } = arc.attribute;\n    let { innerRadius = arcAttribute.innerRadius, outerRadius = arcAttribute.outerRadius } = arc.attribute;\n    outerRadius += outerPadding;\n    innerRadius -= innerPadding;\n\n    const renderBorder = (borderStyle: Partial<IBorderStyle>, key: 'outerBorder' | 'innerBorder') => {\n      const doStroke = !!(borderStyle && borderStyle.stroke);\n\n      const { distance = arcAttribute[key].distance } = borderStyle;\n      const d = keepStrokeScale ? (distance as number) : getScaledStroke(context, distance as number, context.dpr);\n      const deltaAngle = (distance as number) / outerRadius;\n      const sign = key === 'outerBorder' ? 1 : -1;\n      arc.setAttributes({\n        outerRadius: outerRadius + sign * d,\n        innerRadius: innerRadius - sign * d,\n        startAngle: startAngle - sign * deltaAngle,\n        endAngle: endAngle + sign * deltaAngle\n      } as any);\n      context.beginPath();\n      drawArcPath(arc, context, x, y, outerRadius + sign * d, innerRadius - sign * d);\n      // shadow\n      context.setShadowBlendStyle && context.setShadowBlendStyle(arc, arc.attribute, arcAttribute);\n\n      if (strokeCb) {\n        strokeCb(context, borderStyle, arcAttribute[key]);\n      } else if (doStroke) {\n        // 存在stroke\n        const lastOpacity = (arcAttribute[key] as any).opacity;\n        (arcAttribute[key] as any).opacity = opacity;\n        context.setStrokeStyle(\n          arc,\n          borderStyle,\n          (originX - x) / scaleX,\n          (originY - y) / scaleY,\n          arcAttribute[key] as any\n        );\n        (arcAttribute[key] as any).opacity = lastOpacity;\n        context.stroke();\n      }\n    };\n\n    doOuterBorder && renderBorder(outerBorder, 'outerBorder');\n    doInnerBorder && renderBorder(innerBorder, 'innerBorder');\n    arc.setAttributes({ outerRadius: outerRadius, innerRadius: innerRadius, startAngle, endAngle } as any);\n  }\n}\n\nexport const defaultArcRenderContribution = new DefaultArcRenderContribution();\nexport const defaultArcTextureRenderContribution = defaultBaseTextureRenderContribution;\nexport const defaultArcBackgroundRenderContribution = defaultBaseBackgroundRenderContribution;\n"]}