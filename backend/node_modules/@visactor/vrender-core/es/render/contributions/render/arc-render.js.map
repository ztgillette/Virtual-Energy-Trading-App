{"version":3,"sources":["../src/render/contributions/render/arc-render.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,kBAAkB,CAAC;AACtF,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,MAAM,gCAAgC,CAAC;AAC3E,OAAO,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAClD,OAAO,EAAE,WAAW,EAAE,MAAM,uBAAuB,CAAC;AAEpD,OAAO,EAAE,oBAAoB,EAAE,MAAM,uCAAuC,CAAC;AAC7E,OAAO,EAAE,wBAAwB,EAAE,MAAM,iBAAiB,CAAC;AAkB3D,OAAO,EAAE,cAAc,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,SAAS,CAAC;AACnE,OAAO,EAAE,kBAAkB,EAAE,MAAM,kCAAkC,CAAC;AACtE,OAAO,EAAE,qBAAqB,EAAE,MAAM,2BAA2B,CAAC;AAClE,OAAO,EAAE,eAAe,EAAE,MAAM,4BAA4B,CAAC;AAC7D,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EACL,sCAAsC,EACtC,4BAA4B,EAC5B,mCAAmC,EACpC,MAAM,iBAAiB,CAAC;AAmBlB,IAAM,sBAAsB,GAA5B,MAAM,sBAAuB,SAAQ,UAAgB;IAI1D,YAGqB,0BAAyE;QAE5F,KAAK,EAAE,CAAC;QAFW,+BAA0B,GAA1B,0BAA0B,CAA+C;QAL9F,eAAU,GAAW,eAAe,CAAC;QAQnC,IAAI,CAAC,oBAAoB,GAAG;YAC1B,4BAA4B;YAC5B,sCAAsC;YACtC,mCAAmC;SACpC,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;IACxC,CAAC;IAGD,kBAAkB,CAChB,GAAS,EACT,OAA6B,EAC7B,EAAU,EACV,EAAU,EACV,WAAmB,EACnB,WAAmB,EACnB,GAAW,EACX,GAAW;QAEX,MAAM,QAAQ,GAAG,GAAG,GAAG,GAAG,CAAC;QAC3B,MAAM,IAAI,GAAG,GAAG,CAAC,cAAc,EAAE,CAAC;QAClC,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QACnC,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC7B,QAAQ,GAAG,GAAG,CAAC;QAEf,MAAM,UAAU,GAAG,GAAG,CAAC,QAAQ,GAAG,UAAU,CAAC,CAAC;QAC9C,MAAM,SAAS,GAAY,QAAQ,GAAG,UAAU,CAAC;QACjD,IAAI,eAAe,GAAY,KAAK,CAAC;QAErC,IAAI,WAAW,GAAG,WAAW,EAAE;YAC7B,MAAM,IAAI,GAAG,WAAW,CAAC;YACzB,WAAW,GAAG,WAAW,CAAC;YAC1B,WAAW,GAAG,IAAI,CAAC;SACpB;QAED,MAAM,EACJ,eAAe,EACf,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,UAAU,EACV,sBAAsB,EACtB,oBAAoB,EACpB,oBAAoB,EACpB,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,UAAU,EACV,eAAe,EACf,eAAe,EACf,sBAAsB,EACtB,oBAAoB,EACpB,oBAAoB,EACrB,GAAG,wBAAwB,CAAC,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;QAElF,IAAI,UAAU,GAAG,OAAO,EAAE;YACxB,MAAM,iBAAiB,GAAG,GAAG,CAAC,sBAAsB,EAAE,UAAU,CAAC,CAAC;YAClE,MAAM,eAAe,GAAG,GAAG,CAAC,oBAAoB,EAAE,UAAU,CAAC,CAAC;YAE9D,MAAM,EAAE,GAAG,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,iBAAiB,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACrG,MAAM,EAAE,GAAG,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YAGnG,IAAI,UAAU,GAAG,oBAAoB,IAAI,iBAAiB,KAAK,eAAe,EAAE;gBAC9E,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;gBACzD,OAAO,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE,UAAU,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;aAC3G;iBAAM;gBACL,MAAM,EAAE,GAAG,QAAQ,GAAG,QAAQ,GAAG,IAAI,CAAC;gBACtC,MAAM,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;gBACjC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,SAAS,CAAC,CAAC;gBACrD,eAAe,GAAG,CAAC;oBACjB,OAAO,CAAC,GAAG,CACT,EAAE,GAAG,EAAE,CAAC,EAAE,EACV,EAAE,GAAG,EAAE,CAAC,EAAE,EACV,eAAe,EACf,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EACrB,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EACrB,CAAC,SAAS,CACX,CAAC;aACL;SACF;aAAM;YACL,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;SACtC;QAYD,IAAI,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,IAAI,eAAe,GAAG,KAAK,EAAE;YACvD,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;YACrC,eAAe,GAAG,IAAI,CAAC;SACxB;aAAM,IAAI,UAAU,GAAG,OAAO,EAAE;YAC/B,MAAM,iBAAiB,GAAG,GAAG,CAAC,sBAAsB,EAAE,UAAU,CAAC,CAAC;YAClE,MAAM,eAAe,GAAG,GAAG,CAAC,oBAAoB,EAAE,UAAU,CAAC,CAAC;YAE9D,MAAM,EAAE,GAAG,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACpG,MAAM,EAAE,GAAG,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,iBAAiB,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YAEtG,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YAGzD,IAAI,UAAU,GAAG,oBAAoB,IAAI,iBAAiB,KAAK,eAAe,EAAE;gBAC9E,MAAM,WAAW,GAAG,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;gBAC1C,OAAO,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE,UAAU,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EAAE,WAAW,EAAE,CAAC,SAAS,CAAC,CAAC;aACjG;iBAAM;gBACL,eAAe,GAAG,CAAC;oBACjB,OAAO,CAAC,GAAG,CACT,EAAE,GAAG,EAAE,CAAC,EAAE,EACV,EAAE,GAAG,EAAE,CAAC,EAAE,EACV,eAAe,EACf,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EACrB,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,EACrB,CAAC,SAAS,CACX,CAAC;gBACJ,MAAM,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;gBACjD,MAAM,EAAE,GAAG,QAAQ,GAAG,QAAQ,GAAG,IAAI,CAAC;gBACtC,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;aACrD;SACF;aAAM;YACL,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,WAAW,GAAG,GAAG,CAAC,eAAe,CAAC,EAAE,EAAE,GAAG,WAAW,GAAG,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC;SAClG;QAED,OAAO,eAAe,CAAC;IACzB,CAAC;IAED,SAAS,CACP,GAAS,EACT,OAAmB,EACnB,CAAS,EACT,CAAS,EACT,WAAyB,EACzB,MAAiC,EACjC,MAIY,EACZ,QAIY,EACZ,YAA6C;QAG7C,YAAY,GAAG,YAAY,aAAZ,YAAY,cAAZ,YAAY,GAAI,QAAQ,CAAC,GAAG,EAAE,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,CAAC,CAAC,GAAG,CAAC;QAChE,MAAM,EACJ,IAAI,GAAG,YAAY,CAAC,IAAI,EACxB,MAAM,GAAG,YAAY,CAAC,MAAM,EAC5B,CAAC,EAAE,OAAO,GAAG,YAAY,CAAC,CAAC,EAC3B,CAAC,EAAE,OAAO,GAAG,YAAY,CAAC,CAAC,EAC3B,eAAe,GAAG,YAAY,CAAC,eAAe,EAC/C,GAAG,GAAG,CAAC,SAAS,CAAC;QAClB,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;QAC7D,IAAI,CAAC,IAAI,EAAE;YACT,OAAO;SACR;QACD,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;QAEtD,MAAM,EACJ,YAAY,GAAG,YAAY,CAAC,YAAY,EACxC,YAAY,GAAG,YAAY,CAAC,YAAY,EACxC,GAAG,GAAG,YAAY,CAAC,GAAG,EACtB,YAAY,GAAG,YAAY,CAAC,YAAY,EACzC,GAAG,GAAG,CAAC,SAAS,CAAC;QAClB,IAAI,EAAE,WAAW,GAAG,YAAY,CAAC,WAAW,EAAE,WAAW,GAAG,YAAY,CAAC,WAAW,EAAE,GAAG,GAAG,CAAC,SAAS,CAAC;QACvG,WAAW,IAAI,YAAY,CAAC;QAC5B,WAAW,IAAI,YAAY,CAAC;QAE5B,IAAI,aAAa,GAAG,CAAC,CAAC;QACtB,MAAM,sBAAsB,GAC1B,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAK,GAAiB,CAAC,CAAC,CAAC,CAAC,IAAK,IAAuB,CAAC,QAAQ,KAAK,SAAS,CAAC;QACxG,IAAI,sBAAsB,EAAE;YAC1B,MAAM,EAAE,EAAE,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,GAAG,CAAC,cAAc,EAAE,CAAC;YAC1D,IAAI,GAAG,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,GAAG,GAAG,OAAO,EAAE;gBAC9C,aAAa,GAAG,EAAE,IAAI,CAAC,CAAC;gBACvB,IAAyB,CAAC,UAAU,IAAI,aAAa,CAAC;gBACtD,IAAyB,CAAC,QAAQ,IAAI,aAAa,CAAC;aACtD;SACF;QAED,IAAI,8BAA8B,GAAG,KAAK,CAAC;QAC3C,MAAM,EAAE,YAAY,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC;QAClE,IAAI,MAAM,IAAI,YAAY,EAAE;YAC1B,OAAO,CAAC,SAAS,EAAE,CAAC;YAYpB,WAAW,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;YAE1D,8BAA8B,GAAG,IAAI,CAAC;YAEtC,OAAO,CAAC,mBAAmB,IAAI,OAAO,CAAC,mBAAmB,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;YAC7F,IAAI,CAAC,gBAAgB,CACnB,GAAG,EACH,OAAO,EACP,CAAC,EACD,CAAC,EACD,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,MAAM,EACN,QAAQ,CACT,CAAC;YAyBF,IAAI,CAAC,eAAe,EAAE;gBACpB,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;gBAC5F,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,EAAE,QAAQ,EAAE,YAAY,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;aAC/F;iBAAM;gBACL,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,EAAE,QAAQ,EAAE,YAAY,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAC9F,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;aAC7F;SACF;QAGD,IAAI,CAAC,YAAY,IAAI,QAAQ,EAAE;YAC7B,OAAO,CAAC,SAAS,EAAE,CAAC;YACpB,MAAM,eAAe,GAAG,WAAW,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,WAAW,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;YAE/F,IAAI,CAAC,8BAA8B,EAAE;gBACnC,IAAI,CAAC,gBAAgB,CACnB,GAAG,EACH,OAAO,EACP,CAAC,EACD,CAAC,EACD,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,MAAM,EACN,QAAQ,CACT,CAAC;aACH;YAED,IAAI,QAAQ,EAAE;gBACZ,QAAQ,CAAC,OAAO,EAAE,GAAG,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;aAChD;iBAAM,IAAI,QAAQ,EAAE;gBACnB,OAAO,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;gBAC/D,OAAO,CAAC,MAAM,EAAE,CAAC;aAClB;SACF;QAGD,IAAI,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAK,GAAiB,CAAC,CAAC,CAAC,CAAC,IAAI,YAAY,EAAE;YACtE,MAAM,EAAE,UAAU,EAAE,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,cAAc,EAAE,CAAC;YAC9D,MAAM,UAAU,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;YAChC,IAAI,UAAU,IAAI,GAAG,GAAG,OAAO,EAAE;gBAC/B,OAAO,CAAC,SAAS,EAAE,CAAC;gBACpB,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;gBAEzD,MAAM,QAAQ,GAAG,QAAQ,GAAG,WAAW,CAAC;gBACxC,MAAM,EAAE,QAAQ,GAAG,YAAY,CAAC,QAAQ,EAAE,IAAI,GAAG,YAAY,CAAC,IAAI,EAAE,GAAG,GAAG,CAAC,SAAS,CAAC;gBACrF,MAAM,UAAU,GAAG,QAAQ,CAAC;gBAC5B,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE,UAAU,GAAG,QAAQ,CAAC,CAAC;gBAEzG,IAAI,CAAC,8BAA8B,EAAE;oBACnC,IAAI,CAAC,gBAAgB,CACnB,GAAG,EACH,OAAO,EACP,CAAC,EACD,CAAC,EACD,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,MAAM,EACN,QAAQ,CACT,CAAC;iBACH;gBAED,MAAM,QAAQ,GAAG,GAAG,EAAE;oBACpB,IAAI,MAAM,EAAE;wBAEV,MAAM,KAAK,GAAG,IAAI,CAAC;wBACnB,IAAK,KAAwB,CAAC,QAAQ,KAAK,SAAS,EAAE;4BACpD,MAAM,SAAS,GAAG,kBAAkB,CAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,EAAE,KAAY,CAAC,CAAC;4BACnE,IAAI,MAAM,EAAE;6BAEX;iCAAM,IAAI,WAAW,EAAE;gCAEtB,OAAO,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;gCAC/D,OAAO,CAAC,SAAS,GAAG,SAAmB,CAAC;gCACxC,OAAO,CAAC,IAAI,EAAE,CAAC;6BAChB;yBACF;qBACF;gBACH,CAAC,CAAC;gBAEF,MAAM,UAAU,GAAG,GAAG,EAAE;oBACtB,IAAI,QAAQ,EAAE;wBACZ,IAAI,QAAQ,EAAE;yBAEb;6BAAM,IAAI,QAAQ,EAAE;4BACnB,OAAO,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;4BAE/D,OAAO,CAAC,MAAM,EAAE,CAAC;yBAClB;qBACF;gBACH,CAAC,CAAC;gBAEF,IAAI,CAAC,eAAe,EAAE;oBACpB,QAAQ,EAAE,CAAC;oBACX,UAAU,EAAE,CAAC;iBACd;qBAAM;oBACL,QAAQ,EAAE,CAAC;oBACX,UAAU,EAAE,CAAC;iBACd;aACF;SACF;QAED,IAAI,CAAC,eAAe,CAClB,GAAG,EACH,OAAO,EACP,CAAC,EACD,CAAC,EACD,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,MAAM,EACN,QAAQ,CACT,CAAC;QAEF,IAAI,sBAAsB,EAAE;YACzB,IAAyB,CAAC,UAAU,IAAI,aAAa,CAAC;YACtD,IAAyB,CAAC,QAAQ,IAAI,aAAa,CAAC;SACtD;IACH,CAAC;IAEO,QAAQ,CACd,GAAS,EACT,OAAmB,EACnB,CAAS,EACT,CAAS,EACT,YAA4C,EAC5C,MAAe,EACf,QAAiB,EACjB,OAAe,EACf,OAAe,EACf,MAIY;QAEZ,IAAI,MAAM,EAAE;YACV,IAAI,MAAM,EAAE;gBACV,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;aAC9C;iBAAM,IAAI,QAAQ,EAAE;gBACnB,OAAO,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,OAAO,GAAG,CAAC,EAAE,OAAO,GAAG,CAAC,EAAE,YAAY,CAAC,CAAC;gBACnF,OAAO,CAAC,IAAI,EAAE,CAAC;aAChB;SACF;IACH,CAAC;IAEO,UAAU,CAChB,GAAS,EACT,OAAmB,EACnB,CAAS,EACT,CAAS,EACT,YAA4C,EAC5C,QAAiB,EACjB,YAAqB,EACrB,QAAiB,EACjB,QAIY;QAEZ,IAAI,QAAQ,IAAI,YAAY,EAAE;YAC5B,IAAI,QAAQ,EAAE;aAEb;iBAAM,IAAI,QAAQ,EAAE;gBACnB,OAAO,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;gBAE/D,OAAO,CAAC,MAAM,EAAE,CAAC;aAClB;SACF;IACH,CAAC;IAED,IAAI,CAAC,GAAS,EAAE,aAA6B,EAAE,WAAyB,EAAE,MAAiC;QACzG,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,EAAE,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,CAAC,CAAC,GAAG,CAAC;QACtD,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;IAC1E,CAAC;CACF,CAAA;AA3bY,sBAAsB;IADlC,UAAU,EAAE;IAMR,WAAA,MAAM,CAAC,oBAAoB,CAAC,CAAA;IAC5B,WAAA,KAAK,CAAC,qBAAqB,CAAC,CAAA;;GANpB,sBAAsB,CA2blC;SA3bY,sBAAsB","file":"arc-render.js","sourcesContent":["import { abs, atan2, cos, epsilon, min, sin, pi2, isBoolean } from '@visactor/vutils';\nimport { inject, injectable, named } from '../../../common/inversify-lite';\nimport { getTheme } from '../../../graphic/theme';\nimport { parseStroke } from '../../../common/utils';\n// eslint-disable-next-line @typescript-eslint/consistent-type-imports\nimport { ContributionProvider } from '../../../common/contribution-provider';\nimport { calculateArcCornerRadius } from '../render/utils';\nimport type {\n  IContext2d,\n  IArc,\n  IPath2D,\n  IGraphicAttribute,\n  IMarkAttribute,\n  IThemeAttribute,\n  IGradientColor,\n  IArcRenderContribution,\n  IDrawContext,\n  IRenderService,\n  IGraphicRender,\n  IGraphicRenderDrawParams,\n  IContributionProvider,\n  IConicalGradient,\n  IArcGraphicAttribute\n} from '../../../interface';\nimport { cornerTangents, drawArcPath, fillVisible } from './utils';\nimport { getConicGradientAt } from '../../../canvas/conical-gradient';\nimport { ArcRenderContribution } from './contributions/constants';\nimport { ARC_NUMBER_TYPE } from '../../../graphic/constants';\nimport { BaseRender } from './base-render';\nimport {\n  defaultArcBackgroundRenderContribution,\n  defaultArcRenderContribution,\n  defaultArcTextureRenderContribution\n} from './contributions';\n/**\n * 部分源码参考 https://github.com/d3/d3-shape/\n * Copyright 2010-2022 Mike Bostock\n\n  Permission to use, copy, modify, and/or distribute this software for any purpose\n  with or without fee is hereby granted, provided that the above copyright notice\n  and this permission notice appear in all copies.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n  FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\n  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\n  THIS SOFTWARE.\n */\n\n@injectable()\nexport class DefaultCanvasArcRender extends BaseRender<IArc> implements IGraphicRender {\n  type: 'arc';\n  numberType: number = ARC_NUMBER_TYPE;\n\n  constructor(\n    @inject(ContributionProvider)\n    @named(ArcRenderContribution)\n    protected readonly graphicRenderContributions: IContributionProvider<IArcRenderContribution>\n  ) {\n    super();\n    this.builtinContributions = [\n      defaultArcRenderContribution,\n      defaultArcBackgroundRenderContribution,\n      defaultArcTextureRenderContribution\n    ];\n    this.init(graphicRenderContributions);\n  }\n\n  // 绘制尾部cap\n  drawArcTailCapPath(\n    arc: IArc,\n    context: IContext2d | IPath2D,\n    cx: number,\n    cy: number,\n    outerRadius: number,\n    innerRadius: number,\n    _sa: number,\n    _ea: number\n  ) {\n    const capAngle = _ea - _sa;\n    const data = arc.getParsedAngle();\n    const startAngle = data.startAngle;\n    let endAngle = data.endAngle;\n    endAngle = _ea;\n\n    const deltaAngle = abs(endAngle - startAngle);\n    const clockwise: boolean = endAngle > startAngle;\n    let collapsedToLine: boolean = false;\n    // 规范化outerRadius和innerRadius\n    if (outerRadius < innerRadius) {\n      const temp = outerRadius;\n      outerRadius = innerRadius;\n      innerRadius = temp;\n    }\n\n    const {\n      outerDeltaAngle,\n      xors,\n      yors,\n      xirs,\n      yirs,\n      limitedOcr,\n      outerCornerRadiusStart,\n      outerCornerRadiusEnd,\n      maxOuterCornerRadius,\n      xore,\n      yore,\n      xire,\n      yire,\n      limitedIcr,\n      innerDeltaAngle,\n      innerStartAngle,\n      innerCornerRadiusStart,\n      innerCornerRadiusEnd,\n      maxInnerCornerRadius\n    } = calculateArcCornerRadius(arc, startAngle, endAngle, innerRadius, outerRadius);\n\n    if (limitedOcr > epsilon) {\n      const cornerRadiusStart = min(outerCornerRadiusStart, limitedOcr);\n      const cornerRadiusEnd = min(outerCornerRadiusEnd, limitedOcr);\n      // Does the sector’s outer ring have rounded corners?\n      const t0 = cornerTangents(xirs, yirs, xors, yors, outerRadius, cornerRadiusStart, Number(clockwise));\n      const t1 = cornerTangents(xore, yore, xire, yire, outerRadius, cornerRadiusEnd, Number(clockwise));\n\n      // Have the corners merged?\n      if (limitedOcr < maxOuterCornerRadius && cornerRadiusStart === cornerRadiusEnd) {\n        context.moveTo(cx + t0.cx + t0.x01, cy + t0.cy + t0.y01);\n        context.arc(cx + t0.cx, cy + t0.cy, limitedOcr, atan2(t0.y01, t0.x01), atan2(t1.y01, t1.x01), !clockwise);\n      } else {\n        const a1 = endAngle - capAngle - 0.03;\n        const a2 = atan2(t1.y11, t1.x11);\n        context.arc(cx, cy, outerRadius, a1, a2, !clockwise);\n        cornerRadiusEnd > 0 &&\n          context.arc(\n            cx + t1.cx,\n            cy + t1.cy,\n            cornerRadiusEnd,\n            atan2(t1.y11, t1.x11),\n            atan2(t1.y01, t1.x01),\n            !clockwise\n          );\n      }\n    } else {\n      context.moveTo(cx + xors, cy + yors);\n    }\n    //   else {\n    //     // Or is the outer ring just a circular arc?\n    //     if (!partStroke || partStroke[0]) {\n    //       context.moveTo(cx + xors, cy + yors);\n    //       context.arc(cx, cy, outerRadius, outerStartAngle, outerEndAngle, !clockwise);\n    //     } else {\n    //       // context.moveTo(cx + outerRadius * cos(outerEndAngle), cy + yore);\n    //     }\n    //   }\n    //   // Is there no inner ring, and it’s a circular sector?\n    //   // Or perhaps it’s an annular sector collapsed due to padding?\n    if (!(innerRadius > epsilon) || innerDeltaAngle < 0.001) {\n      context.lineTo(cx + xire, cy + yire);\n      collapsedToLine = true;\n    } else if (limitedIcr > epsilon) {\n      const cornerRadiusStart = min(innerCornerRadiusStart, limitedIcr);\n      const cornerRadiusEnd = min(innerCornerRadiusEnd, limitedIcr);\n      // Does the sector’s inner ring (or point) have rounded corners?\n      const t0 = cornerTangents(xire, yire, xore, yore, innerRadius, -cornerRadiusEnd, Number(clockwise));\n      const t1 = cornerTangents(xors, yors, xirs, yirs, innerRadius, -cornerRadiusStart, Number(clockwise));\n\n      context.lineTo(cx + t0.cx + t0.x01, cy + t0.cy + t0.y01);\n\n      // Have the corners merged?\n      if (limitedIcr < maxInnerCornerRadius && cornerRadiusStart === cornerRadiusEnd) {\n        const arcEndAngle = atan2(t1.y01, t1.x01);\n        context.arc(cx + t0.cx, cy + t0.cy, limitedIcr, atan2(t0.y01, t0.x01), arcEndAngle, !clockwise);\n      } else {\n        cornerRadiusEnd > 0 &&\n          context.arc(\n            cx + t0.cx,\n            cy + t0.cy,\n            cornerRadiusEnd,\n            atan2(t0.y01, t0.x01),\n            atan2(t0.y11, t0.x11),\n            !clockwise\n          );\n        const a1 = atan2(t0.cy + t0.y11, t0.cx + t0.x11);\n        const a2 = endAngle - capAngle - 0.03;\n        context.arc(cx, cy, innerRadius, a1, a2, clockwise);\n      }\n    } else {\n      context.lineTo(cx + innerRadius * cos(innerStartAngle), cy + innerRadius * sin(innerStartAngle));\n    }\n\n    return collapsedToLine;\n  }\n\n  drawShape(\n    arc: IArc,\n    context: IContext2d,\n    x: number,\n    y: number,\n    drawContext: IDrawContext,\n    params?: IGraphicRenderDrawParams,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean,\n    arcAttribute?: Required<IArcGraphicAttribute>\n  ) {\n    // const arcAttribute = graphicService.themeService.getCurrentTheme().arcAttribute;\n    arcAttribute = arcAttribute ?? getTheme(arc, params?.theme).arc;\n    const {\n      fill = arcAttribute.fill,\n      stroke = arcAttribute.stroke,\n      x: originX = arcAttribute.x,\n      y: originY = arcAttribute.y,\n      fillStrokeOrder = arcAttribute.fillStrokeOrder\n    } = arc.attribute;\n    const data = this.valid(arc, arcAttribute, fillCb, strokeCb);\n    if (!data) {\n      return;\n    }\n    const { fVisible, sVisible, doFill, doStroke } = data;\n\n    const {\n      outerPadding = arcAttribute.outerPadding,\n      innerPadding = arcAttribute.innerPadding,\n      cap = arcAttribute.cap,\n      forceShowCap = arcAttribute.forceShowCap\n    } = arc.attribute;\n    let { outerRadius = arcAttribute.outerRadius, innerRadius = arcAttribute.innerRadius } = arc.attribute;\n    outerRadius += outerPadding;\n    innerRadius -= innerPadding;\n    // 判断是否是环形渐变，且有头部cap，那就偏移渐变色角度\n    let conicalOffset = 0;\n    const tempChangeConicalColor =\n      ((isBoolean(cap) && cap) || (cap as boolean[])[0]) && (fill as IGradientColor).gradient === 'conical';\n    if (tempChangeConicalColor) {\n      const { sc, startAngle, endAngle } = arc.getParsedAngle();\n      if (abs(endAngle - startAngle) < pi2 - epsilon) {\n        conicalOffset = sc || 0;\n        (fill as IConicalGradient).startAngle -= conicalOffset;\n        (fill as IConicalGradient).endAngle -= conicalOffset;\n      }\n    }\n\n    let beforeRenderContribitionsRuned = false;\n    const { isFullStroke, stroke: arrayStroke } = parseStroke(stroke);\n    if (doFill || isFullStroke) {\n      context.beginPath();\n      // if (arc.shouldUpdateShape()) {\n      //   // 更新shape\n      //   arc.cache = new Path2D(context);\n      //   this.drawArcPath(arc, arc.cache, x, y, outerRadius, innerRadius);\n      //   arc.clearUpdateShapeTag();\n      // } else {\n      //   if (arc.cache) {\n      //     renderCommandList(arc.cache.commandList, context);\n      //   }\n      // }\n      // 测试后，cache对于重绘性能提升不大，但是在首屏有一定性能损耗，因此arc不再使用cache\n      drawArcPath(arc, context, x, y, outerRadius, innerRadius);\n\n      beforeRenderContribitionsRuned = true;\n      // shadow\n      context.setShadowBlendStyle && context.setShadowBlendStyle(arc, arc.attribute, arcAttribute);\n      this.beforeRenderStep(\n        arc,\n        context,\n        x,\n        y,\n        doFill,\n        doStroke,\n        fVisible,\n        sVisible,\n        arcAttribute,\n        drawContext,\n        fillCb,\n        strokeCb\n      );\n\n      // 内联的函数性能差\n      // const _runFill = () => {\n      //   if (doFill) {\n      //     if (fillCb) {\n      //       fillCb(context, arc.attribute, arcAttribute);\n      //     } else if (fVisible) {\n      //       context.setCommonStyle(arc, arc.attribute, originX - x, originY - y, arcAttribute);\n      //       context.fill();\n      //     }\n      //   }\n      // };\n\n      // const _runStroke = () => {\n      //   if (doStroke && isFullStroke) {\n      //     if (strokeCb) {\n      //       strokeCb(context, arc.attribute, arcAttribute);\n      //     } else if (sVisible) {\n      //       context.setStrokeStyle(arc, arc.attribute, originX - x, originY - y, arcAttribute);\n      //       context.stroke();\n      //     }\n      //   }\n      // };\n\n      if (!fillStrokeOrder) {\n        this._runFill(arc, context, x, y, arcAttribute, doFill, fVisible, originX, originY, fillCb);\n        this._runStroke(arc, context, x, y, arcAttribute, doStroke, isFullStroke, sVisible, strokeCb);\n      } else {\n        this._runStroke(arc, context, x, y, arcAttribute, doStroke, isFullStroke, sVisible, strokeCb);\n        this._runFill(arc, context, x, y, arcAttribute, doFill, fVisible, originX, originY, fillCb);\n      }\n    }\n\n    // 需要局部渲染描边的时候\n    if (!isFullStroke && doStroke) {\n      context.beginPath();\n      const collapsedToLine = drawArcPath(arc, context, x, y, outerRadius, innerRadius, arrayStroke);\n\n      if (!beforeRenderContribitionsRuned) {\n        this.beforeRenderStep(\n          arc,\n          context,\n          x,\n          y,\n          doFill,\n          doStroke,\n          fVisible,\n          sVisible,\n          arcAttribute,\n          drawContext,\n          fillCb,\n          strokeCb\n        );\n      }\n\n      if (strokeCb) {\n        strokeCb(context, arc.attribute, arcAttribute);\n      } else if (sVisible) {\n        context.setStrokeStyle(arc, arc.attribute, x, y, arcAttribute);\n        context.stroke();\n      }\n    }\n\n    // 绘制cap\n    if (((isBoolean(cap) && cap) || (cap as boolean[])[1]) && forceShowCap) {\n      const { startAngle: sa, endAngle: ea } = arc.getParsedAngle();\n      const deltaAngle = abs(ea - sa);\n      if (deltaAngle >= pi2 - epsilon) {\n        context.beginPath();\n        const capWidth = Math.abs(outerRadius - innerRadius) / 2;\n        // 以外边界长度为准\n        const capAngle = capWidth / outerRadius;\n        const { endAngle = arcAttribute.endAngle, fill = arcAttribute.fill } = arc.attribute;\n        const startAngle = endAngle;\n        this.drawArcTailCapPath(arc, context, x, y, outerRadius, innerRadius, startAngle, startAngle + capAngle);\n\n        if (!beforeRenderContribitionsRuned) {\n          this.beforeRenderStep(\n            arc,\n            context,\n            x,\n            y,\n            doFill,\n            doStroke,\n            fVisible,\n            sVisible,\n            arcAttribute,\n            drawContext,\n            fillCb,\n            strokeCb\n          );\n        }\n\n        const _runFill = () => {\n          if (doFill) {\n            // 获取渐变色最后一个颜色\n            const color = fill;\n            if ((color as IGradientColor).gradient === 'conical') {\n              const lastColor = getConicGradientAt(0, 0, endAngle, color as any);\n              if (fillCb) {\n                // fillCb(context, arc.attribute, arcAttribute);\n              } else if (fillVisible) {\n                // context.closePath();\n                context.setCommonStyle(arc, arc.attribute, x, y, arcAttribute);\n                context.fillStyle = lastColor as string;\n                context.fill();\n              }\n            }\n          }\n        };\n\n        const _runStroke = () => {\n          if (doStroke) {\n            if (strokeCb) {\n              // fillCb(context, arc.attribute, arcAttribute);\n            } else if (sVisible) {\n              context.setStrokeStyle(arc, arc.attribute, x, y, arcAttribute);\n              // context.strokeStyle = 'red';\n              context.stroke();\n            }\n          }\n        };\n\n        if (!fillStrokeOrder) {\n          _runFill();\n          _runStroke();\n        } else {\n          _runFill();\n          _runStroke();\n        }\n      }\n    }\n\n    this.afterRenderStep(\n      arc,\n      context,\n      x,\n      y,\n      doFill,\n      doStroke,\n      fVisible,\n      sVisible,\n      arcAttribute,\n      drawContext,\n      fillCb,\n      strokeCb\n    );\n\n    if (tempChangeConicalColor) {\n      (fill as IConicalGradient).startAngle += conicalOffset;\n      (fill as IConicalGradient).endAngle += conicalOffset;\n    }\n  }\n\n  private _runFill(\n    arc: IArc,\n    context: IContext2d,\n    x: number,\n    y: number,\n    arcAttribute: Required<IArcGraphicAttribute>,\n    doFill: boolean,\n    fVisible: boolean,\n    originX: number,\n    originY: number,\n    fillCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ) {\n    if (doFill) {\n      if (fillCb) {\n        fillCb(context, arc.attribute, arcAttribute);\n      } else if (fVisible) {\n        context.setCommonStyle(arc, arc.attribute, originX - x, originY - y, arcAttribute);\n        context.fill();\n      }\n    }\n  }\n\n  private _runStroke(\n    arc: IArc,\n    context: IContext2d,\n    x: number,\n    y: number,\n    arcAttribute: Required<IArcGraphicAttribute>,\n    doStroke: boolean,\n    isFullStroke: boolean,\n    sVisible: boolean,\n    strokeCb?: (\n      ctx: IContext2d,\n      markAttribute: Partial<IMarkAttribute & IGraphicAttribute>,\n      themeAttribute: IThemeAttribute\n    ) => boolean\n  ) {\n    if (doStroke && isFullStroke) {\n      if (strokeCb) {\n        // fillCb(context, arc.attribute, arcAttribute);\n      } else if (sVisible) {\n        context.setStrokeStyle(arc, arc.attribute, x, y, arcAttribute);\n        // context.strokeStyle = 'red';\n        context.stroke();\n      }\n    }\n  }\n\n  draw(arc: IArc, renderService: IRenderService, drawContext: IDrawContext, params?: IGraphicRenderDrawParams) {\n    const arcAttribute = getTheme(arc, params?.theme).arc;\n    this._draw(arc, arcAttribute, false, drawContext, params, arcAttribute);\n  }\n}\n"]}