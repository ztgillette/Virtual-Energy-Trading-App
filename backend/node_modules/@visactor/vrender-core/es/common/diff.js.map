{"version":3,"sources":["../src/common/diff.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,kBAAkB,CAAC;AAS3C,MAAM,UAAU,IAAI,CAClB,QAAW,EACX,QAAW,EACX,OAAgC;IAEhC,MAAM,OAAO,GAAwB,EAAE,CAAC;IAGxC,KAAK,MAAM,GAAG,IAAI,QAAQ,EAAE;QAE1B,IAAI,CAAC,CAAC,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;YAChE,OAAO,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;SAC9B;KACF;IAGD,IAAI,OAAO,EAAE;QACX,KAAK,MAAM,GAAG,IAAI,QAAQ,EAAE;YAC1B,IAAI,CAAC,CAAC,GAAG,IAAI,QAAQ,CAAC,EAAE;gBACtB,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;gBAC3B,IAAI,KAAK,KAAK,SAAS,EAAE;oBACvB,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;iBACtB;aACF;SACF;KACF;IAED,OAAO,OAAO,CAAC;AACjB,CAAC","file":"diff.js","sourcesContent":["import { isEqual } from '@visactor/vutils';\n\n/**\n * 比较两个对象的差异，深比较，返回差异的对象\n * @param oldAttrs 原始对象\n * @param newAttrs 目标对象\n * @param getAttr 获取属性值的函数（在于oldAttrs里有，newAttrs里没有的属性，调用函数获取，可选）\n * @returns 差异的对象\n */\nexport function diff<T extends Record<string, any>>(\n  oldAttrs: T,\n  newAttrs: T,\n  getAttr?: (attr: keyof T) => any\n): Record<string, any> {\n  const diffObj: Record<string, any> = {};\n\n  // 处理newAttrs中的属性\n  for (const key in newAttrs) {\n    // 如果oldAttrs不存在该属性或者属性值不同\n    if (!(key in oldAttrs) || !isEqual(oldAttrs[key], newAttrs[key])) {\n      diffObj[key] = newAttrs[key];\n    }\n  }\n\n  // 处理oldAttrs中有但newAttrs中没有的属性\n  if (getAttr) {\n    for (const key in oldAttrs) {\n      if (!(key in newAttrs)) {\n        const value = getAttr(key);\n        if (value !== undefined) {\n          diffObj[key] = value;\n        }\n      }\n    }\n  }\n\n  return diffObj;\n}\n"]}