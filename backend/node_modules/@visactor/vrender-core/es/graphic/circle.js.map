{"version":3,"sources":["../src/graphic/circle.ts"],"names":[],"mappings":"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","file":"circle.js","sourcesContent":["import { epsilon, pi2, type IAABBBounds } from '@visactor/vutils';\nimport type { ICircle, ICircleGraphicAttribute } from '../interface/graphic/circle';\nimport { Graphic, GRAPHIC_UPDATE_TAG_KEY, NOWORK_ANIMATE_ATTR } from './graphic';\nimport { CustomPath2D } from '../common/custom-path2d';\nimport { circleBounds } from '../common/utils';\nimport { getTheme } from './theme';\nimport { application } from '../application';\nimport { CIRCLE_NUMBER_TYPE } from './constants';\nimport { updateBoundsOfCommonOuterBorder } from './graphic-service/common-outer-boder-bounds';\n\nconst CIRCLE_UPDATE_TAG_KEY = ['radius', 'startAngle', 'endAngle', ...GRAPHIC_UPDATE_TAG_KEY];\n\n/**\n * 圆形图元\n * 默认顺时针绘制\n */\nexport class Circle extends Graphic<ICircleGraphicAttribute> implements ICircle {\n  type: 'circle' = 'circle';\n\n  static NOWORK_ANIMATE_ATTR = NOWORK_ANIMATE_ATTR;\n\n  constructor(params: ICircleGraphicAttribute = { radius: 1 }) {\n    super(params);\n    this.numberType = CIRCLE_NUMBER_TYPE;\n  }\n\n  isValid(): boolean {\n    return super.isValid() && this._isValid();\n  }\n  private _isValid(): boolean {\n    const { startAngle, endAngle, radius } = this.attribute;\n    return this._validNumber(startAngle) && this._validNumber(endAngle) && this._validNumber(radius);\n  }\n\n  getGraphicTheme(): Required<ICircleGraphicAttribute> {\n    return getTheme(this).circle;\n  }\n\n  protected updateAABBBounds(\n    attribute: ICircleGraphicAttribute,\n    circleTheme: Required<ICircleGraphicAttribute>,\n    aabbBounds: IAABBBounds,\n    full?: boolean\n  ) {\n    if (!this.updatePathProxyAABBBounds(aabbBounds)) {\n      full\n        ? this.updateCircleAABBBoundsImprecise(attribute, circleTheme, aabbBounds)\n        : this.updateCircleAABBBoundsAccurate(attribute, circleTheme, aabbBounds);\n    }\n\n    const { tb1, tb2 } = application.graphicService.updateTempAABBBounds(aabbBounds);\n\n    updateBoundsOfCommonOuterBorder(attribute, circleTheme, tb1);\n    aabbBounds.union(tb1);\n    tb1.setValue(tb2.x1, tb2.y1, tb2.x2, tb2.y2);\n\n    this.widthWithoutTransform = aabbBounds.x2 - aabbBounds.x1;\n    this.heightWithoutTransform = aabbBounds.y2 - aabbBounds.y1;\n\n    application.graphicService.transformAABBBounds(attribute, aabbBounds, circleTheme, false, this);\n\n    return aabbBounds;\n  }\n\n  protected updateCircleAABBBoundsImprecise(\n    attribute: ICircleGraphicAttribute,\n    circleTheme: Required<ICircleGraphicAttribute>,\n    aabbBounds: IAABBBounds\n  ): IAABBBounds {\n    const { radius = circleTheme.radius } = attribute;\n    aabbBounds.set(-radius, -radius, radius, radius);\n\n    return aabbBounds;\n  }\n  protected updateCircleAABBBoundsAccurate(\n    attribute: ICircleGraphicAttribute,\n    circleTheme: Required<ICircleGraphicAttribute>,\n    aabbBounds: IAABBBounds\n  ): IAABBBounds {\n    const {\n      startAngle = circleTheme.startAngle,\n      endAngle = circleTheme.endAngle,\n      radius = circleTheme.radius\n    } = attribute;\n\n    if (endAngle - startAngle > pi2 - epsilon) {\n      aabbBounds.set(-radius, -radius, radius, radius);\n    } else {\n      circleBounds(startAngle, endAngle, radius, aabbBounds);\n    }\n\n    return aabbBounds;\n  }\n\n  protected needUpdateTags(keys: string[]): boolean {\n    return super.needUpdateTags(keys, CIRCLE_UPDATE_TAG_KEY);\n  }\n  protected needUpdateTag(key: string): boolean {\n    return super.needUpdateTag(key, CIRCLE_UPDATE_TAG_KEY);\n  }\n\n  toCustomPath() {\n    let path = super.toCustomPath();\n    if (path) {\n      return path;\n    }\n    const x = 0;\n    const y = 0;\n\n    const attribute = this.attribute;\n    const radius = attribute.radius ?? this.getDefaultAttribute('radius');\n    const startAngle = attribute.startAngle ?? this.getDefaultAttribute('startAngle');\n    const endAngle = attribute.endAngle ?? this.getDefaultAttribute('endAngle');\n\n    path = new CustomPath2D();\n\n    path.arc(x, y, radius, startAngle, endAngle);\n\n    return path;\n  }\n\n  clone() {\n    return new Circle({ ...this.attribute });\n  }\n\n  getNoWorkAnimateAttr(): Record<string, number> {\n    return Circle.NOWORK_ANIMATE_ATTR;\n  }\n}\n\nexport function createCircle(attributes: ICircleGraphicAttribute): ICircle {\n  return new Circle(attributes);\n}\n\n// addAttributeToPrototype(DefaultCircleStyle, Circle, PURE_STYLE_KEY);\n"]}