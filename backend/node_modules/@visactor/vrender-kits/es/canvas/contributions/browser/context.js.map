{"version":3,"sources":["../src/canvas/contributions/browser/context.ts"],"names":[],"mappings":"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","file":"context.js","sourcesContent":["/**\n * 部分源码参考konva\n * MIT License\n\n  Original work Copyright (C) 2011 - 2013 by Eric Rowell (KineticJS)\n  Modified work Copyright (C) 2014 - present by Anton Lavrenov (Konva)\n\n  Permission is hereby granted, free of charge, to any person obtaining a copy\n  of this software and associated documentation files (the \"Software\"), to deal\n  in the Software without restriction, including without limitation the rights\n  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n  copies of the Software, and to permit persons to whom the Software is\n  furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included in all\n  copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n  SOFTWARE.\n */\nimport type { IPointLike, TextMeasure, ITextMeasureSpec, IMatrix } from '@visactor/vutils';\nimport { Matrix, pi, pi2, Logger, getContextFont } from '@visactor/vutils';\nimport {\n  injectable,\n  DefaultFillStyle,\n  DefaultStrokeStyle,\n  DefaultTextStyle,\n  createColor,\n  getScaledStroke,\n  application,\n  matrixAllocate,\n  transformMat4,\n  createConicalGradient\n} from '@visactor/vrender-core';\nimport type {\n  ICamera,\n  ICanvas,\n  ICommonStyleParams,\n  IConicalGradientData,\n  IContext2d,\n  ISetCommonStyleParams,\n  ISetStrokeStyleParams,\n  IStrokeStyleParams,\n  ITextStyleParams,\n  mat4,\n  EnvType,\n  vec3\n} from '@visactor/vrender-core';\n\nconst outP: [number, number, number] = [0, 0, 0];\n\n// https://github.com/konvajs/konva/blob/master/src/Context.ts\n\nconst addArcToBezierPath = (\n  bezierPath: Array<number[]>,\n  startAngle: number,\n  endAngle: number,\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  clockwise: boolean\n) => {\n  if (clockwise) {\n    while (endAngle > startAngle) {\n      endAngle -= pi2;\n    }\n  } else {\n    while (endAngle < startAngle) {\n      endAngle += pi2;\n    }\n  }\n  // https://stackoverflow.com/questions/1734745/how-to-create-circle-with-b%C3%A9zier-curves\n  const step = (pi / 3) * (endAngle > startAngle ? 1 : -1);\n  let sa = startAngle;\n  let ea = sa;\n  while (ea !== endAngle) {\n    ea = step > 0 ? Math.min(ea + step, endAngle) : Math.max(ea + step, endAngle);\n    const delta = Math.abs(ea - sa);\n    const len = (Math.tan(delta / 4) * 4) / 3;\n    const dir = ea < sa ? -1 : 1;\n\n    const c1 = Math.cos(sa);\n    const s1 = Math.sin(sa);\n    const c2 = Math.cos(ea);\n    const s2 = Math.sin(ea);\n\n    const x1 = c1 * rx + cx;\n    const y1 = s1 * ry + cy;\n\n    const x4 = c2 * rx + cx;\n    const y4 = s2 * ry + cy;\n\n    const hx = rx * len * dir;\n    const hy = ry * len * dir;\n\n    bezierPath.push([x1 - hx * s1, y1 + hy * c1, x4 + hx * s2, y4 - hy * c2, x4, y4]);\n    sa = ea;\n  }\n};\n\n@injectable()\nexport class BrowserContext2d implements IContext2d {\n  static env: EnvType = 'browser';\n  baseGlobalAlpha: number;\n  drawPromise?: Promise<any>;\n  declare mathTextMeasure: TextMeasure<ITextMeasureSpec>;\n\n  declare canvas: ICanvas;\n  declare camera?: ICamera;\n  modelMatrix?: mat4;\n  declare nativeContext: CanvasRenderingContext2D | any;\n  declare _inuse: boolean;\n  declare stack: Matrix[];\n  declare disableFill?: boolean;\n  declare disableStroke?: boolean;\n  declare disableBeginPath?: boolean;\n  protected matrix: Matrix;\n  protected applyedMatrix?: Matrix; // 被应用的matrix\n  declare fontFamily: string;\n  declare fontSize: number;\n  declare _clearMatrix: IMatrix;\n  declare _font?: string;\n\n  // 属性代理\n  set fillStyle(d: string | CanvasGradient | CanvasPattern) {\n    this.nativeContext.fillStyle = d;\n  }\n  get fillStyle(): string | CanvasGradient | CanvasPattern {\n    return this.nativeContext.fillStyle;\n  }\n  set font(d: string) {\n    if (d === this._font) {\n      return;\n    }\n    this._font = d;\n    this.nativeContext.font = d;\n  }\n  get font(): string {\n    return this._font ?? this.nativeContext.font;\n  }\n  set globalAlpha(d: number) {\n    this.nativeContext.globalAlpha = d * this.baseGlobalAlpha;\n  }\n  get globalAlpha(): number {\n    return this.nativeContext.globalAlpha;\n  }\n  set lineCap(d: CanvasLineCap) {\n    this.nativeContext.lineCap = d;\n  }\n  get lineCap(): CanvasLineCap {\n    return this.nativeContext.lineCap;\n  }\n  set lineDashOffset(d: number) {\n    this.nativeContext.lineDashOffset = d;\n  }\n  get lineDashOffset(): number {\n    return this.nativeContext.lineDashOffset;\n  }\n  set lineJoin(d: CanvasLineJoin) {\n    this.nativeContext.lineJoin = d;\n  }\n  get lineJoin(): CanvasLineJoin {\n    return this.nativeContext.lineJoin;\n  }\n  set lineWidth(d: number) {\n    this.nativeContext.lineWidth = d;\n  }\n  get lineWidth(): number {\n    return this.nativeContext.lineWidth;\n  }\n  set miterLimit(d: number) {\n    this.nativeContext.miterLimit = d;\n  }\n  get miterLimit(): number {\n    return this.nativeContext.miterLimit;\n  }\n  set shadowBlur(d: number) {\n    this.nativeContext.shadowBlur = d;\n  }\n  get shadowBlur(): number {\n    return this.nativeContext.shadowBlur;\n  }\n  set shadowColor(d: string) {\n    this.nativeContext.shadowColor = d;\n  }\n  get shadowColor(): string {\n    return this.nativeContext.shadowColor;\n  }\n  set shadowOffsetX(d: number) {\n    this.nativeContext.shadowOffsetX = d;\n  }\n  get shadowOffsetX(): number {\n    return this.nativeContext.shadowOffsetX;\n  }\n  set shadowOffsetY(d: number) {\n    this.nativeContext.shadowOffsetY = d;\n  }\n  get shadowOffsetY(): number {\n    return this.nativeContext.shadowOffsetY;\n  }\n  set strokeStyle(d: string | CanvasGradient | CanvasPattern) {\n    this.nativeContext.strokeStyle = d;\n  }\n  get strokeStyle(): string | CanvasGradient | CanvasPattern {\n    return this.nativeContext.strokeStyle;\n  }\n  set textAlign(d: CanvasTextAlign) {\n    this.nativeContext.textAlign = d;\n  }\n  get textAlign(): CanvasTextAlign {\n    return this.nativeContext.textAlign;\n  }\n  set textBaseline(d: CanvasTextBaseline) {\n    this.nativeContext.textBaseline = d;\n  }\n  get textBaseline(): CanvasTextBaseline {\n    return this.nativeContext.textBaseline;\n  }\n\n  get inuse(): boolean {\n    return !!this._inuse;\n  }\n\n  set inuse(use: boolean) {\n    if (use === !!this._inuse) {\n      return;\n    }\n    this._inuse = use;\n    if (use) {\n      this.nativeContext.save();\n      this.reset();\n    } else {\n      this.nativeContext.restore();\n    }\n  }\n\n  dpr: number;\n\n  constructor(canvas: ICanvas, dpr: number) {\n    const context = canvas.nativeCanvas.getContext('2d');\n    if (!context) {\n      throw new Error('发生错误，获取2d上下文失败');\n    }\n    this.nativeContext = context;\n    this.canvas = canvas;\n    this.matrix = new Matrix(1, 0, 0, 1, 0, 0);\n    this.stack = [];\n    this.dpr = dpr;\n    this.applyedMatrix = new Matrix(1, 0, 0, 1, 0, 0);\n    this._clearMatrix = new Matrix(1, 0, 0, 1, 0, 0);\n    this.baseGlobalAlpha = 1;\n  }\n\n  reset(setTransform: boolean = true) {\n    if (this.stack.length) {\n      Logger.getInstance().warn('可能存在bug，matrix没有清空');\n    }\n    this.matrix.setValue(1, 0, 0, 1, 0, 0);\n    this.applyedMatrix = new Matrix(1, 0, 0, 1, 0, 0);\n    this.stack.length = 0;\n    setTransform && this.nativeContext.setTransform(1, 0, 0, 1, 0, 0);\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getContext() {\n    return this.nativeContext;\n  }\n  /**\n   * 设置当前ctx 的transform信息\n   */\n  setTransformForCurrent(force: boolean = false) {\n    // 只作简单判断\n    // 增加判断，可以降低80%setTransform调用，降低50%setTransformForCurrent执行时间\n    if (!force && this.applyedMatrix.equalToMatrix(this.matrix)) {\n      return;\n    }\n\n    // this.applyedMatrix = this.cloneMatrix(this.matrix);\n    // 避免直接使用cloneMatrix，重复创建Matrix，优化GC\n    this.applyedMatrix.setValue(\n      this.matrix.a,\n      this.matrix.b,\n      this.matrix.c,\n      this.matrix.d,\n      this.matrix.e,\n      this.matrix.f\n    );\n    this.nativeContext.setTransform(\n      this.matrix.a,\n      this.matrix.b,\n      this.matrix.c,\n      this.matrix.d,\n      this.matrix.e,\n      this.matrix.f\n    );\n  }\n  /**\n   * 获取当前矩阵信息\n   */\n  get currentMatrix() {\n    return this.matrix;\n  }\n\n  cloneMatrix(m: Matrix) {\n    return matrixAllocate.allocateByObj(m);\n  }\n\n  /**\n   * 清空画布\n   */\n  clear() {\n    this.save();\n    this.resetTransform();\n    this.nativeContext.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.restore();\n  }\n\n  restore() {\n    this.nativeContext.restore();\n    if (this.stack.length > 0) {\n      matrixAllocate.free(this.matrix);\n      this.matrix = this.stack.pop() as Matrix;\n      this.setTransformForCurrent(true);\n    }\n    this.font = '';\n    this._clearFilterStyle = false;\n    this._clearShadowStyle = false;\n  }\n  highPerformanceRestore() {\n    if (this.stack.length > 0) {\n      matrixAllocate.free(this.matrix);\n      this.matrix = this.stack.pop() as Matrix;\n    }\n  }\n\n  /**\n   *\n   * @param angle 弧度数\n   */\n  rotate(rad: number, setTransform: boolean = true) {\n    this.matrix.rotate(rad);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  save() {\n    const matrix = this.cloneMatrix(this.matrix);\n    this.stack.push(matrix);\n    this.nativeContext.save();\n  }\n  highPerformanceSave() {\n    const matrix = this.cloneMatrix(this.matrix);\n    this.stack.push(matrix);\n  }\n\n  /**\n   * 基于当前matrix再次scale\n   * @param sx\n   * @param sy\n   * @param setTransform 是否设置transform到context中\n   */\n  scale(sx: number, sy: number, setTransform: boolean = true) {\n    this.matrix.scale(sx, sy);\n    setTransform && this.setTransformForCurrent();\n  }\n  setScale(sx: number, sy: number, setTransform: boolean = true): void {\n    this.matrix.setScale(sx, sy);\n    setTransform && this.setTransformForCurrent();\n  }\n  /**\n   * 基于某个点进行缩放\n   * @param sx\n   * @param sy\n   * @param px\n   * @param py\n   */\n  scalePoint(sx: number, sy: number, px: number, py: number, setTransform: boolean = true) {\n    this.translate(px, py, false);\n    this.scale(sx, sy, false);\n    this.translate(-px, -py, false);\n    setTransform && this.setTransformForCurrent();\n  }\n  /**\n   *\n   * @param a\n   * @param b\n   * @param c\n   * @param d\n   * @param e\n   * @param f\n   * @param setTransform\n   */\n  setTransform(\n    a: number,\n    b: number,\n    c: number,\n    d: number,\n    e: number,\n    f: number,\n    setTransform: boolean = true,\n    dpr: number = this.dpr\n  ) {\n    this.matrix.setValue(dpr * a, dpr * b, dpr * c, dpr * d, dpr * e, dpr * f);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  setTransformFromMatrix(matrix: Matrix, setTransform: boolean = true, dpr: number = this.dpr) {\n    this.matrix.setValue(\n      matrix.a * dpr,\n      matrix.b * dpr,\n      matrix.c * dpr,\n      matrix.d * dpr,\n      matrix.e * dpr,\n      matrix.f * dpr\n    );\n    setTransform && this.setTransformForCurrent();\n  }\n\n  resetTransform(setTransform: boolean = true, dpr: number = this.dpr) {\n    this.setTransform(dpr, 0, 0, dpr, 0, 0);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  // transform(m11: number, m12: number, m21: number, m22: number, dx: number, dy: number): void;\n  transform(a: number, b: number, c: number, d: number, e: number, f: number, setTransform: boolean = true) {\n    this.matrix.multiply(a, b, c, d, e, f);\n    setTransform && this.setTransformForCurrent();\n  }\n  transformFromMatrix(matrix: Matrix, setTransform?: boolean): void {\n    this.matrix.multiply(matrix.a, matrix.b, matrix.c, matrix.d, matrix.e, matrix.f);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  translate(x: number, y: number, setTransform: boolean = true) {\n    this.matrix.translate(x, y);\n    setTransform && this.setTransformForCurrent();\n  }\n  /**\n   * 旋转角度，自动转换为弧度\n   * @param deg 角度数\n   */\n  rotateDegrees(deg: number, setTransform: boolean = true) {\n    const rad = (deg * Math.PI) / 180;\n    this.rotate(rad, setTransform);\n  }\n\n  /**\n   * 绕点旋转\n   * @param rad 弧度\n   * @param x 旋转中心点x\n   * @param y 旋转中心点y\n   */\n  rotateAbout(rad: number, x: number, y: number, setTransform: boolean = true) {\n    this.translate(x, y, false);\n    this.rotate(rad, false);\n    this.translate(-x, -y, false);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  /**\n   * 绕点旋转\n   * @param deg 旋转角度\n   * @param x 旋转中心点x\n   * @param y 旋转中心点y\n   */\n  rotateDegreesAbout(deg: number, x: number, y: number, setTransform: boolean = true) {\n    this.translate(x, y, false);\n    this.rotateDegrees(deg, false);\n    this.translate(-x, -y, false);\n    setTransform && this.setTransformForCurrent();\n  }\n\n  // /**\n  //  * 全局坐标 -> 当前矩阵的局部坐标\n  //  * @param x x\n  //  * @param y y\n  //  */\n  // transformPoint(x: number, y: number): Point {\n  //   const inverseMatrix = this.matrix.getInverse();\n  //   // dpr\n  //   x = x * this.dpr;\n  //   y = y * this.dpr;\n  //   return new Point(\n  //     x * inverseMatrix.a + y * inverseMatrix.c + inverseMatrix.e,\n  //     x * inverseMatrix.b + y * inverseMatrix.d + inverseMatrix.f\n  //   );\n  // }\n\n  // /**\n  //  * 坐标转换\n  //  * @param x x\n  //  * @param y y\n  //  */\n  // transformPoint2(x: number, y: number): Point {\n  //   const inverseMatrix = this.matrix;\n  //   return new Point(\n  //     x * inverseMatrix.a + y * inverseMatrix.c + inverseMatrix.e,\n  //     x * inverseMatrix.b + y * inverseMatrix.d + inverseMatrix.f\n  //   );\n  // }\n\n  // transformPoint3(x: number, y: number, matrix: Matrix): Point {\n  //   // dpr\n  //   x = x * this.dpr;\n  //   y = y * this.dpr;\n  //   return new Point(x * matrix.a + y * matrix.c + matrix.e, x * matrix.b + y * matrix.d + matrix.f);\n  // }\n\n  //////// 代理方法\n  // isPointInStroke ,drawFocusIfNeeded 方法没有代理，如有需要再添加\n\n  beginPath() {\n    if (this.disableBeginPath) {\n      return;\n    }\n    this.nativeContext.beginPath();\n  }\n\n  clip(fillRule?: CanvasFillRule): void;\n  clip(path: Path2D, fillRule?: CanvasFillRule): void;\n  clip(path?: Path2D | CanvasFillRule, fillRule?: CanvasFillRule) {\n    if (path) {\n      if (typeof path === 'string') {\n        this.nativeContext.clip(path);\n      } else {\n        this.nativeContext.clip(path, fillRule);\n      }\n    } else {\n      this.nativeContext.clip();\n    }\n  }\n\n  arc(x: number, y: number, radius: number, startAngle: number, endAngle: number, anticlockwise?: boolean, z?: number) {\n    z = z || 0;\n    if (this.camera) {\n      const arr = [] as any;\n      addArcToBezierPath(arr, startAngle, endAngle, x, y, radius, radius, anticlockwise);\n      for (let i = 0; i < arr.length; ++i) {\n        const bez = arr[i];\n        this.bezierCurveTo(bez[0], bez[1], bez[2], bez[3], bez[4], bez[5], z);\n      }\n    } else {\n      this.nativeContext.arc(x, y, Math.max(0, radius), startAngle, endAngle, anticlockwise);\n    }\n  }\n\n  arcTo(x1: number, y1: number, x2: number, y2: number, radius: number): void;\n  arcTo(x1: number, y1: number, x2: number, y2: number, radiusX: number) {\n    this.nativeContext.arcTo(x1, y1, x2, y2, radiusX);\n  }\n\n  bezierCurveTo(cp1x: number, cp1y: number, cp2x: number, cp2y: number, x: number, y: number, z?: number) {\n    z = z || 0;\n    if (this.camera) {\n      let cp1z = z;\n      let cp2z = z;\n      if (this.modelMatrix) {\n        transformMat4(outP, [cp1x, cp1y, z], this.modelMatrix);\n        cp1x = outP[0];\n        cp1y = outP[1];\n        cp1z = outP[2];\n\n        transformMat4(outP, [cp2x, cp2y, z], this.modelMatrix);\n        cp2x = outP[0];\n        cp2y = outP[1];\n        cp2z = outP[2];\n\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      let data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n      data = this.camera.vp(cp1x, cp1y, cp1z);\n      cp1x = data.x;\n      cp1y = data.y;\n      data = this.camera.vp(cp2x, cp2y, cp2z);\n      cp2x = data.x;\n      cp2y = data.y;\n    }\n    this.nativeContext.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  }\n\n  closePath() {\n    this.nativeContext.closePath();\n  }\n\n  ellipse(\n    x: number,\n    y: number,\n    radiusX: number,\n    radiusY: number,\n    rotation: number,\n    startAngle: number,\n    endAngle: number,\n    anticlockwise?: boolean\n  ) {\n    if (anticlockwise == null) {\n      this.nativeContext.ellipse(x, y, radiusX, radiusY, rotation, startAngle, endAngle);\n    } else {\n      this.nativeContext.ellipse(x, y, radiusX, radiusY, rotation, startAngle, endAngle, anticlockwise);\n    }\n  }\n  lineTo(x: number, y: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      const data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n    }\n    this.nativeContext.lineTo(x, y);\n  }\n\n  moveTo(x: number, y: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      const data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n    }\n    this.nativeContext.moveTo(x, y);\n  }\n\n  quadraticCurveTo(cpx: number, cpy: number, x: number, y: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      let cpz = z;\n      if (this.modelMatrix) {\n        transformMat4(outP, [cpx, cpy, z], this.modelMatrix);\n        cpx = outP[0];\n        cpy = outP[1];\n        cpz = outP[2];\n\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      let data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n      data = this.camera.vp(cpx, cpy, cpz);\n      cpx = data.x;\n      cpy = data.y;\n    }\n    this.nativeContext.quadraticCurveTo(cpx, cpy, x, y);\n  }\n\n  rect(x: number, y: number, w: number, h: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      this.moveTo(x, y, z);\n      this.lineTo(x + w, y, z);\n      this.lineTo(x + w, y + h, z);\n      this.lineTo(x, y + h, z);\n      this.closePath();\n    } else {\n      this.nativeContext.rect(x, y, w, h);\n    }\n  }\n\n  createImageData(imageDataOrSw: number | ImageData, sh?: number): ImageData;\n  createImageData() {\n    const a = arguments;\n    if (a.length === 2) {\n      return this.nativeContext.createImageData(a[0], a[1]);\n    } else if (a.length === 1) {\n      return this.nativeContext.createImageData(a[0]);\n    }\n    return null;\n  }\n\n  createLinearGradient(x0: number, y0: number, x1: number, y1: number) {\n    if (!isFinite(x0 + y0 + x1 + y1)) {\n      x0 = 0;\n      y0 = 0;\n      x1 = 0;\n      y1 = 0;\n    }\n\n    return this.nativeContext.createLinearGradient(x0, y0, x1, y1);\n  }\n\n  createPattern(image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement, repetition: string): CanvasPattern {\n    if (image.width === 0 || image.height === 0) {\n      return null;\n    } // 宽高为0时createPattern会报错\n    return this.nativeContext.createPattern(image, repetition);\n  }\n\n  createRadialGradient(x0: number, y0: number, r0: number, x1: number, y1: number, r1: number): CanvasGradient {\n    return this.nativeContext.createRadialGradient(x0, y0, r0, x1, y1, r1);\n  }\n\n  createConicGradient(x: number, y: number, startAngle: number, endAngle: number): IConicalGradientData {\n    // 检测浏览器是否原生支持conic-gradient\n    const isNative = this.nativeContext.createConicGradient;\n    if (isNative && Math.abs(endAngle - startAngle - Math.PI * 2) < 0.001) {\n      return this.nativeContext.createConicGradient(startAngle, x, y);\n    }\n    let edit = false;\n    let pattern: CanvasPattern | null;\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const ctx = this;\n    const obj: IConicalGradientData = {\n      stops: [],\n      addColorStop(offset: number, color: string) {\n        this.stops.push([offset, color]);\n        edit = true;\n      },\n      GetPattern(minW: number, minH: number, deltaAngle?: number): CanvasPattern | null {\n        if (edit) {\n          if (!deltaAngle) {\n            deltaAngle = endAngle - startAngle;\n          }\n          pattern = createConicalGradient(\n            ctx as IContext2d,\n            this.stops,\n            x,\n            y,\n            deltaAngle,\n            startAngle,\n            endAngle,\n            minW,\n            minH\n          );\n          edit = false;\n        }\n        return pattern;\n      }\n    };\n    return obj;\n  }\n\n  // createConicGradient(x: number, y: number, startAngle: number, endAngle: number): IConicalGradient | null {\n  //   // let edit = false;\n  //   // let pattern: CanvasPattern | null;\n  //   // // eslint-disable-next-line @typescript-eslint/no-this-alias\n  //   // const ctx = this;\n  //   // const obj: IConicalGradient = {\n  //   //   stops: [],\n  //   //   addColorStop(offset: number, color: string) {\n  //   //     this.stops.push([offset, color]);\n  //   //     edit = true;\n  //   //   },\n  //   //   GetPattern(minW: number, minH: number, deltaAngle?: number): CanvasPattern | null {\n  //   //     if (edit) {\n  //   //       if (!deltaAngle) deltaAngle = endAngle - startAngle;\n  //   //       pattern = createConicalGradient(ctx, this.stops, x, y, deltaAngle, startAngle, endAngle, minW, minH);\n  //   //       edit = false;\n  //   //     }\n  //   //     return pattern;\n  //   //   }\n  //   // };\n  //   // return obj;\n  // }\n\n  // fill(fillRule?: CanvasFillRule): void;\n  // fill(path?: Path2D, fillRule?: CanvasFillRule): void;\n  fill(path?: Path2D, fillRule?: CanvasFillRule) {\n    if (this.disableFill) {\n      return;\n    }\n    path ? this.nativeContext.fill(path) : this.nativeContext.fill();\n  }\n\n  fillRect(x: number, y: number, width: number, height: number) {\n    this.nativeContext.fillRect(x, y, width, height);\n  }\n\n  clearRect(x: number, y: number, w: number, h: number) {\n    this.nativeContext.clearRect(x, y, w, h);\n  }\n\n  project(x: number, y: number, z: number): IPointLike {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      const data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n    }\n    return { x, y };\n  }\n\n  view(x: number, y: number, z: number): vec3 {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      return this.camera.view(x, y, z);\n    }\n    return [x, y, z];\n  }\n\n  fillText(text: string, x: number, y: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      const data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n    }\n    this.nativeContext.fillText(text, x, y);\n  }\n\n  getImageData(sx: number, sy: number, sw: number, sh: number): ImageData {\n    return this.nativeContext.getImageData(sx, sy, sw, sh);\n  }\n\n  getLineDash(): number[] {\n    return this.nativeContext.getLineDash();\n  }\n\n  isPointInPath(x: number, y: number) {\n    return this.nativeContext.isPointInPath(x, y);\n  }\n\n  isPointInStroke(x: number, y: number) {\n    return this.nativeContext.isPointInStroke(x, y);\n  }\n\n  measureText(\n    text: string,\n    method: 'native' | 'simple' | 'quick' = application.global.measureTextMethod\n  ): { width: number } {\n    if (!method || method === 'native') {\n      return this.nativeContext.measureText(text);\n    }\n    if (!this.mathTextMeasure) {\n      this.mathTextMeasure = application.graphicUtil.createTextMeasureInstance({}, {}, () => this.canvas.nativeCanvas);\n    }\n\n    const fontFamily = this.fontFamily ?? DefaultTextStyle.fontFamily;\n    const fontSize = this.fontSize ?? DefaultTextStyle.fontSize;\n    if (\n      this.mathTextMeasure.textSpec.fontFamily !== fontFamily ||\n      this.mathTextMeasure.textSpec.fontSize !== fontSize\n    ) {\n      this.mathTextMeasure.textSpec.fontFamily = fontFamily;\n      this.mathTextMeasure.textSpec.fontSize = fontSize;\n      this.mathTextMeasure._numberCharSize = null;\n      this.mathTextMeasure._fullCharSize = null;\n      this.mathTextMeasure._letterCharSize = null;\n      this.mathTextMeasure._specialCharSizeMap = {};\n    }\n    return this.mathTextMeasure.measure(text, method);\n  }\n\n  putImageData(imagedata: ImageData, dx: number, dy: number) {\n    this.nativeContext.putImageData(imagedata, dx, dy);\n  }\n\n  setLineDash(segments: number[]) {\n    const a = arguments;\n    const _context = this.nativeContext;\n\n    // works for Chrome and IE11\n    if (!!this.nativeContext.setLineDash) {\n      a[0] && _context.setLineDash(a[0]);\n    } else if ('mozDash' in _context) {\n      // verified that this works in firefox\n      (_context as any).mozDash = a[0];\n    } else if ('webkitLineDash' in _context) {\n      // does not currently work for Safari\n      (_context as any).webkitLineDash = a[0];\n    }\n\n    // no support for IE9 and IE10\n  }\n\n  stroke(path?: Path2D) {\n    if (this.disableStroke) {\n      return;\n    }\n    path ? this.nativeContext.stroke(path) : this.nativeContext.stroke();\n  }\n\n  strokeRect(x: number, y: number, width: number, height: number) {\n    this.nativeContext.strokeRect(x, y, width, height);\n  }\n\n  strokeText(text: string, x: number, y: number, z: number) {\n    z = z || 0;\n    if (this.camera) {\n      if (this.modelMatrix) {\n        transformMat4(outP, [x, y, z], this.modelMatrix);\n        x = outP[0];\n        y = outP[1];\n        z = outP[2];\n      }\n      const data = this.camera.vp(x, y, z);\n      x = data.x;\n      y = data.y;\n    }\n    this.nativeContext.strokeText(text, x, y);\n  }\n\n  drawImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageBitmap,\n    dstX: number,\n    dstY: number\n  ): void;\n  drawImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageBitmap,\n    dstX: number,\n    dstY: number,\n    dstW: number,\n    dstH: number\n  ): void;\n  drawImage(\n    image: HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageBitmap,\n    srcX: number,\n    srcY: number,\n    srcW: number,\n    srcH: number,\n    dstX: number,\n    dstY: number,\n    dstW: number,\n    dstH: number\n  ): void;\n\n  drawImage() {\n    const _context = this.nativeContext;\n    const a = arguments;\n    if (a.length === 3) {\n      _context.drawImage(a[0], a[1], a[2]);\n    } else if (a.length === 5) {\n      _context.drawImage(a[0], a[1], a[2], a[3], a[4]);\n    } else if (a.length === 9) {\n      _context.drawImage(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8]);\n    }\n  }\n\n  protected fillAttributes = { ...DefaultFillStyle, opacity: 1 };\n  protected strokeAttributes = { ...DefaultStrokeStyle, opacity: 1 };\n  protected textAttributes = { ...DefaultTextStyle, opacity: 1 };\n\n  setCommonStyle(\n    params: ISetCommonStyleParams,\n    attribute: ICommonStyleParams,\n    // 用于渐变色\n    offsetX: number,\n    offsetY: number,\n    defaultParams?: ICommonStyleParams | Partial<ICommonStyleParams>[]\n  ) {\n    if (Array.isArray(defaultParams)) {\n      if (defaultParams.length <= 1) {\n        return this._setCommonStyle(params, attribute, offsetX, offsetY, defaultParams[0]);\n      }\n      // TODO 是否存在性能问题？\n      // TODO 默认第一个是theme\n      const dp = Object.create(defaultParams[0]);\n      defaultParams.forEach((p, i) => {\n        if (i === 0) {\n          return;\n        }\n        Object.assign(dp, p);\n      });\n      return this._setCommonStyle(params, attribute, offsetX, offsetY, dp as Required<ICommonStyleParams>);\n    }\n    return this._setCommonStyle(params, attribute, offsetX, offsetY, defaultParams);\n  }\n\n  protected _setCommonStyle(\n    params: ISetCommonStyleParams,\n    attribute: ICommonStyleParams,\n    // 用于渐变色\n    offsetX: number,\n    offsetY: number,\n    defaultParams?: ICommonStyleParams\n  ) {\n    const _context = this.nativeContext;\n    if (!defaultParams) {\n      defaultParams = this.fillAttributes;\n    }\n    const {\n      fillOpacity = defaultParams.fillOpacity,\n      opacity = defaultParams.opacity,\n      fill = defaultParams.fill\n    } = attribute;\n    _context.globalAlpha = fillOpacity * opacity * this.baseGlobalAlpha;\n\n    if (fillOpacity > 1e-12 && opacity > 1e-12) {\n      _context.fillStyle = createColor(this, fill, params, offsetX, offsetY);\n      // todo 小程序\n    }\n  }\n\n  setShadowBlendStyle(\n    params: ISetCommonStyleParams,\n    attribute: ICommonStyleParams,\n    defaultParams?: ICommonStyleParams | Partial<ICommonStyleParams>[]\n  ) {\n    if (Array.isArray(defaultParams)) {\n      if (defaultParams.length <= 1) {\n        return this._setShadowBlendStyle(params, defaultParams[0]);\n      }\n      // TODO 是否存在性能问题？\n      // TODO 默认第一个是theme\n      const dp = Object.create(defaultParams[0]);\n      defaultParams.forEach((p, i) => {\n        if (i === 0) {\n          return;\n        }\n        Object.assign(dp, p);\n      });\n      return this._setShadowBlendStyle(params, attribute, dp as Required<ICommonStyleParams>);\n    }\n    return this._setShadowBlendStyle(params, attribute, defaultParams);\n  }\n\n  protected _clearShadowStyle = false;\n  protected _clearFilterStyle = false;\n  protected _clearGlobalCompositeOperationStyle = false;\n\n  protected _setShadowBlendStyle(\n    params: ISetCommonStyleParams,\n    attribute: ICommonStyleParams,\n    defaultParams?: ICommonStyleParams\n  ) {\n    const _context = this.nativeContext;\n    if (!defaultParams) {\n      defaultParams = this.fillAttributes;\n    }\n    const {\n      opacity = defaultParams.opacity,\n      shadowBlur = defaultParams.shadowBlur,\n      shadowOffsetX = defaultParams.shadowOffsetX,\n      shadowOffsetY = defaultParams.shadowOffsetY,\n      blur = defaultParams.blur,\n      globalCompositeOperation = defaultParams.globalCompositeOperation\n    } = attribute;\n    if (opacity <= 1e-12) {\n      return;\n    }\n    if (shadowOffsetX || shadowOffsetY || shadowBlur) {\n      const {\n        shadowColor = defaultParams.shadowColor,\n        shadowOffsetX = defaultParams.shadowOffsetX,\n        shadowOffsetY = defaultParams.shadowOffsetY\n      } = attribute;\n\n      // canvas的shadow不支持dpr，这里手动设置\n      _context.shadowBlur = shadowBlur * this.dpr;\n      _context.shadowColor = shadowColor;\n      _context.shadowOffsetX = shadowOffsetX * this.dpr;\n      _context.shadowOffsetY = shadowOffsetY * this.dpr;\n      this._clearShadowStyle = true;\n      // todo 小程序\n    } else if (this._clearShadowStyle) {\n      _context.shadowBlur = 0;\n      _context.shadowOffsetX = 0;\n      _context.shadowOffsetY = 0;\n    }\n\n    if (blur) {\n      _context.filter = `blur(${blur}px)`;\n      this._clearFilterStyle = true;\n    } else if (this._clearFilterStyle) {\n      _context.filter = 'blur(0px)';\n      this._clearFilterStyle = false;\n    }\n\n    if (globalCompositeOperation) {\n      _context.globalCompositeOperation = globalCompositeOperation;\n      this._clearGlobalCompositeOperationStyle = true;\n    } else if (this._clearGlobalCompositeOperationStyle) {\n      _context.globalCompositeOperation = 'source-over';\n      this._clearGlobalCompositeOperationStyle = false;\n    }\n  }\n\n  setStrokeStyle(\n    params: ISetStrokeStyleParams,\n    attribute: IStrokeStyleParams,\n    // 用于渐变色\n    offsetX: number,\n    offsetY: number,\n    defaultParams?: IStrokeStyleParams | IStrokeStyleParams[]\n  ) {\n    if (Array.isArray(defaultParams)) {\n      if (defaultParams.length <= 1) {\n        return this._setStrokeStyle(params, attribute, offsetX, offsetY, defaultParams[0]);\n      }\n      // TODO 是否存在性能问题？\n      // TODO 默认第一个是theme\n      const dp = Object.create(defaultParams[0]);\n      defaultParams.forEach((p, i) => {\n        if (i === 0) {\n          return;\n        }\n        Object.assign(dp, p);\n      });\n      return this._setStrokeStyle(params, attribute, offsetX, offsetY, dp as IStrokeStyleParams);\n    }\n    return this._setStrokeStyle(params, attribute, offsetX, offsetY, defaultParams);\n  }\n  protected _setStrokeStyle(\n    params: ISetStrokeStyleParams,\n    attribute: IStrokeStyleParams,\n    // 用于渐变色\n    offsetX: number,\n    offsetY: number,\n    defaultParams?: IStrokeStyleParams\n  ) {\n    const _context = this.nativeContext;\n    if (!defaultParams) {\n      defaultParams = this.strokeAttributes;\n    }\n    const { strokeOpacity = defaultParams.strokeOpacity, opacity = defaultParams.opacity } = attribute;\n\n    _context.globalAlpha = strokeOpacity * opacity * this.baseGlobalAlpha;\n\n    if (strokeOpacity > 1e-12 && opacity > 1e-12) {\n      const {\n        lineWidth = defaultParams.lineWidth,\n        stroke = defaultParams.stroke,\n        lineJoin = defaultParams.lineJoin,\n        lineDash = defaultParams.lineDash,\n        lineDashOffset = defaultParams.lineDashOffset,\n        lineCap = defaultParams.lineCap,\n        miterLimit = defaultParams.miterLimit,\n        keepStrokeScale = defaultParams.keepStrokeScale\n      } = attribute;\n      _context.lineWidth = keepStrokeScale ? lineWidth : getScaledStroke(this, lineWidth, this.dpr);\n      _context.strokeStyle = createColor(this, stroke as any, params, offsetX, offsetY);\n      _context.lineJoin = lineJoin;\n      if (lineDash) {\n        _context.setLineDash(lineDash);\n        _context.lineDashOffset = lineDashOffset;\n      }\n      _context.lineCap = lineCap;\n      _context.miterLimit = miterLimit;\n    }\n  }\n  setTextStyleWithoutAlignBaseline(params: Partial<ITextStyleParams>, defaultParams?: ITextStyleParams, z?: number) {\n    const _context = this.nativeContext;\n    if (!defaultParams) {\n      defaultParams = this.textAttributes;\n    }\n    const { scaleIn3d = defaultParams.scaleIn3d } = params;\n    if (params.font) {\n      this.font = params.font;\n    } else {\n      this.font = getContextFont(params, defaultParams, scaleIn3d && this.camera && this.camera.getProjectionScale(z));\n    }\n    const { fontFamily = defaultParams.fontFamily, fontSize = defaultParams.fontSize } = params;\n    this.fontFamily = fontFamily;\n    this.fontSize = fontSize;\n    _context.textAlign = 'left';\n    _context.textBaseline = 'alphabetic';\n    // // 这里不使用defaultParams\n    // _context.textAlign = params.textAlign || 'left';\n    // _context.textBaseline = params.textBaseline || 'alphabetic';\n  }\n  setTextStyle(params: Partial<ITextStyleParams>, defaultParams?: ITextStyleParams, z?: number) {\n    const _context = this.nativeContext;\n    if (!defaultParams) {\n      defaultParams = this.textAttributes;\n    }\n    if (params.font) {\n      this.font = params.font;\n    } else {\n      this.font = getContextFont(params, defaultParams, this.camera && this.camera.getProjectionScale(z));\n    }\n    const { fontFamily = defaultParams.fontFamily, fontSize = defaultParams.fontSize } = params;\n    this.fontFamily = fontFamily;\n    this.fontSize = fontSize;\n    _context.textAlign = params.textAlign ?? defaultParams.textAlign;\n    _context.textBaseline = params.textBaseline ?? defaultParams.textBaseline;\n  }\n\n  draw() {\n    return;\n  }\n\n  clearMatrix(setTransform: boolean = true, dpr: number = this.dpr) {\n    this.setTransformFromMatrix(this._clearMatrix, setTransform, dpr);\n  }\n\n  setClearMatrix(a: number, b: number, c: number, d: number, e: number, f: number) {\n    this._clearMatrix.setValue(a, b, c, d, e, f);\n  }\n\n  onlyTranslate(dpr: number = this.dpr): boolean {\n    return this.matrix.a === dpr && this.matrix.b === 0 && this.matrix.c === 0 && this.matrix.d === dpr;\n  }\n\n  release(...params: any): void {\n    this.stack.forEach(m => matrixAllocate.free(m));\n    this.stack.length = 0;\n    return;\n  }\n}\n"]}