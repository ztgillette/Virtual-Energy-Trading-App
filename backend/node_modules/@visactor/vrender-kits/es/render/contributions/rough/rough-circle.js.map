{"version":3,"sources":["../src/render/contributions/rough/rough-circle.ts"],"names":[],"mappings":";;;;;;;;;;;;AAOA,OAAO,EAAE,kBAAkB,EAAE,yBAAyB,EAAY,MAAM,EAAE,UAAU,EAAE,MAAM,wBAAwB,CAAC;AACrH,OAAO,KAAK,MAAM,SAAS,CAAC;AAC5B,OAAO,EAAE,eAAe,EAAE,MAAM,eAAe,CAAC;AAGzC,IAAM,uBAAuB,GAA7B,MAAM,uBAAwB,SAAQ,eAAe;IAK1D,YAEkB,cAA8B;QAE9C,KAAK,EAAE,CAAC;QAFQ,mBAAc,GAAd,cAAc,CAAgB;QAJhD,UAAK,GAAY,OAAO,CAAC;QAOvB,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC;QACrB,IAAI,CAAC,UAAU,GAAG,kBAAkB,CAAC;IACvC,CAAC;IAED,IAAI,CAAC,MAAe,EAAE,aAA6B,EAAE,WAAyB,EAAE,MAAiC;QAC/G,MAAM,EAAE,OAAO,EAAE,GAAG,WAAW,CAAC;QAChC,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO;SACR;QAGD,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC;QAC3C,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;QAGpC,MAAM,eAAe,GAAG,MAAM,CAAC,eAAe,EAAE,CAAC;QACjD,IAAI,EAAE,CAAC,GAAG,eAAe,CAAC,CAAC,EAAE,CAAC,GAAG,eAAe,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC;QACxE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,EAAE;YAEvC,CAAC,GAAG,CAAC,CAAC;YACN,CAAC,GAAG,CAAC,CAAC;YACN,OAAO,CAAC,mBAAmB,CAAC,MAAM,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;SACvD;aAAM,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE;YAEnC,OAAO,CAAC,WAAW,EAAE,CAAC;SACvB;QAED,MAAM,EACJ,MAAM,GAAG,eAAe,CAAC,MAAM,EAC/B,IAAI,GAAG,eAAe,CAAC,IAAI,EAC3B,MAAM,GAAG,eAAe,CAAC,MAAM,EAC/B,SAAS,GAAG,eAAe,CAAC,SAAS,EACtC,GAAG,MAAM,CAAC,SAAS,CAAC;QACrB,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,EAAE;YACtB,IAAI,EAAE,IAAI,CAAC,CAAC,CAAE,IAAe,CAAC,CAAC,CAAC,SAAS;YACzC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAE,MAAiB,CAAC,CAAC,CAAC,SAAS;YAC/C,WAAW,EAAE,SAAS;YACtB,SAAS,EAAE,QAAQ;YACnB,SAAS,EAAE,GAAG;SACf,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AAnDY,uBAAuB;IADnC,UAAU,EAAE;IAOR,WAAA,MAAM,CAAC,yBAAyB,CAAC,CAAA;;GANzB,uBAAuB,CAmDnC;SAnDY,uBAAuB","file":"rough-circle.js","sourcesContent":["import type {\n  IGraphicRender,\n  IRenderService,\n  ICircle,\n  IDrawContext,\n  IGraphicRenderDrawParams\n} from '@visactor/vrender-core';\nimport { CIRCLE_NUMBER_TYPE, DefaultCanvasCircleRender, getTheme, inject, injectable } from '@visactor/vrender-core';\nimport rough from 'roughjs';\nimport { RoughBaseRender } from './base-render';\n\n@injectable()\nexport class RoughCanvasCircleRender extends RoughBaseRender implements IGraphicRender {\n  declare type: 'circle';\n  declare numberType: number;\n  style: 'rough' = 'rough';\n\n  constructor(\n    @inject(DefaultCanvasCircleRender)\n    public readonly canvasRenderer: IGraphicRender\n  ) {\n    super();\n    this.type = 'circle';\n    this.numberType = CIRCLE_NUMBER_TYPE;\n  }\n\n  draw(circle: ICircle, renderService: IRenderService, drawContext: IDrawContext, params?: IGraphicRenderDrawParams) {\n    const { context } = drawContext;\n    if (!context) {\n      return;\n    }\n\n    // 获取到原生canvas\n    const canvas = context.canvas.nativeCanvas;\n    const rc = rough.canvas(canvas, {});\n\n    // const circleAttribute = graphicService.themeService.getCurrentTheme().circleAttribute;\n    const circleAttribute = circle.getGraphicTheme();\n    let { x = circleAttribute.x, y = circleAttribute.y } = circle.attribute;\n    if (!circle.transMatrix.onlyTranslate()) {\n      // 性能较差\n      x = 0;\n      y = 0;\n      context.transformFromMatrix(circle.transMatrix, true);\n    } else if (!context.onlyTranslate()) {\n      // 当前context有rotate/scale，重置matrix\n      context.clearMatrix();\n    }\n\n    const {\n      radius = circleAttribute.radius,\n      fill = circleAttribute.fill,\n      stroke = circleAttribute.stroke,\n      lineWidth = circleAttribute.lineWidth\n    } = circle.attribute;\n    rc.circle(x, y, radius, {\n      fill: fill ? (fill as string) : undefined,\n      stroke: stroke ? (stroke as string) : undefined,\n      strokeWidth: lineWidth,\n      fillStyle: 'zigzag',\n      roughness: 0.5\n    });\n  }\n}\n"]}