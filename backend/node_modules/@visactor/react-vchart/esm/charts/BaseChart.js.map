{"version":3,"sources":["../src/charts/BaseChart.tsx"],"names":[],"mappings":"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","file":"BaseChart.js","sourcesContent":["import type {\n  IVChart,\n  IData,\n  IInitOption,\n  ISpec,\n  IVChartConstructor,\n  IHierarchyData,\n  IVChartRenderOption\n} from '@visactor/vchart';\nimport type { ReactNode } from 'react';\nimport React, { useState, useEffect, useRef, useImperativeHandle } from 'react';\nimport type { ContainerProps } from '../containers/withContainer';\nimport withContainer from '../containers/withContainer';\nimport type { ChartContextType } from '../context/chart';\nimport RootChartContext from '../context/chart';\nimport { isEqual, isNil, isValid, pickWithout } from '@visactor/vutils';\nimport { toArray } from '../util';\nimport { REACT_PRIVATE_PROPS } from '../constants';\nimport type {\n  EventsProps,\n  LegendEventProps,\n  ScrollBarEventProps,\n  BrushEventProps,\n  DataZoomEventProps,\n  PlayerEventProps,\n  DimensionEventProps,\n  HierarchyEventProps,\n  ChartLifeCycleEventProps\n} from '../eventsUtils';\nimport { bindEventsToChart, CHART_EVENTS_KEYS, CHART_EVENTS } from '../eventsUtils';\nimport type { IReactTooltipProps } from '../components/tooltip/interface';\nimport { initCustomTooltip } from '../components/tooltip/util';\n\nexport type ChartOptions = Omit<IInitOption, 'dom'>;\n\nexport interface BaseChartProps\n  extends EventsProps,\n    LegendEventProps,\n    ScrollBarEventProps,\n    BrushEventProps,\n    DataZoomEventProps,\n    PlayerEventProps,\n    DimensionEventProps,\n    HierarchyEventProps,\n    ChartLifeCycleEventProps,\n    IReactTooltipProps {\n  vchartConstructor?: IVChartConstructor;\n  /**  @deprecated 请使用 vchartConstructor  */\n  vchartConstrouctor?: IVChartConstructor;\n  type?: string;\n  /** 上层container */\n  container?: HTMLDivElement;\n  /**\n   * used only by <VChart />\n   */\n  spec?: ISpec;\n  /** 数据 */\n  data?: IData | IHierarchyData;\n  /** 画布宽度 */\n  width?: number;\n  /** 画布高度 */\n  height?: number;\n  /** 图表配置 */\n  options?: ChartOptions;\n  /** skip function diff when component update */\n  skipFunctionDiff?: boolean;\n  /**\n   * add `morphConfig` for chart\n   * @since 1.12.7\n   */\n  morphConfig?: IVChartRenderOption['morphConfig'];\n  /** 图表渲染完成事件 */\n  onReady?: (instance: IVChart, isInitial: boolean) => void;\n  /** throw error when chart run into an error */\n  onError?: (err: Error) => void;\n  /**\n   * use sync render\n   *\n   * @since 1.8.3\n   * @deprecated 1.9.0\n   **/\n  useSyncRender?: boolean;\n}\n\ntype Props = React.PropsWithChildren<BaseChartProps>;\n\nconst notSpecKeys = [\n  ...REACT_PRIVATE_PROPS,\n  ...CHART_EVENTS_KEYS,\n  'vchartConstructor',\n  'vchartConstrouctor',\n  'useSyncRender',\n  'skipFunctionDiff',\n  'onError',\n  'onReady',\n  'spec',\n  'container',\n  'options',\n  'morphConfig'\n];\nconst defaultMorphConfig = {\n  morph: false,\n  enableExitAnimation: false\n};\n\nconst getComponentId = (child: React.ReactNode, index: number) => {\n  const componentName = child && (child as any).type && ((child as any).type.displayName || (child as any).type.name);\n  return `${componentName}-${index}`;\n};\n\nconst parseSpecFromChildren = (props: Props) => {\n  const specFromChildren: Omit<ISpec, 'type' | 'data' | 'width' | 'height'> = {};\n\n  toArray(props.children).map((child, index) => {\n    const parseSpec = child && (child as any).type && (child as any).type.parseSpec;\n\n    if (parseSpec && (child as any).props) {\n      const childProps = isNil((child as any).props.componentId)\n        ? {\n            ...(child as any).props,\n            componentId: getComponentId(child, index)\n          }\n        : (child as any).props;\n\n      const specResult = parseSpec(childProps);\n\n      if (specResult.isSingle) {\n        (specFromChildren as any)[specResult.specName] = specResult.spec;\n      } else {\n        if (!(specFromChildren as any)[specResult.specName]) {\n          (specFromChildren as any)[specResult.specName] = [];\n        }\n\n        (specFromChildren as any)[specResult.specName].push(specResult.spec);\n      }\n    }\n  });\n\n  return specFromChildren;\n};\n\nconst BaseChart: React.FC<Props> = React.forwardRef((props, ref) => {\n  const [updateId, setUpdateId] = useState<number>(0);\n  const chartContext = useRef<ChartContextType>({});\n  useImperativeHandle(ref, () => chartContext.current?.chart);\n  const hasSpec = !!props.spec;\n  const isUnmount = useRef<boolean>(false);\n  const prevSpec = useRef(pickWithout(props, notSpecKeys));\n  const specFromChildren = useRef<Omit<ISpec, 'type' | 'data' | 'width' | 'height'>>(null);\n  const eventsBinded = React.useRef<BaseChartProps>(null);\n  const skipFunctionDiff = !!props.skipFunctionDiff;\n  const [tooltipNode, setTooltipNode] = useState<ReactNode>(null);\n\n  const parseSpec = (props: Props) => {\n    let spec: ISpec;\n\n    if (hasSpec && props.spec) {\n      spec = props.spec;\n\n      if (isValid(props.data)) {\n        spec = {\n          ...props.spec,\n          data: props.data\n        } as ISpec;\n      }\n    } else {\n      spec = {\n        ...prevSpec.current,\n        ...specFromChildren.current\n      } as ISpec;\n    }\n\n    const tooltipSpec = initCustomTooltip(setTooltipNode, props, spec.tooltip);\n    if (tooltipSpec) {\n      spec.tooltip = tooltipSpec;\n    }\n    return spec;\n  };\n\n  const createChart = (props: Props) => {\n    const cs = new (props.vchartConstructor ?? (props as any).vchartConstrouctor)(parseSpec(props), {\n      ...props.options,\n      onError: props.onError,\n      autoFit: true,\n      dom: props.container\n    });\n    chartContext.current = { ...chartContext.current, chart: cs };\n    isUnmount.current = false;\n  };\n\n  const handleChartRender = (rebindEvent?: boolean) => {\n    // rebind events after render\n    if (!isUnmount.current) {\n      if (!chartContext.current || !chartContext.current.chart) {\n        return;\n      }\n\n      if (rebindEvent) {\n        bindEventsToChart(chartContext.current.chart, props, eventsBinded.current, CHART_EVENTS);\n      }\n\n      setUpdateId(updateId + 1);\n      if (props.onReady) {\n        props.onReady(chartContext.current.chart, updateId === 0);\n      }\n    }\n  };\n\n  const renderChart = () => {\n    if (chartContext.current.chart) {\n      // event should bind before render when the chart has not been rendered\n      bindEventsToChart(chartContext.current.chart, props, eventsBinded.current, CHART_EVENTS);\n\n      chartContext.current.chart.renderSync({\n        reuse: false\n      });\n      handleChartRender();\n    }\n  };\n\n  useEffect(() => {\n    const newSpecFromChildren = hasSpec ? null : parseSpecFromChildren(props);\n\n    if (!chartContext.current?.chart) {\n      if (!hasSpec) {\n        specFromChildren.current = newSpecFromChildren;\n      }\n\n      createChart(props);\n      renderChart();\n      eventsBinded.current = props;\n      return;\n    }\n\n    if (hasSpec) {\n      if (!isEqual(eventsBinded.current.spec, props.spec, { skipFunction: skipFunctionDiff })) {\n        chartContext.current.chart.updateSpecSync(parseSpec(props), undefined, props.morphConfig ?? defaultMorphConfig);\n        handleChartRender(true);\n        eventsBinded.current = props;\n      } else if (eventsBinded.current.data !== props.data) {\n        chartContext.current.chart.updateFullDataSync(props.data as any);\n        handleChartRender(true);\n        eventsBinded.current = props;\n      }\n      return;\n    }\n\n    const newSpec = pickWithout(props, notSpecKeys);\n\n    if (\n      !isEqual(newSpec, prevSpec.current, { skipFunction: skipFunctionDiff }) ||\n      !isEqual(newSpecFromChildren, specFromChildren.current, { skipFunction: skipFunctionDiff })\n    ) {\n      prevSpec.current = newSpec;\n      specFromChildren.current = newSpecFromChildren;\n\n      chartContext.current.chart.updateSpecSync(parseSpec(props), undefined, props.morphConfig ?? defaultMorphConfig);\n      handleChartRender(true);\n      eventsBinded.current = props;\n    }\n  }, [props]);\n\n  useEffect(() => {\n    return () => {\n      if (chartContext) {\n        if (chartContext.current && chartContext.current.chart) {\n          chartContext.current.chart.release();\n          chartContext.current.chart = null;\n        }\n      }\n      eventsBinded.current = null;\n      isUnmount.current = true;\n    };\n  }, []);\n\n  return (\n    <RootChartContext.Provider value={chartContext.current}>\n      {toArray(props.children).map((child, index) => {\n        if (typeof child === 'string') {\n          return null;\n        }\n\n        const childId = getComponentId(child, index);\n\n        return (\n          <React.Fragment key={childId}>\n            {React.cloneElement(child as React.ReactElement<any, React.JSXElementConstructor<any>>, {\n              updateId: updateId,\n              componentId: childId\n            })}\n          </React.Fragment>\n        );\n      })}\n      {tooltipNode}\n    </RootChartContext.Provider>\n  );\n});\n\nexport const createChart = <T extends Props>(\n  componentName: string,\n  defaultProps?: Partial<T>,\n  registers?: (() => void)[]\n) => {\n  if (registers && registers.length && defaultProps.vchartConstructor) {\n    defaultProps.vchartConstructor.useRegisters(registers);\n  }\n\n  const Com = withContainer<T>(BaseChart as any, componentName, (props: T) => {\n    if (defaultProps) {\n      return Object.assign(props, defaultProps);\n    }\n    return props;\n  });\n  Com.displayName = componentName;\n  return Com;\n};\n"]}