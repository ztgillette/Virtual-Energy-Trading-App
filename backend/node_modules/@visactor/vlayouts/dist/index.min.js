!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VUtils={})}(this,(function(t){"use strict";!function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,n,o,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,o||t,r),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,o=n.length,r=new Array(o);s<o;s++)r[s]=n[s].fn;return r},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,s,o,r){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,s),!0;case 5:return c.fn.call(c.context,e,n,s,o),!0;case 6:return c.fn.call(c.context,e,n,s,o,r),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var d,g=c.length;for(h=0;h<g;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,n);break;case 4:c[h].fn.call(c[h].context,e,n,s);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];c[h].fn.apply(c[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,s){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return r(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||s&&!a.once||n&&a.context!==n||r(this,o);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||s&&!a[l].once||n&&a[l].context!==n)&&h.push(a[l]);h.length?this._events[o]=1===h.length?h[0]:h:r(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&r(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}({exports:{}});var e=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var i=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"boolean"==typeof t:!0===t||!1===t||e(t,"Boolean")};var n=t=>"function"==typeof t;var s=t=>null==t;var o=t=>null!=t;var r=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var a=t=>"object"==typeof t&&null!==t;var l=function(t){if(!a(t)||!e(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let i=t;for(;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(t)===i};var h=function(t){const i=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"string"===i:"string"===i||e(t,"String")};var c=t=>Array.isArray?Array.isArray(t):e(t,"Array");var u=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var d=function(t){const i=typeof t;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"number"===i:"number"===i||e(t,"Number")};var g=t=>d(t)&&Number.isFinite(t);var f=t=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(t);var p=t=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(t);var x=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const y=Object.prototype;var m=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||y)};const v=Object.prototype.hasOwnProperty;var M=(t,e,i)=>{const n=h(e)?e.split("."):e;for(let e=0;e<n.length;e++)t=t?t[n[e]]:void 0;return void 0===t?i:t};function _(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e){if(t===e)return;if(o(e)&&"object"==typeof e){const s=Object(e),r=[];for(const t in s)r.push(t);let{length:a}=r,l=-1;for(;a--;){const a=r[++l];!o(s[a])||"object"!=typeof s[a]||n&&c(t[a])?b(t,a,s[a]):w(t,e,a,i,n)}}}}function w(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t[i],r=e[i];let a=e[i],h=!0;if(c(r)){if(n)a=[];else if(c(o))a=o;else if(u(o)){a=new Array(o.length);let t=-1;const e=o.length;for(;++t<e;)a[t]=o[t]}}else l(r)?(a=null!=o?o:{},"function"!=typeof o&&"object"==typeof o||(a={})):h=!1;h&&_(a,r,n,s),b(t,i,a)}function b(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function S(t){let e=-1;const i=arguments.length<=1?0:arguments.length-1;for(;++e<i;)_(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1],!0);return t}function k(t,e){if(!t||!l(t))return t;const i={};return Object.keys(t).forEach((n=>{const s=t[n];let o=!1;e.forEach((t=>{(h(t)&&t===n||t instanceof RegExp&&n.match(t))&&(o=!0)})),o||(i[n]=s)})),i}function z(t){return o(t)?c(t)?t:[t]:[]}const F=(t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let s=1;s<t.length;s++){const o=t[s];(null!==(i=null==e?void 0:e(o,n))&&void 0!==i?i:o-n)<0&&(n=o)}return n};function T(t){let e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random,s=t.length;for(;s;)e=Math.floor(n()*s),i=t[--s],t[s]=t[e],t[e]=i;return t}function R(t,e,i){o(e)||(e=t,t=0),o(i)||(i=1);let n=-1;const s=0|Math.max(0,Math.ceil((e-t)/i)),r=new Array(s);for(;++n<s;)r[n]=t+n*i;return r}function L(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function I(t){return Number(t)}const C="undefined"!=typeof console;function P(t,e,i){const n=[e].concat([].slice.call(i));C&&console[t].apply(console,n)}var O;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(O||(O={}));class A{static getInstance(t,e){return A._instance&&d(t)?A._instance.level(t):A._instance||(A._instance=new A(t,e)),A._instance}static setInstance(t){return A._instance=t}static setInstanceLevel(t){A._instance?A._instance.level(t):A._instance=new A(t)}static clearInstance(){A._instance=null}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.None,e=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=O.Info}canLogDebug(){return this._level>=O.Debug}canLogError(){return this._level>=O.Error}canLogWarn(){return this._level>=O.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this._level>=O.Error&&(this._onErrorHandler.length?this.callErrorHandler(...i):P(null!==(t=this._method)&&void 0!==t?t:"error","ERROR",i)),this}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=O.Warn&&P(this._method||"warn","WARN",e),this}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=O.Info&&P(this._method||"log","INFO",e),this}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this._level>=O.Debug&&P(this._method||"log","DEBUG",e),this}}A._instance=null;const E=t=>{let e=null,i=null;return function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return e&&s.every(((t,i)=>t===e[i]))||(e=s,i=t(...s)),i}};var D=function(t,e,i){return t<e?e:t>i?i:t};function W(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}function B(t,e){return i=>t*(1-i)+e*i}function N(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}function $(t){if(g(t))return t;const e=+t;return g(e)?e:0}function q(t){return parseFloat("0."+Math.sin(t).toString().substring(6))}const j=4294967296;const H=()=>{let t=-1;const e=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9];return()=>(t=(t+1)%e.length,e[t])},G=t=>e=>M(e,t),U=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(t))return t;const i=[t];return(e&&e.get||G)(i)},V=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c(t)){const i=t.map((t=>U(t,e)));return t=>i.map((e=>e(t)))}return U(t,e)},K=t=>t?"string"==typeof t||"number"==typeof t?()=>t:n(t)?t:e=>e[t.field]:null,Y=(t,e)=>s(t)?e:h(t)?e*parseFloat(t)/100:t,X=t=>0,Z=(t,e)=>{const i=n(e)?e:t=>t;let o,r;if(t&&t.length){const e=t.length;for(let n=0;n<e;n+=1){let e=i(t[n]);s(e)||!d(e=+e)||Number.isNaN(e)||(s(o)?(o=e,r=e):(o=Math.min(o,e),r=Math.max(r,e)))}return[o,r]}return[o,r]},Q=Math.sqrt,J=Math.pow;function tt(t,e){let i=0;for(let n=0;n<t.length;++n)i+=t[n]*e[n];return i}class et{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=n}clone(){return new et(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return d(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return d(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class it{static distancePP(t,e){return Q(J(t.x-e.x,2)+J(t.y-e.y,2))}static distanceNN(t,e,i,n){return Q(J(t-i,2)+J(e-n,2))}static distancePN(t,e,i){return Q(J(e-t.x,2)+J(i-t.y,2))}static pointAtPP(t,e,i){return new et((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function nt(t){return t*(Math.PI/180)}function st(t,e,i){return e?{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}:{x:t.x,y:t.y}}function ot(t,e,i){e/=100,i/=100;const n=(1-Math.abs(2*i-1))*e,s=n*(1-Math.abs(t/60%2-1)),o=i-n/2;let r=0,a=0,l=0;return 0<=t&&t<60?(r=n,a=s,l=0):60<=t&&t<120?(r=s,a=n,l=0):120<=t&&t<180?(r=0,a=n,l=s):180<=t&&t<240?(r=0,a=s,l=n):240<=t&&t<300?(r=s,a=0,l=n):300<=t&&t<360&&(r=n,a=0,l=s),r=Math.round(255*(r+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:r,g:a,b:l}}function rt(t,e,i){t/=255,e/=255,i/=255;const n=Math.min(t,e,i),s=Math.max(t,e,i),o=s-n;let r=0,a=0,l=0;return r=0===o?0:s===t?(e-i)/o%6:s===e?(i-t)/o+2:(t-e)/o+4,r=Math.round(60*r),r<0&&(r+=360),l=(s+n)/2,a=0===o?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:r,s:a,l:l}}const at=/^#([0-9a-f]{3,8})$/,lt={transparent:4294967040},ht={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ct(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ut(t){return d(t)?new xt(t>>16,t>>8&255,255&t,1):c(t)?new xt(t[0],t[1],t[2]):new xt(255,255,255)}function dt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function gt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const ft=(t,e)=>{const i=at.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new xt((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?ut(t):8===e?new xt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};class pt{static Brighter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new pt(t).brighter(e).toRGBA()}static SetOpacity(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 1===e?t:new pt(t).setOpacity(e).toRGBA()}static getColorBrightness(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hsl";const i=t instanceof pt?t:new pt(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(o(lt[t]))return function(t){return d(t)?new xt(t>>>24,t>>>16&255,t>>>8&255,255&t):c(t)?new xt(t[0],t[1],t[2],t[3]):new xt(255,255,255,1)}(lt[t]);if(o(ht[t]))return ut(ht[t]);const e=`${t}`.trim().toLowerCase(),i=ft(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new xt(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=ot(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new xt(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(t){const e=pt.parseColorString(t);e?this.color=e:(console.warn(`Warn: 传入${t}无法解析为Color`),this.color=new xt(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t))),this}add(t){const{r:e,g:i,b:n}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,n+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:n}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(n*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const n=this.color.opacity,o=rt(this.color.r,this.color.g,this.color.b),r=ot(s(t)?o.h:D(t,0,360),s(e)?o.s:e>=0&&e<=1?100*e:e,s(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new xt(r.r,r.g,r.b,n),this}setRGB(t,e,i){return!s(t)&&(this.color.r=t),!s(e)&&(this.color.g=e),!s(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=ft(e,!0);return null!=i?i:this}setColorName(t){const e=ht[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let n,s,o;return n=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),s=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*n+.7152*s+.0722*o}clone(){return new pt(this.color.toString())}copyGammaToLinear(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=dt(t.color.r),this.color.g=dt(t.color.g),this.color.b=dt(t.color.b),this}copyLinearToSRGB(t){return this.color.r=gt(t.color.r),this.color.g=gt(t.color.g),this.color.b=gt(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class xt{constructor(t,e,i,n){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),o(n)?this.opacity=isNaN(+n)?1:Math.max(0,Math.min(1,+n)):this.opacity=1}formatHex(){return`#${ct(this.r)+ct(this.g)+ct(this.b)+(1===this.opacity?"":ct(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:n}=rt(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${n}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}}var yt=Object.freeze({__proto__:null,Color:pt,DEFAULT_COLORS:ht,RGB:xt,hexToRgb:function(t){let e="",i="",n="";const s="#"===t[0]?1:0;for(let o=s;o<t.length;o++)"#"!==t[o]&&(o<s+2?e+=t[o]:o<s+4?i+=t[o]:o<s+6&&(n+=t[o]));return[parseInt(e,16),parseInt(i,16),parseInt(n,16)]},hslToRgb:ot,interpolateRgb:function(t,e){const i=t.r,n=e.r,s=t.g,o=e.g,r=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+n*t),c=Math.round(s*(1-t)+o*t),u=Math.round(r*(1-t)+a*t);return new xt(e,c,u,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:rt});const mt=1e-10;function vt(t,e){const i=function(t){const e=[];for(let i=0;i<t.length;++i)for(let n=i+1;n<t.length;++n){const s=wt(t[i],t[n]);for(let t=0;t<s.length;++t){const o=s[t];o.parentIndex=[i,n],e.push(o)}}return e}(t),n=i.filter((function(e){return function(t,e){for(let i=0;i<e.length;++i)if(it.distancePP(t,e[i])>e[i].radius+mt)return!1;return!0}(e,t)}));let s=0,o=0;const r=[];if(n.length>1){const e=bt(n);for(let t=0;t<n.length;++t){const i=n[t];i.angle=Math.atan2(i.x-e.x,i.y-e.y)}n.sort((function(t,e){return e.angle-t.angle}));let i=n[n.length-1];for(let e=0;e<n.length;++e){const a=n[e];o+=(i.x+a.x)*(a.y-i.y);const l={x:(a.x+i.x)/2,y:(a.y+i.y)/2};let h=null;for(let e=0;e<a.parentIndex.length;++e)if(i.parentIndex.indexOf(a.parentIndex[e])>-1){const n=t[a.parentIndex[e]],s=Math.atan2(a.x-n.x,a.y-n.y),o=Math.atan2(i.x-n.x,i.y-n.y);let r=o-s;r<0&&(r+=2*Math.PI);const c=o-r/2;let u=it.distancePP(l,{x:n.x+n.radius*Math.sin(c),y:n.y+n.radius*Math.cos(c)});u>2*n.radius&&(u=2*n.radius),(null===h||h.width>u)&&(h={circle:n,width:u,p1:a,p2:i})}null!==h&&(r.push(h),s+=Mt(h.circle.radius,h.width),i=a)}}else{let e=t[0];for(let i=1;i<t.length;++i)t[i].radius<e.radius&&(e=t[i]);let i=!1;for(let n=0;n<t.length;++n)if(it.distancePP(t[n],e)>Math.abs(e.radius-t[n].radius)){i=!0;break}i?s=o=0:(s=e.radius*e.radius*Math.PI,r.push({circle:e,p1:{x:e.x,y:e.y+e.radius},p2:{x:e.x-mt,y:e.y+e.radius},width:2*e.radius}))}return o/=2,e&&(e.area=s+o,e.arcArea=s,e.polygonArea=o,e.arcs=r,e.innerPoints=n,e.intersectionPoints=i),s+o}function Mt(t,e){return t*t*Math.acos(1-e/t)-(t-e)*Math.sqrt(e*(2*t-e))}function _t(t,e,i){if(i>=t+e)return 0;if(i<=Math.abs(t-e))return Math.PI*Math.min(t,e)*Math.min(t,e);const n=e-(i*i-t*t+e*e)/(2*i);return Mt(t,t-(i*i-e*e+t*t)/(2*i))+Mt(e,n)}function wt(t,e){const i=it.distancePP(t,e),n=t.radius,s=e.radius;if(i>=n+s||i<=Math.abs(n-s))return[];const o=(n*n-s*s+i*i)/(2*i),r=Math.sqrt(n*n-o*o),a=t.x+o*(e.x-t.x)/i,l=t.y+o*(e.y-t.y)/i,h=-(e.y-t.y)*(r/i),c=-(e.x-t.x)*(r/i);return[{x:a+h,y:l-c},{x:a-h,y:l+c}]}function bt(t){const e={x:0,y:0};for(let i=0;i<t.length;++i)e.x+=t[i].x,e.y+=t[i].y;return e.x/=t.length,e.y/=t.length,e}function St(t){const e=new Array(t);for(let i=0;i<t;++i)e[i]=0;return e}function kt(t,e){return St(t).map((function(){return St(e)}))}function zt(t){return Math.sqrt(tt(t,t))}function Ft(t,e,i){for(let n=0;n<e.length;++n)t[n]=e[n]*i}function Tt(t,e,i,n,s){for(let o=0;o<t.length;++o)t[o]=e*i[o]+n*s[o]}function Rt(t,e,i){const n=(i=i||{}).maxIterations||200*e.length,s=i.nonZeroDelta||1.05,o=i.zeroDelta||.001,r=i.minErrorDelta||1e-6,a=i.minErrorDelta||1e-5,l=void 0!==i.rho?i.rho:1,h=void 0!==i.chi?i.chi:2,c=void 0!==i.psi?i.psi:-.5,u=void 0!==i.sigma?i.sigma:.5;let d;const g=e.length,f=new Array(g+1);f[0]=e,f[0].fx=t(e),f[0].id=0;for(let i=0;i<g;++i){const n=e.slice();n[i]=n[i]?n[i]*s:o,f[i+1]=n,f[i+1].fx=t(n),f[i+1].id=i+1}function p(t){for(let e=0;e<t.length;e++)f[g][e]=t[e];f[g].fx=t.fx}const x=function(t,e){return t.fx-e.fx},y=e.slice(),m=e.slice(),v=e.slice(),M=e.slice();for(let e=0;e<n;++e){if(f.sort(x),i.history){const t=f.map((function(t){const e=t.slice();return e.fx=t.fx,e.id=t.id,e}));t.sort((function(t,e){return t.id-e.id})),i.history.push({x:f[0].slice(),fx:f[0].fx,simplex:t})}d=0;for(let t=0;t<g;++t)d=Math.max(d,Math.abs(f[0][t]-f[1][t]));if(Math.abs(f[0].fx-f[g].fx)<r&&d<a)break;for(let t=0;t<g;++t){y[t]=0;for(let e=0;e<g;++e)y[t]+=f[e][t];y[t]/=g}const e=f[g];if(Tt(m,1+l,y,-l,e),m.fx=t(m),m.fx<f[0].fx)Tt(M,1+h,y,-h,e),M.fx=t(M),M.fx<m.fx?p(M):p(m);else if(m.fx>=f[g-1].fx){let i=!1;if(m.fx>e.fx?(Tt(v,1+c,y,-c,e),v.fx=t(v),v.fx<e.fx?p(v):i=!0):(Tt(v,1-c*l,y,c*l,e),v.fx=t(v),v.fx<m.fx?p(v):i=!0),i){if(u>=1)break;for(let e=1;e<f.length;++e)Tt(f[e],1-u,f[0],u,f[e]),f[e].fx=t(f[e])}}else p(m)}return f.sort(x),{fx:f[0].fx,x:f[0]}}function Lt(t,e,i,n,s,o,r){const a=i.fx,l=tt(i.fxprime,e);let h=a,c=a,u=l,d=0;function g(c,d,g){for(let f=0;f<16;++f)if(s=(c+d)/2,Tt(n.x,1,i.x,s,e),h=n.fx=t(n.x,n.fxprime),u=tt(n.fxprime,e),h>a+o*s*l||h>=g)d=s;else{if(Math.abs(u)<=-r*l)return s;u*(d-c)>=0&&(d=c),c=s,g=h}return 0}s=s||1,o=o||1e-6,r=r||.1;for(let f=0;f<10;++f){if(Tt(n.x,1,i.x,s,e),h=n.fx=t(n.x,n.fxprime),u=tt(n.fxprime,e),h>a+o*s*l||f&&h>=c)return g(d,s,c);if(Math.abs(u)<=-r*l)return s;if(u>=0)return g(s,d,h);c=h,d=s,s*=2}return s}function It(t,e,i){let n={x:e.slice(),fx:0,fxprime:e.slice()},s={x:e.slice(),fx:0,fxprime:e.slice()};const o=e.slice();let r,a=1;const l=(i=i||{}).maxIterations||20*e.length;n.fx=t(n.x,n.fxprime);const h=n.fxprime.slice();Ft(h,n.fxprime,-1);for(let e=0;e<l;++e){if(a=Lt(t,h,n,s,a),i.history&&i.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:a}),a){Tt(o,1,s.fxprime,-1,n.fxprime);const t=tt(n.fxprime,n.fxprime);Tt(h,Math.max(0,tt(o,s.fxprime)/t),h,-1,s.fxprime),r=n,n=s,s=r}else Ft(h,n.fxprime,-1);if(zt(n.fxprime)<=1e-5)break}return i.history&&i.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:a}),n}const Ct=(t,e,i=0,n=-1,o,r,a="value")=>{let l=0,h=null!=n?n:-1,c=i;return t.forEach(((t,n)=>{var u,d;const g={flattenIndex:++h,key:r?r(t):`${null!==(u=null==o?void 0:o.key)&&void 0!==u?u:""}-${n}`,maxDepth:-1,depth:i,index:n,value:t[a],isLeaf:!0,datum:o?o.datum.concat(t):[t],parentKey:null==o?void 0:o.key};if(null===(d=t.children)||void 0===d?void 0:d.length){g.children=[],g.isLeaf=!1;const e=Ct(t.children,g.children,i+1,h,g,r,a);g.value=s(t[a])?e.sum:Math.max(e.sum,$(t[a])),h=e.flattenIndex,c=Math.max(e.maxDepth,c)}else g.isLeaf=!0,g.value=$(t[a]);l+=Math.abs(g.value),e.push(g)})),{sum:l,maxDepth:c,flattenIndex:h}},Pt=(t,e,i,n)=>{let s=n;return t.forEach(((t,n)=>{var o;s=e(t,n,i,s),(null===(o=t.children)||void 0===o?void 0:o.length)&&(s=Pt(t.children,e,t,s))})),n},Ot=(t,e,i,n)=>{let s=n;return t.forEach(((t,n)=>{var o;(null===(o=t.children)||void 0===o?void 0:o.length)&&(s=Ot(t.children,e,t,s)),s=e(t,n,i,s)})),s},At=(t,e=[],i)=>{const n=(null==i?void 0:i.maxDepth)>=0;return t.forEach((t=>{(!n||t.depth<=i.maxDepth)&&(e.push((null==i?void 0:i.callback)?i.callback(t):t),t.children&&(n&&t.depth===i.maxDepth?(t.children=null,t.isLeaf=!0):At(t.children,e,i)))})),e};function Et(t,e){let i,n;if(Bt(e,t))return[e];for(i=0;i<t.length;++i)if(Dt(e,t[i])&&Bt($t(t[i],e),t))return[t[i],e];for(i=0;i<t.length-1;++i)for(n=i+1;n<t.length;++n)if(Dt($t(t[i],t[n]),e)&&Dt($t(t[i],e),t[n])&&Dt($t(t[n],e),t[i])&&Bt(qt(t[i],t[n],e),t))return[t[i],t[n],e];A.getInstance().error("error when packEncloseRandom")}function Dt(t,e){const i=t.radius-e.radius,n=e.x-t.x,s=e.y-t.y;return i<0||i*i<n*n+s*s}function Wt(t,e){const i=t.radius-e.radius+1e-9*Math.max(t.radius,e.radius,1),n=e.x-t.x,s=e.y-t.y;return i>0&&i*i>n*n+s*s}function Bt(t,e){for(let i=0;i<e.length;++i)if(!Wt(t,e[i]))return!1;return!0}function Nt(t){switch(t.length){case 1:return function(t){return{x:t.x,y:t.y,radius:t.radius}}(t[0]);case 2:return $t(t[0],t[1]);case 3:return qt(t[0],t[1],t[2])}}function $t(t,e){const i=t.x,n=t.y,s=t.radius,o=e.x,r=e.y,a=e.radius,l=o-i,h=r-n,c=a-s,u=Math.sqrt(l*l+h*h);return{x:(i+o+l/u*c)/2,y:(n+r+h/u*c)/2,radius:(u+s+a)/2}}function qt(t,e,i){const n=t.x,s=t.y,o=t.radius,r=e.x,a=e.y,l=e.radius,h=i.x,c=i.y,u=i.radius,d=n-r,g=n-h,f=s-a,p=s-c,x=l-o,y=u-o,m=n*n+s*s-o*o,v=m-r*r-a*a+l*l,M=m-h*h-c*c+u*u,_=g*f-d*p,w=(f*M-p*v)/(2*_)-n,b=(p*x-f*y)/_,S=(g*v-d*M)/(2*_)-s,k=(d*y-g*x)/_,z=b*b+k*k-1,F=2*(o+w*b+S*k),T=w*w+S*S-o*o,R=-(Math.abs(z)>1e-6?(F+Math.sqrt(F*F-4*z*T))/(2*z):T/F);return{x:n+w+b*R,y:s+S+k*R,radius:R}}function jt(t,e,i){const n=t.x-e.x;let s,o;const r=t.y-e.y;let a,l;const h=n*n+r*r;h?(o=e.radius+i.radius,o*=o,l=t.radius+i.radius,l*=l,o>l?(s=(h+l-o)/(2*h),a=Math.sqrt(Math.max(0,l/h-s*s)),i.x=t.x-s*n-a*r,i.y=t.y-s*r+a*n):(s=(h+o-l)/(2*h),a=Math.sqrt(Math.max(0,o/h-s*s)),i.x=e.x+s*n-a*r,i.y=e.y+s*r+a*n)):(i.x=e.x+i.radius,i.y=e.y)}function Ht(t,e){const i=t.radius+e.radius-1e-6,n=e.x-t.x,s=e.y-t.y;return i>0&&i*i>n*n+s*s}function Gt(t){const e=t._,i=t.next._,n=e.radius+i.radius,s=(e.x*i.radius+i.x*e.radius)/n,o=(e.y*i.radius+i.y*e.radius)/n;return s*s+o*o}function Ut(t){return{_:t,next:null,prev:null}}function Vt(t,e){const i=(t=z(t)).length;if(!i)return 0;let n=t[0];if(n.x=0,n.y=0,1===i)return n.radius;const s=t[1];if(n.x=-s.radius,s.x=n.radius,s.y=0,2===i)return n.radius+s.radius;let o=t[2];jt(s,n,o);let r,a,l,h,c,u,d,g=Ut(n),f=Ut(s),p=Ut(o);g.next=f,p.prev=f,f.next=p,g.prev=p,p.next=g,f.prev=g;for(let e=3;e<i;++e){d=!1,o=t[e],jt(g._,f._,o),p=Ut(o),r=f.next,a=g.prev,l=f._.radius,h=g._.radius;do{if(l<=h){if(Ht(r._,p._)){f=r,g.next=f,f.prev=g,--e,d=!0;break}l+=r._.radius,r=r.next}else{if(Ht(a._,p._)){g=a,g.next=f,f.prev=g,--e,d=!0;break}h+=a._.radius,a=a.prev}}while(r!==a.next);if(!d){for(p.prev=g,p.next=f,g.next=f.prev=f=p,c=Gt(g),p=p.next;p!==f;)u=Gt(p),u<c&&(g=p,c=u),p=p.next;f=g.next}}const x=[f._];for(p=f.next;p!==f;)x.push(p._),p=p.next;o=function(t,e){let i=0;const n=T(Array.from(t),e),s=n.length;let o,r,a=[];for(;i<s;)o=n[i],r&&Wt(r,o)?++i:(a=Et(a,o),r=Nt(a),i=0);return r}(x,e);for(let e=0;e<i;++e)n=t[e],n.x-=o.x,n.y-=o.y;return o.radius}function Kt(t){return function(e){e.children||(e.radius=Math.max(0,+t(e)||0))}}function Yt(t,e,i){return function(n){const s=null==n?void 0:n.children;if(s){let o;const r=s.length,a=t(n)*e||0;if(a)for(o=0;o<r;++o)s[o].radius+=a;const l=Vt(s,i);if(a)for(o=0;o<r;++o)s[o].radius-=a;n.radius=l+a}}}function Xt(t,e){return function(i,n,s){i.radius*=t,i.maxDepth=e,s&&(i.x=s.x+t*i.x,i.y=s.y+t*i.y)}}class Zt{constructor(t){this.options=t;const e=null==t?void 0:t.nodeKey,i=n(e)?e:e?V(e):null;this._getNodeKey=i,this._getPadding=d(null==t?void 0:t.padding)?e=>t.padding:c(null==t?void 0:t.padding)?e=>{var i;return null!==(i=t.padding[e.depth+1])&&void 0!==i?i:0}:()=>0,this._maxDepth=-1}layout(t,e){var i;const s="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];const o=[],r=Ct(t,o,0,-1,null,this._getNodeKey);this._maxDepth=r.maxDepth;const a=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return()=>(t=(1664525*t+1013904223)%j)/j}(),l={flattenIndex:-1,maxDepth:-1,key:"root",depth:-1,index:-1,value:r.sum,datum:null,children:o,x:s.x0+s.width/2,y:s.y0+s.height/2},{nodeSort:h,setRadius:c,padding:u,includeRoot:d}=null!==(i=this.options)&&void 0!==i?i:{};if(!1!==h){const t=n(h)?this.options.nodeKey:Zt.defaultOpionts.nodeSort;Pt([l],(e=>{e.children&&e.children.length&&e.children.sort(t)}))}if(c)Pt([l],Kt(c)),Ot([l],Yt(this._getPadding,.5,a)),Pt([l],Xt(1,this._maxDepth));else{const t=Math.min(s.width,s.height);Pt([l],Kt(Zt.defaultOpionts.setRadius)),Ot([l],Yt(X,1,a)),u&&Ot([l],Yt(this._getPadding,l.radius/t,a)),Pt([l],Xt(t/(2*l.radius),this._maxDepth))}return d?[l]:o}}Zt.defaultOpionts={setRadius:t=>Math.sqrt(t.value),padding:0,nodeSort:(t,e)=>e.value-t.value};const Qt=t=>{let e=0;return t.forEach(((t,i)=>{var n;s(t.value)&&((null===(n=t.children)||void 0===n?void 0:n.length)?t.value=Qt(t.children):t.value=0),e+=Math.abs(t.value)})),e};function Jt(t,e){const i=[],n=[],o={},r={},a=[];return function(t,e,i=[],n={},o){Qt(t);const r=(t,a,l)=>{t.forEach(((t,h)=>{const c=e?e(t):l?`${l[l.length-1].key}-${h}`:`${a}-${h}`,u=s(t.value)?0:$(t.value);if(n[c])n[c].value=void 0;else{const e={depth:a,datum:t,index:h,key:c,value:u,sourceLinks:[],targetLinks:[]};n[c]=e,i.push(e)}l&&o&&o.push({source:l[l.length-1].key,target:c,value:u,parents:l}),t.children&&t.children.length&&r(t.children,a+1,l?l.concat([n[c]]):[n[c]])}))};r(t,0,null)}(t,e,i,o,a),a.forEach(((t,e)=>{const i=`${t.source}-${t.target}`,s=k(t,["parents"]);if(s.parents=t.parents.map((t=>k(t,["sourceLinks","targetLinks"]))),r[i])return r[i].value+=$(t.value),void r[i].datum.push(s);const a={index:e,key:`${t.source}-${t.target}`,source:t.source,target:t.target,datum:[s],value:t.value,parents:t.parents.map((t=>t.key))};n.push(a),o[t.source].sourceLinks.push(a),o[t.target].targetLinks.push(a),r[i]=a})),{nodes:i,links:n,nodeMap:o}}function te(t){return t.depth}function ee(t,e){return e-1-t.endDepth}const ie=(t,e)=>(null==t?void 0:t.y0)-(null==e?void 0:e.y0),ne=(t,e)=>{if(s(t.value))return null;const i=(e?t.targetLinks:t.sourceLinks).reduce(((t,e)=>(s(e.value)?t.count+=1:t.sum+=e.value,t)),{sum:0,count:0});return i.count>0?(t.value-i.sum)/i.count:null},se={left:te,right:ee,justify:function(t,e){return t.sourceLinks.length?t.depth:e-1},center:function(t,e,i){return t.targetLinks.length?t.depth:t.sourceLinks.length?F(t.sourceLinks.map((t=>i[t.target].depth)))-1:0},start:te,end:ee},oe=W(0,1);class re{constructor(t){this._ascendingSourceBreadth=(t,e)=>ie(this._nodeMap[t.source],this._nodeMap[e.source])||t.index-e.index,this._ascendingTargetBreadth=(t,e)=>ie(this._nodeMap[t.target],this._nodeMap[e.target])||t.index-e.index,this.options=Object.assign({},re.defaultOptions,t);const e=this.options.nodeKey,i=n(e)?e:e?V(e):null;this._getNodeKey=i,this._logger=A.getInstance(),this._alignFunc=n(this.options.setNodeLayer)?t=>this.options.setNodeLayer(t.datum):se[this.options.nodeAlign]}layout(t,e){if(!t)return null;const i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};"vertical"===this.options.direction?this._viewBox={x0:i.y0,x1:i.y1,y0:i.x0,y1:i.x1,width:i.height,height:i.width}:this._viewBox=i;const n=this.computeNodeLinks(t),o=n.nodes;let r=n.links;if(this._nodeMap=n.nodeMap,this.computeNodeValues(o),this.computeNodeDepths(o),["right","end","justify"].includes(this.options.nodeAlign)&&this.computeNodeEndDepths(o),this._maxDepth<=0)return null;const a=this.computeNodeBreadths(o);if(this.computeLinkBreadths(o),o.forEach((t=>{t.sourceLinks=t.sourceLinks.filter((t=>!s(t.source)&&!s(t.target))),t.targetLinks=t.targetLinks.filter((t=>!s(t.source)&&!s(t.target)))})),r=r.filter((t=>!s(t.source)&&!s(t.target))),"vertical"===this.options.direction)if(this.options.inverse){const t=this._viewBox.x1;o.forEach((e=>{const{y0:i,y1:n,x0:s,x1:o}=e;e.y0=t-o,e.y1=t-s,e.x0=i,e.x1=n})),r.forEach((e=>{e.vertical=!0;const{x0:i,x1:n,y0:s,y1:o}=e;e.x0=s,e.x1=o,e.y0=t-i,e.y1=t-n}))}else o.forEach((t=>{const{y0:e,y1:i}=t;t.y0=t.x0,t.y1=t.x1,t.x0=e,t.x1=i})),r.forEach((t=>{t.vertical=!0;const e=t.x0,i=t.x1;t.x0=t.y0,t.x1=t.y1,t.y0=e,t.y1=i}));else this.options.inverse&&(o.forEach((t=>{const{x0:e,x1:n}=t;t.x0=i.x1-n,t.x1=i.x1-e})),r.forEach((t=>{t.x0=i.x1-t.x0,t.x1=i.x1-t.x1})));return r.forEach((t=>{const e=this._nodeMap[t.source],i=this._nodeMap[t.target];t.sourceRect={x0:e.x0,x1:e.x1,y0:e.y0,y1:e.y1},t.targetRect={x0:i.x0,x1:i.x1,y1:i.y1,y0:i.y0}})),{nodes:o,links:r,columns:a}}computeHierarchicNodeLinks(t){return Jt(t,this._getNodeKey)}computeSourceTargetNodeLinks(t){const e=[],i=[],n={};t.nodes&&t.nodes.forEach(((t,i)=>{const s={depth:-1,datum:t,index:i,key:this._getNodeKey?this._getNodeKey(t):i,value:t.value,sourceLinks:[],targetLinks:[]};n[s.key]=s,e.push(s)}));const o=[];return t.links.forEach(((r,a)=>{const l=!s(r.source),h=!s(r.target);if(t.nodes&&(!n[r.source]||!n[r.target]))return;t.nodes||!l||n[r.source]||(n[r.source]={value:void 0,depth:-1,index:e.length,key:r.source,datum:null,sourceLinks:[],targetLinks:[]},e.push(n[r.source])),t.nodes||!h||n[r.target]||(n[r.target]={value:void 0,depth:-1,index:e.length,key:r.target,datum:null,sourceLinks:[],targetLinks:[]},e.push(n[r.target]));const c={index:a,source:r.source,target:r.target,datum:r,value:r.value};this.options.divideNodeValueToLink&&s(r.value)&&o.push(c),i.push(c),l&&n[r.source].sourceLinks.push(c),h&&n[r.target].targetLinks.push(c)})),this.options.divideNodeValueToLink&&o.length&&o.forEach((t=>{const e=[ne(n[t.source]),ne(n[t.target],!0)].filter((t=>!s(t)));e.length&&(t.value=F(e))})),{nodeMap:n,nodes:e,links:i}}computeNodeLinks(t){let e;"links"in t?e=this.computeSourceTargetNodeLinks(t):(this._isHierarchic=!0,e=this.computeHierarchicNodeLinks(t.nodes));let i=e.nodes;const n=e.links;if(this.options.linkSortBy)for(let t=0,e=i.length;t<e;t++)i[t].sourceLinks.sort(this.options.linkSortBy),i[t].targetLinks.sort(this.options.linkSortBy);return this.options.dropIsolatedNode&&(i=i.filter((t=>t.targetLinks.length||t.sourceLinks.length))),{nodes:i,links:n,nodeMap:e.nodeMap}}computeNodeValues(t){return function(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];i.value=Math.max(s(i.value)?0:$(i.value),i.sourceLinks.reduce(((t,e)=>{var i;return t+(null!==(i=$(e.value))&&void 0!==i?i:0)}),0),i.targetLinks.reduce(((t,e)=>{var i;return t+(null!==(i=$(e.value))&&void 0!==i?i:0)}),0))}}(t)}computeNodeDepths(t){var e;const i=t.length;let s,o,r=t,a=0,l=-1;const h=n(this.options.setNodeLayer)?this.options.setNodeLayer:null;for(;r.length&&a<i;){s=[],o={};for(let t=0,i=r.length;t<i;t++){const i=r[t];if(i&&(i.depth=h&&null!==(e=h(i.datum))&&void 0!==e?e:a,h&&(l=Math.max(i.depth,l)),i.sourceLinks&&i.sourceLinks.length))for(let t=0,e=i.sourceLinks.length;t<e;t++){const e=i.sourceLinks[t];o[e.target]||(s.push(this._nodeMap[e.target]),o[e.target]=!0)}}r=s,a+=1}a>i&&this._logger.warn("Error: there is a circular link"),this._maxDepth=h?l+1:a}computeNodeEndDepths(t){const e=t.length;let i,n,s=t,o=0;for(;s.length&&o<e;){i=[],n={};for(let t=0,e=s.length;t<e;t++){const e=s[t];if(e){e.endDepth=o;for(let t=0,s=e.targetLinks.length;t<s;t++){const s=e.targetLinks[t];n[s.source]||(i.push(this._nodeMap[s.source]),n[s.source]=!0)}}}s=i,o+=1}o>e&&this._logger.warn("Error: there is a circular link")}computeNodeLayers(t){const e=this.options.nodeWidth,i=this.options.linkWidth,o=this.options.minStepWidth,r=this._viewBox.width;let a=null,l=null,c=!1;if(h(e)){const t=D(parseFloat(e.replace("%",""))/100,0,1);let i=r/(this._maxDepth-1+t);o>0&&(i=Math.max(o,i)),a=i*t,l=i*(1-t),c=!0}else if(d(e)){if(a=e,d(i))l=i;else if(s(i)){let t=(r-e)/(this._maxDepth-1);o>0&&(t=Math.max(o,t)),l=t-e}c=!0}else n(e)&&d(i)&&(l=i);const u=[];for(let e=0,i=t.length;e<i;e++){const i=t[e];i.layer=this._isHierarchic?i.depth:D(Math.floor(this._alignFunc(i,this._maxDepth,this._nodeMap)),0,this._maxDepth-1);const n=i.layer;n===this._maxDepth-1&&(i.isLastLayer=!0),c&&(i.x0=this._viewBox.x0+n*(a+l),i.x1=i.x0+a),u[n]?u[n].push(i):u[n]=[i]}if(this.options.nodeSortBy)for(let t=0,e=u.length;t<e;t++)u[t].sort(this.options.nodeSortBy);if(!c&&n(e)){let t=this._viewBox.x0;for(let s=0;s<this._maxDepth;s++){const o=u[s];let r=0,h=0;for(let s=0,c=o&&o.length;s<c;s++){const c=o[s],u=e(c);c.x0=t,c.x1=t+u,r=Math.max(a,u);const d=c.sourceLinks;for(let t=0,e=d.length;t<e;t++){const e=d[t],s=n(i)?i(e,this._viewBox):l;h=Math.max(h,s)}}t+=r+h}}return u}initializeNodeBreadths(t){var e,i,o;const r=null!==(e=this.options.minLinkHeight)&&void 0!==e?e:0;let a=null!==(i=this.options.minNodeHeight)&&void 0!==i?i:0;const l=null!==(o=this.options.maxNodeHeight)&&void 0!==o?o:1/0;let h=this.options.maxLinkHeight;(s(a)||a<r)&&(a=r),(s(h)||h>l)&&(h=l);let c=0,u=null,g=null;if(n(this.options.nodeGap))u=this.options.nodeGap,c=t.reduce(((t,e)=>{const i=e.reduce(((t,e)=>t+e.value),0),n=e.reduce(((t,e)=>t+this.options.nodeGap(e)),0);return Math.min(t,(this._viewBox.height-n)/i)}),1/0);else{const e=t.reduce(((t,e)=>Math.max(t,e.length)),0),i=this._viewBox.height/e;let n=Math.min(this.options.nodeGap,i);if(a+n>i&&(n=a>=i?i/2:(i-a)/2,a=Math.min(i-n,a)),u=()=>n,this._gapY=n,this.options.equalNodeHeight)g=this._viewBox.height/e-n;else{const e=a>0?Math.max(n,a):n;c=t.reduce(((t,i)=>{const n=i.reduce(((t,e)=>t+e.value),0);return Math.min(t,(this._viewBox.height-((i.length-1)*e+a))/n)}),1/0)}}const f="start"===this.options.gapPosition,p=!f&&"end"!==this.options.gapPosition,x=d(this.options.nodeHeight)?t=>this.options.nodeHeight:n(this.options.nodeHeight)?this.options.nodeHeight:g>0?t=>g:t=>Math.max(t.value*c,0),y=d(this.options.linkHeight)?()=>this.options.linkHeight:n(this.options.linkHeight)?this.options.linkHeight:(t,e,i)=>Math.min(Math.max(e.value?i*oe(t.value/e.value):0,r,0),h);for(let e=0,i=t.length;e<i;e++){const i=t[e];if(!i||!i.length)continue;let n=this._viewBox.y0,s=0,o=0,r=0;for(let t=0,e=i.length;t<e;t++){const e=i[t];s=u(e),f&&(n+=s),r=x(e),o=Math.min(Math.max(r,a),l),e.y0=n,e.y1=n+o,n=f?e.y1:e.y1+s;for(let t=0,i=e.sourceLinks.length;t<i;t++){const i=e.sourceLinks[t];i.thickness=y(i,e,r)}}let h=this._viewBox.y1-n+(p?s:0);if(h>0)if("start"===this.options.crossNodeAlign);else if("end"===this.options.crossNodeAlign)for(let t=0,e=i.length;t<e;++t){const e=i[t];e.y0+=h,e.y1+=h}else if("parent"===this.options.crossNodeAlign){const n=i.reduce(((t,e)=>(e.targetLinks&&e.targetLinks.length&&e.targetLinks.forEach((e=>{t[e.source]=!0})),t)),{});if(Object.keys(n).length&&t[e-1]&&t[e-1].length){const s=t[e-1].filter((t=>n[t.key]));if(s&&s.length&&s[0].y0!==i[0].y0){const t=s[0].y0-i[0].y0;for(let e=0,n=i.length;e<n;++e){const n=i[e];n.y0+=t,n.y1+=t}}}}else{h/=i.length+1;for(let t=0,e=i.length;t<e;++t){const e=i[t];e.y0+=h*(t+1),e.y1+=h*(t+1)}}else if(h<0&&i.length>1&&(h/=i.length-1,s+h>=0)){s+=h,this._gapY=Math.min(s);for(let t=1,e=i.length;t<e;++t){const e=i[t];e.y0+=h*t,e.y1+=h*t}}this.reorderLinks(i)}}computeNodeBreadths(t){const e=this.computeNodeLayers(t);this.initializeNodeBreadths(e);const i=this.options.iterations;if(!this._isHierarchic&&!n(this.options.setNodeLayer)&&!n(this.options.nodeGap))for(let t=0;t<i;++t){const n=Math.pow(.99,t),s=Math.max(1-n,(t+1)/i);this.relaxRightToLeft(e,n,s),this.relaxLeftToRight(e,n,s)}return e}relaxLeftToRight(t,e,i){for(let n=1,o=t.length;n<o;++n){const o=t[n];for(let t=0,i=o.length;t<i;t++){const i=o[t];let n=0,s=0;for(let t=0,e=i.targetLinks.length;t<e;t++){const e=i.targetLinks[t],o=e.value*(i.layer-this._nodeMap[e.source].layer);n+=this.targetTop(this._nodeMap[e.source],i)*o,s+=o}if(!(s>0))continue;const r=(n/s-i.y0)*e;i.y0+=r,i.y1+=r,this.reorderNodeLinks(i)}s(this.options.nodeSortBy)&&o.sort(ie),this.resolveCollisions(o,i)}}relaxRightToLeft(t,e,i){for(let n=t.length-2;n>=0;--n){const s=t[n];for(let t=0,i=s.length;t<i;t++){const i=s[t];let n=0,o=0;for(let t=0,e=i.sourceLinks.length;t<e;t++){const e=i.sourceLinks[t],s=e.value*(this._nodeMap[e.target].layer-i.layer);n+=this.sourceTop(i,this._nodeMap[e.target])*s,o+=s}if(!(o>0))continue;const r=(n/o-i.y0)*e;i.y0+=r,i.y1+=r,this.reorderNodeLinks(i)}void 0===this.options.nodeSortBy&&s.sort(ie),this.resolveCollisions(s,i)}}resolveCollisions(t,e){const i=t.length>>1,n=t[i];this.resolveCollisionsBottomToTop(t,n.y0-this._gapY,i-1,e),this.resolveCollisionsTopToBottom(t,n.y1+this._gapY,i+1,e),this.resolveCollisionsBottomToTop(t,this._viewBox.y1,t.length-1,e),this.resolveCollisionsTopToBottom(t,this._viewBox.y0,0,e)}resolveCollisionsTopToBottom(t,e,i,n){for(;i<t.length;++i){const s=t[i],o=(e-s.y0)*n;o>1e-6&&(s.y0+=o,s.y1+=o),e=s.y1+this._gapY}}resolveCollisionsBottomToTop(t,e,i,n){for(;i>=0;--i){const s=t[i],o=(s.y1-e)*n;o>1e-6&&(s.y0-=o,s.y1-=o),e=s.y0-this._gapY}}targetTop(t,e){let i,n,s,o=t.y0-(t.sourceLinks.length-1)*this._gapY/2;for(i=0,n=t.sourceLinks.length;i<n&&(s=t.sourceLinks[i],s.target!==e.key);i++)o+=s.thickness+this._gapY;for(i=0,n=e.targetLinks.length;i<n&&(s=e.targetLinks[i],s.source!==t.key);i++)o-=s.thickness;return o}sourceTop(t,e){let i,n,s,o=e.y0-(e.targetLinks.length-1)*this._gapY/2;for(i=0,n=e.targetLinks.length;i<n&&(s=e.targetLinks[i],s.source!==t.key);i++)o+=s.thickness+this._gapY;for(i=0,n=t.sourceLinks.length;i<n&&(s=t.sourceLinks[i],s.target!==e.key);i++)o-=s.thickness;return o}computeLinkBreadthsNoOverlap(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];let n=i.y0,s=!1;for(let t=0,e=i.sourceLinks.length;t<e;t++){const e=i.sourceLinks[t];s||(e.y0=n+e.thickness/2),e.x0=i.x1,n+e.thickness>i.y1||s?(e.y0=i.y1-e.thickness/2,s=!0):n+=e.thickness}let o=i.y0;s=!1;for(let t=0,e=i.targetLinks.length;t<e;t++){const e=i.targetLinks[t];s||(e.y1=o+e.thickness/2),e.x1=i.x0,o+e.thickness>i.y1||s?(e.y1=i.y1-e.thickness/2,s=!0):o+=e.thickness}}}computeLinkBreadthsOverlap(t){const e=this.options.linkOverlap;for(let i=0,n=t.length;i<n;i++){const n=t[i],s="start"===e?n.y0:"end"===e?n.y1:(n.y0+n.y1)/2,o="start"===e?.5:"end"===e?-.5:0;for(let t=0,e=n.sourceLinks.length;t<e;t++){const e=n.sourceLinks[t];e.y0=s+o*e.thickness,e.x0=n.x1}for(let t=0,e=n.targetLinks.length;t<e;t++){const e=n.targetLinks[t];e.y1=s+o*e.thickness,e.x1=n.x0}}}computeLinkBreadths(t){this.options.linkOverlap?this.computeLinkBreadthsOverlap(t):this.computeLinkBreadthsNoOverlap(t)}reorderNodeLinks(t){if(s(this.options.linkSortBy)){const e=t.targetLinks,i=t.sourceLinks;for(let t=0,i=e.length;t<i;t++){const i=e[t];this._nodeMap[i.source].sourceLinks.sort(this._ascendingTargetBreadth)}for(let t=0,e=i.length;t<e;t++){const e=i[t];this._nodeMap[e.target].targetLinks.sort(this._ascendingSourceBreadth)}}}reorderLinks(t){if(s(this.options.linkSortBy))for(let e=0,i=t.length;e<i;e++){const i=t[e];i.sourceLinks.sort(this._ascendingTargetBreadth),i.targetLinks.sort(this._ascendingSourceBreadth)}}}re.defaultOptions={iterations:6,nodeAlign:"justify",direction:"horizontal",nodeWidth:24,nodeGap:8,crossNodeAlign:"middle",dropIsolatedNode:!0};const ae=t=>t.sourceLinks&&t.sourceLinks.length?!s(t.sourceLinks[0].x0):!(!t.targetLinks||!t.targetLinks.length)&&!s(t.targetLinks[0].x0),le=(t,e)=>{const i=new re(t).layout(Array.isArray(e)?e[0]:e,"width"in t?{width:t.width,height:t.height}:{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1});return i?[i]:[]};function he(t,e,i,n,s,o={x0:"x0",x1:"x1",y0:"y0",y1:"y1"}){const r=t.children;let a,l=-1;const h=r.length,c=t.value&&(n-e)/t.value;for(;++l<h;)a=r[l],a[o.y0]=i,a[o.y1]=s,a[o.x0]=e,a[o.x1]=e+=a.value*c}const ce={x0:"startAngle",x1:"endAngle",y0:"innerRadius",y1:"outerRadius"};class ue{constructor(t){this._layoutNode=t=>{if(t.maxDepth=this._maxDepth,t.children){const e=this._parsedInnerRadius[t.depth+1],n=this._parsedOutterRadius[t.depth+1];he(t,t.startAngle,Math.min(e,n),t.endAngle,Math.max(e,n),ce);const s=c(this.options.label)?this.options.label[t.depth+1]:this.options.label;t.children.forEach((t=>{if(t.x=this._parsedCenter[0],t.y=this._parsedCenter[1],s)return this._layoutLabel(t,i(s)?{align:"center",rotate:"radial"}:s)}))}},this.options=t?Object.assign({},ue.defaultOpionts,t):Object.assign({},ue.defaultOpionts);const e=this.options.nodeKey,s=n(e)?e:e?V(e):null;this._getNodeKey=s,this._maxDepth=-1}_parseRadius(t,e){const i=t.x0+Y(this.options.center[0],t.width),n=t.y0+Y(this.options.center[1],t.height),o=Math.min(t.width/2,t.height/2),r=this.options.innerRadius,a=this.options.outerRadius,l=c(r),h=l?r.map((t=>Y(t,o))):Y(r,o),u=c(a),d=this.options.gapRadius,g=u?a.map((t=>Y(t,o))):Y(a,o),f=R(0,e+1);if(l)this._parsedInnerRadius=f.map(((t,e)=>{const i=h[e];return s(i)?o:i})),this._parsedOutterRadius=f.map(((t,i)=>{var n,s;return u?null!==(n=g[i])&&void 0!==n?n:o:i<e?this._parsedInnerRadius[i+1]-(c(d)?null!==(s=d[i])&&void 0!==s?s:0:d):g}));else if(u)this._parsedOutterRadius=f.map(((t,e)=>s(g[e])?o:g[e])),this._parsedInnerRadius=f.map(((t,e)=>{var i;return 0===e?h:this._parsedOutterRadius[e-1]-(c(d)?null!==(i=d[e])&&void 0!==i?i:0:d)}));else{const t=Y(r,o),i=(g-t)/(e+1);this._parsedInnerRadius=f.map(((e,n)=>t+n*i)),this._parsedOutterRadius=f.map(((t,e)=>{var n;return this._parsedInnerRadius[e]+i-(c(d)?null!==(n=d[e])&&void 0!==n?n:0:d)}))}this._parsedCenter=[i,n],this._maxRadius=o}layout(t,e){const i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];const n=[],s=Ct(t,n,0,-1,null,this._getNodeKey);return this._parseRadius(i,s.maxDepth),this._maxDepth=s.maxDepth,this._layout(n,{flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:s.sum,datum:null,children:n,startAngle:this.options.startAngle,endAngle:this.options.endAngle}),n}_layout(t,e){this._layoutNode(e),t.forEach((t=>{var e;(null===(e=null==t?void 0:t.children)||void 0===e?void 0:e.length)?this._layout(t.children,t):this._layoutNode(t)}))}_layoutLabel(t,e){var i;const n=(t.startAngle+t.endAngle)/2,s=("start"===e.align?t.innerRadius:"end"===e.align?t.outerRadius:(t.innerRadius+t.outerRadius)/2)+(null!==(i=e.offset)&&void 0!==i?i:0),o=st({x:this._parsedCenter[0],y:this._parsedCenter[1]},s,n);if(t.label={x:o.x,y:o.y,textBaseline:"middle"},"tangential"===e.rotate)t.label.angle=n-Math.PI/2,t.label.textAlign="center",t.label.maxLineWidth=Math.abs(t.endAngle-t.startAngle)*s;else{const i=n%(2*Math.PI),s=i<0?i+2*Math.PI:i;s>Math.PI/2&&s<1.5*Math.PI?(t.label.angle=s+Math.PI,t.label.textAlign="start"===e.align?"end":"end"===e.align?"start":"center"):(t.label.angle=s,t.label.textAlign=e.align),t.label.maxLineWidth=t.isLeaf?void 0:Math.abs(t.outerRadius-t.innerRadius)}}}ue.defaultOpionts={startAngle:Math.PI/2,endAngle:-3*Math.PI/2,center:["50%","50%"],gapRadius:0,innerRadius:0,outerRadius:"70%"};const de=(t,e=[],i)=>{const n=(null==i?void 0:i.maxDepth)>=0;return t.forEach((t=>{(!n||t.depth<=i.maxDepth-1)&&t.children&&t.children.forEach((n=>{var s;const o={source:t,target:n,x0:t.x,y0:t.y,x1:n.x,y1:n.y,key:`${t.key}~${n.key}`};e.push((null==i?void 0:i.callback)?i.callback(o):o),(null===(s=n.children)||void 0===s?void 0:s.length)&&de([n],e,i)}))})),e};function ge(t,e){return t.parentKey===e.parentKey?1:2}function fe(t,e,i,n,s=ge){let o,r=0;if(Ot([t],(t=>{const e=t.children;e?(t.x=function(t){return t.reduce(((t,e)=>t+e.x),0)/t.length}(e),t.y=function(t){return 1+t.reduce(((t,e)=>Math.max(t,e.y)),0)}(e)):(t.x=o?r+=s(t,o):0,t.y=0,o=t)})),d(i)&&d(n))Ot([t],(s=>{s.x=e.x0+(s.x-t.x)*i,s.y=e.y0+(t.y-s.y)*n}));else{const n=function(t){let e=t.children;for(;e;)e=(t=e[0]).children;return t}(t),o=function(t){let e=t.children;for(;e;)e=(t=e[e.length-1]).children;return t}(t),r=n.x-s(n,o)/2,a=o.x+s(o,n)/2,l=d(i)?i:e.width/(a-r);Ot([t],(i=>{i.x=e.x0+(i.x-r)*l,i.y=e.y0+(1-(t.y?i.y/t.y:1))*e.height}))}return t}function pe(t,e){return t.parentKey===e.parentKey?1:2}function xe(t){const e=t.children;return e?e[0]:t.t}function ye(t){const e=t.children;return e?e[e.length-1]:t.t}function me(t,e,i){const n=i/(e.i-t.i);e.c-=n,e.s+=i,t.c+=n,e.z+=i,e.m+=i}function ve(t,e,i){var n;const s=null!==(n=t.a)&&void 0!==n?n:t;return s.parent===e.parent?s:i}function Me(t,e){return{_:t,i:e,parent:null,A:null,a:null,z:0,m:0,c:0,s:0,t:null}}function _e(t,e,i,n,s=pe){const o=(t,e,i)=>{if(e){let n,o=t,r=t,a=e,l=o.parent.children[0],h=o.m,c=r.m,u=a.m,d=l.m;for(a=ye(a),o=xe(o);a&&o;)l=xe(l),r=ye(r),r.a=t,n=a.z+u-o.z-h+s(a._,o._),n>0&&(me(ve(a,t,i),t,n),h+=n,c+=n),u+=a.m,h+=o.m,d+=l.m,c+=r.m,a=ye(a),o=xe(o);a&&!ye(r)&&(r.t=a,r.m+=u-c),o&&!xe(l)&&(l.t=o,l.m+=h-d,i=t)}return i},r=function(t){const e=Me(t,0),i=[e];let n,s,o,r,a=i.pop();for(;a;){if(s=a._.children,s)for(r=s.length,a.children=new Array(r),o=r-1;o>=0;--o)n=Me(s[o],o),a.children[o]=n,i.push(n),n.parent=a;a=i.pop()}return e.parent=Me(null,0),e.parent.children=[e],e}(t);let a;if(Ot([r],(t=>{const e=t.children,i=t.parent.children,n=t.i?i[t.i-1]:null;if(e){!function(t){let e=0,i=0;const n=t.children;let s,o=n.length;for(;--o>=0;)s=n[o],s.z+=e,s.m+=e,e+=s.s+(i+=s.c)}(t);const i=(e[0].z+e[e.length-1].z)/2;n?(t.z=n.z+s(t._,n._),t.m=t.z-i):t.z=i}else n&&(t.z=n.z+s(t._,n._));t.parent.A=o(t,n,t.parent.A||i[0])})),r.parent.m=-r.z,Pt([r],(t=>{t._.x=t.z+t.parent.m,t.m+=t.parent.m})),d(n))a=t=>t.depth*n;else if(c(n)&&n.length){const t=n.reduce(((t,e,i)=>(t[i]=0===i?e:t[i-1]+e,t)),[]);a=e=>{var i;return null!==(i=t[e.depth])&&void 0!==i?i:t[t.length-1]}}if(d(i)&&a){Pt([t],(t=>{t.x=e.x0+e.width/2+t.x*i,t.y=e.y0+a(t)}))}else{let n=t,o=t,r=t;Pt([t],(t=>{t.x<n.x&&(n=t),t.x>o.x&&(o=t),t.depth>r.depth&&(r=t)}));const l=n===o?1:s(n,o)/2,h=l-n.x,c=d(i)?i:e.width/(o.x+l+h),u=e.height/(r.depth||1);Pt([t],(t=>{t.x=e.x0+(t.x+h)*c,t.y=e.y0+(a?a(t):t.depth*u)}))}return t}class we{constructor(t){this.options=Object.assign({},we.defaultOpionts,t);const e=null==t?void 0:t.nodeKey,i=n(e)?e:e?V(e):null;this._getNodeKey=i,this._maxDepth=-1}layout(t,e){const i=z(t);if(!i.length)return[];const n="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)},s=[],o=Ct(i,s,0,-1,null,this._getNodeKey);this._maxDepth=o.maxDepth;const r=["vertical","TB","BT"].includes(this.options.direction),a="radial"===this.options.layoutType?{x0:0,y0:0,x1:2*Math.PI,y1:Math.min(n.width,n.height)/2,width:2*Math.PI,height:Math.min(n.width,n.height)/2}:r?n:{x0:n.y0,y0:n.x0,x1:n.y1,y1:n.x1,width:n.height,height:n.width};if("leaf"===this.options.alignType?fe(s[0],a,this.options.minNodeGap,this.options.linkWidth):_e(s[0],a,this.options.minNodeGap,this.options.linkWidth),"radial"===this.options.layoutType){const t={x:(n.x0+n.x1)/2,y:(n.y0+n.y1)/2};Pt(s,(e=>{const i=e.x,n=e.y,s=st(t,n,i);e.x=s.x,e.y=s.y,e.maxDepth=this._maxDepth}))}else["BT","RL"].includes(this.options.direction)?Pt(s,(t=>{t.y=a.y0+a.y1-t.y,t.maxDepth=this._maxDepth})):Pt(s,(t=>{t.maxDepth=this._maxDepth})),r||Pt(s,(t=>{[t.x,t.y]=[t.y,t.x]}));return s}}we.defaultOpionts={direction:"horizontal",alignType:"depth",layoutType:"orthogonal"};function be(t,e,i,n,s){const o=t.children;let r,a=-1;const l=o.length,h=t.value&&(s-i)/t.value;for(;++a<l;)r=o[a],r.x0=e,r.x1=n,r.y0=i,i+=r.value*h,r.y1=i}const Se=t=>(e,i,n,s,o)=>{!function(t,e,i,n,s,o){const r=[],a=e.children;let l,h,c=0,u=0;const d=a.length;let g,f,p,x,y,m,v,M,_,w=e.value;for(;c<d;){g=s-i,f=o-n;do{p=a[u++].value}while(!p&&u<d);for(x=p,y=p,M=Math.max(f/g,g/f)/(w*t),_=p*p*M,v=Math.max(y/_,_/x);u<d;++u){if(h=a[u].value,p+=h,h<x&&(x=h),h>y&&(y=h),_=p*p*M,m=Math.max(y/_,_/x),m>v){p-=h;break}v=m}l=Object.assign({},e,{value:p,children:a.slice(c,u)}),r.push(l),g<f?he(l,i,n,s,w?n+=f*p/w:o):be(l,i,n,w?i+=g*p/w:s,o),w-=p,c=u}}(t,e,i,n,s,o)},ke={binary:function(t,e,i,n,s){const o=t.children,r=o.length;let a=0;const l=new Array(r+1);l[0]=0;for(let t=0;t<r;++t)a+=o[t].value,l[t+1]=a;const h=(t,e,i,n,s,r,a)=>{if(t>=e-1){const e=o[t];return e.x0=n,e.y0=s,e.x1=r,void(e.y1=a)}const c=l[t],u=i/2+c;let d=t+1,g=e-1;for(;d<g;){const t=d+g>>>1;l[t]<u?d=t+1:g=t}u-l[d-1]<l[d]-u&&t+1<d&&--d;const f=l[d]-c,p=i-f;if(r-n>a-s){const o=i?(n*p+r*f)/i:r;h(t,d,f,n,s,o,a),h(d,e,p,o,s,r,a)}else{const o=i?(s*p+a*f)/i:a;h(t,d,f,n,s,r,o),h(d,e,p,n,o,r,a)}};h(0,r,t.value,e,i,n,s)},dice:he,slice:be,sliceDice:function(t,e,i,n,s){(t.depth%2==1?be:he)(t,e,i,n,s)}};class ze{constructor(t){var e;this._filterByArea=(t,e)=>{var i;const n=this._getMinAreaByDepth(t.depth);if(n>0&&t.value*e<n)return!1;if(null===(i=t.children)||void 0===i?void 0:i.length){const i=t.children.filter((t=>this._filterByArea(t,e)));i.length?i.length!==t.children.length&&(t.children=i):(t.isLeaf=!0,t.children=null)}return!0},this._getMinAreaByDepth=t=>{var e;return t<0?0:null!==(e=c(this.options.minVisibleArea)?this.options.minVisibleArea[t]:this.options.minVisibleArea)&&void 0!==e?e:0},this._getGapWidthByDepth=t=>{var e;return t<0?0:null!==(e=c(this.options.gapWidth)?this.options.gapWidth[t]:this.options.gapWidth)&&void 0!==e?e:0},this._getPaddingByDepth=t=>{var e;return t<0?0:null!==(e=c(this.options.padding)?this.options.padding[t]:this.options.padding)&&void 0!==e?e:0},this._getLabelPaddingByDepth=t=>{var e;return t<0?0:null!==(e=c(this.options.labelPadding)?this.options.labelPadding[t]:this.options.labelPadding)&&void 0!==e?e:0},this._layoutNode=t=>{const e=this._getGapWidthByDepth(t.depth);let i=t.x0,n=t.y0,s=t.x1,o=t.y1;if(t.maxDepth=this._maxDepth,e>0&&(i+=e/2,s-=e/2,n+=e/2,o-=e/2,i>s&&(i=(i+s)/2,s=i),n>o&&(n=(n+o)/2,o=n),t.x0=i,t.x1=s,t.y0=n,t.y1=o),t.children){const e=this._getLabelPaddingByDepth(t.depth),r=this._getPaddingByDepth(t.depth);r>0&&r<Math.min(s-i,o-n)/2&&(n+=r,o-=r,i+=r,s-=r),e>0&&("top"===this.options.labelPosition&&n+e<o?(t.labelRect={x0:i,y0:n,x1:s,y1:n+e},n+=e):"bottom"===this.options.labelPosition&&o-e>n?(t.labelRect={x0:i,y0:o-e,x1:s,y1:o},o-=e):"left"===this.options.labelPosition&&i+e<s?(t.labelRect={x0:i,y0:n,x1:i+e,y1:o},i+=e):"right"===this.options.labelPosition&&s-e>i&&(t.labelRect={x0:s-e,y0:n,x1:s,y1:o},s-=e));const a=this._getGapWidthByDepth(t.depth+1);a>0&&(i-=a/2,s+=a/2,n-=a/2,o+=a/2),this._splitNode(t,i,n,s,o)}},this.options=Object.assign({},ze.defaultOpionts,t);const i=this.options.nodeKey,s=n(i)?i:i?V(i):null;this._getNodeKey=s,this._splitNode="squarify"===this.options.splitType?Se(this.options.aspectRatio):null!==(e=ke[this.options.splitType])&&void 0!==e?e:ke.binary,this._maxDepth=-1}layout(t,e){var i;if(!t||!t.length)return[];const n="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)},s=[],o=Ct(t,s,0,-1,null,this._getNodeKey,this.options.valueField);if(this._maxDepth=o.maxDepth,o.sum<=0)return[];const r={flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:o.sum,datum:null,x0:n.x0,x1:n.x1,y0:n.y0,y1:n.y1,children:s},a=n.width*n.height/o.sum;return this._filterByArea(r,a),this._layout(r),null!==(i=r.children)&&void 0!==i?i:[]}_filterChildren(t){const e=this.options.maxDepth;if(d(e)&&e>=0&&t.depth>=e)return!1;const i=this.options.minChildrenVisibleArea;if(d(i)&&Math.abs((t.x1-t.x0)*(t.y1-t.y0))<i)return!1;const n=this.options.minChildrenVisibleSize;return!d(n)||!(Math.abs(t.x1-t.x0)<n||Math.abs(t.y1-t.y0)<n)}_layout(t){var e;this._filterChildren(t)||(t.children=null,t.isLeaf=!0),this._layoutNode(t),(null===(e=t.children)||void 0===e?void 0:e.length)&&t.children.forEach((t=>{var e;(null===(e=null==t?void 0:t.children)||void 0===e?void 0:e.length)?this._layout(t):this._layoutNode(t)}))}}ze.defaultOpionts={aspectRatio:(1+Math.sqrt(5))/2,gapWidth:0,labelPadding:0,labelPosition:"top",splitType:"binary",minVisibleArea:10};function Fe(t,e,i){return Math.min(t,e)*Math.min(t,e)*Math.PI<=i+mt?Math.abs(t-e):function(t,e,i,n){var s,o;const r=null!==(s=null==n?void 0:n.maxIterations)&&void 0!==s?s:100,a=null!==(o=null==n?void 0:n.tolerance)&&void 0!==o?o:1e-10,l=t(e),h=t(i);let c=i-e;if(l*h>0)return A.getInstance().error("Initial bisect points must have opposite signs"),NaN;if(0===l)return e;if(0===h)return i;for(let i=0;i<r;++i){c/=2;const i=e+c,n=t(i);if(n*l>=0&&(e=i),Math.abs(c)<a||0===n)return i}return e+c}((function(n){return _t(t,e,n)-i}),0,t+e)}function Te(t,e){const i=(e=e||{}).restarts||10,n=[],s={};let o;for(o=0;o<t.length;++o){const e=t[o];1===e.sets.length&&(s[e.sets[0]]=n.length,n.push(e))}const r=function(t,e,i){const n=kt(e.length,e.length),s=kt(e.length,e.length);return t.filter((function(t){return 2===t.sets.length})).map((t=>{const o=i[t.sets[0]],r=i[t.sets[1]],a=Fe(Math.sqrt(e[o].size/Math.PI),Math.sqrt(e[r].size/Math.PI),t.size);n[o][r]=n[r][o]=a;let l=0;t.size+1e-10>=Math.min(e[o].size,e[r].size)?l=1:t.size<=1e-10&&(l=-1),s[o][r]=s[r][o]=l})),{distances:n,constraints:s}}(t,n,s);let a=r.distances;const l=r.constraints,h=zt(a.map(zt))/a.length;a=a.map((t=>t.map((t=>t/h))));const c=function(t,e){return function(t,e,i,n){let s,o=0;for(s=0;s<e.length;++s)e[s]=0;for(s=0;s<i.length;++s){const r=t[2*s],a=t[2*s+1];for(let l=s+1;l<i.length;++l){const h=t[2*l],c=t[2*l+1],u=i[s][l],d=n[s][l],g=(h-r)*(h-r)+(c-a)*(c-a),f=Math.sqrt(g),p=g-u*u;d>0&&f<=u||d<0&&f>=u||(o+=2*p*p,e[2*s]+=4*p*(r-h),e[2*s+1]+=4*p*(a-c),e[2*l]+=4*p*(h-r),e[2*l+1]+=4*p*(c-a))}}return o}(t,e,a,l)};let u,d;for(o=0;o<i;++o){const t=St(2*a.length).map(((t,e)=>q(e)));d=It(c,t,e),(!u||d.fx<u.fx)&&(u=d)}const g=u.x,f={};for(o=0;o<n.length;++o){const t=n[o];f[t.sets[0]]={x:g[2*o]*h,y:g[2*o+1]*h,radius:Math.sqrt(t.size/Math.PI)}}if(e.history)for(o=0;o<e.history.length;++o)Ft(e.history[o].x,h);return f}function Re(t,e){let i=0;for(let n=0;n<e.length;++n){const s=e[n];let o;if(1===s.sets.length)continue;if(2===s.sets.length){const e=t[s.sets[0]],i=t[s.sets[1]];o=_t(e.radius,i.radius,it.distancePP(e,i))}else o=vt(s.sets.map((function(e){return t[e]})));i+=(s.hasOwnProperty("weight")?s.weight:1)*(o-s.size)*(o-s.size)}return i}function Le(t,e){let i=function(t,e){const i=e&&e.lossFunction?e.lossFunction:Re,n={},s={};for(let e=0;e<t.length;++e){const i=t[e];if(1===i.sets.length){const t=i.sets[0];n[t]={x:1e10,y:1e10,size:i.size,radius:Math.sqrt(i.size/Math.PI),setId:t},s[t]=[]}}t=t.filter((function(t){return 2===t.sets.length}));for(let e=0;e<t.length;++e){const i=t[e];let o=i.hasOwnProperty("weight")?i.weight:1;const r=i.sets[0],a=i.sets[1];i.size+mt>=Math.min(n[r].size,n[a].size)&&(o=0),s[r].push({set:a,size:i.size,weight:o}),s[a].push({set:r,size:i.size,weight:o})}const o=[];for(const t in s)if(s.hasOwnProperty(t)){let e=0;for(let i=0;i<s[t].length;++i)e+=s[t][i].size*s[t][i].weight;o.push({set:t,size:e})}function r(t,e){return e.size-t.size}o.sort(r);const a={};function l(t){return t.set in a}function h(t,e){n[e].x=t.x,n[e].y=t.y,a[e]=!0}h({x:0,y:0},o[0].set);for(let e=1;e<o.length;++e){const a=o[e].set,c=s[a].filter(l),u=n[a];if(c.sort(r),0===c.length)throw"ERROR: missing pairwise overlap information";const d=[];for(let t=0;t<c.length;++t){const e=n[c[t].set],i=Fe(u.radius,e.radius,c[t].size);d.push({x:e.x+i,y:e.y}),d.push({x:e.x-i,y:e.y}),d.push({y:e.y+i,x:e.x}),d.push({y:e.y-i,x:e.x});for(let s=t+1;s<c.length;++s){const t=n[c[s].set],o=Fe(u.radius,t.radius,c[s].size),r=wt({x:e.x,y:e.y,radius:i},{x:t.x,y:t.y,radius:o});for(let t=0;t<r.length;++t)d.push(r[t])}}let g=1e50,f=d[0];for(let e=0;e<d.length;++e){n[a].x=d[e].x,n[a].y=d[e].y;const s=i(n,t);s<g&&(g=s,f=d[e])}h(f,a)}return n}(t,e);const n=e.lossFunction||Re;if(t.length>=8){const s=Te(t,e);n(s,t)+1e-8<n(i,t)&&(i=s)}return i}function Ie(t,e,i){let n;if(null===i?t.sort((function(t,e){return e.radius-t.radius})):t.sort(i),t.length>0){const e=t[0].x,i=t[0].y;for(n=0;n<t.length;++n)t[n].x-=e,t[n].y-=i}if(2===t.length){it.distancePP(t[0],t[1])<Math.abs(t[1].radius-t[0].radius)&&(t[1].x=t[0].x+t[0].radius-t[1].radius-1e-10,t[1].y=t[0].y)}if(t.length>1){const i=Math.atan2(t[1].x,t[1].y)-e,s=Math.cos(i),o=Math.sin(i);let r,a;for(n=0;n<t.length;++n)r=t[n].x,a=t[n].y,t[n].x=s*r-o*a,t[n].y=o*r+s*a}if(t.length>2){let i=Math.atan2(t[2].x,t[2].y)-e;for(;i<0;)i+=2*Math.PI;for(;i>2*Math.PI;)i-=2*Math.PI;if(i>Math.PI){const e=t[1].y/(1e-10+t[1].x);for(n=0;n<t.length;++n){const i=(t[n].x+e*t[n].y)/(1+e*e);t[n].x=2*i-t[n].x,t[n].y=2*i*e-t[n].y}}}}function Ce(t){const e=function(e){const i=Math.max.apply(null,t.map((function(t){return t[e]+t.radius}))),n=Math.min.apply(null,t.map((function(t){return t[e]-t.radius})));return{max:i,min:n}};return{xRange:e("x"),yRange:e("y")}}function Pe(t,e,i){null===e&&(e=Math.PI/2);let n=[];for(const e in t)if(t.hasOwnProperty(e)){const i=t[e];n.push({x:i.x,y:i.y,radius:i.radius,setId:e})}const s=function(t){function e(t){return t.parent!==t&&(t.parent=e(t.parent)),t.parent}function i(t,i){const n=e(t),s=e(i);n.parent=s}t.map((function(t){t.parent=t}));for(let e=0;e<t.length;++e)for(let n=e+1;n<t.length;++n){const s=t[e].radius+t[n].radius;it.distancePP(t[e],t[n])+1e-10<s&&i(t[n],t[e])}const n={};let s;for(let i=0;i<t.length;++i)s=e(t[i]).parent.setId,s in n||(n[s]=[]),n[s].push(t[i]);t.map((function(t){delete t.parent}));const o=[];for(s in n)n.hasOwnProperty(s)&&o.push(n[s]);return o}(n);for(let t=0;t<s.length;++t){Ie(s[t],e,i);const n=Ce(s[t]);s[t].size=(n.xRange.max-n.xRange.min)*(n.yRange.max-n.yRange.min),s[t].bounds=n}s.sort((function(t,e){return e.size-t.size})),n=s[0];let o=n.bounds;const r=(o.xRange.max-o.xRange.min)/50;function a(t,e,i){if(!t)return;const s=t.bounds;let a,l,h;e?a=o.xRange.max-s.xRange.min+r:(a=o.xRange.max-s.xRange.max,h=(s.xRange.max-s.xRange.min)/2-(o.xRange.max-o.xRange.min)/2,h<0&&(a+=h)),i?l=o.yRange.max-s.yRange.min+r:(l=o.yRange.max-s.yRange.max,h=(s.yRange.max-s.yRange.min)/2-(o.yRange.max-o.yRange.min)/2,h<0&&(l+=h));for(let e=0;e<t.length;++e)t[e].x+=a,t[e].y+=l,n.push(t[e])}let l=1;for(;l<s.length;)a(s[l],!0,!1),a(s[l+1],!1,!0),a(s[l+2],!0,!0),l+=3,o=Ce(n);const h={};for(let t=0;t<n.length;++t)h[n[t].setId]=n[t];return h}function Oe(t,e){const i={},n=function(t){const e={},i=[];for(const n in t)i.push(n),e[n]=[];for(let n=0;n<i.length;n++){const s=t[i[n]];for(let o=n+1;o<i.length;++o){const r=t[i[o]],a=it.distancePP(s,r);a+r.radius<=s.radius+1e-10?e[i[o]].push(i[n]):a+s.radius<=r.radius+1e-10&&e[i[n]].push(i[o])}}return e}(t);for(let s=0;s<e.length;++s){const o=e[s].sets,r={},a={};for(let t=0;t<o.length;++t){r[o[t]]=!0;const e=n[o[t]];for(let t=0;t<e.length;++t)a[e[t]]=!0}const l=[],h=[];for(const e in t)e in r?l.push(t[e]):e in a||h.push(t[e]);const c=Ae(l,h);if(i[o.toString()]=c,c.disjoint&&e[s].size>0){A.getInstance().error("Area "+o+" not represented on screen")}}return i}function Ae(t,e){const i=[];for(let e=0;e<t.length;++e){const n=t[e];i.push({x:n.x,y:n.y}),i.push({x:n.x+n.radius/2,y:n.y}),i.push({x:n.x-n.radius/2,y:n.y}),i.push({x:n.x,y:n.y+n.radius/2}),i.push({x:n.x,y:n.y-n.radius/2})}let n=i[0],s=Ee(i[0],t,e);for(let o=1;o<i.length;++o){const r=Ee(i[o],t,e);r>=s&&(n=i[o],s=r)}const o=Rt((function(i){return-1*Ee({x:i[0],y:i[1]},t,e)}),[n.x,n.y],{maxIterations:500,minErrorDelta:1e-10}).x;let r={x:o[0],y:o[1]},a=!0;for(let e=0;e<t.length;++e)if(it.distancePP(r,t[e])>t[e].radius){a=!1;break}for(let t=0;t<e.length;++t)if(it.distancePP(r,e[t])<e[t].radius){a=!1;break}if(!a)if(1===t.length)r={x:t[0].x,y:t[0].y};else{const i={};vt(t,i),r=0===i.arcs.length?{x:0,y:-1e3,disjoint:!0}:1===i.arcs.length?{x:i.arcs[0].circle.x,y:i.arcs[0].circle.y}:e.length?Ae(t,[]):bt(i.arcs.map((function(t){return t.p1})))}return r}function Ee(t,e,i){let n,s,o=e[0].radius-it.distancePP(e[0],t);for(n=1;n<e.length;++n)s=e[n].radius-it.distancePP(e[n],t),s<=o&&(o=s);for(n=0;n<i.length;++n)s=it.distancePP(i[n],t)-i[n].radius,s<=o&&(o=s);return o}const De=t=>{const e={},i=Object.values(t);if(!i.length)return[];vt(i,e);const n=e.arcs.map((({p1:t,p2:e,circle:i,width:n})=>({p1:t,p2:e,radius:i.radius,setId:i.setId,largeArcFlag:n>i.radius}))),s=[];let o=0,r=n[0];for(;o<n.length&&r;){const{p2:t}=r;s.push(r),r=n.find((e=>it.distancePP(e.p1,t)<mt)),o++}return s},We=t=>{if(!(null==t?void 0:t.length))return"";let e=0,i=t[0];const{p1:n}=i;let s=`M${n.x},${n.y}`;for(;i;){const{p2:n,radius:o,largeArcFlag:r}=i;s+=`A${o},${o} 0 ${r?1:0},0 ${n.x},${n.y}`,i=t[++e]}return s+=" Z",s},Be=(t,e)=>{const{x0:i,x1:n,y0:o,y1:r,setField:a="sets",valueField:l="size",orientation:h=Math.PI/2,orientationOrder:c=null,emptySetKey:d}=t;let g={},f={};const p=e.some((t=>{const e=z(t[a]);return!e||0===e.length})),y=p?e.filter((t=>!function(t){if(s(t))return!0;if(u(t))return!t.length;const e=x(t);if("Map"===e||"Set"===e)return!t.size;if(m(t))return!Object.keys(t).length;for(const e in t)if(v.call(t,e))return!1;return!0}(z(t[a])))):e;if(y.length>0){const e=y.map((t=>({sets:z(t[a]),size:t[l]})));let s=function(t,e){(e=e||{}).maxIterations=e.maxIterations||500;const i=e.initialLayout||Le,n=e.lossFunction||Re;t=function(t){t=t.slice();const e=[],i={};for(let n=0;n<t.length;++n){const s=t[n];if(1===s.sets.length)e.push(s.sets[0]);else if(2===s.sets.length){const t=s.sets[0],e=s.sets[1];i[[t,e].toString()]=!0,i[[e,t].toString()]=!0}}e.sort((function(t,e){return+(t>e)}));for(let n=0;n<e.length;++n){const s=e[n];for(let o=n+1;o<e.length;++o){const n=e[o];[s,n].toString()in i||t.push({sets:[s,n],size:0})}}return t}(t);const s=i(t,e),o=[],r=[];for(const t in s)s.hasOwnProperty(t)&&(o.push(s[t].x),o.push(s[t].y),r.push(t));const a=Rt((function(e){const i={};for(let t=0;t<r.length;++t){const n=r[t];i[n]={x:e[2*t],y:e[2*t+1],radius:s[n].radius}}return n(i,t)}),o,e).x;for(let t=0;t<r.length;++t){const e=r[t];s[e].x=a[2*t],s[e].y=a[2*t+1]}return s}(e,t);s=Pe(s,h,c),g=function(t,e,i,n,s,o=!1){e=Math.max(e,1),i=Math.max(i,1);const r=[],a=[];for(const e in t)t.hasOwnProperty(e)&&(a.push(e),r.push(t[e]));const l=Ce(r),h=l.xRange,c=l.yRange;if(h.max===h.min||c.max===c.min)return console.log("not scaling solution: zero size detected"),t;const u=e/(h.max-h.min),d=i/(c.max-c.min);let g;if(o){const t=Math.min(e,i)/2,n=(h.min+h.max)/2,s=(c.min+c.max)/2;let o=0;for(const t of r){const e=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-s,2))+t.radius;o=Math.max(o,e)}g=t/o}else g=Math.min(d,u);const f=(e-(h.max-h.min)*g)/2,p=(i-(c.max-c.min)*g)/2,x={};for(let t=0;t<r.length;++t){const e=r[t];x[a[t]]={radius:g*e.radius,x:n+f+(e.x-h.min)*g,y:s+p+(e.y-c.min)*g,setId:e.setId}}return x}(s,n-i,r-o,i,o,p),f=Oe(g,e)}const M=e.map((t=>{const e=z(t[a]);if(!e||0===e.length)return Object.assign(Object.assign({},t),{datum:t,sets:e,key:d||"others",size:t[l],labelX:void 0,labelY:void 0,type:"circle",x:i+(n-i)/2,y:o+(r-o)/2,radius:Math.min(n-i,r-o)/2});const s=e.toString(),h=f[s],c=Object.assign(Object.assign({},t),{datum:t,sets:e,key:s,size:t[l],labelX:null==h?void 0:h.x,labelY:null==h?void 0:h.y}),u=g[s];if(u)return Object.assign(Object.assign({},c),{type:"circle",x:u.x,y:u.y,radius:u.radius});const p=De(e.map((t=>g[t])));return Object.assign(Object.assign({},c),{type:"overlap",x:0,y:0,path:We(p),arcs:p})}));return M},Ne=(t,e)=>e.filter((e=>e.type===t.datumType)),$e={triangleForward:function(){return function(t){const e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))}},triangleUpright:qe,triangle:qe,diamond:function(){return function(t){const e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))}},square:function(){return function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))}},star:function(){return function(t){const e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}},cardioid:function(){return function(t){return 1+Math.sin(t)}},circle:function(){return function(){return 1}},pentagon:function(){return function(t){const e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))}}};function qe(){return function(t){const e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))}}function je(t,e){const i=e[0],n=e[1];let s=1;const o=[e[0]>>1,e[1]>>1];switch(t){case"cardioid":o[1]=~~(n/2.7*.4),s=Math.floor(Math.min(i/2.3,n/2.6));break;case"triangleForward":s=n/Math.sqrt(.75)>i?Math.floor(i/2):Math.floor(n/(2*Math.sqrt(.75)));break;case"triangle":case"triangleUpright":o[1]=~~(n/1.5),s=Math.floor(Math.min(n/1.5,i/2));break;case"circle":case"diamond":case"square":case"star":case"pentagon":s=Math.floor(Math.min(i/2,n/2));break;default:s=Math.floor(Math.max(i/2,n/2))}return{maxRadius:s,center:o}}const He=t=>$e[t]?$e[t]():$e.circle(),Ge=(t,e)=>"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)";function Ue(t){return n(t)?t:function(){return t}}class Ve{constructor(t){var e,i;switch(this.options=S({},Ve.defaultOptions,t),n(this.options.shape)?this.shape=this.options.shape:this.shape=He(this.options.shape),this.getText=null!==(e=Ue(this.options.text))&&void 0!==e?e:t=>t,this.getTextFontWeight=Ue(this.options.fontWeight),this.getTextFontSize=Ue(this.options.fontSize),this.getTextFontStyle=Ue(this.options.fontStyle),this.getTextFontFamily=Ue(this.options.fontFamily),this.outputCallback=null!==(i=this.options.outputCallback)&&void 0!==i?i:t=>t,this.options.color){case"random-dark":this.getTextColor=()=>Ge(10,50);break;case"random-light":this.getTextColor=()=>Ge(50,90);break;default:this.getTextColor=Ue(this.options.color)}if(s(this.options.rotate))if(this.options.useRandomRotate){const t=Math.abs(this.options.maxRotation-this.options.minRotation),e=Math.abs(Math.floor(this.options.rotationSteps)),i=Math.min(this.options.maxRotation,this.options.minRotation);this.getTextRotate=()=>0===this.options.rotateRatio||Math.random()>this.options.rotateRatio?0:0===t?i:e>0?i+Math.floor(Math.random()*e)*t/(e-1):i+Math.random()*t}else this.getTextRotate=()=>0;else this.getTextRotate=n(this.options.rotate)?t=>{var e;return nt(null!==(e=this.options.rotate(t))&&void 0!==e?e:0)}:(t,e)=>{const i=z(this.options.rotate),n=this.options.random?Math.random():q(e);return nt(i[Math.floor(n*i.length)])}}canRepeat(){return!1}exceedTime(){var t;return this.options.progressiveStep>0?this.progressiveIndex>=((null!==(t=this.currentStepIndex)&&void 0!==t?t:-1)+1)*this.options.progressiveStep:this.options.progressiveTime>0&&(new Date).getTime()-this.escapeTime>this.options.progressiveTime}progressiveRun(){var t;if(this.options.progressiveStep>0?this.currentStepIndex=(null!==(t=this.currentStepIndex)&&void 0!==t?t:-1)+1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.data&&this.progressiveIndex<this.data.length){this.progressiveResult=[];let t=this.progressiveIndex,e=0;const i=this.options.maxSingleWordTryCount,n=Math.min(this.options.maxFailCount,this.originalData.length);for(;t<this.data.length&&this.failCount<n;){const s=this.layoutWord(t);if(e++,(s||e>i)&&(t++,e=0,this.failCount=s?0:this.failCount+1),this.progressiveIndex=t,this.exceedTime())break;t===this.data.length&&this.failCount<n&&this.options.repeatFill&&this.canRepeat()&&(this.data=[...this.data,...this.originalData.map((t=>Object.assign(Object.assign({},t),{isFill:!0})))],this.isTryRepeatFill=!0)}return this.progressiveResult}return this.result}initProgressive(){this.failCount=0,this.progressiveIndex=0,this.options.progressiveStep>0?this.currentStepIndex=-1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.progressiveResult=[]}output(){return this.result?this.outputCallback(this.result):null}progressiveOutput(){return this.progressiveResult?this.outputCallback(this.progressiveResult):null}unfinished(){return this.data&&this.data.length&&!s(this.progressiveIndex)&&this.progressiveIndex<this.data.length}release(){this.data=null,this.result=null,this.progressiveIndex=null,this.progressiveResult=null}}Ve.defaultOptions={fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",fontStyle:"normal",minFontSize:12,drawOutOfBound:!1,shrink:!1,minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,rotateRatio:.1,random:!1,shape:"circle",progressiveTime:0,progressiveStep:0,repeatFill:!1,fillTextFontSize:12,maxFailCount:20};const Ke={archimedean:function(t){const e=t[0]/t[1];return t=>[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]},rectangular:function(t){const e=4*t[0]/t[1];let i=0,n=0;return t=>{const s=t<0?-1:1;switch(Math.sqrt(1+4*s*t)-s&3){case 0:i+=e;break;case 1:n+=4;break;case 2:i-=e;break;default:n-=4}return[i,n]}}};const Ye=6e4;class Xe extends Ve{constructor(t){var e;super(S({},Xe.defaultOptions,t)),this.cw=64,this.ch=2048,this._size=[256,256],this._isBoardExpandCompleted=!1,this._placeStatus=0,this._tTemp=null,this._dtTemp=null,this._dy=0,this.cacheMap=new Map,this.options.minFontSize<=Xe.defaultOptions.minFontSize&&(this.options.minFontSize=Xe.defaultOptions.minFontSize),this.spiral=h(this.options.spiral)?null!==(e=Ke[this.options.spiral])&&void 0!==e?e:Ke.archimedean:this.options.spiral,this.random=this.options.random?Math.random:()=>1,this.getTextPadding=Ue(this.options.padding)}zoomRatio(){return this._originSize[0]/this._size[0]}dy(){return this._dy}layoutWord(t){const e=this.data[t];if(""===(""+e.text).trim())return!0;const{maxRadius:i,center:n}=je(this.options.shape,this._size);if(e.x=n[0],e.y=n[1],function(t,e,i,n,s,o){if(e.sprite)return;const r=t.context,a=t.ratio;r.setTransform(a,0,0,a,0,0),r.clearRect(0,0,(s<<5)/a,o/a);let l=0,h=0,c=0;const u=i.length;let d,g,f,p,x;--n;for(;++n<u;){if(e=i[n],r.save(),r.font=e.fontStyle+" "+e.fontWeight+" "+~~((e.fontSize+1)/a)+"px "+e.fontFamily,d=r.measureText(e.text+"m").width*a,f=e.fontSize<<1,e.angle){const t=Math.sin(e.angle),i=Math.cos(e.angle),n=d*i,s=d*t,o=f*i,r=f*t;d=Math.max(Math.abs(n+r),Math.abs(n-r))+31>>5<<5,f=~~Math.max(Math.abs(s+o),Math.abs(s-o))}else d=d+31>>5<<5;if(f>c&&(c=f),l+d>=s<<5&&(l=0,h+=c,c=0),h+f>=o)break;r.translate((l+(d>>1))/a,(h+(f>>1))/a),e.angle&&r.rotate(e.angle),r.fillText(e.text,0,0),e.padding&&(r.lineWidth=2*e.padding,r.strokeText(e.text,0,0)),r.restore(),e.width=d,e.height=f,e.xoff=l,e.yoff=h,e.x1=d>>1,e.y1=f>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,l+=d}const y=r.getImageData(0,0,(s<<5)/a,o/a),m=y.data,v=[];for(;--n>=0;){if(!(e=i[n]).hasText)continue;for(d=e.width,g=d>>5,f=e.y1-e.y0,p=0;p<f*g;p++)v[p]=0;if(l=e.xoff,null==l)return;h=e.yoff;let t=0,o=-1;for(x=0;x<f;x++){for(p=0;p<d;p++){const e=g*x+(p>>5),i=m[(h+x)*(s<<5)+(l+p)<<2]?1<<31-p%32:0;v[e]|=i,t|=i}t?o=x:(e.y0++,f--,x--,h++)}e.y1=e.y0+o,e.sprite=v.slice(0,(e.y1-e.y0)*g)}}(this.contextAndRatio,e,this.data,t,this.cw,this.ch),this._placeStatus=0,e.hasText&&this.place(this._board,e,this._bounds,i))return this.result.push(e),this._bounds?function(t,e){const i=t[0],n=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0);e.y+e.y0<i.y&&(i.y=e.y+e.y0);e.x+e.x1>n.x&&(n.x=e.x+e.x1);e.y+e.y1>n.y&&(n.y=e.y+e.y1)}(this._bounds,e):this._bounds=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}],e.x-=this._size[0]>>1,e.y-=this._size[1]>>1,this._tTemp=null,this._dtTemp=null,!0;if(this.updateBoardExpandStatus(e.fontSize),e.hasText&&this.shouldShrinkContinue()){if(1===this._placeStatus){const t=e.fontSize*this._originSize[0]/this.options.minFontSize,i=Math.max(e.width,e.height);if(i<=t)this.expandBoard(this._board,this._bounds,i/this._size[0]);else{if(!this.options.clip)return!0;this.expandBoard(this._board,this._bounds,t/this._size[0])}}else this._placeStatus,this.expandBoard(this._board,this._bounds);return this.updateBoardExpandStatus(e.fontSize),!1}return this._tTemp=null,this._dtTemp=null,!0}layout(t,e){this.initProgressive(),this.result=[],this._size=[e.width,e.height],this.clearCache(),this._originSize=[...this._size];const i=this.getContext(this.options.createCanvas({width:1,height:1}));this.contextAndRatio=i,this._board=new Array((this._size[0]>>5)*this._size[1]).fill(0),this._bounds=null,t.length,this.result=[];const n=t.map(((t,e)=>({text:this.getText(t),fontFamily:this.getTextFontFamily(t),fontStyle:this.getTextFontStyle(t),fontWeight:this.getTextFontWeight(t),angle:this.getTextRotate(t,e),fontSize:~~this.getTextFontSize(t),padding:this.getTextPadding(t),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:t,x:0,y:0,width:0,height:0}))).sort((function(t,e){return e.fontSize-t.fontSize}));if(this.originalData=n,this.data=n,this.progressiveRun(),!this.options.clip&&this.options.enlarge&&this._bounds&&this.shrinkBoard(this._bounds),this._bounds&&["cardioid","triangle","triangle-upright"].includes(this.options.shape)){const t=(this._bounds[0].y+this._bounds[1].y)/2;this._dy=-(t-this._originSize[1]/2)}return this.result}formatTagItem(t){const e=this._size,i=this.zoomRatio(),n=this.dy(),s=e[0]>>1,o=e[1]>>1,r=t.length,a=[];let l,h;for(let e=0;e<r;++e)l=t[e],h={},h.datum=l.datum,h.x=(l.x+s)*i,h.y=(l.y+o+n)*i,h.fontFamily=l.fontFamily,h.fontSize=l.fontSize*i,h.fontStyle=l.fontStyle,h.fontWeight=l.fontWeight,h.angle=l.angle,a.push(h);return a}output(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.result)):this.formatTagItem(this.result)}progressiveOutput(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.progressiveResult)):this.formatTagItem(this.progressiveResult)}updateBoardExpandStatus(t){this._isBoardExpandCompleted=t*(this._originSize[0]/this._size[0])<this.options.minFontSize}shouldShrinkContinue(){return!this.options.clip&&this.options.shrink&&!this._isBoardExpandCompleted}shrinkBoard(t){const e=t[0],i=t[1];if(i.x>=this._size[0]||i.y>=this._size[1])return;const n=Math.min(e.x,this._size[0]-i.x),s=Math.min(e.y,this._size[1]-i.y),o=2*Math.min(n/this._size[0],s/this._size[1]);this._size=this._size.map((t=>t*(1-o)))}expandBoard(t,e,i){const n=this._size[0]*(i||1.1)-this._size[0]>>5;let s=2*n>2?n:2;s%2!=0&&s++;let o=Math.ceil(this._size[1]*(s<<5)/this._size[0]);o%2!=0&&o++;const r=this._size[0],a=this._size[1],l=new Array(s).fill(0),h=new Array(o/2*(s+(r>>5))).fill(0);this.insertZerosToArray(t,a*(r>>5),h.length+s/2);for(let e=a-1;e>0;e--)this.insertZerosToArray(t,e*(r>>5),l.length);this.insertZerosToArray(t,0,h.length+s/2),this._size=[r+(s<<5),a+o],e&&(e[0].x+=(s<<5)/2,e[0].y+=o/2,e[1].x+=(s<<5)/2,e[1].y+=o/2)}insertZerosToArray(t,e,i){if(this.options.customInsertZerosToArray)return this.options.customInsertZerosToArray(t,e,i);const n=Math.floor(i/Ye),s=i%Ye;for(let i=0;i<n;i++)t.splice(e+i*Ye,0,...new Array(Ye).fill(0));t.splice(e+n*Ye,0,...new Array(s).fill(0))}getContext(t){t.width=1,t.height=1;const e=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1),i=Math.sqrt(e.data.length>>2);t.width=(this.cw<<5)/i,t.height=this.ch/i;const n=t.getContext("2d",{willReadFrequently:!0});return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:i,canvas:t}}place(t,e,i,n){let s=!1;if(this.shouldShrinkContinue()&&(e.width>this._size[0]||e.height>this._size[1]))return this._placeStatus=1,!1;const o=this.random()<.5?1:-1;if(!this.shouldShrinkContinue()&&this.isSizeLargerThanMax(e,o))return null;const r=e.x,a=e.y,l=Math.sqrt(this._size[0]*this._size[0]+this._size[1]*this._size[1]),h=this.spiral(this._size);let c,u,d,g,f=-o;for(this._tTemp=null,this._dtTemp=null;c=h(f+=o);){u=c[0],d=c[1];const h=Math.sqrt(u**2+d**2);let p=Math.atan(d/u);u<0?p+=Math.PI:d<0&&(p=2*Math.PI+p);const x=this.shape(p);if(Math.min(Math.abs(u),Math.abs(d))>=l)break;if(h>=n)s&&null===this._tTemp&&(this._tTemp=f,this._dtTemp=o);else{if(e.x=r+~~(h*x*Math.cos(-p)),e.y=a+~~(h*x*Math.sin(-p)),g=e,this.options.clip)if(this.shouldShrinkContinue()){if(ti(g,this._size)){s&&null===this._tTemp&&(this._tTemp=f,this._dtTemp=o);continue}}else{if(Je(g,this._size)){s&&null===this._tTemp&&(this._tTemp=f,this._dtTemp=o);continue}ti(g,this._size)&&(g=ei(g,this._size))}else if(ti(g,this._size)){s&&null===this._tTemp&&(this._tTemp=f,this._dtTemp=o);continue}if(s=!0,(!i||Qe(g,i))&&(!i||!Ze(g,t,this._size))){const i=g.sprite,n=g.width>>5,s=this._size[0]>>5,o=g.x-(n<<4),r=127&o,a=32-r,l=g.y1-g.y0;let h,c=(g.y+g.y0)*s+(o>>5);for(let e=0;e<l;e++){h=0;for(let s=0;s<=n;s++)t[c+s]|=h<<a|(s<n?(h=i[e*n+s])>>>r:0);c+=s}return e.sprite=null,g.sprite=null,!0}}}return null!==this._tTemp&&(this._placeStatus=3),!this.shouldShrinkContinue()&&this.setCache(g,o),!1}clearCache(){this.cacheMap.clear()}setCache(t,e){const i=`${t.angle}-${e}`,n=t.x1-t.x0,s=t.y1-t.y0;if(!this.cacheMap.has(i))return void this.cacheMap.set(i,{width:n,height:s});const{width:o,height:r}=this.cacheMap.get(i);(n<o&&s<r||n<=o&&s<r)&&this.cacheMap.set(i,{width:n,height:s})}isSizeLargerThanMax(t,e){const i=`${t.angle}-${e}`;if(!this.cacheMap.has(i))return!1;const{width:n,height:s}=this.cacheMap.get(i),o=t.x1-t.x0,r=t.y1-t.y0;return o>=n&&r>=s}}function Ze(t,e,i){const n=i[0]>>5,s=t.sprite,o=t.width>>5,r=t.x-(o<<4),a=127&r,l=32-a,h=t.y1-t.y0;let c,u=(t.y+t.y0)*n+(r>>5);for(let t=0;t<h;t++){c=0;for(let i=0;i<=o;i++)if((c<<l|(i<o?(c=s[t*o+i])>>>a:0))&e[u+i])return!0;u+=n}return!1}function Qe(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}Xe.defaultOptions={enlarge:!1,minFontSize:2,maxSingleWordTryCount:2};const Je=(t,e)=>t.x+t.x0>e[0]||t.y+t.y0>e[0]||t.x+t.x1<0||t.y+t.y1<0,ti=(t,e)=>t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>e[0]||t.y+t.y1>e[1];function ei(t,e){const i=t.sprite,n=t.y1-t.y0,s=t.width>>5;let o=0;const r=[],a=Math.max(-(t.y0+t.y),0),l=Math.min(n+(e[1]-(t.y1+t.y)),n),h=Math.max(-(t.x0+t.x),0)>>5,c=Math.min(s+(e[0]-(t.x1+t.x)>>5)+1,s);for(let t=0;t<n;t++){for(let e=0;e<s;e++)t<a||l<=t||e<h||c<=e||r.push(i[o+e]);o+=s}const u=h<<5,d=s-c<<5,g=a,f=n-l;return Object.assign(Object.assign({},t),{width:t.width-u-d,height:t.height-g-f,x0:t.x0+u,x1:t.x1-d,y0:t.y0+g,y1:t.y1-f,x:t.x+u/2-d/2,sprite:r})}const ii=(t,e,i)=>{const{threshold:n,invert:s=!1}=null!=e?e:{};if(!t||"#fff"===t)return(t,e,i)=>{const o=t.width;if(0===t.data[e*o*4+4*i+3])return!s;const r=t.data[e*o*4+4*i+0],a=t.data[e*o*4+4*i+1],l=t.data[e*o*4+4*i+2];if(255===r&&255===a&&255===l)return!s;if(g(n)){const t=.3*r+.59*a+.11*l;return s?t<=n:t>=n}return!1};const o=i({width:1,height:1}).getContext("2d",{willReadFrequently:!0});o.fillStyle=t,o.fillRect(0,0,1,1);const r=o.getImageData(0,0,1,1).data;return(t,e,i)=>{const n=t.width;return[0,1,2,3].every((o=>s?t.data[4*(e*n+i)+o]!==r[o]:t.data[4*(e*n+i)+o]===r[o]))}},ni=(t,e,i,n,s=!1,o)=>{let{backgroundColor:r="#fff"}=t,{fill:a="#000"}=t;s&&([r,a]=[a,r]);const l=n||o({width:e,height:i,dpr:1}),h=l.getContext("2d",{willReadFrequently:!0});if(n){const t=n.width,s=n.height;h.clearRect(0,0,t,s),n.style.width=`${e}px`,n.style.height=`${i}px`,n.width=e,n.height=i}return h.fillStyle=r,h.fillRect(0,0,l.width,l.height),"text"===t.type?si(t,a,l.width,l.height,h):"geometric"===t.type&&hi(t,a,l.width,l.height,h),l},si=(t,e,i,n,s)=>{const{fontFamily:r="sans-serif",fontWeight:a="normal",fontStyle:l="normal",fontVariant:h="normal",text:c,hollow:u}=t;let d=12;s.font=`${l} ${h} ${a} ${d}px ${r}`,s.textAlign="center",s.textBaseline="middle",s.fillStyle=e;const g=s.measureText(c),f="normal"!==l?1.1:1,p=o(g.actualBoundingBoxRight)&&o(g.actualBoundingBoxLeft)?Math.ceil(f*(Math.abs(g.actualBoundingBoxRight)+Math.abs(g.actualBoundingBoxLeft))):0,x=Math.max(Math.ceil(g.width),p,d);if(u&&(s.globalCompositeOperation="xor"),x>i){const t=Math.min(i/x,n/d);s.fillText(c,i/2,n/2),s.scale(t,t)}else d=Math.floor(d*i/x),d=Math.min(d,n),s.font=`${l} ${h} ${a} ${d}px ${r}`,s.fillText(c,Math.floor(i/2),Math.floor(n/2))},oi=(t,e,i=0,n)=>{const s=2*Math.PI/n;return new Array(n).fill(0).map(((n,o)=>st(t,e,i+o*s)))},ri=(t,e,i=0,n)=>{const s=2*Math.PI/n,o=He("cardioid");return new Array(n).fill(0).map(((n,r)=>{const a=i+r*s,l=e*o(a);return st(t,l,a)}))},ai=(t,e)=>{t.beginPath(),e.forEach(((e,i)=>{0===i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)})),t.closePath(),t.fill()},li=(t,e)=>{let i;t.beginPath(),e.forEach(((e,n)=>{0===n?t.moveTo(e.x,e.y):t.bezierCurveTo(e.x,e.y,i.x,i.y,e.x,e.y),i=e})),t.closePath(),t.fill()},hi=(t,e,i,n,s)=>{const{hollow:o}=t,{center:r,maxRadius:a}=je(t.shape,[i,n]);s.fillStyle=e,o&&(s.globalCompositeOperation="xor");const l=r[0],h=r[1];if("cardioid"===t.shape)li(s,ri({x:l,y:h},a,0,100));else if("circle"===t.shape)s.beginPath(),s.arc(l,h,a,0,2*Math.PI,!0),s.fill();else if("diamond"===t.shape)ai(s,oi({x:l,y:h},a,-Math.PI/2,4));else if("square"===t.shape)ai(s,oi({x:l,y:h},a,-Math.PI/4,4));else if("pentagon"===t.shape)ai(s,oi({x:l,y:h},a,Math.PI/2,5));else if("triangle"===t.shape||"triangleUpright"===t.shape)ai(s,oi({x:l,y:h},a,-Math.PI/2,3));else if("triangleForward"===t.shape)ai(s,oi({x:l,y:h},a,0,3));else if("star"===t.shape){const t=oi({x:l,y:h},a,-Math.PI/2,5),e=oi({x:l,y:h},a/(2*Math.cos(Math.PI/5)),-Math.PI/2+Math.PI/5,5),i=[];for(let n=0;n<5;n++)i.push(t[n]),i.push(e[n]);ai(s,i)}else s.fillRect(0,0,i,n)};function ci(t){const{size:e,maskCanvas:i}=t,n=i.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,i.width,i.height),s=new Array(e[0]*e[1]).fill(0);let o=1;const r=[[0,1],[1,0],[-1,0],[0,-1]];let a=[];for(let i=0;i<e[1];i++)for(let l=0;l<e[0];l++)if(0===s[i*e[0]+l]&&!t.isEmptyPixel(n,i,l)){s[i*e[0]+l]=o,a.push([i,l]);for(let i=0;i<a.length;i++)for(let l=0;l<4;l++){let h=a[i][0]+r[l][0],c=a[i][1]+r[l][1];h=h<0?0:h>=e[1]?e[1]-1:h,c=c<0?0:c>=e[0]?e[0]-1:c,0!==s[h*e[0]+c]||t.isEmptyPixel(n,h,c)||(s[h*e[0]+c]=o,a.push([h,c]))}o++,a=[]}const l={},h={},c={},u={},d={},g={},f={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0,width:0,height:0},p=[];for(let t=0;t<e[1];t++)for(let i=0;i<e[0];i++){const n=s[t*e[0]+i];0!==n&&(S(t,i)&&(p.push([t,i]),l[n]=l[n]||[],l[n].push([i,t]),u[n]||(u[n]=[1/0,-1/0,1/0,-1/0]),t<u[n][0]&&(u[n][0]=t),t>u[n][1]&&(u[n][1]=t),i<u[n][2]&&(u[n][2]=i),i>u[n][3]&&(u[n][3]=i),i<f.x1&&(f.x1=i),i>f.x2&&(f.x2=i),t<f.y1&&(f.y1=t),t>f.y2&&(f.y2=t)),h[n]=(h[n]||0)+1)}const x=[];for(const t in l){const e=l[t],i=~~(e.reduce(((t,e)=>t+e[0]),0)/e.length),n=~~(e.reduce(((t,e)=>t+e[1]),0)/e.length);c[t]=[i,n],x.push(...e);const[s,o,r,a]=u[t];d[t]=~~Math.max(Math.sqrt((i-r)**2+(n-s)**2),Math.sqrt((i-a)**2+(n-o)**2),Math.sqrt((i-r)**2+(n-o)**2),Math.sqrt((i-a)**2+(n-s)**2)),g[t]=(a-r)/(o-s)}const y=Object.keys(c).map((t=>({label:t-1,boundary:l[t],area:h[t],center:c[t],maxPoint:u[t],maxR:d[t],ratio:g[t]})));f.width=f.x2-f.x1+1,f.height=f.y2-f.y1+1;const m=~~(x.reduce(((t,e)=>t+e[0]),0)/x.length),v=~~(x.reduce(((t,e)=>t+e[1]),0)/x.length),M=~~Math.max(Math.sqrt((m-f.x1)**2+(v-f.y1)**2),Math.sqrt((m-f.x2)**2+(v-f.y2)**2),Math.sqrt((m-f.x1)**2+(v-f.y2)**2),Math.sqrt((m-f.x2)**2+(v-f.y1)**2)),_=f.width/f.height,w=Object.keys(h).reduce(((t,e)=>t+h[e]),0),b={regions:y,labels:s,labelNumber:o-1};if(t.blur){const i=t.blur,n=function(t,e,i,n){const s=n/3,o=Math.ceil(n/2),r=function(t,e){const i=new Array(2*t+1).fill(0),n=t;let s=0;for(let o=-t;o<=t;o++){const t=Math.exp(-o*o/(2*e*e));i[o+n]=t,s+=t}for(let t=0;t<i.length;t++)i[t]/=s;return i}(o,s),a=new Array(t.length).fill(0),l=new Array(t.length).fill(0);for(let n=0;n<i;n++)for(let i=0;i<e;i++){let s=0;for(let a=-o;a<=o;a++){s+=t[n*e+Math.min(Math.max(i+a,0),e-1)]*r[a+o]}a[n*e+i]=s}for(let t=0;t<e;t++)for(let n=0;n<i;n++){let s=0;for(let l=-o;l<=o;l++){s+=a[Math.min(Math.max(n+l,0),i-1)*e+t]*r[l+o]}l[n*e+t]=Math.max(0,Math.min(1,s))}return l}(s,e[0],e[1],i),o=function(t,e,i,n,s=1){const o=new Array(t.length).fill(0);for(const[t,r]of e)if(o[t*i+r]=1,s>1)for(let e=1-s;e<=s-1;e++)for(let a=1-s;a<=s-1;a++){if(Math.sqrt(e*e+a*a)<s){const s=t+e,l=r+a;s>=0&&s<n&&l>=0&&l<i&&(o[s*i+l]=1)}}return o}(s,p,e[0],e[1],Math.ceil(i/2));o.forEach(((t,e)=>{1===t&&(s[e]=n[e])}))}return Object.assign(t,{segmentation:b,shapeBounds:f,shapeMaxR:M,shapeRatio:_,shapeCenter:[m,v],shapeArea:w});function S(t,i){const n=[[0,1],[1,0],[-1,0],[0,-1]];if(0===t||0===i||t===e[1]-1||i===e[0]-1)return!0;for(let o=0;o<4;o++){let r=t+n[o][0],a=i+n[o][1];if(r=r<0?0:r>=e[1]?e[1]-1:r,a=a<0?0:a>=e[0]?e[0]-1:a,0===s[r*e[0]+a])return!0}return!1}}function ui(t,e,i){e.width=t.width,e.height=t.height;const n=e.getContext("2d",{willReadFrequently:!0});n.clearRect(0,0,e.width,e.height),n.drawImage(t,0,0);const s=e.width,o=n.getImageData(0,0,e.width,e.height);let r=0,a=o.height,l=0,h=o.width;const c=(t,e)=>{for(let n=0;n<t;++n)if(!i(o,e,n))return!1;return!0},u=(t,e,n)=>{for(let s=e;s<n;++s)if(!i(o,s,t))return!1;return!0};for(;r<a&&c(s,r);)++r;for(;a-1>r&&c(s,a-1);)--a;for(;l<h&&u(l,r,a);)++l;for(;h-1>l&&u(h-1,r,a);)--h;const d=n.getImageData(l,r,h-l,a-r);return e.width=d.width,e.height=d.height,n.clearRect(0,0,e.width,e.height),n.putImageData(d,0,0),e}function di(t,e){const i=t.width,n=t.height;let s=e[0]/i;n*s>e[1]&&(s=e[1]/n);const o=Math.floor(s*i),r=Math.floor(s*n);return{x:(e[0]-o)/2,y:(e[1]-r)/2,width:o,height:r,scale:s}}
/*!
   * wordcloud2.js
   * http://timdream.org/wordcloud2.js/
   *
   * Copyright 2011 - 2019 Tim Guan-tin Chien and contributors.
   * Released under the MIT license
   */let gi=class t extends Ve{constructor(e){super(S({},t.defaultOptions,e)),this.fillGridAt=(t,e)=>{t>=this.ngx||e>=this.ngy||t<0||e<0||(this.grid[t][e]=!1)},this.updateGrid=(t,e,i,n,s)=>{const o=s.occupied;let r=o.length;for(;r--;){const i=t+o[r][0],n=e+o[r][1];i>=this.ngx||n>=this.ngy||i<0||n<0||this.fillGridAt(i,n)}},this.gridSize=Math.max(Math.floor(this.options.gridSize),4)}getPointsAtRadius(t){if(this.pointsAtRadius[t])return this.pointsAtRadius[t];const e=8*t;let i=e;const n=[];for(0===t&&n.push([this.center[0],this.center[1],0]);i--;){const s=this.shape(i/e*2*Math.PI);n.push([this.center[0]+t*s*Math.cos(-i/e*2*Math.PI),this.center[1]+t*s*Math.sin(-i/e*2*Math.PI)*this.options.ellipticity,i/e*2*Math.PI])}return this.pointsAtRadius[t]=n,n}getTextInfo(t,e=1,i){var n;const s=this.options.clip?1:e,o=Math.max(Math.floor((this.isTryRepeatFill?this.options.fillTextFontSize:this.getTextFontSize(t))*s),this.options.minFontSize);let r=this.getText(t)+"";if(this.options.clip&&(r=r.slice(0,Math.ceil(r.length*e))),!r)return null;const a=this.getTextFontWeight(t),l=this.getTextFontStyle(t),h=this.getTextRotate&&null!==(n=this.getTextRotate(t,i))&&void 0!==n?n:0,c=this.getTextFontFamily(t),u=this.options.createCanvas({width:1,height:1}),d=u.getContext("2d",{willReadFrequently:!0});d.font=l+" "+a+" "+o.toString(10)+"px "+c;const g=d.measureText(r).width,f=Math.max(o,d.measureText("m").width,d.measureText("Ｗ").width);let p=g+2*f,x=3*f;const y=Math.ceil(p/this.gridSize),m=Math.ceil(x/this.gridSize);p=y*this.gridSize,x=m*this.gridSize;const v=-g/2,M=.4*-f,_=Math.ceil((p*Math.abs(Math.sin(h))+x*Math.abs(Math.cos(h)))/this.gridSize),w=Math.ceil((p*Math.abs(Math.cos(h))+x*Math.abs(Math.sin(h)))/this.gridSize),b=w*this.gridSize,S=_*this.gridSize;u.setAttribute("width",""+b),u.setAttribute("height",""+S),d.scale(1,1),d.translate(b/2,S/2),d.rotate(-h),d.font=l+" "+a+" "+o.toString(10)+"px "+c,d.fillStyle="#000",d.textBaseline="middle",d.fillText(r,v,M);const k=d.getImageData(0,0,b,S).data;if(this.exceedTime())return null;const z=[];let F,T=w;const R=[_/2,w/2,_/2,w/2],L=(t,e,i)=>{let n=this.gridSize;for(;n--;){let s=this.gridSize;for(;s--;)if(k[4*((e*this.gridSize+n)*b+(t*this.gridSize+s))+3])return i.push([t,e]),t<R[3]&&(R[3]=t),t>R[1]&&(R[1]=t),e<R[0]&&(R[0]=e),void(e>R[2]&&(R[2]=e))}};for(;T--;)for(F=_;F--;)L(T,F,z);return{datum:t,occupied:z,bounds:R,gw:w,gh:_,fillTextOffsetX:v,fillTextOffsetY:M,fillTextWidth:g,fillTextHeight:f,fontSize:o,fontStyle:l,fontWeight:a,fontFamily:c,angle:h,text:r}}calculateEmptyRate(){const t=this.ngx*this.ngy;let e=0;for(let t=0;t<this.ngx;t++)for(let i=0;i<this.ngy;i++)this.grid[t][i]&&e++;return e/t}canFitText(t,e,i,n,s){let o=s.length;for(;o--;){const i=t+s[o][0],n=e+s[o][1];if(i>=this.ngx||n>=this.ngy||i<0||n<0){if(!this.options.drawOutOfBound)return!1}else if(!this.grid[i][n])return!1}return!0}layoutWord(t,e=1){const i=this.data[t],n=this.getTextInfo(i,e,t);if(!n)return!1;if(this.exceedTime())return!1;if(!this.options.drawOutOfBound&&(!this.options.shrink||n.fontSize<=this.options.minFontSize)&&!this.options.clip){const t=n.bounds;if(t[1]-t[3]+1>this.ngx||t[2]-t[0]+1>this.ngy)return!1}let s=this.maxRadius+1;const o=t=>{const e=Math.floor(t[0]-n.gw/2),i=Math.floor(t[1]-n.gh/2),o=n.gw,r=n.gh;return!!this.canFitText(e,i,o,r,n.occupied)&&(n.distance=this.maxRadius-s,n.theta=t[2],this.outputText(e,i,n),this.updateGrid(e,i,o,r,n),!0)};for(;s--;){let t=this.getPointsAtRadius(this.maxRadius-s);this.options.random&&(t=[].concat(t),T(t));if(t.some(o))return!0}return(this.options.clip||!!(this.options.shrink&&n.fontSize>this.options.minFontSize))&&this.layoutWord(t,.75*e)}outputText(t,e,i){const n=this.getTextColor(i),s={text:i.text,datum:i.datum,color:n,fontStyle:i.fontStyle,fontWeight:i.fontWeight,fontFamily:i.fontFamily,angle:i.angle,width:i.fillTextWidth,height:i.fillTextHeight,x:(t+i.gw/2)*this.gridSize,y:(e+i.gh/2)*this.gridSize+i.fillTextOffsetY+.5*i.fontSize,fontSize:i.fontSize};this.result.push(s),this.progressiveResult&&this.progressiveResult.push(s)}initGrid(t){this.grid=[];const e=this.options.shape;if(r(e)){const i=ni(e,t.width,t.height,void 0,!1,this.options.createCanvas);let n=i.getContext("2d").getImageData(0,0,this.ngx*this.gridSize,this.ngy*this.gridSize);this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(i);let s=ii(e.backgroundColor,void 0,this.options.createCanvas);const o=(t,e)=>{let i=this.gridSize;for(;i--;){let o=this.gridSize;for(;o--;)if(!s(n,e*this.gridSize+i,t*this.gridSize+o))return void(this.grid[t][e]=!0)}this.grid[t][e]=!1};let r=this.ngx;for(;r--;){this.grid[r]=[];let t=this.ngy;for(;t--;)o(r,t),!1!==this.grid[r][t]&&(this.grid[r][t]=!0)}n=s=void 0}else{let t=this.ngx;for(;t--;){this.grid[t]=[];let e=this.ngy;for(;e--;)this.grid[t][e]=!0}}}canRepeat(){return this.calculateEmptyRate()>.001}layout(t,e){this.initProgressive(),this.drawnCount=0,this.isTryRepeatFill=!1,this.originalData=t,this.data=t,this.pointsAtRadius=[],this.ngx=Math.floor(e.width/this.gridSize),this.ngy=Math.floor(e.height/this.gridSize);const{center:i,maxRadius:n}=je(this.options.shape,[e.width,e.height]);return this.center=e.origin?[e.origin[0]/this.gridSize,e.origin[1]/this.gridSize]:[i[0]/this.gridSize,i[1]/this.gridSize],this.maxRadius=Math.floor(n/this.gridSize),this.initGrid(e),this.result=[],this.progressiveRun()}};gi.defaultOptions={gridSize:8,ellipticity:1,maxSingleWordTryCount:1};class fi extends Ve{constructor(t){super(S({},fi.defaultOptions,t)),this.random=this.options.random?Math.random:()=>0,this.aspectRatio=1}fit(t){for(let e=0,i=this.result.length;e<i;e++)if(pi(t,this.result[e]))return!1;return!0}getTextInfo(t,e){const i={datum:t,fontSize:this.getTextFontSize(t),fontWeight:this.getTextFontWeight(t),fontStyle:this.getTextFontStyle(t),fontFamily:this.getTextFontFamily(t),angle:this.getTextRotate(t,e),text:this.getText(t)+"",x:this.center[0],y:this.center[1]},n=this.options.getTextBounds(i);return i.width=n.width(),i.height=n.height(),i.top=this.center[1]-i.height+.21*i.height,i.left=this.center[0]-i.width/2,i}layoutWord(t){const e=this.getTextInfo(this.data[t],t);let i=2*Math.PI,n=0,s=e.left,o=e.top;const r=e.width,a=e.height;let l=1,h=this.fit(e);for(;!h&&n<this.maxRadius;)n+=.5,l=this.shape(n/this.maxRadius*2*Math.PI),i+=.5*(this.options.random?this.random()>.5?1:-1:t%2==0?1:-1),s=this.center[0]-r/2+n*l*Math.cos(i)*this.aspectRatio,o=this.center[1]-a/2+n*l*Math.sin(i),e.left=s,e.top=o,e.x=s+r/2,e.y=o+a/2,h=this.fit(e);return!!h&&(!!(this.options.clip||e.left>=0&&e.left+e.width<=this.width&&e.top>=0&&e.top+e.height<=this.height)&&(this.result.push(e),!0))}layout(t,e){if(!(null==t?void 0:t.length))return[];this.initProgressive(),this.result=[],this.maxRadius=Math.sqrt(e.width*e.width+e.height*e.height)/2,this.center=[e.width/2,e.height/2],this.width=e.width,this.height=e.height,this.data=t.sort(((t,e)=>this.getTextFontSize(e)-this.getTextFontSize(t)));let i=0;for(;i<t.length&&(this.layoutWord(i),i++,this.progressiveIndex=i,!this.exceedTime()););return this.result}}function pi(t,e){return!(t.left+t.width<e.left||t.top+t.height<e.top||t.left>e.left+e.width||t.top>e.top+e.height)}fi.defaultOptions={enlarge:!1};const xi={x:"x",y:"y",z:"z",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle"},yi=t=>h(t)||d(t)||n(t)||c(t)?t:e=>e[t.field],mi=t=>t<0?-Math.sqrt(-t):Math.sqrt(t),vi=(t,e,i)=>{if(t[0]===t[1])return t=>e[0];const n=mi(t[0]),s=mi(t[1]),o=Math.min(n,s),r=Math.max(n,s);return t=>(mi(t)-o)/(r-o)*(e[1]-e[0])+e[0]},Mi=(t,e)=>{let i=1/0,n=-1/0;const s=e.length;let o;for(let r=0;r<s;++r)o=I(t(e[r])),o<i&&(i=o),o>n&&(n=o);return 1===e.length&&i===n&&(i-=1e4),[i,n]};function _i(t,e,i,n,s){const o=Math.max(t[0],t[1])/2,r=function(t,e,i,n,s){const{x:o,y:r}=s,a=o/t*Math.PI*2;let l=Math.PI-r/e*Math.PI;l+=(l<Math.PI/2?1:-1)*Math.pow(Math.min(l-Math.PI/2,1),2)/5;const h=i*Math.sin(l)*Math.cos(a)+n.x,c=i*Math.cos(l)+n.y,u=i*Math.sin(l)*Math.sin(a)+n.z;return{x:h,y:c,z:u}}(t[0],t[1],o,{x:o,y:o,z:null!=s?s:o},e);i[n.x]=r.x,i[n.y]=r.y,i[n.z]=r.z}var wi;t.WORDCLOUD_SHAPE_HOOK_EVENT=void 0,(wi=t.WORDCLOUD_SHAPE_HOOK_EVENT||(t.WORDCLOUD_SHAPE_HOOK_EVENT={})).BEFORE_WORDCLOUD_SHAPE_LAYOUT="beforeWordcloudShapeLayout",wi.AFTER_WORDCLOUD_SHAPE_LAYOUT="afterWordcloudShapeLayout",wi.AFTER_WORDCLOUD_SHAPE_DRAW="afterWordcloudShapeDraw";const bi=t=>/^[\u4e00-\u9fa5]+$/.test(t),Si=(t,e)=>{if(s(t))return 0;let i=0;for(const e of t)bi(e)?i+=1:i+=.53;return i};function ki(t,e,i){const{stepFactor:n,importantWordCount:s,globalShinkLimit:o}=e,{size:r,segmentation:{regions:a},tempCanvas:l,boardSize:h,shapeCenter:c,shapeMaxR:u,shapeRatio:d}=i,g=l.getContext("2d",{willReadFrequently:!0}),f=Li(i);let p=f.slice(0);const x=e.fontSizeShrinkFactor;let y=null,m=1,v=1;const M=s;let _=0;if(t.length>M){_=t.sort(((t,e)=>e.weight-t.weight))[M].weight}for(let e=0;e<a.length;e++){const i=a[e],{words:s,center:c,maxR:u,ratio:d}=i;let M=!1;for(let e=0;e<s.length;e++){Ri(l,g,t,e);const i=s[e];if(i.x=c[0],i.y=c[1],!i.skip&&i.hasText&&i.sprite&&zi(p,i,u,d,r,h,n))i.hasPlaced=!0;else{if(!i.skip&&i.weight>_&&v>o){const e=i.datum[Symbol.for("vGrammar_id")];e!==y&&(y=e,m=v),v*=x,t.forEach((t=>{t.hasText=!1,t.sprite=null,t.fontSize=t.fontSize*x})),p=f.slice(0),M=!0;break}if(!i.skip&&i.datum[Symbol.for("vGrammar_id")]===y){t.forEach((t=>{t.hasText=!1,t.sprite=null,t.fontSize=t.fontSize/v})),i.skip=!0,v=m,y=null,p=f.slice(0),M=!0;break}}}M&&(e=-1)}for(let i=0;i<e.textLayoutTimes;i++){const i=t.filter((t=>(t.hasPlaced||(t.hasText=!1,t.sprite=null,t.fontSize=Math.max(~~(t.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!t.hasPlaced)));if(0===i.length)break;for(let t=0;t<i.length;t++){const e=i[t];Ri(l,g,i,t),e.x=c[0],e.y=c[1],e.hasText&&zi(p,e,u,d,r,h,n)&&(e.hasPlaced=!0)}}e.board=p}function zi(t,e,i,n,s,o,r){const a=e.x,l=e.y,h=function(t){return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}(n),c=1*r;let u,d,g,f=-c;for(;u=h(f+=c);){const{wordSize:n,bounds:{dTop:r,dBottom:h,dLeft:c,dRight:f}}=e;if(d=u[0],g=u[1],Math.min(Math.abs(d),Math.abs(g))>=i)break;if(e.x=~~(a+d),e.y=~~(l+g),!(e.x-c<0||e.x+f>s[0]||e.y-r<0||e.y+h>s[1]||Ti(e,t,o)))return Fi(e,t,o),!0}return!1}function Fi(t,e,i){const{wordSize:n}=t,s=t.sprite,o=n[0]>>5,r=i[0]>>5,a=t.x-(o<<4),l=a%32,h=32-l,c=n[1];let u,d=(t.y-(n[1]>>1))*r+(a>>5);if(0===l)for(let t=0;t<c;t++){for(let i=0;i<o;i++)e[d+i]|=s[t*o+i];d+=r}else for(let t=0;t<c;t++){u=0;for(let i=0;i<=o;i++)e[d+i]|=u<<h|(i<o?(u=s[t*o+i])>>>l:0);d+=r}}function Ti(t,e,i){const{sprite:n,wordSize:s}=t,o=i[0]>>5,r=s[0]>>5,a=t.x-(r<<4),l=a%32,h=32-l,c=s[1];let u,d=(t.y-(s[1]>>1))*o+(a>>5);if(0===l)for(let t=0;t<c;t++){for(let i=0;i<r;i++)if(e[d+i]&n[t*r+i])return!0;d+=o}else for(let t=0;t<c;t++){u=0;for(let i=0;i<=r;i++)if((u<<h|(i<r?(u=n[t*r+i])>>>l:0))&e[d+i])return!0;d+=o}return!1}function Ri(t,e,i,n){if(i[n].sprite||0===i[n].fontSize)return;const s=2048,o=2048,r=Math.PI/180,a=i.length;t.width=s,t.height=o,e.clearRect(0,0,s,o),e.textAlign="center";let l,h,c=0,u=0,d=0,g=0;const f=n;for(--n;++n<a;){const t=i[n],a=Math.max(t.fontSize,2);if(e.save(),e.font=t.fontStyle+" "+t.fontWeight+" "+a+"px "+t.fontFamily,l=e.measureText(t.text+"m").width+2*t.padding,h=2*a+2*t.padding,0!==t.rotate){const e=Math.sin(t.rotate*r),i=Math.cos(t.rotate*r),n=l*i,s=l*e,o=h*i,a=h*e;l=Math.max(Math.abs(n+a),Math.abs(n-a)),h=~~Math.max(Math.abs(s+o),Math.abs(s-o))}if(l=l+31>>5<<5,h=Math.ceil(h),h>d&&(d=h),c+l>=s&&(c=0,u+=d,d=h),u+h>=o){if(0===u){t.hasText=!1;continue}break}u+h>=g&&(g=u+h),e.translate(c+(l>>1),u+(h>>1)),0!==t.rotate&&e.rotate(t.rotate*r),e.fillText(t.text,0,0),t.padding&&(e.lineWidth=2*t.padding,e.strokeText(t.text,0,0)),e.restore(),t.LT=[c,u],t.wordSize=[l,h],t.hasText=!0,c+=l}if(0===g)return;const p=e.getImageData(0,0,s,g).data;let x,y;for(;--n>=f;){const t=i[n];if(!t.hasText){t.bounds={dTop:1/0,dBottom:-1/0,dLeft:1/0,dRight:-1/0};break}const{LT:e=[0,0],wordSize:o}=t;[c,u]=e;const r=o[0]>>5,a=new Array(r*o[1]).fill(0);let[l,h,d,g]=[1/0,-1/0,1/0,-1/0];for(y=0;y<o[1];y++){let t;for(x=0;x<o[0];x++)if(p[4*((u+y)*s+(c+x))+3]>0){const e=1<<31-x%32;a[r*y+(x>>5)]|=e,x<d&&(d=x),x>g&&(g=x),t|=e}t&&(y<l&&(l=y),y>h&&(h=y))}t.bounds={dTop:(o[1]>>1)-l,dBottom:h-(o[1]>>1),dLeft:(o[0]>>1)-d,dRight:g-(o[0]>>1)},t.sprite=a,delete t.LT}}function Li(t){const{segmentation:{labels:e},boardSize:i,size:n}=t,s=i[0]>>5,o=new Array(s*n[1]).fill(0);for(let t=0;t<n[1];t++)for(let i=0;i<n[0];i++){if(0===e[t*n[0]+i]){const e=1<<31-i%32;o[s*t+(i>>5)]|=e}}if(i[0]>n[0]){const t=(1<<i[0]-n[0])-1;for(let e=0;e<n[1];e++){o[s*e+s-1]|=t}}return o}function Ii(t,e,i){!function(t,e){const{segmentation:{regions:i}}=e;let n=-1/0,s=0,o=0;i.forEach(((t,e)=>{const i=t.area;i>n&&(n=i,o=e),s+=i}));let r=0;i.forEach((e=>{const i=e.area,o=Math.ceil(i/s*t.length),a=i/n;e.words=[],e.regionNum=o,e.regionWeight=a,r+=o})),r<t.length&&(i[o].wordsNum+=t.length-r);let a=o;const l=i.map((t=>t.regionNum));t.forEach((t=>{let e=0,n=0;t.regionIndex=-1;do{if(l[a]>0&&t.weight<=i[a].regionWeight){t.regionIndex=a,i[a].words.push(t),l[a]--,a=(a+1)%i.length;break}a=(a+1)%i.length,e++,n++,n>i.length+1&&(i.forEach((t=>{t.regionWeight+=.15})),n=0)}while(-1===t.regionIndex&&e<3*i.length);-1===t.regionIndex&&(t.regionIndex=o,i[o].words.push(t),l[o]--)})),i.forEach((t=>{t.words.sort(((t,e)=>e.weight-t.weight))}))}(t,i),"ensureMapping"===e.layoutMode?ki(t,e,i):"ensureMappingEnlarge"===e.layoutMode?function(t,e,i){const{size:n,stepFactor:s,importantWordCount:o}=e,{segmentation:{regions:r},tempCanvas:a,boardSize:l,shapeCenter:h,shapeMaxR:c,shapeRatio:u}=i,d=a.getContext("2d",{willReadFrequently:!0}),g=Li(i);let f=g.slice(0);const p=e.fontSizeEnlargeFactor,x=Math.min(o,t.length);let y=0;t.length>x&&(y=t.sort(((t,e)=>e.weight-t.weight))[x-1].weight);let m=0,v=1,M=!1;for(let o=0;o<r.length;o++){const h=r[o],{words:c,center:u,maxR:_,ratio:w}=h;let b=!1;for(let o=0;o<c.length;o++){Ri(a,d,t,o);const r=c[o];if(r.x=u[0],r.y=u[1],r.hasText&&r.sprite&&zi(f,r,_,w,n,l,s)){if(r.hasPlaced=!0,r.weight>=y&&m++,m>=x&&!M){v*=p,t.forEach((t=>{t.hasText=!1,t.sprite=null,t.fontSize=t.fontSize*p})),f=g.slice(0),b=!0,m=0;break}}else{if(r.weight>=y&&v>1){t.forEach((t=>{t.hasText=!1,t.sprite=null,t.fontSize=t.fontSize/p})),v/=p,M=!0,f=g.slice(0),b=!0;break}if(r.weight>=y)return ki(t,e,i)}}b&&(o=-1)}for(let i=0;i<e.textLayoutTimes;i++){const i=t.filter((t=>(t.hasPlaced||(t.hasText=!1,t.sprite=null,t.fontSize=Math.max(~~(t.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!t.hasPlaced)));if(0===i.length)break;for(let t=0;t<i.length;t++){const e=i[t];Ri(a,d,i,t),e.x=h[0],e.y=h[1],e.hasText&&zi(f,e,c,u,n,l,s)&&(e.hasPlaced=!0)}}e.board=f}(t,e,i):function(t,e,i){const{size:n,stepFactor:s}=e,{segmentation:{regions:o},tempCanvas:r,boardSize:a,shapeCenter:l,shapeMaxR:h,shapeRatio:c}=i,u=Li(i),d=r.getContext("2d",{willReadFrequently:!0});for(const e of o){const{words:i,center:o,maxR:l,ratio:h}=e;for(let e=0;e<i.length;e++){Ri(r,d,t,e);const c=i[e];c.x=o[0],c.y=o[1],c.hasText&&c.sprite&&zi(u,c,l,h,n,a,s)&&(c.hasPlaced=!0)}}for(let i=0;i<e.textLayoutTimes;i++){const i=t.filter((t=>(t.hasPlaced||(t.hasText=!1,t.sprite=null,t.fontSize=Math.max(~~(t.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!t.hasPlaced)));if(0===i.length)break;for(let t=0;t<i.length;t++){const e=i[t];Ri(r,d,i,t),e.x=l[0],e.y=l[1],e.hasText&&zi(u,e,h,c,n,a,s)&&(e.hasPlaced=!0)}}e.board=u}(t,e,i);const n=function(t,e,i){const{size:n,fillingTimes:s,fillingXStep:o,fillingYStep:r,getFillingFontStyle:a,getFillingFontWeight:l,getFillingFontFamily:h,fillingInitialFontSize:c,fillingDeltaFontSize:u,fillingInitialOpacity:d,fillingDeltaOpacity:g,fillingRotateList:f,getFillingPadding:p,random:x,board:y,minFillFontSize:m}=e,{boardSize:v,shapeBounds:M,tempCanvas:_,randomGenerator:w}=i,b=_.getContext("2d",{willReadFrequently:!0});let S=c,k=d;const z=[];for(let t=0;t<s;t++)F(S,k),S=Math.max(S>u?S-u:u,m),k=k>g?k-g:g;return z;function F(e,i){const s=t.map((t=>{const{text:n,color:s,fillingColor:o,hasPlaced:r,datum:c}=t;return{x:0,y:0,weight:0,text:n,fontFamily:h(c),fontStyle:a(c),fontWeight:l(c),fontSize:e,rotate:f[~~(w()*f.length)],padding:p(c),opacity:i,visible:!0,color:s,fillingColor:o,hasPlaced:r,datum:c}}));T(s);let c=0;const{x1:u,y1:d,x2:g,y2:m}=M,[S,k]=[u+~~(w()*o*2),d+~~(w()*r*2)];for(let t=k;t<=m;t+=r)for(let e=S;e<=g;e+=o){Ri(_,b,s,c);const i=s[c];i.x=e,i.y=t;const{wordSize:o,bounds:r,hasPlaced:a}=i;if(!a||!r){++c===s.length&&(c=0,x&&T(s));continue}const{dTop:l,dBottom:h,dLeft:u,dRight:d}=r;i.x-u<0||i.x+d>n[0]||i.y-l<0||i.y+h>n[1]||i.hasText&&i.sprite&&!Ti(i,y,v)&&(Fi(i,y,v),z.push(Object.assign({},i)),++c===s.length&&(c=0,x&&T(s)))}}function T(t){return t.sort((()=>w()-.5))}}(t,e,i),s=[],o=[];for(let e=0;e<t.length;e++)t[e].hasPlaced?o.push(t[e]):s.push(t[e]);return s.forEach((t=>t.visible=!1)),{fillingWords:n,successedWords:o,failedWords:s}}function Ci(t,e){return t&&(f(t)||p(t)||t.startsWith("<svg"))?new Promise(((i,n)=>{var s;const o=e({image:t}),r=null===(s=o.resources)||void 0===s?void 0:s.get(t);r&&"success"===r.state&&r.data?i(r.data):(o.successCallback=()=>{var e;if(o){const s=null===(e=o.resources)||void 0===e?void 0:e.get(t);s&&"success"===s.state&&s.data?i(s.data):n(new Error("image load failed: "+t))}else n(new Error("image load failed: "+t))},o.failCallback=()=>{n(new Error("image load failed: "+t))})})):null}function Pi(t,e){return Promise.allSettled(t.map((t=>Ci(t,e))))}var Oi;function Ai(t){return t}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(Oi||(Oi={})),Object.values(Oi).forEach((t=>{}));const Ei=t=>t<0?-Math.sqrt(-t):Math.sqrt(t),Di=t=>t<0?-t*t:t*t;function Wi(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function Bi(t,e,i){const n=t[0],s=t[1],o=e[0],r=e[1];let a,l;return s<n?(a=Wi(s,n),l=i(r,o)):(a=Wi(n,s),l=i(o,r)),t=>l(a(t))}function Ni(t,e,i){const n=Math.min(t.length,e.length)-1,o=new Array(n),r=new Array(n);let a=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<n;)o[a]=Wi(t[a],t[a+1]),r[a]=i(e[a],e[a+1]);return function(e){const i=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;for(s(n)&&(n=t.length);i<n;){const s=i+n>>>1;L(t[s],e)>0?n=s:i=s+1}return i}(t,e,1,n)-1;return r[i](o[i](e))}}class $i{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:o(this._rangeFactorStart)&&o(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=function(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),n=t[0]-i*e[0];return[n,i+n]}(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):o(this._rangeFactorStart)&&o(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return s(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!s(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return s(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!s(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:n}=this._fishEyeOptions,o=this.range(),r=o[0],a=o[o.length-1],l=Math.min(r,a),h=Math.max(r,a),c=D(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,l,h),u=s(n)?(h-l)*i:n;let d=Math.exp(e);d=d/(d-1)*u;const g=e/u;this._fishEyeTransform=t=>{const e=Math.abs(t-c);if(e>=u)return t;if(e<=1e-6)return c;const i=d*(1-Math.exp(-e*g))/e*.75+.25;return c+(t-c)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}}const qi=Symbol("implicit");class ji extends $i{specified(t){var e;return t?(this._specified=Object.assign(null!==(e=this._specified)&&void 0!==e?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Oi.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=qi}clone(){const t=(new ji).domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return o(this._rangeFactorStart)&&o(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let n=this._index.get(e);if(!n){if(this._unknown!==qi)return this._unknown;n=this._domain.push(t),this._index.set(e,n)}const s=this._ordinalRange[(n-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(s):s}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const t=`${e}`;this._index.has(t)||this._index.set(t,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&null!==(e=this._index.get(`${t}`))&&void 0!==e?e:-1}}const{interpolateRgb:Hi}=yt;function Gi(t,e){const i=typeof e;let n;if(s(e)||"boolean"===i)return()=>e;if("number"===i)return B(t,e);if("string"===i){if(n=pt.parseColorString(e)){const e=Hi(pt.parseColorString(t),n);return t=>e(t).formatRgb()}return B(Number(t),Number(e))}return e instanceof xt?Hi(t,e):e instanceof pt?Hi(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),n=e.valueOf(),s=new Date;return t=>(s.setTime(i*(1-t)+n*t),s)}(t,e):B(Number(t),Number(e))}class Ui extends $i{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ai,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ai;super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Ai,this._piecewise=Bi,this._interpolate=Gi}calculateVisibleDomain(t){var e;return o(this._rangeFactorStart)&&o(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),B)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const n=Array.from(t,I);return this._domain=n,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=N,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,n=i.length,s=this._range.length;let o=Math.min(n,s);if(n&&n<s&&this._forceAlign){const t=s-n+1,e=i[n-1],r=n>=2?(e-i[n-2])/t:0;for(let s=1;s<=t;s++)i[n-2+s]=e-r*(t-s);o=s}return this._autoClamp&&(this._clamp=W(i[0],i[o-1])),this._piecewise=o>2?Ni:Bi,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Ai),this.rescale(i)):this._clamp!==Ai}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(){return[]}tickData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return s(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return s(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const Vi=Math.sqrt(50),Ki=Math.sqrt(10),Yi=Math.sqrt(2),Xi=[1,2,5,10],Zi=(t,e,i)=>{let n=1,s=t;const o=Math.floor((e-1)/2),r=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?s=0:t<0&&t>=-Number.MIN_VALUE?s=-(e-1):!i&&r<1?n=en(r).step:(i||r>1)&&(s=Math.floor(t)-o*n),n>0?(t>0?s=Math.max(s,0):t<0&&(s=Math.min(s,-(e-1)*n)),R(0,e).map((t=>s+t*n))):t>0?Ji(0,-(e-1)/n,n):Ji((e-1)/n,0,n)},Qi=E(((t,e,i,n)=>{let s,o,r,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((s=e<t)&&(o=t,t=e,e=o),a=nn(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),n=Math.round(e/a);for(i*a<t&&++i,n*a>e&&--n,r=new Array(o=n-i+1);++l<o;)r[l]=(i+l)*a}else if(a<0&&(null==n?void 0:n.noDecimals)){a=1;const i=Math.ceil(t),n=Math.floor(e);if(!(i<=n))return[];for(r=new Array(o=n-i+1);++l<o;)r[l]=i+l}else{a=-a;let i=Math.round(t*a),n=Math.round(e*a);for(i/a<t&&++i,n/a>e&&--n,r=new Array(o=n-i+1);++l<o;)r[l]=(i+l)/a}return s&&r.reverse(),r})),Ji=(t,e,i)=>{let n,s,o=-1;if(i>0){let r=Math.floor(t/i),a=Math.ceil(e/i);for((r+1)*i<t&&++r,(a-1)*i>e&&--a,s=new Array(n=a-r+1);++o<n;)s[o]=(r+o)*i}else{i=-i;let r=Math.floor(t*i),a=Math.ceil(e*i);for((r+1)/i<t&&++r,(a-1)/i>e&&--a,s=new Array(n=a-r+1);++o<n;)s[o]=(r+o)/i}return s},tn=E(((t,e,i,n)=>{let s,o,r;if(i=+i,(t=+t)==(e=+e))return Zi(t,i,null==n?void 0:n.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return Zi(t,i,null==n?void 0:n.noDecimals);(s=e<t)&&(r=t,t=e,e=r);const a=nn(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let n=1;const{power:s,gap:r}=a,h=10===r?2*10**s:1*10**s;for(;n<=5&&(o=Ji(t,e,l),o.length>i+1)&&i>2;)l+=h,n+=1;i>2&&o.length<i-1&&(o=((t,e,i)=>{let n;const s=t[0],o=t[t.length-1],r=e-t.length;if(o<=0){const e=[];for(n=r;n>=1;n--)e.push(s-n*i);return e.concat(t)}if(s>=0){for(n=1;n<=r;n++)t.push(o+n*i);return t}let a=[];const l=[];for(n=1;n<=r;n++)n%2==0?a=[s-Math.floor(n/2)*i].concat(a):l.push(o+Math.ceil(n/2)*i);return a.concat(t).concat(l)})(o,i,l))}else(null==n?void 0:n.noDecimals)&&l<0&&(l=1),o=Ji(t,e,l);return s&&o.reverse(),o})),en=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let n=Xi[0];return i>=Vi?n=Xi[3]:i>=Ki?n=Xi[2]:i>=Yi&&(n=Xi[1]),e>=0?{step:n*10**e,gap:n,power:e}:{step:-(10**-e)/n,gap:n,power:e}};function nn(t,e,i){const n=(e-t)/Math.max(0,i);return en(n)}function sn(t,e,i){let n;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(n=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(n))return[];const s=new Array(i);for(let e=0;e<i;e++)s[e]=t+e*n;return s}function on(t){let e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=0,o=t.length-1,r=t[s],a=t[o],l=10;for(a<r&&(i=r,r=a,a=i,i=s,s=o,o=i);l-- >0;){if(i=nn(r,a,n).step,i===e)return t[s]=r,t[o]=a,t;if(i>0)r=Math.floor(r/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;r=Math.ceil(r*i)/i,a=Math.floor(a*i)/i}e=i}}class rn extends Ui{constructor(){super(...arguments),this.type=Oi.Linear}clone(){var t;const e=new rn;return e.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(e._niceType=this._niceType,e._domainValidator=this._domainValidator,e._niceDomain=null===(t=this._niceDomain)||void 0===t?void 0:t.slice()),e}tickFormat(){return()=>{}}d3Ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;const i=this.calculateVisibleDomain(this._range);return Qi(i[0],i[i.length-1],t,e)}ticks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i;if(n(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(o(this._rangeFactorStart)&&o(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const s=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,r=this._domain,a=s[0],l=s[s.length-1];let h=tn(r[0],r[r.length-1],t,e);if(!h.length)return h;if(this._domainValidator)h=h.filter(this._domainValidator);else if((h[0]!==a||h[h.length-1]!==l)&&this._niceType){const t=s.slice();if("all"===this._niceType?(t[0]=h[0],t[t.length-1]=h[h.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&h[0]!==a?(t[0]=h[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&h[h.length-1]!==l&&(t[t.length-1]=h[h.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);h=h.filter((t=>t>=e&&t<=i))}}return h}forceTicks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const e=this.calculateVisibleDomain(this._range);return sn(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let n,s,o=-1;if(i=+i,(s=(e=+e)<(t=+t))&&(n=t,t=e,e=n),!isFinite(i)||e-t<=i)return[t];const r=Math.floor((e-t)/i+1),a=new Array(r);for(;++o<r;)a[o]=t+o*i;return s&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;var i,n;const s=this._domain;let o=[];if(e){const t=function(t,e){const i=d(e.forceMin),n=d(e.forceMax);let s=null;const o=[];let r=null;const a=i&&n?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:n?t=>t<=e.forceMax:null;return i?o[0]=e.forceMin:d(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(o[0]=e.min),n?o[1]=e.forceMax:d(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(o[1]=e.max),d(o[0])&&d(o[1])?(r=t.slice(),r[0]=o[0],r[r.length-1]=o[1]):s=d(o[0])||d(o[1])?d(o[0])?"max":"min":"all",{niceType:s,niceDomain:r,niceMinMax:o,domainValidator:a}}(s,e);if(o=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=on(s.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=o[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(n=o[0])&&void 0!==n?n:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="min";const e=this._domain[this._domain.length-1],i=on(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this._niceType="max";const e=this._domain[0],i=on(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class an extends rn{constructor(){super(Ei,Di),this.type=Oi.Sqrt}clone(){return(new an).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}}const ln={x:"x",y:"y",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle",opacity:"opacity",visible:"visible",isFillingWord:"isFillingWord",color:"color"};const hn=(t,e,i,n)=>{var s,o,r,a;const{colorMode:l,getColor:h,getFillingColor:c}=e,{sameColorList:u}=i;let d,g,f=e.colorList,p=i.fillingColorList;if("ordinal"===l){const e=t.map((t=>h(t)));if(d=t=>(new ji).domain(e).range(f).scale(t),c&&((null===(s=n.colorField)||void 0===s?void 0:s.field)!==(null===(o=n.fillingColorField)||void 0===o?void 0:o.field)||!u)){const e=t.map((t=>c(t)));g=t=>(new ji).domain(e).range(p).scale(t)}}else{1===f.length&&(f=[f[0],f[0]]);const e=(new rn).domain(dn(h,t)).range(f);if(d=t=>e.scale(t),c&&((null===(r=n.colorField)||void 0===r?void 0:r.field)!==(null===(a=n.fillingColorField)||void 0===a?void 0:a.field)||!u)){1===p.length&&(p=[p[0],p[0]]);const e=(new rn).domain(dn(c,t)).range(p);g=t=>e.scale(t)}}Object.assign(e,{colorScale:d,fillingColorScale:g})},cn=(t,e,i)=>{let{fontSizeRange:s}=e;const{getFontSize:o,getText:r}=e;let a;if(o){if(o&&s){const e=(new an).domain(dn(o,t)).range(s);a=t=>e.scale(o(t))}else if(o&&n(o)&&!s){const e=.5,[n,l]=dn(o,t),h=t.map((t=>({text:r(t),value:o(t),weight:l===n?1:(o(t)-n)/(l-n)}))),c=un(h,i,!0);s=[~~(e*c),~~c];const u=(new an).domain(dn(o,t)).range(s);a=t=>u.scale(o(t))}}else{const e=t.map((t=>({text:r(t)}))),n=un(e,i,!1);a="function"==typeof(l=n)?l:function(){return l}}var l;Object.assign(e,{getFontSize:o,fontSizeRange:s,fontSizeScale:a})},un=(t,e,i)=>{const n=e.shapeArea,s=e.ratio,o=e.segmentation.regions,r=Math.ceil(Math.sqrt(n)/12),a=t.reduce(((t,e)=>{const n=Si(e.text);return n<r?t+n*(i?(.5+.5*e.weight)**2:1):t}),0);if(0===a)return 12;let l=20;if(1===o.length)l=Math.sqrt(s*(n/(1.7*a)));else{const t=[];for(let e=0;e<o.length;e++){const i=o[e].area,r=o[e].ratio,l=i/n;if(l<.1)continue;const h=l*(a*(r<1?2.7-r:1.7)),c=Math.sqrt(s*(i/h));t.push(c)}l=t.length?Math.min(...t):Math.sqrt(s*(n/(1.7*a)))}return l};const dn=(t,e)=>{let i=1/0,n=-1/0;const s=e.length;let o;for(let r=0;r<s;++r)o=I(t(e[r])),o<i&&(i=o),o>n&&(n=o);return 1===e.length&&i===n&&(i-=1e4),[i,n]};var gn;function fn(t,e){t.aspectRatio>1?(t.width=e,t.height=~~(e/t.aspectRatio)):(t.height=e,t.width=~~(e*t.aspectRatio))}!function(t){t.BEFORE_IMAGECLOUD_LAYOUT="beforeImagecloudLayout",t.AFTER_IMAGECLOUD_LAYOUT="afterImagecloudLayout",t.AFTER_IMAGECLOUD_DRAW="afterImagecloudDraw"}(gn||(gn={}));class pn{constructor(t){this.progressiveResult=[],this.imageCollageList=[],this.options=t}preProcess(){const{imageConfig:t={},weight:e}=this.options,{padding:i=0}=t;let n=this.imageCollageList;return n.forEach(((t,n)=>{!1===t.valid?(t.x=-10,t.y=-10,t.width=0,t.height=0,t.opacity=0):(t.padding=i,t.weight=K(e)(this.data[n]),t.datum=this.data[n])})),n=n.filter((t=>!1!==t.valid)).sort(((t,e)=>e.weight-t.weight)),n}onImageCollageInputReady(t){t.forEach(((t,e)=>{if("fulfilled"===t.status){const i=t.value,{width:n,height:s}=i;this.imageCollageList.push(Object.assign({},this.data[e],{aspectRatio:n/s}))}else this.imageCollageList.push(Object.assign({},this.data[e],{valid:!1}))}))}layout(t){this.data=t,this.loadSegmentationInput(),this.loadImageCollageInput()}loadSegmentationInput(){var t,e,i,n,s,o;const r=this.options,a=r.size,l={shapeUrl:null!==(t=r.mask)&&void 0!==t?t:{type:"geometric",shape:"rect"},size:a,ratio:r.ratio||.8,tempCanvas:void 0,boardSize:[0,0],random:!1,randomGenerator:void 0,blur:null===(e=r.maskConfig)||void 0===e?void 0:e.edgeBlur},c=this.options.createCanvas({width:a[0],height:a[1]}),u=c.getContext("2d",{willReadFrequently:!0});u.textAlign="center",u.textBaseline="middle",l.tempCanvas=c;const d=a[0]+31>>5<<5;if(l.boardSize=[d,a[1]],l.random?l.randomGenerator=Math.random:l.randomGenerator=H(),this.segmentationInput=l,h(l.shapeUrl)){l.isEmptyPixel=ii(void 0,{threshold:null!==(n=null===(i=r.maskConfig)||void 0===i?void 0:i.threshold)&&void 0!==n?n:200,invert:null===(s=r.maskConfig)||void 0===s?void 0:s.invert},this.options.createCanvas);const t=Ci(l.shapeUrl,this.options.createImage);t?(this.isMaskImageFinished=!1,this.isLayoutFinished=!1,t.then((t=>{var e,i;this.isMaskImageFinished=!0;const n=r.size,s=this.options.createCanvas({width:n[0],height:n[1],dpr:1});l.maskCanvas=s;const o=s.getContext("2d");(null===(e=r.maskConfig)||void 0===e?void 0:e.removeWhiteBorder)&&ui(t,s,l.isEmptyPixel);const a=di(t,n);let h;o.clearRect(0,0,n[0],n[1]),o.drawImage(t,a.x,a.y,a.width,a.height),this.segmentationOutput=ci(this.segmentationInput),"masked"===(null===(i=this.options.layoutConfig)||void 0===i?void 0:i.placement)&&(h=this.generateTransparentMaskCanvas(t,n)),this.segmentationOutput.transparentMaskCanvas=h,this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(s,h)})).catch((t=>{this.isMaskImageFinished=!0}))):(this.isMaskImageFinished=!0,this.isLayoutFinished=!0)}else if(l.shapeUrl&&("text"===l.shapeUrl.type||"geometric"===l.shapeUrl.type)){l.isEmptyPixel=ii(l.shapeUrl.backgroundColor,void 0,this.options.createCanvas),"text"!==l.shapeUrl.type&&"geometric"!==l.shapeUrl.type||l.shapeUrl.backgroundColor||(l.shapeUrl.backgroundColor="rgba(255,255,255,255)");const t=ni(l.shapeUrl,a[0],a[1],void 0,null===(o=r.maskConfig)||void 0===o?void 0:o.invert,this.options.createCanvas);l.maskCanvas=t,this.segmentationOutput=ci(this.segmentationInput),this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(t,t),this.isMaskImageFinished=!0}}loadImageCollageInput(){const t=Pi(this.data.map((t=>K(this.options.image)(t))),this.options.createImage);t?t.then((t=>{this.onImageCollageInputReady(t),this.isImagesFinished=!0})).catch((t=>{this.isImagesFinished=!0,this.isLayoutFinished=!0,A.getInstance().error("image load failed",t)})):(this.isImagesFinished=!0,this.isLayoutFinished=!0)}canAnimate(){return!0}unfinished(){return!this.isLayoutFinished}output(){return this.progressiveResult}progressiveRun(){if(this.isImagesFinished&&this.isMaskImageFinished&&!this.isLayoutFinished){const t=this.preProcess(),e=this.doLayout(t);this.options&&this.options.onLayoutEnd&&this.options.onLayoutEnd(e),this.progressiveResult=this.processOutput(e),this.isLayoutFinished=!0}}progressiveOutput(){return this.progressiveResult}release(){this.segmentationInput=null,this.data=null,this.progressiveResult=null,this.options=null}calculateImageSize(t,e={},i=.45){const{imageSizeRange:s,padding:o=0}=e,r=d(e.imageSize)?e.imageSize:V(e.imageSize),a=this.options.size;if(r||s)if(r&&!n(r))t.forEach((t=>fn(t,r)));else if(s){const e=(new an).domain(Z(t,(t=>t.weight))).range(s);t.forEach((t=>fn(t,~~e.scale(t.weight))))}else if(r&&n(r)&&!s){const e=.5,[n,s]=Z(t,(t=>t.weight)),r=t.reduce(((t,i)=>{const o=i.aspectRatio,r=(i.weight-n)/(s-n);return t+(o>1?1/o:o)*(e+(1-e)*r)**2}),0),l=~~Math.sqrt(i*a[0]*a[1]/r),h=[~~(e*l)-2*o<0?1:~~(e*l)-2*o,~~l-2*o<0?1:~~l-2*o],c=(new an).domain(Z(t,(t=>t.weight))).range(h);t.forEach((t=>fn(t,~~c.scale(t.weight))))}else console.warn("image cloud imageSize error");else{const e=t.reduce(((t,e)=>{const i=e.aspectRatio;return t+(i>1?1/i:i)}),0);let n=~~Math.sqrt(i*a[0]*a[1]/e);n=n-2*o<0?1:n-2*o,t.forEach((t=>fn(t,n)))}return t}generateTransparentMaskCanvas(t,e){var i;const n=this.options.createCanvas({width:e[0],height:e[1],dpr:1}),s=n.getContext("2d");this.segmentationOutput.transparentMaskCanvas=n,(null===(i=this.options.maskConfig)||void 0===i?void 0:i.removeWhiteBorder)&&ui(t,n,this.segmentationInput.isEmptyPixel);const o=s.createImageData(e[0],e[1]),r=this.segmentationOutput.segmentation.labels;for(let t=0;t<r.length;t++){const e=0===r[t]?255:0,i=255*r[t],n=4*t;o.data[n]=e,o.data[n+1]=e,o.data[n+2]=e,o.data[n+3]=i}return s.clearRect(0,0,e[0],e[1]),s.fillStyle="rgba(255,255,255,0)",s.fillRect(0,0,e[0],e[1]),s.putImageData(o,0,0),n}processOutput(t){var e;const i=null===(e=this.options)||void 0===e?void 0:e.as;return i&&Object.keys(i).forEach((e=>{t.forEach((t=>{t[i[e]]=t[e],delete t[e]}))})),t}}class xn extends pn{preProcess(){const t=super.preProcess(),{imageConfig:e={},ratio:i=.45}=this.options;return this.calculateImageSize(t,e,i)}tryPlaceImage(t,e,i,n,s,o=1){const[r,a]=e,l=r/2,h=a/2,c=Math.sqrt(l**2+h**2),u=Ke[i](e);let d,g,f=-o;const{segmentation:p}=n,{labels:x}=p;for(;([d,g]=u(f+=o))&&!(Math.min(Math.abs(d),Math.abs(g))>=c);)if(d-=t.width/2,g-=t.height/2,t.visible=!0,t.x=~~(l+d),t.y=~~(h+g),t._left=t.x+t.padding,t._top=t.y+t.padding,t._leftWithoutPadding=t.x,t._topWithoutPadding=t.y,yn(t,s)){const{x:e,y:i,width:n,height:s}=t;let o=!1;for(let t=0;t<n;t++){for(let n=0;n<s&&i+t<=a;n++){if(e+n>r)continue;if(!!!x[(i+t)*r+(e+n)]){o=!0;break}}if(o)break}if(!o){const e=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x,y:t.y+t.height},{x:t.x+t.width,y:t.y+t.height}];let i=!0;for(const t of e)if(!x[t.y*r+t.x]){i=!1;break}if(!i)continue;return!0}}return!1}doLayout(t){var e;const{segmentationOutput:i}=this,{layoutConfig:n={}}=this.options,s=this.options.size,{spiralType:o="archimedean",fillingTimes:r=4,minFillingImageSize:a=10}=n,l=[],h=Object.keys(t[0]).find((t=>t.includes("VGRAMMAR")));for(const e of t)e._widthWithPadding=e.width+2*e.padding,e._heightWithPadding=e.height+2*e.padding,e.frequency=1,this.tryPlaceImage(e,s,o,i,l)&&l.push(e);const c=F(l,((t,e)=>t.width-e.width)).width,u=F(l,((t,e)=>t.height-e.height)).height,d=[];for(let n=0;n<r;n++){const r=.5*c-1*n,g=.5*u-1*n;for(const n of t){const t=Object.assign({},n,{visible:!0});fn(t,Math.max(a,t.aspectRatio>1?r:g)),t._widthWithPadding=t.width+2*t.padding,t._heightWithPadding=t.height+2*t.padding,this.tryPlaceImage(t,s,o,i,[...d,...l],.5)&&(n._tempFrequency=(null!==(e=n._tempFrequency)&&void 0!==e?e:n.frequency)+1,t.frequency=n._tempFrequency,t.distance=Math.sqrt(Math.pow(t.x-s[0]/2,2)+Math.pow(t.y-s[1]/2,2)),t[h]=`${t[h]}_${t.frequency}`,d.push(t))}}return[...l,...d].filter((t=>t.visible))}}function yn(t,e){for(let i=0;i<e.length;i++)if(mn(t,e[i]))return!1;return!0}function mn(t,e){return!(t._leftWithoutPadding+t._widthWithPadding<e._leftWithoutPadding||t._topWithoutPadding+t._heightWithPadding<e._topWithoutPadding||t._leftWithoutPadding>e._leftWithoutPadding+e._widthWithPadding||t._topWithoutPadding>e._topWithoutPadding+e._heightWithPadding)}function vn(t){const{imageConfig:e={},size:i,ratio:n=.1,layoutConfig:s={}}=t,{padding:o=0,imageSize:r}=e,[a,l]=i;let h;h=r||Math.min(a,l)*n-2*o,h<0&&(h=1);const{rectAspectRatio:c=1}=s;let u,d;c>1?(u=h,d=h/c):(d=h,u=h*c);const g=Math.ceil(l/(d+o)),f=Math.ceil(a/(u+o)),p=a/2,x=l/2,y=new Array(f*g);for(let t=0;t<g;t++)for(let e=0;e<f;e++){const i=e*(u+o)+u/2,n=t*(d+o)+d/2;y[t*f+e]={centerX:i,centerY:n,x:i-u/2,y:n-d/2,row:t,col:e,distance:Math.sqrt(Math.pow(i-p,2)+Math.pow(n-x,2))}}const m=Object.assign({},s,{cellWidth:u,cellHeight:d,cellInfo:y,cellCount:y.length,cellType:"rect",cellPixelCount:u*d,eachPixel:(t,e)=>{const{x:i,y:n}=t;for(let t=0;t<u;t++)for(let s=0;s<d&&n+t<=l;s++)i+s>a||e((~~n+t)*a+(~~i+s))},clipPath:`M${-u/2} ${-d/2} L${u/2} ${-d/2} L${u/2} ${d/2} L${-u/2} ${d/2} Z`});return{context:m,imageLength:h}}const Mn={rect:vn,circle:function(t){const{imageConfig:e={},size:i,ratio:n=.1,layoutConfig:s={}}=t,{padding:o=0,imageSize:r=0}=e,[a,l]=i,h=a/2,c=l/2;let u=0;u=r?r/2:Math.min(a,l)*n/2,u-o<=0&&(u=o+1);const d=2*u,g=Math.sqrt(3)/2*d+o,f=[];let p=0;for(let t=0;t*g-u<l;t++){const e=t*g,i=t%2==0?0:u;for(let n=-1;n*(d+o)+i-u<a;n++){const s=n*(d+o)+i+u;f[p++]={centerX:s,centerY:e,x:s-u,y:e-u,row:t,col:n,distance:Math.sqrt(Math.pow(s-h,2)+Math.pow(e-c,2))}}}let x=0;const y=u*u;for(let t=0;t<d;t++)for(let e=0;e<d;e++){const i=t-u,n=e-u;i*i+n*n<=y&&x++}const m=Object.assign({},s,{cellWidth:d,cellHeight:d,cellInfo:f,cellCount:f.length,cellType:"circle",cellPixelCount:x,eachPixel:(t,e)=>{const{x:i,y:n}=t;for(let t=0;t<d;t++)for(let s=0;s<d;s++){if(t+i<0||t+i>a||s+n>l||s+n<0)continue;const o=t-u,r=s-u;o*o+r*r<=y&&e((~~n+t)*a+(~~i+s))}},clipPath:"M 1 0 A 1 1 0 1 0 -1 0 A 1 1 0 1 0 1 0 Z"});return{context:m,imageLength:d}},hexagonal:function(t){const{imageConfig:e={},size:i,ratio:n=.1,layoutConfig:s={}}=t,{padding:o=0,imageSize:r}=e,[a,l]=i,h=a/2,c=l/2;let u;u=r?r/2:Math.min(a,l)*n/2,u-o<=0&&(u=o+1);const d=[],g=2*Math.PI/6;for(let t=0;t<6;t++){const e=g*t;d.push({x:(u-o/2)*Math.cos(e),y:(u-o/2)*Math.sin(e)})}const f=2*u,p=Math.sin(Math.PI/6)*f,x=Math.sqrt(3)*p,y=f-p/2,m=Math.cos(Math.PI/6)*f,v=m/2,M=Math.floor(l/x),_=Math.floor(a/p),w=[];for(let t=-1;t<=M+1;t++)for(let e=-1;e<=_;e++){const i=e*y,n=t*m+(e%2?v:0);w.push({centerX:i,centerY:n,x:i-p,y:n-p,row:t,col:e,distance:Math.sqrt(Math.pow(i-h,2)+Math.pow(n-c,2))})}let b=0;const S=[];for(let t=0;t<=x;t++)for(let e=0;e<=2*p;e++){const i=e-p,n=t-x/2,s=Math.abs(i),o=Math.abs(n);s<=p&&o<=x/2&&2*o+s*Math.sqrt(3)<=x?(b++,S.push(!0)):S.push(!1)}const k=Object.assign({},s,{cellHexSideLength:p,cellHexPoints:d,cellHeight:x,cellWidth:2*p,cellInfo:w,cellCount:w.length,cellType:"hexagonal",cellPixelCount:b,eachPixel:(t,e)=>{const{x:i,y:n}=t;let s=0;for(let t=0;t<=x;t++)for(let o=0;o<=2*p;o++)S[s++]&&e((~~n+t)*a+(~~i+o))},clipPath:"M 1 0 L 0.5 0.866 L -0.5 0.866 L -1 0 L -0.5 -0.866 L 0.5 -0.866 Z"});return{context:k,imageLength:f-o}}};class _n extends pn{preProcess(){var t;const e=super.preProcess(),{layoutConfig:i={}}=this.options,{cellType:n="rect"}=i,s=(null!==(t=Mn[n])&&void 0!==t?t:Mn.rect)(this.options),{context:o,imageLength:r}=s;return e.forEach((t=>function(t,e){t.aspectRatio>1?(t.height=e,t.width=~~(e*t.aspectRatio)):(t.width=e,t.height=~~(e/t.aspectRatio))}(t,r))),o.cellInfo.sort(((t,e)=>t.distance-e.distance)),this.layoutContext=o,e}doLayout(t){const{cellWidth:e,cellHeight:i,cellInfo:n,cellCount:s,clipPath:o,eachPixel:r,cellPixelCount:a}=this.layoutContext;if(0===t.length||0===s||0===e||0===i||0===n.length)return void(this.isLayoutFinished=!0);const{segmentationOutput:l}=this,{layoutConfig:h={}}=this.options,{placement:c="default"}=h;if("edge"===c||"default"===c){const{segmentation:t}=l,{labels:e}=t;n.forEach((t=>{let i=0;r(t,(t=>{e[t]&&i++})),t.intersectPixels=i}))}const u=t.length,d=t=>{const{intersectPixels:e}=t;return"default"===c?e>=.45*a:"edge"!==c||e>.1*a&&e<a};for(let e=0;e<u;e++){const i=t[e],s=n[e];s&&(i.x=s.centerX-i.width/2,i.y=s.centerY-i.height/2,i.clipConfig={shape:o},i.frequency=1,i.visible=d(s),i.cell=k(s,["image"]),i.distance=s.distance,s.image=i)}const g=Object.keys(t[0]).find((t=>t.includes("VGRAMMAR")));if(u<s)for(let e=u;e<s;e++){const i=t[e-u],s=n[e];if(s){const e=Object.assign({},i);e.x=s.centerX-e.width/2,e.y=s.centerY-e.height/2,e.frequency+=1,e[g]=`${e[g]}_${e.frequency}`,e.visible=d(s),e.distance=s.distance,e.cell=k(s,["image"]),s.image=e,t.push(e)}}return t.filter((t=>t.visible))}}class wn extends pn{preProcess(){const t=super.preProcess(),{imageConfig:e={},ratio:i=.1}=this.options,n=vn;return this.layoutContext=n(Object.assign({},this.options,{imageConfig:{imageSize:null}})).context,this.layoutContext.cellInfo.sort(((t,e)=>t.distance-e.distance)),this.calculateImageSize(t,e,i)}doLayout(t){const{segmentationOutput:e}=this,{cellWidth:i,cellHeight:n,cellInfo:s,cellCount:o,eachPixel:r,cellPixelCount:a}=this.layoutContext;if(0===t.length||0===o||0===i||0===n||0===s.length)return void(this.isLayoutFinished=!0);const{layoutConfig:l={}}=this.options,h=this.options.size,{placement:c="default",maxAngle:u=Math.PI/180*45}=l;if("edge"===c||"default"===c){const{segmentation:t}=e,{labels:i}=t;s.forEach((t=>{let e=0;r(t,(t=>{i[t]&&e++})),t.intersectPixels=e}))}const d=t.length,g=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2)),f=t=>{const{intersectPixels:e}=t;return"default"===c?e>.5*a:"edge"!==c||e>.1*a&&e<a};for(let e=0;e<d;e++){const i=t[e],n=s[e];n&&(i.x=n.centerX-i.width/2,i.y=n.centerY-i.height/2,i.visible=f(n),i.cell=`${n.row}_${n.col}`,i.angle=Math.random()*(2*u)-u,i.anchor=[i.x+i.width/2,i.y+i.height/2],i.zIndex=g-n.distance,i.distance=n.distance,i.frequency=1,n.image=i)}const p=Object.keys(t[0]).find((t=>t.includes("VGRAMMAR")));if(d<o)for(let e=d;e<o;e++){const i=t[e-d],n=s[e];if(n){const e=Object.assign({},i);e.x=n.centerX-e.width/2,e.y=n.centerY-e.height/2,e.anchor=[e.x+e.width/2,e.y+e.height/2],e.angle=Math.random()*(2*u)-u,e.frequency+=1,e[p]=`${e[p]}_${e.frequency}`,e.visible=f(n),e.cell=`${n.row}_${n.col}`,e.distance=n.distance,e.zIndex=g-n.distance,n.image=e,t.push(e)}}return t.filter((t=>t.visible))}}t.CirclePackingLayout=Zt,t.ImageCloudGridLayout=_n,t.ImageCloudSpiralLayout=xn,t.ImageCloudStackLayout=wn,t.SankeyLayout=re,t.SunburstLayout=ue,t.TreeLayout=we,t.TreemapLayout=ze,t.WordcloudCloudLayout=Xe,t.WordcloudFastLayout=fi,t.WordcloudGridLayout=gi,t.calculateNodeValue=Ct,t.circlePackingTransform=(t,e)=>{const i=new Zt(t).layout(e,"width"in t?{width:t.width,height:t.height}:{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1});if(t.flatten){const e=[];return At(i,e,{maxDepth:null==t?void 0:t.maxDepth}),e}return i},t.drawCardioid=li,t.drawRegularPolygon=ai,t.eachAfter=Ot,t.eachBefore=Pt,t.flattenNodes=At,t.flattenTreeLinks=de,t.formatLinkPath=(t,e=!0)=>{var i;return!s(null===(i=null==t?void 0:t[0])||void 0===i?void 0:i.vertical)?t.map((t=>{const i=t.thickness/2;let n=t.y0,s=t.y1,o=(n+s)/2,r=t.x0-i,a=t.x0+i,l=t.x1-i,h=t.x1+i;return e&&(n=Math.round(n),s=Math.round(s),o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l),h=Math.round(h)),Object.assign({},t,{path:`\n            M${r},${n}\n            C${r},${o},${l},${o},${l},${s}\n            L${h},${s}\n            C${h},${o},${a},${o},${a},${n}\n            Z\n            `})})):t.map((t=>{const i=t.thickness/2;let n=t.x0,s=t.x1,o=(n+s)/2,r=t.y0-i,a=t.y0+i,l=t.y1-i,h=t.y1+i;return e&&(n=Math.round(n),s=Math.round(s),o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l),h=Math.round(h)),Object.assign({},t,{path:`\n          M${n},${r}\n          C${o},${r},${o},${l},${s},${l}\n          L${s},${h}\n          C${o},${h},${o},${a},${n},${a}\n          Z`})}))},t.formatLinkPolygon=t=>{var e;return!s(null===(e=null==t?void 0:t[0])||void 0===e?void 0:e.vertical)?t.map((t=>{const e=t.thickness/2,i=[{x:t.x0-e,y:t.y0},{x:t.x1-e,y:t.y1},{x:t.x1+e,y:t.y1},{x:t.x0+e,y:t.y0}];return Object.assign({},t,{points:i})})):t.map((t=>{const e=t.thickness/2,i=[{x:t.x0,y:t.y0-e},{x:t.x1,y:t.y1-e},{x:t.x1,y:t.y1+e},{x:t.x0,y:t.y0+e}];return Object.assign({},t,{points:i})}))},t.formatNodeRect=t=>t.map((t=>Object.assign({},t,{x:t.x0,y:t.y0,width:t.x1-t.x0,height:t.y1-t.y0}))),t.generateCardioidPoints=ri,t.generateIsEmptyPixel=ii,t.generateMaskCanvas=ni,t.generatePoints=oi,t.getAlignEndTexts=(t,e=0)=>ae(t[0])?t.map((t=>({y:t.y1-e,x:(t.x0+t.x1)/2,datum:t.datum,key:t.key}))):t.map((t=>({x:t.x0-e,y:(t.y0+t.y1)/2,datum:t.datum,key:t.key}))),t.getAlignStartTexts=(t,e=0)=>ae(t[0])?t.map((t=>({y:t.y1,x:(t.x0+t.x1)/2,datum:t.datum,key:t.key}))):t.map((t=>({x:t.x1,y:(t.y0+t.y1)/2,datum:t.datum,key:t.key}))),t.getArcsFromCircles=De,t.getArcsFromPath=t=>{const e=[],i=t.split("A"),n=i[0];let s=n.indexOf(",");for(e.push({p1:{x:+n.slice(1,s),y:+n.slice(s+1)}}),s=1;s<i.length;s++){const t=i[s].split(",");e[s-1].radius=+t[0];const n=+t[2].slice(2),o=+t[3].split(" ")[0];e[s-1].p2={x:n,y:o},e[s-1].largeArcFlag="1"===t[1][t[1].length-1],s<i.length-1&&e.push({p1:{x:n,y:o}})}return e},t.getBoundsOfNodes=t=>{let e=1/0,i=-1/0,n=1/0,s=-1/0;return t.forEach((t=>{e=Math.min(t.x0,e),i=Math.max(t.x1,i),n=Math.min(t.y0,n),s=Math.max(t.y1,s)})),{x0:e,x1:i,y0:n,y1:s,width:i-e,height:s-n}},t.getCirclesFromArcs=t=>{var e;return null!==(e=null==t?void 0:t.map((t=>{const{p1:e,p2:i,radius:n,largeArcFlag:s,setId:o}=t,{x:r,y:a}=e,{x:l,y:h}=i,c=((l-r)**2+(h-a)**2)**.5,u=(r+l)/2,d=(a+h)/2,g=(n**2-(c/2)**2)**.5;let f=u+g*(h-a)/c,p=d-g*(l-r)/c;var x,y;return((x=[l-r,h-a])[0]*(y=[f-r,p-a])[1]-x[1]*y[0]>0||s)&&(f=u-g*(h-a)/c,p=d+g*(l-r)/c),{x:f,y:p,radius:n,setId:o}})))&&void 0!==e?e:[]},t.getMaxRadiusAndCenter=je,t.getPathFromArcs=We,t.getShapeFunction=He,t.imagecloudTransform=(t,e,i)=>{var o,r;const a=n(t.size)?t.size():t.size;if(t.size=a,!a||s(a[0])||s(a[1])||a[0]<=0||a[1]<=0){return A.getInstance().info("Wordcloud size dimensions must be greater than 0"),[]}if(t.size=[Math.ceil(a[0]),Math.ceil(a[1])],t.image||A.getInstance().error("Imagecloud: image source must be specified."),t.onBeforeLayout&&t.onBeforeLayout(),!e||0===e.length)return[];let l;switch(null!==(r=null===(o=t.layoutConfig)||void 0===o?void 0:o.layoutMode)&&void 0!==r?r:"spiral"){case"grid":l=_n;break;case"stack":l=wn;break;default:l=xn}const h=new l(t);return h.layout(e),h.unfinished()?{progressive:h}:h.output()},t.loadImage=Ci,t.loadImages=Pi,t.removeBorder=ui,t.sankeyTransform=le,t.scaleAndMiddleShape=di,t.segmentation=ci,t.shapes=$e,t.spirals=Ke,t.sunburstTransform=(t,e)=>{const i=new ue(t).layout(e,"width"in t?{width:t.width,height:t.height}:{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1});if(t.flatten){const e=[];return At(i,e,{maxDepth:null==t?void 0:t.maxDepth}),e}return i},t.treeTransform=(t,e)=>{const i=new we(t).layout(e,"width"in t?{width:t.width,height:t.height}:{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1});if(t.flatten){const{maxDepth:e}=null!=t?t:{},n=[];At(i,n,{maxDepth:e});const s=[];return de(i,s,{maxDepth:e}),{nodes:n,links:s}}return i},t.treemapTransform=(t,e)=>{const i=new ze(t).layout(e,"width"in t?{width:t.width,height:t.height}:{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1});if(t.flatten){const e=[];return At(i,e,{maxDepth:null==t?void 0:t.maxDepth}),e}return i},t.vennMarkTransform=Ne,t.vennTransform=Be,t.wordcloudShapeTransform=(t,e,i)=>{if(!t.size||s(t.size[0])||s(t.size[1])||t.size[0]<=0||t.size[1]<=0){return A.getInstance().info("Wordcloud size dimensions must be greater than 0"),[]}if(t.size=[Math.ceil(t.size[0]),Math.ceil(t.size[1])],t.shape||A.getInstance().error("WordcloudShape shape must be specified."),t.text||A.getInstance().error("WordcloudShape text must be specified."),t.onBeforeLayout&&t.onBeforeLayout(),!e||0===e.length)return[];const n=new class{constructor(t){this.progressiveResult=[],this.options=t}layout(t){this.data=t;const e=this.options,i={shapeUrl:e.shape,size:e.size,ratio:e.ratio||.8,tempCanvas:void 0,boardSize:[0,0],random:!1,randomGenerator:void 0},n=this.options.createCanvas({width:e.size[0],height:e.size[1]}),s=n.getContext("2d",{willReadFrequently:!0});s.textAlign="center",s.textBaseline="middle",i.tempCanvas=n;const o=e.size[0]+31>>5<<5;if(i.boardSize=[o,e.size[1]],i.random?i.randomGenerator=Math.random:i.randomGenerator=H(),this.segmentationInput=i,h(i.shapeUrl)){i.isEmptyPixel=ii(void 0,void 0,this.options.createCanvas);const t=Ci(i.shapeUrl,this.options.createImage);t?(this.isImageFinished=!1,this.isLayoutFinished=!1,t.then((t=>{this.isImageFinished=!0;const n=this.options.createCanvas({width:e.size[0],height:e.size[1],dpr:1});i.maskCanvas=n;const s=n.getContext("2d");e.removeWhiteBorder&&ui(t,n,i.isEmptyPixel);const o=di(t,e.size);s.clearRect(0,0,e.size[0],e.size[1]),s.drawImage(t,o.x,o.y,o.width,o.height),this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(i.maskCanvas)})).catch((t=>{this.isImageFinished=!0}))):(this.isImageFinished=!0,this.isLayoutFinished=!0)}else if(i.shapeUrl&&("text"===i.shapeUrl.type||"geometric"===i.shapeUrl.type)){i.isEmptyPixel=ii(i.shapeUrl.backgroundColor,void 0,this.options.createCanvas);const t=ni(i.shapeUrl,e.size[0],e.size[1],void 0,!1,this.options.createCanvas);i.maskCanvas=t,this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(t),this.doLayout(),this.isImageFinished=!0,this.isLayoutFinished=!0}}canAnimate(){return!0}unfinished(){return!this.isLayoutFinished}output(){return this.progressiveResult}progressiveRun(){this.isImageFinished&&!this.isLayoutFinished&&(this.segmentationInput.maskCanvas&&this.doLayout(),this.isLayoutFinished=!0)}progressiveOutput(){return this.progressiveResult}doLayout(){var t,e,i,n,s,o,r,a,l,h,c,u,d,g,f,p,x,y,m,v,M;const _=this.segmentationInput,w=ci(_);if(!w.segmentation.regions.length)return;const b=this.options,S=this.data,k=b.colorMode||"ordinal",z={getText:K(b.text),getFontSize:K(b.fontSize),fontSizeRange:b.fontSizeRange,colorMode:k,getColor:b.colorField?K(b.colorField):K(b.text),getFillingColor:K(b.fillingColorField),colorList:b.colorList||("ordinal"===k?["#2E62F1"]:["#537EF5","#2E62F1","#2358D8","#184FBF","#0C45A6","#013B8E"]),getColorHex:K(b.colorHexField),getFontFamily:K(b.fontFamily||"sans-serif"),rotateList:b.rotateList||[0],getPadding:K(b.padding||1),getFontStyle:K(b.fontStyle||"normal"),getFontWeight:K(b.fontWeight||"normal"),getFontOpacity:b.fontOpacity?K(b.fontOpacity):()=>1};cn(S,z,w);const F={size:b.size,ratio:b.ratio||.8,shapeUrl:b.shape,random:void 0===b.random||b.random,textLayoutTimes:null!==(t=b.textLayoutTimes)&&void 0!==t?t:3,removeWhiteBorder:b.removeWhiteBorder,layoutMode:null!==(e=b.layoutMode)&&void 0!==e?e:"default",fontSizeShrinkFactor:null!==(i=b.fontSizeShrinkFactor)&&void 0!==i?i:.8,stepFactor:null!==(n=b.stepFactor)&&void 0!==n?n:1,importantWordCount:null!==(s=b.importantWordCount)&&void 0!==s?s:10,globalShinkLimit:b.globalShinkLimit||.2,fontSizeEnlargeFactor:null!==(o=b.fontSizeEnlargeFactor)&&void 0!==o?o:1.5,fillingRatio:null!==(r=b.fillingRatio)&&void 0!==r?r:.7,fillingTimes:null!==(a=b.fillingTimes)&&void 0!==a?a:4,fillingXStep:b.fillingXRatioStep?Math.max(Math.floor(b.size[0]*b.fillingXRatioStep),1):null!==(l=b.fillingXStep)&&void 0!==l?l:4,fillingYStep:b.fillingYRatioStep?Math.max(Math.floor(b.size[1]*b.fillingYRatioStep),1):null!==(h=b.fillingYStep)&&void 0!==h?h:4,fillingInitialFontSize:b.fillingInitialFontSize,fillingDeltaFontSize:b.fillingDeltaFontSize,fillingInitialOpacity:null!==(c=b.fillingInitialOpacity)&&void 0!==c?c:.8,fillingDeltaOpacity:null!==(u=b.fillingDeltaOpacity)&&void 0!==u?u:.05,getFillingFontFamily:K(b.fillingFontFamily||"sans-serif"),getFillingFontStyle:K(b.fillingFontStyle||"normal"),getFillingFontWeight:K(b.fillingFontWeight||"normal"),getFillingPadding:K(null!==(d=b.fillingPadding)&&void 0!==d?d:.4),fillingRotateList:null!==(g=b.fillingRotateList)&&void 0!==g?g:[0,90],fillingDeltaFontSizeFactor:null!==(f=b.fillingDeltaFontSizeFactor)&&void 0!==f?f:.2,fillingColorList:b.fillingColorList||["#537EF5"],sameColorList:!1,minInitFontSize:null!==(p=b.minInitFontSize)&&void 0!==p?p:10,minFontSize:null!==(x=b.minFontSize)&&void 0!==x?x:4,minFillFontSize:null!==(y=b.minFillFontSize)&&void 0!==y?y:2},T=((t,e)=>{if(1===e.length&&"#537EF5"===e[0])return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0})(z.colorList,F.fillingColorList);F.sameColorList=T,hn(S,z,F,b),function(t,e,i,n){const{getText:s}=e;let{fillingInitialFontSize:o,fillingDeltaFontSize:r}=i;const{fillingRatio:a}=i,l=Math.ceil(Math.sqrt(n.shapeArea)/4);if(!o||!r){const e=a/100,h=t.reduce(((t,e)=>{const i=Si(s(e));return i>l?t:t+i}),0)/t.length;let c;if(0===h)c=8;else{const t=.2*n.shapeArea;c=Math.sqrt(e*(t/h))}o=~~c,r=c*i.fillingDeltaFontSizeFactor,Object.assign(i,{fillingInitialFontSize:o,fillingDeltaFontSize:r})}}(S,z,F,w);const{getText:R,getFontFamily:L,getFontStyle:I,getFontWeight:C,getPadding:P,getColor:O,getFillingColor:A,getColorHex:E,fontSizeScale:D,colorScale:W,fillingColorScale:B,getFontOpacity:N,rotateList:$}=z,q=S.map((t=>{var e,i;return{x:0,y:0,weight:0,text:R(t),fontFamily:L(t),fontWeight:C(t),fontStyle:I(t),rotate:$[~~(_.randomGenerator()*$.length)],fontSize:Math.max(F.minInitFontSize,~~D(t)),opacity:N(t),padding:P(t),color:E&&E(t)||W&&W(O(t))||"black",fillingColor:!A||(null===(e=b.colorField)||void 0===e?void 0:e.field)===(null===(i=b.fillingColorField)||void 0===i?void 0:i.field)&&T?void 0:E&&E(t)||B&&B(A(t))||"black",datum:t,visible:!0,hasPlaced:!1}})),j=((t,e)=>{var i;if(0===t.length)return;let n=t[0];for(let s=1;s<t.length;s++){const o=t[s];(null!==(i=null==e?void 0:e(o,n))&&void 0!==i?i:o-n)>0&&(n=o)}return n})(q.map((t=>t.fontSize)));q.forEach((t=>t.weight=t.fontSize/j)),q.sort(((t,e)=>e.weight-t.weight));const{fillingWords:H,successedWords:G,failedWords:U}=Ii(q,F,w),V=null!==(v=null===(m=b.text)||void 0===m?void 0:m.field)&&void 0!==v?v:"textKey",Y=null!==(M=b.dataIndexKey)&&void 0!==M?M:"defaultDataIndexKey",X=b.as?Object.assign(Object.assign({},ln),b.as):ln;let Z,Q;const J=[];for(let t=0;t<q.length;++t)Z=q[t],Q=Z.datum,Q[X.x]=Z.x,Q[X.y]=Z.y,Q[X.fontFamily]=Z.fontFamily,Q[X.fontSize]=Z.fontSize,Q[X.fontStyle]=Z.fontStyle,Q[X.fontWeight]=Z.fontWeight,Q[X.angle]=nt(Z.rotate),Q[X.opacity]=Z.opacity,Q[X.visible]=Z.visible,Q[X.isFillingWord]=!1,Q[X.color]=Z.color,Q[Y]=`${Z.text}_${t}_keyword`,J.push(Q);const tt=[];H.forEach(((t,e)=>{var i,n;const s=Object.assign({},t.datum);s[X.x]=t.x,s[X.y]=t.y,s[X.fontFamily]=t.fontFamily,s[X.fontSize]=t.fontSize,s[X.fontStyle]=t.fontStyle,s[X.fontWeight]=t.fontWeight,s[X.angle]=nt(t.rotate),s[X.opacity]=t.opacity,s[X.visible]=t.visible,s[X.isFillingWord]=!0,s[X.color]=A?(null===(i=b.colorField)||void 0===i?void 0:i.field)===(null===(n=b.fillingColorField)||void 0===n?void 0:n.field)&&T?t.color:t.fillingColor:F.fillingColorList[~~(_.randomGenerator()*F.fillingColorList.length)],s[V]=t.text,s[Y]=`${t.text}_${e}_fillingWords`,tt.push(s)})),this.options.onLayoutFinished&&this.options.onLayoutFinished({successedWords:G,failedWords:U}),this.progressiveResult=J.concat(tt)}release(){this.segmentationInput=null,this.data=null,this.progressiveResult=null,this.options=null}}(t);return n.layout(e),n.unfinished()?{progressive:n}:n.output()},t.wordcloudTransform=(t,e)=>{var i,n,s,o,r,a;if(t.size&&(t.size[0]<=0||t.size[1]<=0)){return A.getInstance().info("Wordcloud size dimensions must be greater than 0"),[]}const l=e,h=(null!==(i=t.size)&&void 0!==i?i:[500,500]).slice();h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]);const c=t.fontFamily?yi(t.fontFamily):"sans-serif",u=t.fontStyle?yi(t.fontStyle):"normal",g=t.fontWeight?yi(t.fontWeight):"normal",f=t.rotate?yi(t.rotate):0,p=yi(t.text),x=null!==(n=t.spiral)&&void 0!==n?n:"archimedean",y=t.padding?yi(t.padding):1,m=null!==(s=t.shape)&&void 0!==s?s:"square",v=null!==(o=t.shrink)&&void 0!==o&&o,M=null!==(r=t.enlarge)&&void 0!==r&&r,_=null!==(a=t.clip)&&void 0!==a&&a,w=t.minFontSize,b=t.randomVisible,S=t.as?Object.assign(Object.assign({},xi),t.as):xi,k=t.depth_3d,z=t.postProjection;let F=t.fontSize?yi(t.fontSize):14;const T=t.fontSizeRange;if(T&&!d(F)){const t=F,e=vi(Mi(t,l),T);F=i=>e(t(i))}let R=Xe;"fast"===t.layoutType?R=fi:"grid"===t.layoutType&&(R=gi);const L=new R(Object.assign(Object.assign({},t),{text:p,padding:y,spiral:x,shape:m,rotate:f,fontFamily:c,fontStyle:u,fontWeight:g,fontSize:F,shrink:v,clip:_,enlarge:M,minFontSize:w,random:b,outputCallback:e=>{const i=[];let n,s;for(let o=0,r=e.length;o<r;o++)s=e[o],n=s.datum,n[S.x]=s.x,n[S.y]=s.y,n[S.fontFamily]=s.fontFamily,n[S.fontSize]=s.fontSize,n[S.fontStyle]=s.fontStyle,n[S.fontWeight]=s.fontWeight,n[S.angle]=s.angle,"StereographicProjection"===z&&_i(h,s,n,S,k),t.dataIndexKey&&(n[t.dataIndexKey]=`${o}`),i.push(n);return i}}));return L.layout(l,{width:h[0],height:h[1]}),t.progressiveStep>0||t.progressiveTime>0?{progressive:L}:L.output()}}));
