{"version":3,"sources":["../src/wordcloud-shape/wordcloud-shape.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AAEjD,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAC;AAElC,MAAM,CAAC,MAAM,SAAS,GAAG,CAAC,OAA8B,EAAE,YAAmB,EAAE,UAAgB,EAAO,EAAE;IAEtG,IACE,CAAC,OAAO,CAAC,IAAI;QACb,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACtB,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC;QACpB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,EACpB;QACA,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC;QACpC,MAAM,CAAC,IAAI,CAAC,kDAAkD,CAAC,CAAC;QAEhE,OAAO,EAAE,CAAC;KACX;IAED,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAExE,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE;QAClB,MAAM,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,yCAAyC,CAAC,CAAC;KACvE;IACD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;QACjB,MAAM,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,wCAAwC,CAAC,CAAC;KACtE;IAED,IAAI,OAAO,CAAC,cAAc,EAAE;QAC1B,OAAO,CAAC,cAAc,EAAE,CAAC;KAC1B;IAGD,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;QAC9C,OAAO,EAAE,CAAC;KACX;IAED,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;IAEnC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IAE5B,IAAI,MAAM,CAAC,UAAU,EAAE,EAAE;QACvB,OAAO;YACL,WAAW,EAAE,MAAM;SACpB,CAAC;KACH;IACD,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;AACzB,CAAC,CAAC","file":"wordcloud-shape.js","sourcesContent":["import { Logger, isNil } from '@visactor/vutils';\nimport type { WordCloudShapeOptions } from './interface';\nimport { Layout } from './layout';\n\nexport const transform = (options: WordCloudShapeOptions, upstreamData: any[], parameters?: any): any => {\n  /** options 配置错误提示 */\n  if (\n    !options.size ||\n    isNil(options.size[0]) ||\n    isNil(options.size[1]) ||\n    options.size[0] <= 0 ||\n    options.size[1] <= 0\n  ) {\n    const logger = Logger.getInstance();\n    logger.info('Wordcloud size dimensions must be greater than 0');\n    // size非法不报错，不进行布局，ChartSpace层会有用户初始化size为0的情况\n    return [];\n  }\n  /** size 处理, 如果是小数, segmentation 计算会有问题导致place陷入死循环 */\n  options.size = [Math.ceil(options.size[0]), Math.ceil(options.size[1])];\n\n  if (!options.shape) {\n    Logger.getInstance().error('WordcloudShape shape must be specified.');\n  }\n  if (!options.text) {\n    Logger.getInstance().error('WordcloudShape text must be specified.');\n  }\n\n  if (options.onBeforeLayout) {\n    options.onBeforeLayout();\n  }\n\n  // 第一次数据流到这里data为空，如果不做判断，走到布局算法会报错\n  if (!upstreamData || upstreamData.length === 0) {\n    return [];\n  }\n\n  const layout = new Layout(options);\n\n  layout.layout(upstreamData);\n\n  if (layout.unfinished()) {\n    return {\n      progressive: layout\n    };\n  }\n  return layout.output();\n};\n"]}