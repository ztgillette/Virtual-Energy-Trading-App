{"version":3,"sources":["../src/link-path/link-path.ts"],"names":[],"mappings":"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","file":"link-path.js","sourcesContent":["/**\n * @description 桑基图Link组件，也适用于其他有宽度的连边展示\n * @author 康晓婷\n */\nimport type { IGroup, IPath } from '@visactor/vrender-core';\nimport { merge } from '@visactor/vutils';\nimport { AbstractComponent } from '../core/base';\nimport type { LinkPathAttributes } from './type';\nimport type { ComponentOptions } from '../interface';\nimport { loadLinkPathComponent } from './register';\n\nexport const getHorizontalPath = (options: LinkPathAttributes, ratio?: number) => {\n  let x0 = options.x0;\n  let x1 = options.x1;\n  const thickness = typeof ratio === 'number' ? options.thickness * ratio : options.thickness;\n  let y00 = options.y0 - options.thickness / 2;\n  let y10 = options.y1 - options.thickness / 2;\n\n  if (options.align === 'center') {\n    y00 = options.y0 - thickness / 2;\n    y10 = options.y1 - thickness / 2;\n  } else if (options.align === 'end') {\n    y00 = options.y0 + options.thickness / 2 - thickness;\n    y10 = options.y1 + options.thickness / 2 - thickness;\n  }\n\n  let midX = (x0 + x1) / 2;\n  let y01 = y00 + thickness;\n  let y11 = y10 + thickness;\n\n  if (options.round) {\n    x0 = Math.round(x0);\n    x1 = Math.round(x1);\n    y00 = Math.round(y00);\n    y10 = Math.round(y10);\n    y01 = Math.round(y01);\n    y11 = Math.round(y11);\n    midX = Math.round(midX);\n  }\n\n  const hasLength = Math.abs(x1 - x0) > 1e-6;\n  const endArrowPath =\n    options.endArrow && hasLength\n      ? `L${x1},${y10 - thickness / 2}L${x1 + thickness},${(y10 + y11) / 2}L${x1},${y11 + thickness / 2}`\n      : '';\n  const startArrowPath =\n    options.startArrow && hasLength\n      ? `L${x0},${y01 + thickness / 2}L${x0 - thickness},${(y00 + y01) / 2}L${x0},${y00 - thickness / 2}`\n      : '';\n\n  if (options.isSmooth === false) {\n    return `M${x0},${y00}L${x1},${y10}${endArrowPath}L${x1},${y11}L${x0},${y01}${startArrowPath}Z`;\n  }\n\n  return `M${x0},${y00}\n  C${midX},${y00},${midX},${y10},${x1},${y10}\n  ${endArrowPath}\n  L${x1},${y11}\n  C${midX},${y11},${midX},${y01},${x0},${y01}\n  ${startArrowPath}\n  Z`;\n};\n\nexport const getVerticalPath = (options: LinkPathAttributes, ratio?: number) => {\n  let y0 = options.y0;\n  let y1 = options.y1;\n  let x00 = options.x0 - options.thickness / 2;\n  let x10 = options.x1 - options.thickness / 2;\n  const thickness = typeof ratio === 'number' ? options.thickness * ratio : options.thickness;\n\n  if (options.align === 'center') {\n    x00 = options.x0 - thickness / 2;\n    x10 = options.x1 - thickness / 2;\n  } else if (options.align === 'end') {\n    x00 = options.x0 + options.thickness / 2 - thickness;\n    x10 = options.x1 + options.thickness / 2 - thickness;\n  }\n\n  let midY = (y0 + y1) / 2;\n  let x01 = x00 + thickness;\n  let x11 = x10 + thickness;\n\n  if (options.round) {\n    y0 = Math.round(y0);\n    y1 = Math.round(y1);\n    x00 = Math.round(x00);\n    x10 = Math.round(x10);\n    x01 = Math.round(x01);\n    x11 = Math.round(x11);\n    midY = Math.round(midY);\n  }\n\n  const hasLength = Math.abs(y1 - y0) > 1e-6;\n  const endArrowPath =\n    options.endArrow && hasLength\n      ? `L${x10 - thickness / 2},${y1}L${(x10 + x11) / 2},${y1 + thickness}L${x11 + thickness / 2},${y1}`\n      : '';\n  const startArrowPath =\n    options.startArrow && hasLength\n      ? `L${x01 + thickness / 2},${y0}L${(x01 + x00) / 2},${y0 - thickness}L${x00 - thickness / 2},${y0}`\n      : '';\n\n  if (options.isSmooth === false) {\n    return `M${x00},${y0}L${x10},${y1}${endArrowPath}L${x11},${y1}L${x01},${y0}${startArrowPath}Z`;\n  }\n  return `M${x00},${y0}\n  C${x00},${midY},${x10},${midY},${x10},${y1}\n  ${endArrowPath}\n  L${x11},${y1}\n  C${x11},${midY},${x01},${midY},${x01},${y0}\n  ${startArrowPath}\n  Z`;\n};\n\nloadLinkPathComponent();\n\nexport class LinkPath extends AbstractComponent<Required<LinkPathAttributes>> {\n  static defaultAttributes = {\n    direction: 'horizontal',\n    align: 'start'\n  };\n\n  private _container!: IGroup;\n\n  private _backPath?: IPath;\n  private _frontPath?: IPath;\n\n  constructor(attributes: LinkPathAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, LinkPath.defaultAttributes, attributes));\n  }\n\n  protected render() {\n    const { direction = 'horizontal' } = this.attribute as LinkPathAttributes;\n    const parsePath = direction === 'vertical' ? getVerticalPath : getHorizontalPath;\n    const isRatioShow =\n      typeof this.attribute.ratio === 'number' && this.attribute.ratio >= 0 && this.attribute.ratio <= 1;\n    const groupAttrKeys = [\n      'direction',\n      'x0',\n      'x1',\n      'y0',\n      'y1',\n      'thickness',\n      'round',\n      'ratio',\n      'align',\n      'isSmooth',\n      'backgroudStyle'\n    ];\n    const commonStyle: any = {};\n    Object.keys(this.attribute).forEach(key => {\n      if (!groupAttrKeys.includes(key)) {\n        commonStyle[key] = (this.attribute as any)[key];\n      }\n    });\n\n    if (isRatioShow) {\n      const background = this.createOrUpdateChild(\n        'sankey-link-background',\n        Object.assign({}, commonStyle, this.attribute.backgroudStyle, {\n          path: parsePath(this.attribute as LinkPathAttributes, 1),\n          visible: true,\n          pickable: false,\n          zIndex: -1\n        }),\n        'path'\n      ) as IPath;\n      this._backPath = background;\n    } else if (this._backPath) {\n      this._backPath.setAttribute('visible', false);\n    }\n\n    const front = this.createOrUpdateChild(\n      'sankey-link-front',\n      Object.assign({}, commonStyle, {\n        path: parsePath(this.attribute as LinkPathAttributes, isRatioShow ? this.attribute.ratio : 1),\n        pickable: false\n      }),\n      'path'\n    ) as IPath;\n    this._frontPath = front;\n  }\n}\n"]}