{"version":3,"sources":["../src/weather/weather-box.ts"],"names":[],"mappings":"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","file":"weather-box.js","sourcesContent":["import { AbstractComponent } from '../core/base';\nimport type { IWeatherBoxAttrs } from './type';\nimport type { ComponentOptions } from '../interface';\nimport { merge } from '@visactor/vutils';\nimport type { IGroup, ISymbol, ITimeline } from '@visactor/vrender-core';\nimport { Animate, DefaultTimeline } from '@visactor/vrender-animate';\n\n// todo 后续可能做成有随机数种子的伪随机，这样可以保证每次都生成一样的随机数\nfunction random() {\n  return Math.random();\n}\n\nfunction createUniformRandom(count: number) {\n  const result: number[] = [];\n  const step = 1 / count;\n  for (let i = 0; i < count; i++) {\n    result.push(((random() - 0.5) * step) / 2 + step * i);\n  }\n  result.sort(() => Math.random() - 0.5);\n  let idx = 0;\n  return function (i?: number) {\n    if (idx > count - 1) {\n      idx = 0;\n    }\n    if (i === void 0) {\n      i = idx;\n      idx++;\n    }\n    return result[i];\n  };\n}\n\nexport class WeatherBox extends AbstractComponent<Required<IWeatherBoxAttrs>> {\n  name: string = 'weatherBox';\n\n  static defaultAttributes: Partial<IWeatherBoxAttrs> = {\n    snowIconPath:\n      'M512 64c24.7 0 44.8 20.1 44.8 44.8v43.1l29.3-15.5c21.9-11.6 49-3.2 60.5 18.7s3.2 49-18.7 60.5l-71.2 37.6v85.2c32 8.2 60.6 25.1 83.1 48l73.8-42.6-3-80.4c-0.9-24.7 18.4-45.5 43.1-46.4 24.7-0.9 45.5 18.4 46.4 43.1l1.2 33.1 37.3-21.5c21.4-12.4 48.8-5 61.2 16.4 12.4 21.4 5 48.8-16.4 61.2l-37.3 21.5 28.1 17.6c21 13.2 27.3 40.8 14.1 61.8-13.2 20.9-40.8 27.3-61.8 14.1l-68.2-42.8-73.6 42.5c4.2 15.3 6.5 31.4 6.5 48s-2.3 32.7-6.5 48l73.8 42.6 68.2-42.8c20.9-13.2 48.6-6.8 61.8 14.1 13.2 21 6.8 48.6-14.1 61.8l-28.1 17.6 37.3 21.5c21.4 12.4 28.8 39.8 16.4 61.2-12.4 21.4-39.8 28.8-61.2 16.4l-37.3-21.5-1.2 33.1c-0.9 24.7-21.7 44-46.4 43.1-24.7-0.9-44-21.7-43.1-46.4l3-80.4-73.8-42.6c-22.5 22.9-51 39.8-83.1 48v85.2l71.2 37.6c21.9 11.6 30.2 38.7 18.7 60.5-11.6 21.9-38.7 30.2-60.5 18.7L557 872.2v43.1c0 24.7-20.1 44.8-44.8 44.8-24.7 0-44.8-20.1-44.8-44.8v-43.1l-29.3 15.5c-21.9 11.6-49 3.2-60.5-18.7-11.6-21.9-3.2-49 18.7-60.5l71.2-37.6v-85.2c-32-8.2-60.6-25.1-83.1-48l-73.8 42.6 3 80.4c0.9 24.7-18.4 45.5-43.1 46.4-24.7 0.9-45.5-18.4-46.4-43.1l-1.2-33.1-37.3 21.5c-21.4 12.4-48.8 5-61.2-16.4s-5-48.8 16.4-61.2l37.3-21.5-28.1-17.6c-21-13.2-27.3-40.8-14.1-61.8 13.2-20.9 40.8-27.3 61.8-14.1l68.2 42.8 73.8-42.6c-4.2-15.3-6.5-31.4-6.5-48s2.3-32.7 6.5-48l-73.8-42.6-68.2 42.8c-21 13.2-48.6 6.8-61.8-14.1-13.2-21-6.8-48.6 14.1-61.8l28.1-17.6-37.3-21.5C119 336.8 111.7 309.4 124 288c12.4-21.4 39.8-28.8 61.2-16.4l37.3 21.5 1.2-33.1c0.9-24.7 21.7-44 46.4-43.1 24.7 0.9 44 21.7 43.1 46.4l-3 80.4 73.8 42.6c22.5-22.9 51-39.8 83.1-48v-85.2L396 215.6c-21.9-11.6-30.2-38.7-18.7-60.5 11.6-21.9 38.7-30.2 60.5-18.7l29.3 15.5v-43.1C467.2 84.1 487.3 64 512 64z m0 537.6c49.5 0 89.6-40.1 89.6-89.6s-40.1-89.6-89.6-89.6-89.6 40.1-89.6 89.6 40.1 89.6 89.6 89.6z',\n    rainIconPath:\n      'M802.94208 583.04c19.328 38.016 29.056 78.336 29.056 120.96a313.216 313.216 0 0 1-44.032 161.536 324.48 324.48 0 0 1-114.56 114.944c-23.552 13.696-49.024 24.32-76.416 32-27.264 7.68-55.68 11.52-84.992 11.52-29.44 0-57.6-3.84-84.992-11.52a331.136 331.136 0 0 1-76.544-32 337.536 337.536 0 0 1-65.024-49.92 337.536 337.536 0 0 1-49.92-65.024 331.136 331.136 0 0 1-32-76.544A313.216 313.216 0 0 1 191.99808 704c0-42.24 9.344-82.56 28.032-120.448L509.43808 0l293.504 583.04z',\n    windIconPath: `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path d=\"M 4.0003 14.0002 L 12.0003 14.0008 M 12.0003 14.0008 C 13.1049 14.0009 14.0003 14.8964 14.0002 16.001 C 14.0001 17.1055 13.1046 18.0009 12 18.0008 L 10.5 18.0007\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      <path d=\"M 7 10.0002 L 14.5 10.0008 C 15.6046 10.0009 16.5001 9.1055 16.5002 8.001 C 16.5003 6.8964 15.6049 6.0009 14.5003 6.0008 L 13.0003 6.0007\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n    </svg>`,\n    windRatio: 0,\n    rainRatio: 0,\n    snowRatio: 0,\n    rainCountThreshold: 10,\n    snowCountThreshold: 10,\n    rainSizeRange: [5, 10],\n    snowSizeRange: [5, 13],\n    windSize: 30,\n    rainSpeed: 1,\n    snowSpeed: 0.5,\n    windSpeed: 1,\n    windAnimateEffect: 'fade',\n    rainStyle: {},\n    snowStyle: {},\n    windStyle: {\n      opacity: 0.8\n    },\n    snowRainBottomPadding: 0\n  };\n\n  timeline: ITimeline;\n\n  constructor(attributes: IWeatherBoxAttrs, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, WeatherBox.defaultAttributes, attributes));\n    this.timeline = options?.timeline ?? (new DefaultTimeline() as any);\n  }\n\n  protected render(): void {\n    const {\n      rainRatio,\n      rainIconPath,\n      snowRatio,\n      snowIconPath,\n      rainCountThreshold,\n      snowCountThreshold,\n      windRatio,\n      rainSizeRange,\n      snowSizeRange,\n      rainSpeed,\n      snowSpeed,\n      width,\n      height,\n      windIconPath,\n      windSize,\n      windSpeed\n    } = this.attribute as IWeatherBoxAttrs;\n\n    this.attribute.clip = true;\n\n    // 计算风速导致的偏转角度\n    const windAngle = (-windRatio * Math.PI) / 4;\n\n    const rainGroup = this.createOrUpdateChild('rain-container', { zIndex: 1, width, height }, 'group') as IGroup;\n    if (rainRatio > 0) {\n      this.generateRainOrSnow(\n        'rain',\n        rainRatio,\n        rainCountThreshold,\n        windRatio,\n        rainGroup,\n        rainIconPath,\n        windAngle,\n        rainSizeRange,\n        rainSpeed\n      );\n    }\n    const snowGroup = this.createOrUpdateChild('snow-container', { zIndex: 1, width, height }, 'group') as IGroup;\n    if (snowRatio > 0) {\n      this.generateRainOrSnow(\n        'snow',\n        snowRatio,\n        snowCountThreshold,\n        windRatio,\n        snowGroup,\n        snowIconPath,\n        windAngle,\n        snowSizeRange,\n        snowSpeed\n      );\n    }\n\n    const windGroup = this.createOrUpdateChild('wind-container', { zIndex: 0, width, height }, 'group') as IGroup;\n    if (windRatio > 0) {\n      this.generateWind(windRatio, windIconPath, windGroup, windSize, windSpeed);\n    }\n  }\n\n  protected generateWind(windRatio: number, windIconPath: string, group: IGroup, size: number, speed: number) {\n    const { width, height } = group.attribute;\n    const { windAnimateEffect, windStyle = {} } = this.attribute;\n\n    let fromAttribute = { opacity: 0, clipRange: 1 };\n    let toAttribute = { opacity: 1, clipRange: 1 };\n    if (windAnimateEffect === 'clipRange') {\n      fromAttribute = { clipRange: 0, opacity: 1 };\n      toAttribute = { clipRange: 1, opacity: 1 };\n    }\n    const wind = group.createOrUpdateChild(\n      `wind`,\n      {\n        x: (width - size) / 2,\n        y: (height - size) / 2,\n        symbolType: windIconPath,\n        size,\n        stroke: 'white',\n        lineWidth: 2,\n        dx: -size / 2,\n        dy: -size / 2,\n        ...windStyle,\n        ...fromAttribute\n      },\n      'symbol'\n    ) as ISymbol;\n\n    const duration = (speed / 4) * 1000;\n\n    new Animate(void 0, this.timeline)\n      .bind(wind)\n      .to(fromAttribute, duration, 'linear')\n      .to(toAttribute, duration, 'linear')\n      .wait(duration / 2)\n      .loop(Infinity);\n  }\n\n  protected generateRainOrSnow(\n    type: string,\n    ratio: number,\n    threshold: number,\n    windRatio: number,\n    group: IGroup,\n    path: string,\n    windAngle: number,\n    sizeRange: [number, number],\n    speed: number\n  ) {\n    let { width } = group.attribute;\n    const { height } = group.attribute;\n    const { snowRainBottomPadding, rainStyle = {}, snowStyle = {} } = this.attribute;\n    let maxCount = Math.round(ratio * threshold);\n    // 由于风速，雨雪粒子会偏转，所以需要增加粒子数量\n    if (windRatio > 0) {\n      maxCount = maxCount * Math.round(1 + windRatio);\n    }\n    width = width * Math.round(1 + windRatio);\n    const uniformRandomX = createUniformRandom(maxCount);\n    const uniformRandomY = createUniformRandom(maxCount);\n    for (let i = 0; i < maxCount; i++) {\n      const x = uniformRandomX();\n      const y = uniformRandomY();\n      const size = sizeRange[0] + random() * (sizeRange[1] - sizeRange[0]);\n\n      const deltaX = windAngle ? height * Math.tan(Math.abs(windAngle)) : 0;\n      const startX = x * width - deltaX;\n      const startY = -y * height;\n      const particle = group.createOrUpdateChild(\n        `${type}-${i}`,\n        {\n          x: startX,\n          y: startY,\n          symbolType: path,\n          size,\n          fill: 'white',\n          angle: windAngle,\n          ...(type === 'rain' ? rainStyle : snowStyle)\n        },\n        'symbol'\n      ) as ISymbol;\n      const duration = (1 / speed / 2) * (1 + y) * 1000;\n      let endX = x * width;\n      if (type === 'rain' && windAngle) {\n        endX = startX + (1 + y) * height * Math.tan(Math.abs(windAngle));\n      }\n      new Animate(void 0, this.timeline)\n        .bind(particle)\n        .to({ x: endX, y: height - snowRainBottomPadding }, duration, 'linear')\n        .loop(Infinity);\n      new Animate(void 0, this.timeline).bind(particle).to({ opacity: 0 }, duration, 'quintIn').loop(Infinity);\n    }\n  }\n}\n"]}