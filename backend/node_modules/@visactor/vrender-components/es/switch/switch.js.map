{"version":3,"sources":["../src/switch/switch.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AACzC,OAAO,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAC;AAGjD,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,wBAAwB,CAAC;AAE5D,OAAO,EAAE,mBAAmB,EAAE,MAAM,YAAY,CAAC;AACjD,OAAO,EAAE,eAAe,EAAE,MAAM,SAAS,CAAC;AAE1C,mBAAmB,EAAE,CAAC;AACtB,MAAM,OAAO,MAAO,SAAQ,iBAA6C;IAmCvE,YAAY,UAA4B,EAAE,OAA0B;QAClE,KAAK,CAAC,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,WAAW,EAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,iBAAiB,EAAE,UAAU,CAAC,CAAC,CAAC;QAqHrF,qBAAgB,GAAG,GAAG,EAAE;YAC9B,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;gBAC3B,OAAO;aACR;iBAAM,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;gBACjC,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;aACrC;iBAAM;gBACL,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;aACpC;YAED,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE;gBACzC,SAAS,EAAE,qBAAqB;gBAChC,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO;aAChC,CAAC,CAAC;YAEH,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC;QAC/B,CAAC,CAAC;QAnIA,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,IAAI,CAAC,uBAAuB,GAAG,CAAC,GAAQ,EAAE,UAAe,EAAE,GAA6B,EAAE,EAAE;YAC1F,IAAI,aAAa,IAAI,GAAG,EAAE;gBACxB,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,GAAG,CAAC,WAAW,CAAC,CAAC;aAChD;YACD,IAAI,UAAU,IAAI,GAAG,EAAE;gBACrB,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;aACjG;YACD,OAAO,SAAS,CAAC;QACnB,CAAC,CAAC;QAEF,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC5D,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QAE1B,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,SAAS;QACP,IAAI,CAAC,IAAI,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;QACpD,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;YACrD,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;gBACtB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,kBAAkB;aAC5C,CAAC,CAAC;SACJ;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;YAC7D,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;gBACtB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,oBAAoB;aAC9C,CAAC,CAAC;SACJ;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;YACjC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;gBACtB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW;aACrC,CAAC,CAAC;SACJ;aAAM;YACL,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;gBACtB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa;aACvC,CAAC,CAAC;SACJ;QACD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IAED,YAAY;QACV,IAAI,CAAC,OAAO,GAAG,IAAI,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;QAC5D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACjC,CAAC;IAED,UAAU;;QACR,IAAI,CAAC,KAAK,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,mCAAI,EAAE,CAAC,CAAC,CAAC;QAC5D,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,KAAI,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,WAAW,CAAA,EAAE;YAC9D,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC;gBACvB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW;aACtC,CAAC,CAAC;SACJ;aAAM,IAAI,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,aAAa,EAAE;YAC7C,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC;gBACvB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa;aACxC,CAAC,CAAC;SACJ;QACD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,WAAW;QACT,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YAC/B,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;SACtC;QACD,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;YAC3B,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;SAC3D;IACH,CAAC;IAED,MAAM;;QACJ,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,yBAAyB,CAAC;QACvD,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC;QAE5C,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC;QAC5C,MAAM,YAAY,GAAG,MAAM,GAAG,CAAC,CAAC;QAChC,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;QAClD,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,YAAY,EAAE,UAAU,CAAC,CAAC;QAChE,MAAM,OAAO,GAAG,SAAS,GAAG,CAAC,GAAG,YAAY,GAAG,CAAC,GAAG,MAAM,CAAC;QAC1D,MAAM,KAAK,GAAG,SAAS,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC,CAAC;QAE7C,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC;QAC1C,MAAM,WAAW,GAAG,MAAM,GAAG,CAAC,CAAC;QAE/B,MAAM,SAAS,GAAG,eAAe,CAC/B,CAAC,MAAA,MAAA,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,WAAW,0CAAE,MAAM,mCAAI,CAAC,CAAC,GAAG,CAAC,MAAA,MAAA,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,aAAa,0CAAE,MAAM,mCAAI,CAAC,CAAC;YACjG,CAAC,CAAC,MAAA,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,WAAW,mCAAI,EAAE;YACxC,CAAC,CAAC,MAAA,MAAA,IAAI,CAAC,SAAS,CAAC,IAAI,0CAAE,aAAa,mCAAI,EAAE,EAC5C,IAAI,CAAC,KAAK,CAAC,SAAS,CACrB,CAAC,KAAK,CAAC;QACR,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAW,GAAG,SAAS,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC;QACzE,MAAM,OAAO,GAAG,SAAS,GAAG,CAAC,GAAG,WAAW,GAAG,CAAC,GAAG,MAAM,CAAC;QACzD,MAAM,KAAK,GAAG,OAAO,GAAG,MAAM,GAAG,KAAK,CAAC;QAEvC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;YACtB,KAAK,EAAE,QAAQ;YACf,MAAM,EAAE,SAAS;SAClB,CAAC,CAAC;QAGH,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC;YACzB,CAAC,EAAE,OAAO;YACV,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,GAAG,OAAO;SAC1D,CAAC,CAAC;QAGH,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC;YACvB,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQ,GAAG,KAAK,GAAG,SAAS;YACjE,CAAC,EAAE,KAAK;SACT,CAAC,CAAC;IACL,CAAC;IAmBD,cAAc,CAAC,MAAwB,EAAE,OAA0B;QACjE,MAAM,GAAG,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,WAAW,EAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAC;QACrF,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAC7B,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;;AA9KM,wBAAiB,GAA8B;IACpD,WAAW,EAAE,IAAI;IACjB,QAAQ,EAAE,KAAK;IACf,OAAO,EAAE,KAAK;IACd,MAAM,EAAE,SAAS;IACjB,aAAa,EAAE,aAAa;IAC5B,MAAM,EAAE;QACN,MAAM,EAAE,CAAC;QACT,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,KAAK;KAChB;IACD,GAAG,EAAE;QACH,KAAK,EAAE,EAAE;QACT,MAAM,EAAE,EAAE;QACV,YAAY,EAAE,EAAE;QAChB,aAAa,EAAE,kBAAkB;QACjC,WAAW,EAAE,SAAS;QACtB,oBAAoB,EAAE,kBAAkB;QACxC,kBAAkB,EAAE,kBAAkB;QACtC,QAAQ,EAAE,KAAK;KAChB;IACD,IAAI,EAAE;QACJ,SAAS,EAAE,MAAM;QACjB,YAAY,EAAE,KAAK;QACnB,QAAQ,EAAE,KAAK;KAChB;IACD,yBAAyB,EAAE,CAAC;CAC7B,CAAC","file":"switch.js","sourcesContent":["import { merge } from '@visactor/vutils';\nimport { AbstractComponent } from '../core/base';\nimport type { SwitchAttributes } from './type';\nimport type { ICircle } from '@visactor/vrender-core';\nimport { Circle, Rect, Text } from '@visactor/vrender-core';\nimport type { ComponentOptions } from '../interface';\nimport { loadSwitchComponent } from './register';\nimport { measureTextSize } from '../util';\n\nloadSwitchComponent();\nexport class Switch extends AbstractComponent<Required<SwitchAttributes>> {\n  static defaultAttributes: Partial<SwitchAttributes> = {\n    interactive: true,\n    disabled: false,\n    checked: false,\n    cursor: 'pointer',\n    disableCursor: 'not-allowed',\n    circle: {\n      radius: 8,\n      fill: '#FFF',\n      pickable: false\n    },\n    box: {\n      width: 40,\n      height: 24,\n      cornerRadius: 12,\n      uncheckedFill: 'rgb(201,205,212)',\n      checkedFill: '#165DFF',\n      disableUncheckedFill: 'rgb(242,243,245)',\n      disableCheckedFill: 'rgb(148,191,255)',\n      pickable: false\n    },\n    text: {\n      textAlign: 'left',\n      textBaseline: 'top',\n      pickable: false\n    },\n    spaceBetweenTextAndCircle: 6\n  };\n  _box: Rect;\n  _circle: ICircle;\n  _text: Text;\n\n  name: 'switch';\n\n  constructor(attributes: SwitchAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, Switch.defaultAttributes, attributes));\n    this.renderGroup();\n\n    this.onBeforeAttributeUpdate = (val: any, attributes: any, key: null | string | string[]) => {\n      if ('interactive' in val) {\n        this.setAttribute('pickable', val.interactive);\n      }\n      if ('disabled' in val) {\n        this.setAttribute('cursor', val.disable ? this.attribute.disableCursor : this.attribute.cursor);\n      }\n      return undefined;\n    };\n\n    this.addEventListener('pointerup', this._handlePointerUp);\n  }\n\n  render() {\n    this.removeAllChild(true);\n\n    this.renderBox();\n    this.renderCircle();\n    this.renderText();\n    this.layout();\n  }\n\n  renderBox() {\n    this._box = new Rect(merge({}, this.attribute.box));\n    if (this.attribute.disabled && this.attribute.checked) {\n      this._box.setAttributes({\n        fill: this.attribute.box.disableCheckedFill\n      });\n    } else if (this.attribute.disabled && !this.attribute.checked) {\n      this._box.setAttributes({\n        fill: this.attribute.box.disableUncheckedFill\n      });\n    } else if (this.attribute.checked) {\n      this._box.setAttributes({\n        fill: this.attribute.box.checkedFill\n      });\n    } else {\n      this._box.setAttributes({\n        fill: this.attribute.box.uncheckedFill\n      });\n    }\n    this.appendChild(this._box);\n  }\n\n  renderCircle() {\n    this._circle = new Circle(merge({}, this.attribute.circle));\n    this.appendChild(this._circle);\n  }\n\n  renderText() {\n    this._text = new Text(merge({}, this.attribute.text ?? {}));\n    if (this.attribute.checked && this.attribute.text?.checkedText) {\n      this._text.setAttributes({\n        text: this.attribute.text.checkedText\n      });\n    } else if (this.attribute.text?.uncheckedText) {\n      this._text.setAttributes({\n        text: this.attribute.text.uncheckedText\n      });\n    }\n    this.appendChild(this._text);\n  }\n\n  renderGroup() {\n    if (!this.attribute.interactive) {\n      this.setAttribute('pickable', false);\n    }\n    if (this.attribute.disabled) {\n      this.setAttribute('cursor', this.attribute.disableCursor);\n    }\n  }\n\n  layout() {\n    const space = this.attribute.spaceBetweenTextAndCircle;\n    const radius = this.attribute.circle.radius;\n\n    const boxHeight = this.attribute.box.height;\n    const circleHeight = radius * 2;\n    const textHeight = this._text.AABBBounds.height();\n    const maxHeight = Math.max(boxHeight, circleHeight, textHeight);\n    const circleY = maxHeight / 2 - circleHeight / 2 + radius;\n    const textY = maxHeight / 2 - textHeight / 2;\n\n    const boxWidth = this.attribute.box.width;\n    const circleWidth = radius * 2;\n    // const textWidth = this._text.AABBBounds.width();\n    const textWidth = measureTextSize(\n      (this.attribute.text?.checkedText?.length ?? 0) > (this.attribute.text?.uncheckedText?.length ?? 0)\n        ? this.attribute.text?.checkedText ?? ''\n        : this.attribute.text?.uncheckedText ?? '',\n      this._text.attribute\n    ).width;\n    const maxWidth = Math.max(boxWidth, circleWidth + textWidth + space * 3); // [circle[space]text[space][space]]\n    const circleX = boxHeight / 2 - circleWidth / 2 + radius;\n    const textX = circleX + radius + space;\n\n    this._box.setAttributes({\n      width: maxWidth,\n      height: maxHeight\n    });\n\n    // set circle position\n    this._circle.setAttributes({\n      y: circleY,\n      x: !this.attribute.checked ? circleX : maxWidth - circleX\n    });\n\n    // set text position\n    this._text.setAttributes({\n      x: !this.attribute.checked ? textX : maxWidth - textX - textWidth,\n      y: textY\n    });\n  }\n\n  private _handlePointerUp = () => {\n    if (this.attribute.disabled) {\n      return;\n    } else if (this.attribute.checked) {\n      this.setAttribute('checked', false);\n    } else {\n      this.setAttribute('checked', true);\n    }\n\n    this._dispatchEvent('switch_state_change', {\n      eventType: 'switch_state_change',\n      checked: this.attribute.checked\n    });\n\n    this.stage.renderNextFrame();\n  };\n\n  initAttributes(params: SwitchAttributes, options?: ComponentOptions) {\n    params = options?.skipDefault ? params : merge({}, Switch.defaultAttributes, params);\n    super.initAttributes(params);\n    this.renderGroup();\n    this.render();\n  }\n}\n"]}