{"version":3,"sources":["../src/poptip/poptip.ts"],"names":[],"mappings":"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","file":"poptip.js","sourcesContent":["/**\n * @description PopTip组件\n */\nimport {\n  type IGraphic,\n  type IGroup,\n  type IRect,\n  type ISymbol,\n  type IText,\n  type ITextGraphicAttribute,\n  type TextAlignType,\n  type TextBaselineType\n} from '@visactor/vrender-core';\nimport {\n  AABBBounds,\n  Bounds,\n  getRectIntersect,\n  isArray,\n  isBoolean,\n  isEmpty,\n  isValid,\n  max,\n  merge,\n  min,\n  normalizePadding,\n  pi,\n  rectInsideAnotherRect,\n  type IAABBBoundsLike\n} from '@visactor/vutils';\nimport { AbstractComponent } from '../core/base';\nimport type { ComponentOptions } from '../interface';\nimport type { PopTipAttributes } from './type';\nimport { loadPoptipComponent } from './register';\n\nconst _tBounds = new AABBBounds();\n\nloadPoptipComponent();\n\nconst tlStr = 'M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z';\nconst blStr = 'M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z';\nconst trStr = 'M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z';\nconst brStr = 'M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z';\n\nconst conciseSymbolMap = {\n  tl: tlStr,\n  tr: trStr,\n  bl: blStr,\n  br: brStr,\n  lt: tlStr,\n  lb: blStr,\n  rt: trStr,\n  rb: brStr\n};\nexport class PopTip extends AbstractComponent<Required<PopTipAttributes>> {\n  name = 'poptip';\n\n  static defaultAttributes: Partial<PopTipAttributes> = {\n    position: 'rt',\n    visible: true,\n    title: null,\n    content: null,\n    titleStyle: {\n      fontSize: 12,\n      fill: '#000',\n      textAlign: 'left',\n      textBaseline: 'top'\n    },\n    contentStyle: {\n      fontSize: 12,\n      fill: '#000',\n      textAlign: 'left',\n      textBaseline: 'top'\n    },\n    panel: {} as any,\n    maxWidthPercent: 0.8,\n    space: 8,\n    padding: 10\n  };\n\n  titleShape?: IText;\n  contentShape?: IText;\n  group?: IGroup;\n\n  constructor(attributes: PopTipAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, PopTip.defaultAttributes, attributes));\n  }\n\n  protected render() {\n    const {\n      titleStyle = {} as ITextGraphicAttribute,\n      position,\n      contentStyle = {} as ITextGraphicAttribute,\n      panel,\n      logoSymbol,\n      poptipAnchor = 'position',\n      logoText,\n      logoTextStyle = {} as ITextGraphicAttribute,\n      triangleMode = 'default',\n      space = 4,\n      minWidth = 0,\n      maxWidth = Infinity,\n      padding = 4,\n      maxWidthPercent,\n      visible,\n      state,\n      dx = 0,\n      dy = 0,\n      positionBounds\n    } = this.attribute as PopTipAttributes;\n\n    let { title = '', content = '' } = this.attribute as PopTipAttributes;\n\n    title = this.attribute.titleFormatMethod ? this.attribute.titleFormatMethod(title) : title;\n    content = this.attribute.contentFormatMethod ? this.attribute.contentFormatMethod(content) : content;\n\n    const parsedPadding = normalizePadding(padding);\n\n    const group = this.createOrUpdateChild('poptip-content', { x: 0, y: 0, zIndex: 1 }, 'group') as IGroup;\n    this.group = group;\n\n    const maxLineWidth = maxWidth - parsedPadding[1] - parsedPadding[3];\n\n    const titleVisible = isValid(title) && visible !== false;\n    const titleAttrs = {\n      text: isArray(title) ? title : ([title] as any),\n      visible: titleVisible,\n      wrap: true,\n      ...titleStyle,\n      x: parsedPadding[3],\n      y: parsedPadding[0],\n      maxLineWidth,\n      textAlign: 'left' as TextAlignType,\n      textBaseline: 'top' as TextBaselineType\n    };\n\n    const titleShape = group.createOrUpdateChild('poptip-title', titleAttrs, 'text') as IText;\n    if (!isEmpty(state?.title)) {\n      titleShape.states = state.title;\n    }\n\n    const titleBounds = titleShape.AABBBounds;\n    const titleHeight = titleBounds.height();\n    const titleWidth = titleBounds.width();\n    let height = titleHeight + space;\n    if (!titleVisible) {\n      height = 0;\n    }\n\n    const contentVisible = isValid(content) && visible !== false;\n    const contentAttrs = {\n      text: isArray(content) ? content : ([content] as any),\n      visible: contentVisible,\n      wrap: true,\n      ...contentStyle,\n      x: parsedPadding[3],\n      y: parsedPadding[0] + height,\n      maxLineWidth,\n      textAlign: 'left' as TextAlignType,\n      textBaseline: 'top' as TextBaselineType\n    };\n\n    const contentShape = group.createOrUpdateChild('poptip-content', contentAttrs, 'text') as IText;\n    if (!isEmpty(state?.content)) {\n      contentShape.states = state.content;\n    }\n\n    const contentBounds = contentShape.AABBBounds;\n    const contentHeight = contentBounds.height();\n    const contentWidth = contentBounds.width();\n\n    if (contentVisible) {\n      height += contentHeight;\n    }\n\n    this.titleShape = titleShape;\n    this.contentShape = contentShape;\n\n    // 计算整个popTip的宽高\n    let popTipWidth = max(\n      titleWidth + parsedPadding[1] + parsedPadding[3],\n      contentWidth + parsedPadding[1] + parsedPadding[3]\n    );\n    if (popTipWidth > maxWidth) {\n      popTipWidth = maxWidth;\n    } else if (popTipWidth < minWidth) {\n      popTipWidth = minWidth;\n    }\n    let poptipHeight = parsedPadding[0] + parsedPadding[2] + height;\n\n    // 绘制背景层\n    const { visible: bgVisible, square, ...backgroundStyle } = panel;\n    // 如果是正方形，取宽高的最大值，同时文字也需要居中\n    if (square) {\n      const maxWH = max(popTipWidth, poptipHeight);\n      popTipWidth = maxWH;\n      const deltaH = maxWH - poptipHeight;\n      poptipHeight = maxWH;\n      titleShape.setAttributes({ dy: deltaH / 2 });\n      contentShape.setAttributes({ dy: deltaH / 2 });\n    }\n    const symbolSize = backgroundStyle.size ?? 12;\n    const spaceSize: number | [number, number] = isArray(symbolSize)\n      ? [symbolSize[0] + (backgroundStyle.space ?? 0), symbolSize[1] + (backgroundStyle.space ?? 0)]\n      : (symbolSize as number) + (backgroundStyle.space ?? 0);\n    const lineWidth = backgroundStyle.lineWidth ?? 1;\n    const range: [number, number] | undefined = (this as any).stage\n      ? [\n          (this as any).stage.viewWidth ?? (this as any).stage.width,\n          (this as any).stage.viewHeight ?? (this as any).stage.height\n        ]\n      : undefined;\n\n    if (range) {\n      // 尝试进行换行\n      const b = (this as any).AABBBounds;\n      const leftWidth = this.attribute.x ?? b.x1;\n      const rightWidth = range[0] - b.x1;\n      let maxSpace = Math.max(leftWidth, rightWidth);\n      // 减一些buffer，buffer不能超过maxSpace的20%\n      const buf = (isArray(symbolSize) ? symbolSize[0] : 12) + 3;\n      maxSpace = Math.min(maxSpace - buf, maxSpace * maxWidthPercent);\n      // 需要进行换行\n      if (maxSpace < popTipWidth) {\n        popTipWidth = maxSpace;\n        const buf = parsedPadding[1] + parsedPadding[3];\n        titleShape.setAttribute('maxLineWidth', maxSpace - buf);\n        contentShape.setAttribute('maxLineWidth', maxSpace - buf);\n        poptipHeight = parsedPadding[0] + parsedPadding[2];\n        if (titleVisible) {\n          poptipHeight += titleShape.AABBBounds.height() + space;\n        }\n        poptipHeight += contentShape.AABBBounds.height();\n      }\n    }\n\n    const layout = position === 'auto' || isArray(position);\n    const positionList = isArray(position) ? position : this.positionList;\n    // 最多循环this.positionList次\n    let maxBBoxI: number;\n    let maxBBoxSize: number = -Infinity;\n\n    for (let i = 0; i < positionList.length + 1; i++) {\n      const p = layout ? positionList[i === positionList.length ? maxBBoxI : i] : position;\n      let symbolType = 'arrow2Left';\n      let offsetX = (isArray(symbolSize) ? symbolSize[0] : symbolSize) / 4;\n      let offsetY = 0;\n      if (p === 'top' || p === 'bottom' || p === 'left' || p === 'right') {\n        symbolType = 'arrow2Left';\n      } else if (triangleMode === 'concise') {\n        symbolType = (conciseSymbolMap as any)[p];\n        offsetX = ['tl', 'bl', 'rt', 'rb'].includes(p)\n          ? (isArray(symbolSize) ? symbolSize[0] : symbolSize) / 2\n          : -(isArray(symbolSize) ? symbolSize[0] : symbolSize) / 2;\n        offsetY = ['tl', 'tr', 'lb', 'rb'].includes(p)\n          ? -(isArray(symbolSize) ? symbolSize[1] : symbolSize) / 2\n          : (isArray(symbolSize) ? symbolSize[1] : symbolSize) / 2;\n      }\n\n      const { angle, offset } = this.getAngleAndOffset(\n        p,\n        popTipWidth,\n        poptipHeight,\n        isArray(spaceSize) ? (spaceSize as [number, number]) : [spaceSize, spaceSize - lineWidth],\n        symbolType\n      );\n\n      // Calculate anchor point if using bounds\n      let anchorPoint = { x: 0, y: 0 };\n      if (poptipAnchor === 'bounds' && positionBounds) {\n        anchorPoint = this.calculateAnchorPoint(p, positionBounds);\n      }\n\n      // 后续可能需要偏移，所以需要保存\n      let bgSymbol: ISymbol;\n      if (isBoolean(bgVisible)) {\n        bgSymbol = group.createOrUpdateChild(\n          'poptip-symbol-panel',\n          {\n            ...backgroundStyle,\n            visible: bgVisible && (contentVisible || titleVisible),\n            x: offsetX,\n            y: offsetY,\n            strokeBoundsBuffer: -1,\n            boundsPadding: -2,\n            anchor: [0, 0],\n            symbolType,\n            angle: angle,\n            dx: offset[0],\n            // 标签和背景同时移动\n            dy: offset[1] - (backgroundStyle.space ?? 0),\n            size: symbolSize,\n            zIndex: 9\n          },\n          'symbol'\n        ) as ISymbol;\n        if (!isEmpty(state?.panel)) {\n          bgSymbol.states = state.panel;\n        }\n\n        let bgRect: IGraphic;\n        if (panel.panelSymbolType) {\n          bgRect = group.createOrUpdateChild(\n            'poptip-rect-panel',\n            {\n              ...backgroundStyle,\n              visible: bgVisible && (contentVisible || titleVisible),\n              x: 0,\n              y: 0,\n              symbolType: 'rect',\n              size: [popTipWidth, poptipHeight],\n              zIndex: -8\n            },\n            'symbol'\n          ) as ISymbol;\n        } else {\n          bgRect = group.createOrUpdateChild(\n            'poptip-rect-panel',\n            {\n              ...backgroundStyle,\n              visible: bgVisible && (contentVisible || titleVisible),\n              x: 0,\n              y: 0,\n              width: popTipWidth,\n              height: poptipHeight,\n              zIndex: -8\n            },\n            'rect'\n          ) as IRect;\n        }\n        if (!isEmpty(state?.panel)) {\n          bgRect.states = state.panel;\n        }\n      }\n\n      group.setAttributes({\n        x: -offset[0] + dx + anchorPoint.x,\n        y: -offset[1] + dy + anchorPoint.y,\n        anchor: [offsetX, offsetY]\n      });\n\n      // 添加logo和logo内的text\n      if (logoSymbol) {\n        const { size = 12 } = logoSymbol;\n        const sizeArray = isArray(size) ? (size as [number | string, number | string]) : [size, size];\n        if (sizeArray[1] === 'auto') {\n          sizeArray[1] = poptipHeight;\n        }\n        if (sizeArray[0] === 'auto') {\n          sizeArray[0] = poptipHeight;\n        }\n        const sizeW = sizeArray[0] as number;\n        group.createOrUpdateChild(\n          'poptip-logo',\n          {\n            ...logoSymbol,\n            x: 0,\n            y: poptipHeight / 2,\n            visible: bgVisible && (contentVisible || titleVisible),\n            zIndex: 10,\n            size: sizeArray as [number, number]\n          },\n          'symbol'\n        );\n        group.setAttributes({\n          x: -offset[0] + dx + sizeW / 2,\n          y: -offset[1] + dy\n        });\n        if (logoText) {\n          group.createOrUpdateChild(\n            'poptip-logo-text',\n            {\n              ...logoTextStyle,\n              x: 0,\n              y: poptipHeight / 2,\n              visible: bgVisible && (contentVisible || titleVisible),\n              text: logoText,\n              textAlign: 'center',\n              textBaseline: 'middle',\n              zIndex: 10\n            },\n            'text'\n          );\n        }\n      }\n\n      if (range) {\n        _tBounds.setValue(0, 0, popTipWidth, poptipHeight).transformWithMatrix(group.globalTransMatrix);\n        const b = _tBounds;\n        const stageBounds = new Bounds().setValue(0, 0, range[0], range[1]);\n        if (layout) {\n          if (rectInsideAnotherRect(b, stageBounds, false)) {\n            break;\n          } else {\n            const bbox = getRectIntersect(b, stageBounds, false);\n\n            const size = (bbox.x2 - bbox.x1) * (bbox.y2 - bbox.y1);\n            if (size > maxBBoxSize) {\n              maxBBoxSize = size;\n              maxBBoxI = i;\n            }\n          }\n        }\n\n        // 检测是否是'top' | 'bottom' | 'left' | 'right'，如果是，则需要进行偏移\n        // 1. 判断主方向上有没有重叠（top|bottom的话就是垂直方向，left|right的话就是水平方向），如果重叠就无法偏移\n        // 2. 找到次方向上的偏移量（top|bottom的话就是水平方向，left|right的话就是垂直方向），然后对group进行偏移即可\n        if (['top', 'bottom', 'left', 'right'].includes(p)) {\n          const isVerticalPosition = p === 'top' || p === 'bottom';\n          const isHorizontalPosition = p === 'left' || p === 'right';\n\n          // 判断主方向上有没有偏移\n          let mainDirectionOverlap = false;\n          if (isVerticalPosition) {\n            mainDirectionOverlap = (p === 'top' && b.y1 < 0) || (p === 'bottom' && b.y2 > stageBounds.y2);\n          } else if (isHorizontalPosition) {\n            mainDirectionOverlap = (p === 'left' && b.x1 < 0) || (p === 'right' && b.x2 > stageBounds.x2);\n          }\n\n          // 如果主方向上没有偏移，则可以尝试在次方向上找到合适的偏移量\n          if (!mainDirectionOverlap) {\n            let secondaryOffset = 0;\n\n            const szNumber = (isArray(symbolSize) ? symbolSize[1] : symbolSize) / 2;\n            if (isVerticalPosition) {\n              // 水平偏移\n              if (b.x1 < 0) {\n                secondaryOffset = -b.x1;\n              } else if (b.x2 > stageBounds.x2) {\n                secondaryOffset = stageBounds.x2 - b.x2;\n              }\n              group.setAttribute('x', group.attribute.x + secondaryOffset);\n              bgSymbol.setAttribute(\n                'dx',\n                min(max(bgSymbol.attribute.dx - secondaryOffset, szNumber), b.width() - szNumber)\n              );\n            } else if (isHorizontalPosition) {\n              // 垂直偏移\n              if (b.y1 < 0) {\n                secondaryOffset = -b.y1;\n              } else if (b.y2 > stageBounds.y2) {\n                secondaryOffset = stageBounds.y2 - b.y2;\n              }\n\n              group.setAttribute('y', group.attribute.y + secondaryOffset);\n              bgSymbol.setAttribute(\n                'dy',\n                min(max(bgSymbol.attribute.dy - secondaryOffset, szNumber), b.height() - szNumber)\n              );\n            }\n            break;\n          }\n        }\n\n        if (!layout) {\n          break;\n        }\n      } else {\n        break;\n      }\n    }\n  }\n\n  positionList = ['top', 'tl', 'tr', 'bottom', 'bl', 'br', 'left', 'lt', 'lb', 'right', 'rt', 'rb'];\n\n  /**\n   * Calculate anchor point based on positionBounds and position\n   */\n  calculateAnchorPoint(position: string, positionBounds?: IAABBBoundsLike): { x: number; y: number } {\n    if (!positionBounds) {\n      return { x: 0, y: 0 };\n    }\n\n    const { x, y } = this.attribute;\n\n    const { x1, y1, x2, y2 } = positionBounds;\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    // Calculate anchor point based on position\n    switch (position) {\n      case 'top':\n      case 'tl':\n      case 'tr':\n        return { x: x1 + width / 2 - x, y: y1 - y };\n      case 'bottom':\n      case 'bl':\n      case 'br':\n        return { x: x1 + width / 2 - x, y: y2 - y };\n      case 'left':\n      case 'lt':\n      case 'lb':\n        return { x: x1 - x, y: y1 + height / 2 - y };\n      case 'right':\n      case 'rt':\n      case 'rb':\n        return { x: x2 - x, y: y1 + height / 2 - y };\n      default:\n        return { x: 0, y: 0 };\n    }\n  }\n\n  getAngleAndOffset(\n    position: string,\n    width: number,\n    height: number,\n    size: [number, number],\n    symbolType: 'arrow2Left' | string\n  ): { angle: number; offset: [number, number] } {\n    // const sizeW = size[0];\n    const sizeH = symbolType === 'arrow2Left' ? size[1] / 2 : size[1];\n    switch (position) {\n      case 'tl':\n        return {\n          angle: symbolType === 'arrow2Left' ? (pi / 2) * 3 : 0,\n          offset: symbolType === 'arrow2Left' ? [width / 4, height + sizeH] : [0, height + sizeH]\n        };\n      case 'top':\n        return { angle: (pi / 2) * 3, offset: [width / 2, height + sizeH] };\n      case 'tr':\n        return {\n          angle: symbolType === 'arrow2Left' ? (pi / 2) * 3 : 0,\n          offset: symbolType === 'arrow2Left' ? [(width / 4) * 3, height + sizeH] : [width, height + sizeH]\n        };\n      case 'rt':\n        return {\n          angle: 0,\n          offset: symbolType === 'arrow2Left' ? [-sizeH, height / 5] : [-sizeH, 0]\n        };\n      case 'right':\n        return { angle: 0, offset: [-sizeH, height / 2] };\n      case 'rb':\n        return {\n          angle: 0,\n          offset: symbolType === 'arrow2Left' ? [-sizeH, (height / 5) * 4] : [-sizeH, height]\n        };\n      case 'bl':\n        return {\n          angle: symbolType === 'arrow2Left' ? pi / 2 : 0,\n          offset: symbolType === 'arrow2Left' ? [width / 4, -sizeH] : [0, -sizeH]\n        };\n      case 'bottom':\n        return { angle: pi / 2, offset: [width / 2, -sizeH] };\n      case 'br':\n        return {\n          angle: symbolType === 'arrow2Left' ? pi / 2 : 0,\n          offset: symbolType === 'arrow2Left' ? [(width / 4) * 3, -sizeH] : [width, -sizeH]\n        };\n      case 'lt':\n        return {\n          angle: symbolType === 'arrow2Left' ? pi : 0,\n          offset: symbolType === 'arrow2Left' ? [width + sizeH, height / 5] : [width + sizeH, 0]\n        };\n      case 'left':\n        return { angle: pi, offset: [width + sizeH, height / 2] };\n      case 'lb':\n        return {\n          angle: symbolType === 'arrow2Left' ? pi : 0,\n          offset: symbolType === 'arrow2Left' ? [width + sizeH, (height / 5) * 4] : [width + sizeH, height]\n        };\n    }\n  }\n}\n"]}