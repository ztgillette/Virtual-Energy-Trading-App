{"version":3,"sources":["../src/label-item/label-item.ts"],"names":[],"mappings":"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","file":"label-item.js","sourcesContent":["import type {\n  IGroup,\n  ILine,\n  ILineGraphicAttribute,\n  IRect,\n  ISymbol,\n  ISymbolGraphicAttribute,\n  IText\n} from '@visactor/vrender-core';\nimport { AbstractComponent } from '../core/base';\nimport type { IStoryLabelItemAttrs } from './type';\nimport type { ComponentOptions } from '../interface';\nimport { merge } from '@visactor/vutils';\n\nexport class StoryLabelItem extends AbstractComponent<Required<IStoryLabelItemAttrs>> {\n  name: 'labelItem';\n  _line?: ILine;\n  _symbolStart: ISymbol;\n  _symbolEnd: ISymbol;\n  _symbolStartOuter: ISymbol;\n  _titleTop: IText;\n  _titleBottom: IText;\n  _titleTopPanel: IRect;\n  _titleBottomPanel: IRect;\n\n  static defaultAttributes: Partial<IStoryLabelItemAttrs> = {\n    // 内容在X上的偏移量\n    contentOffsetX: 100,\n    // 内容在Y上的偏移量\n    contentOffsetY: -60,\n    titleTopStyle: {\n      fontSize: 12,\n      fill: 'white'\n    },\n    titleBottomStyle: {\n      fontSize: 12,\n      fill: 'white'\n    },\n    lineStyle: {\n      stroke: 'white',\n      lineWidth: 1\n    } as ILineGraphicAttribute,\n    // 线段开始端点的样式\n    symbolStartStyle: {\n      symbolType: 'circle',\n      size: 3,\n      fill: 'white'\n    } as Partial<ISymbolGraphicAttribute>,\n    // 线段结束端点的样式\n    symbolEndStyle: {\n      symbolType: 'circle',\n      size: 3,\n      fill: 'white'\n    } as Partial<ISymbolGraphicAttribute>,\n    // 线段开始端点外面包裹symbol的样式\n    symbolStartOuterStyle: {\n      symbolType: 'M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0',\n      size: 8,\n      stroke: 'white'\n    } as Partial<ISymbolGraphicAttribute>,\n    titleSpace: [2, 2],\n    titleTopPanelStyle: {\n      visible: false,\n      padding: { left: 0, right: 0, bottom: 2, top: 2 },\n      cornerRadius: 3\n    },\n    titleBottomPanelStyle: {\n      visible: false,\n      padding: { left: 0, right: 0, bottom: 2, top: 2 },\n      cornerRadius: 3\n    },\n    // 默认和简约两套主题\n    theme: 'default'\n  };\n\n  constructor(attributes: IStoryLabelItemAttrs, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, StoryLabelItem.defaultAttributes, attributes));\n  }\n\n  protected render(): void {\n    const {\n      contentOffsetX,\n      contentOffsetY,\n      lineStyle,\n      symbolStartStyle,\n      symbolEndStyle,\n      symbolStartOuterStyle,\n      titleTop: titleTopText,\n      titleBottom: titleBottomText,\n      titleTopStyle,\n      titleBottomStyle,\n      titleSpace,\n      titleTopPanelStyle,\n      titleBottomPanelStyle,\n      theme\n    } = this.attribute;\n\n    const group = this.createOrUpdateChild('label-item-container', { x: 0, y: 0, zIndex: 1 }, 'group') as IGroup;\n\n    const symbolStart = group.createOrUpdateChild(\n      'label-item-symbol-start',\n      { x: 0, y: 0, ...symbolStartStyle },\n      'symbol'\n    ) as ISymbol;\n    const symbolEnd = group.createOrUpdateChild(\n      'label-item-symbol-end',\n      { x: contentOffsetX, y: contentOffsetY, ...symbolEndStyle },\n      'symbol'\n    ) as ISymbol;\n    const symbolStartOut = group.createOrUpdateChild(\n      'label-item-symbol-start-out',\n      { x: 0, y: 0, ...symbolStartOuterStyle },\n      'symbol'\n    ) as ISymbol;\n\n    const spaceW = titleSpace[0];\n    const spaceH = titleSpace[1];\n    // 逻辑：group占满，title在group内做偏移\n    const titleTopGroup = group.createOrUpdateChild(\n      'label-item-title-top-group',\n      { x: contentOffsetX, y: contentOffsetY, clip: true },\n      'group'\n    ) as IGroup;\n    const titleTop = titleTopGroup.createOrUpdateChild(\n      'label-item-title-top',\n      {\n        x: spaceW,\n        y: -spaceH,\n        text: titleTopText,\n        ...titleTopStyle,\n        textBaseline: 'bottom',\n        textAlign: 'left',\n        zIndex: 10\n      },\n      'text'\n    ) as IText;\n    const titleTopBounds = titleTop.AABBBounds;\n    if (contentOffsetX > 0) {\n      titleTopGroup.setAttributes({ x: contentOffsetX - titleTopBounds.width() - spaceW * 2 });\n    }\n    titleTopGroup.setAttributes({\n      width: titleTopBounds.width() + spaceW * 2,\n      height: -titleTopBounds.height() - spaceH * 2\n    });\n    // 添加panel\n    const titleTopPanel = titleTopGroup.createOrUpdateChild(\n      'label-item-title-top-panel',\n      {\n        ...titleTopPanelStyle,\n        x: titleTopPanelStyle.padding.left,\n        y: (titleTopGroup.attribute.height > 0 ? 0 : titleTopGroup.attribute.height) + titleTopPanelStyle.padding.top,\n        width: titleTopGroup.attribute.width - titleTopPanelStyle.padding.left - titleTopPanelStyle.padding.right,\n        height:\n          (titleTopGroup.attribute.height > 0 ? 1 : -1) * titleTopGroup.attribute.height -\n          titleTopPanelStyle.padding.bottom -\n          titleTopPanelStyle.padding.top,\n        scaleCenter: [titleTopGroup.attribute.width / 2, titleTopGroup.attribute.height / 2]\n      },\n      'rect'\n    ) as IRect;\n    this._titleTopPanel = titleTopPanel;\n\n    const titleBottomGroup = group.createOrUpdateChild(\n      'label-item-title-bottom-group',\n      { x: contentOffsetX, y: contentOffsetY, clip: true },\n      'group'\n    ) as IGroup;\n    const titleBottom = titleBottomGroup.createOrUpdateChild(\n      'label-item-title-bottom',\n      {\n        x: spaceW,\n        y: spaceH,\n        text: titleBottomText,\n        ...titleBottomStyle,\n        textBaseline: 'top',\n        textAlign: 'left',\n        zIndex: 10\n      },\n      'text'\n    ) as IText;\n    const titleBottomBounds = titleBottom.AABBBounds;\n    if (contentOffsetX > 0) {\n      titleBottomGroup.setAttributes({ x: contentOffsetX - titleBottomBounds.width() - spaceW * 2 });\n    }\n    titleBottomGroup.setAttributes({\n      width: titleBottomBounds.width() + spaceW * 2,\n      height: titleTopBounds.height() + spaceH * 2\n    });\n    // 添加panel\n    const titleBottomPanel = titleBottomGroup.createOrUpdateChild(\n      'label-item-title-bottom-panel',\n      {\n        ...titleBottomPanelStyle,\n        x: titleBottomPanelStyle.padding.left,\n        y:\n          (titleBottomGroup.attribute.height > 0 ? 0 : titleBottomGroup.attribute.height) +\n          titleBottomPanelStyle.padding.top,\n        width:\n          titleBottomGroup.attribute.width - titleBottomPanelStyle.padding.left - titleBottomPanelStyle.padding.right,\n        height:\n          (titleBottomGroup.attribute.height > 0 ? 1 : -1) * titleBottomGroup.attribute.height -\n          titleBottomPanelStyle.padding.bottom -\n          titleBottomPanelStyle.padding.top,\n        scaleCenter: [titleBottomGroup.attribute.width / 2, titleBottomGroup.attribute.height / 2]\n      },\n      'rect'\n    ) as IRect;\n    this._titleBottomPanel = titleBottomPanel;\n\n    const maxTextWidth = Math.max(titleTop.AABBBounds.width(), titleBottom.AABBBounds.width()) + spaceW * 2;\n    const points = [\n      { x: 0, y: 0 },\n      contentOffsetX > 0\n        ? { x: contentOffsetX - maxTextWidth, y: contentOffsetY }\n        : { x: contentOffsetX + maxTextWidth, y: contentOffsetY },\n      { x: contentOffsetX, y: contentOffsetY }\n    ];\n    // simple风格，不绘制终点，同时文字也要居中\n    if (theme === 'simple') {\n      points.pop();\n      const p = points[1];\n      symbolEnd.setAttributes(p);\n    }\n    const line = group.createOrUpdateChild('label-item-line', { x: 0, y: 0, ...lineStyle, points }, 'line') as ILine;\n\n    this._symbolEnd = symbolEnd;\n    this._symbolStart = symbolStart;\n    this._symbolStartOuter = symbolStartOut;\n    this._titleTop = titleTop;\n    this._titleBottom = titleBottom;\n    this._line = line;\n  }\n}\n"]}