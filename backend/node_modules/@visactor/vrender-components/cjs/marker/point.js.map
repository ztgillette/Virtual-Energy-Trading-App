{"version":3,"sources":["../src/marker/point.ts"],"names":[],"mappings":"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","file":"point.js","sourcesContent":["import type {\n  IGroup,\n  IImage,\n  INode,\n  ISymbol,\n  IImageGraphicAttribute,\n  IRichText,\n  IRichTextGraphicAttribute,\n  ILine,\n  ILineGraphicAttribute\n} from '@visactor/vrender-core';\n// eslint-disable-next-line no-duplicate-imports\nimport { graphicCreator } from '@visactor/vrender-core';\nimport type { IPointLike } from '@visactor/vutils';\n// eslint-disable-next-line no-duplicate-imports\nimport { isValidNumber, merge } from '@visactor/vutils';\nimport { ArcSegment, Segment } from '../segment';\nimport type { TagAttributes } from '../tag';\n// eslint-disable-next-line no-duplicate-imports\nimport { Tag } from '../tag';\nimport { Marker } from './base';\nimport { DEFAULT_MARK_POINT_TEXT_STYLE_MAP, DEFAULT_MARK_POINT_THEME, FUZZY_EQUAL_DELTA } from './config';\nimport type { IItemContent, IItemLine, MarkPointAnimationType, MarkPointAttrs, MarkerAnimationState } from './type';\n// eslint-disable-next-line no-duplicate-imports\nimport { IMarkPointItemPosition } from './type';\nimport type { Point } from '../core/type';\nimport type { ComponentOptions } from '../interface';\nimport { loadMarkPointComponent } from './register';\nimport { computeOffsetForlimit } from '../util/limit-shape';\nimport { DEFAULT_STATES } from '../constant';\nimport { DefaultExitMarkerAnimation, DefaultUpdateMarkPointAnimation, markPointAnimate } from './animate/animate';\nimport {\n  deltaXYToAngle,\n  fuzzyEqualNumber,\n  getTextAlignAttrOfVerticalDir,\n  isPostiveXAxis,\n  removeRepeatPoint\n} from '../util';\n\nloadMarkPointComponent();\n\nexport function registerMarkPointAnimate() {\n  MarkPoint._animate = markPointAnimate;\n}\n\nexport class MarkPoint extends Marker<MarkPointAttrs, MarkPointAnimationType> {\n  name = 'markPoint';\n  static defaultAttributes = DEFAULT_MARK_POINT_THEME;\n\n  /** animate */\n  defaultUpdateAnimation = DefaultUpdateMarkPointAnimation;\n  defaultExitAnimation = DefaultExitMarkerAnimation;\n  protected markerAnimate(state: MarkerAnimationState): void {\n    if (MarkPoint._animate && this._animationConfig) {\n      MarkPoint._animate([this._line, this._decorativeLine], this._item, this._animationConfig, state);\n    }\n  }\n\n  private _item!: ISymbol | Tag | IImage | IRichText;\n  private _targetItem!: ISymbol;\n\n  private _line?: Segment;\n\n  private _decorativeLine!: ILine;\n  private _isArcLine: boolean = false; // 用于区分 arc-segment 和 segment\n  private _isStraightLine: boolean = false; // 用于区分绘制 纯直线 和 折线,（type-do/op/po时, 如果偏移量很小, 视觉无法分辨, 也需要绘制成直线）\n\n  constructor(attributes: MarkPointAttrs, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, MarkPoint.defaultAttributes, attributes));\n  }\n\n  protected setLabelPos() {\n    //do nothing\n  }\n\n  protected getTextAlignAttr(\n    autoRotate: boolean,\n    offsetX: number,\n    offsetY: number,\n    lineEndAngle: number,\n    itemPosition: keyof typeof IMarkPointItemPosition\n  ) {\n    // 垂直方向例外\n    if (\n      fuzzyEqualNumber(Math.abs(lineEndAngle), Math.PI / 2, FUZZY_EQUAL_DELTA) ||\n      fuzzyEqualNumber(Math.abs(lineEndAngle), (Math.PI * 3) / 2, FUZZY_EQUAL_DELTA)\n    ) {\n      return getTextAlignAttrOfVerticalDir(autoRotate, lineEndAngle, itemPosition);\n    }\n\n    if (isPostiveXAxis(lineEndAngle)) {\n      return DEFAULT_MARK_POINT_TEXT_STYLE_MAP.postiveXAxis[itemPosition];\n    }\n    return DEFAULT_MARK_POINT_TEXT_STYLE_MAP.negativeXAxis[itemPosition];\n  }\n\n  protected setItemAttributes(\n    item: ISymbol | Tag | IImage | IRichText,\n    itemContent: IItemContent,\n    newPosition: Point,\n    newItemPosition: Point,\n    itemType: 'symbol' | 'text' | 'image' | 'richText' | 'custom'\n  ) {\n    if (!item) {\n      return;\n    }\n    const {\n      autoRotate = true,\n      refX = 0,\n      refY = 0,\n      refAngle = 0,\n      style,\n      position: positionType = IMarkPointItemPosition.middle\n    } = itemContent as any;\n    const { state } = this.attribute as MarkPointAttrs;\n    const lineEndAngle = this._line?.getEndAngle() || 0;\n    const itemRefOffsetX = refX * Math.cos(lineEndAngle) + refY * Math.cos(lineEndAngle - Math.PI / 2);\n    const itemRefOffsetY = refX * Math.sin(lineEndAngle) + refY * Math.sin(lineEndAngle - Math.PI / 2);\n    if (itemType === 'text') {\n      const offsetX = newItemPosition.x - newPosition.x;\n      const offsetY = newItemPosition.y - newPosition.y;\n      item.setAttributes({\n        ...(style as TagAttributes),\n        textStyle: {\n          ...this.getTextAlignAttr(\n            autoRotate,\n            offsetX,\n            offsetY,\n            lineEndAngle,\n            itemContent.position ?? ('end' as keyof typeof IMarkPointItemPosition)\n          ),\n          ...style.textStyle\n        },\n        state: {\n          panel: merge({}, DEFAULT_STATES, state?.textBackground),\n          text: merge({}, DEFAULT_STATES, state?.itemContent)\n        }\n      } as any);\n    } else if (itemType === 'richText') {\n      item.setAttributes({\n        dx: this.getItemDx(item, positionType, style) + (style.dx || 0),\n        dy: this.getItemDy(item, positionType, style) + (style.dy || 0)\n      });\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    } else if (itemType === 'image') {\n      item.setAttributes({\n        dx: this.getItemDx(item, positionType, style) + (style.dx || 0),\n        dy: this.getItemDy(item, positionType, style) + (style.dy || 0)\n      });\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    }\n\n    const itemAngle = isPostiveXAxis(lineEndAngle) ? lineEndAngle : lineEndAngle - Math.PI;\n\n    item.setAttributes({\n      x: newItemPosition.x + (itemRefOffsetX || 0),\n      y: newItemPosition.y + (itemRefOffsetY || 0),\n      angle: autoRotate && itemAngle + refAngle\n    });\n  }\n\n  protected getItemDx(\n    item: ISymbol | Tag | IImage | IRichText,\n    position: keyof typeof IMarkPointItemPosition,\n    style?: IImageGraphicAttribute | IRichTextGraphicAttribute\n  ) {\n    const width = (item as IGroup)?.AABBBounds?.width() ?? (style?.width || 0);\n    if (position.includes('inside')) {\n      return -width;\n    }\n    if (position === 'insideTop') {\n      return 0;\n    }\n    return 0;\n  }\n\n  protected getItemDy(\n    item: ISymbol | Tag | IImage | IRichText,\n    position: keyof typeof IMarkPointItemPosition,\n    style?: IImageGraphicAttribute | IRichTextGraphicAttribute\n  ) {\n    const height = (item as IGroup)?.AABBBounds?.height() ?? (style?.height || 0);\n    if (position.includes('top') || position.includes('Top')) {\n      return -height;\n    }\n    if (position.includes('middle') || position.includes('Middle')) {\n      return -height / 2;\n    }\n    return 0;\n  }\n\n  protected initItem(itemContent: IItemContent, newPosition: Point, newItemPosition: Point) {\n    const { state } = this.attribute as MarkPointAttrs;\n    const { type = 'text', style, renderCustomCallback } = itemContent as any;\n    let item: ISymbol | Tag | IImage | IRichText | IGroup;\n    if (type === 'symbol') {\n      item = graphicCreator.symbol({\n        ...newItemPosition,\n        ...style\n      });\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    } else if (type === 'text') {\n      item = new Tag({\n        ...newItemPosition,\n        state: {\n          panel: merge({}, DEFAULT_STATES, state?.textBackground),\n          text: merge({}, DEFAULT_STATES, state?.itemContent)\n        }\n      });\n    } else if (type === 'richText') {\n      // 兼容老逻辑\n      item = graphicCreator.richtext({\n        ...newItemPosition,\n        ...style\n      });\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    } else if (type === 'image') {\n      item = graphicCreator.image({\n        ...newItemPosition,\n        ...style\n      });\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    } else if (type === 'custom' && renderCustomCallback) {\n      item = renderCustomCallback();\n      item.states = merge({}, DEFAULT_STATES, state?.itemContent);\n    }\n    item.name = `mark-point-${type}`;\n    this.setItemAttributes(item, itemContent, newPosition, newItemPosition, type);\n    return item;\n  }\n\n  protected getItemLineAttr(itemLine: IItemLine, newPosition: Point, newItemPosition: Point) {\n    let points: Point[] = [];\n    let center = { x: 0, y: 0 };\n    let radius = 0;\n    let startAngle = 0;\n    let endAngle = 0;\n    const { type = 'type-s', arcRatio = 0.8 } = itemLine;\n    // confine之后位置会变化，所以这里需要重新check是否是直线\n    const itemOffsetX = newItemPosition.x - newPosition.x;\n    const itemOffsetY = newItemPosition.y - newPosition.y;\n    this._isStraightLine =\n      fuzzyEqualNumber(itemOffsetX, 0, FUZZY_EQUAL_DELTA) || fuzzyEqualNumber(itemOffsetY, 0, FUZZY_EQUAL_DELTA);\n    if (this._isArcLine) {\n      // 思路:\n      // 1. 以数据位置为起点, 标记内容的位置为终点绘制圆弧\n      //    - 在起点与终点的垂直平分线上找圆心\n      //    - 根据圆心计算半径\n      //    - 根据圆心计算起始角度和结束角度\n      // 2. 根据数据位置上要绘制的targetSymbol调整起始角度, 保证标记线上的startSymbol紧贴在targetSymbol上\n      //    ps: 计算时将targetSymbol看作圆, 如果是其他不规则形状, 无法保证\n      //    - 直接计算圆弧与targetSymbol的交点 到 圆心 的角度(也可以先计算交点的准确坐标, 但需解二元二次方程, 可行却没必要)\n      //    - 用计算好的起始角度 - 交点到圆心的角度, 得到最终起始角度\n      // 3. 根据是否为凹凸圆弧, 进行角度的进一步加工\n\n      const { x: x1, y: y1 } = this.attribute.position;\n      const { x: x2, y: y2 } = newItemPosition;\n      // 得到中点和斜率\n      const x0 = (x1 + x2) / 2;\n      const y0 = (y1 + y2) / 2;\n      // 得到垂直平分线表达式\n      const k = y1 === y2 ? 0 : -(x1 - x2) / (y1 - y2); // 垂直平分线斜率 * 两点连线斜率 = -1\n      const line = (x: number) => k * (x - x0) + y0;\n      // 在垂直平分线上找圆心\n      const direction = y2 > y1 ? -1 : 1;\n      const deltaX = arcRatio * direction * x0; // 数值决定曲率, 符号决定法向, 可通过配置自定义\n      const centerX = x0 + deltaX;\n      const centerY = line(centerX);\n      // 计算半径和角度\n      startAngle = deltaXYToAngle(y1 - centerY, x1 - centerX);\n      endAngle = deltaXYToAngle(y2 - centerY, x2 - centerX);\n      center = { x: centerX, y: centerY };\n\n      // 圆弧与symbol交点的角度\n      const R = Math.sqrt((centerX - x1) * (centerX - x1) + (centerY - y1) * (centerY - y1));\n      const r = this.attribute.targetSymbol.style.size / 2;\n      const deltaAngle = Math.acos(Math.sqrt(1 - (r * r) / (4 * R * R))) * 2;\n      startAngle = startAngle + deltaAngle;\n\n      if (arcRatio > 0) {\n        // 此时绘制凹圆弧, 顺时针绘制\n        // 根据arc图元绘制逻辑, 需要保证endAngle > startAngle, 才能顺时针绘制\n        if (endAngle < startAngle) {\n          endAngle += Math.PI * 2;\n        }\n      } else {\n        // 此时绘制凸圆弧, 顺时针绘制\n        // 根据arc图元绘制逻辑, 需要保证endAngle < startAngle, 才能逆时针绘制\n        if (startAngle < endAngle) {\n          startAngle += Math.PI * 2;\n        }\n      }\n\n      radius = Math.sqrt((centerX - x1) * (centerX - x1) + (centerY - y1) * (centerY - y1));\n    } else if (type === 'type-do' && !this._isStraightLine) {\n      points = [\n        newPosition,\n        {\n          x: (newPosition.x + newItemPosition.x) / 2,\n          y: newItemPosition.y\n        },\n        newItemPosition\n      ];\n    } else if (type === 'type-po' && !this._isStraightLine) {\n      points = [\n        newPosition,\n        {\n          x: newItemPosition.x,\n          y: newPosition.y\n        },\n        newItemPosition\n      ];\n    } else if (type === 'type-op' && !this._isStraightLine) {\n      points = [\n        newPosition,\n        {\n          x: newPosition.x,\n          y: newItemPosition.y\n        },\n        newItemPosition\n      ];\n    } else {\n      points = [newPosition, newItemPosition];\n    }\n    // 插值的过程中可能会产生重复的点, 在此去除\n    points = removeRepeatPoint(points);\n    return {\n      points,\n      center,\n      radius,\n      startAngle,\n      endAngle\n    };\n  }\n\n  protected reDrawLine(itemLine: IItemLine, pointsAttr: any) {\n    this._line.release();\n    const { startSymbol, endSymbol, lineStyle, type = 'type-s' } = itemLine;\n    const { state } = this.attribute as MarkPointAttrs;\n    const lineConstructor = this._isArcLine ? ArcSegment : Segment;\n    this._container.removeChild(this._line);\n    this._line = new lineConstructor({\n      ...pointsAttr,\n      pickable: false,\n      startSymbol,\n      endSymbol,\n      lineStyle,\n      visible: itemLine.visible,\n      state: {\n        line: merge({}, DEFAULT_STATES, state?.line),\n        startSymbol: merge({}, DEFAULT_STATES, state?.lineStartSymbol),\n        endSymbol: merge({}, DEFAULT_STATES, state?.lineEndSymbol)\n      }\n    } as any);\n    this._container.add(this._line as unknown as INode);\n  }\n\n  protected setItemLineAttr(itemLine: IItemLine, newPosition: Point, newItemPosition: Point) {\n    if (this._line) {\n      const { startSymbol, endSymbol, lineStyle, type = 'type-s' } = itemLine;\n      const { state } = this.attribute as MarkPointAttrs;\n      const pointsAttr = this.getItemLineAttr(itemLine, newPosition, newItemPosition);\n      if ((this._isArcLine && this._line.key === 'arc-segment') || (!this._isArcLine && this._line.key === 'segment')) {\n        this._line.setAttributes({\n          ...pointsAttr,\n          startSymbol,\n          endSymbol,\n          lineStyle,\n          visible: itemLine.visible,\n          state: {\n            line: merge({}, DEFAULT_STATES, state?.line),\n            startSymbol: merge({}, DEFAULT_STATES, state?.lineStartSymbol),\n            endSymbol: merge({}, DEFAULT_STATES, state?.lineEndSymbol)\n          }\n        });\n      } else {\n        this.reDrawLine(itemLine, pointsAttr);\n      }\n    }\n  }\n\n  protected getDecorativeLineAttr(itemLine: IItemLine) {\n    const decorativeLength = itemLine?.decorativeLine?.length || 10;\n    const itemAngle = this._line.getEndAngle() || 0;\n\n    const startPointOffsetX = (decorativeLength / 2) * Math.cos(itemAngle - Math.PI / 2);\n    const startPointOffsetY = (decorativeLength / 2) * Math.sin(itemAngle - Math.PI / 2);\n    const endPointOffsetX = (-decorativeLength / 2) * Math.cos(itemAngle - Math.PI / 2);\n    const endPointOffsetY = (-decorativeLength / 2) * Math.sin(itemAngle - Math.PI / 2);\n    return {\n      startPointOffsetX,\n      startPointOffsetY,\n      endPointOffsetX,\n      endPointOffsetY\n    };\n  }\n\n  protected setDecorativeLineAttr(itemLine: IItemLine, newItemPosition: Point, visible: boolean) {\n    if (this._decorativeLine) {\n      const { lineStyle } = itemLine;\n      const { startPointOffsetX, startPointOffsetY, endPointOffsetX, endPointOffsetY } =\n        this.getDecorativeLineAttr(itemLine);\n      this._decorativeLine.setAttributes({\n        points: [\n          {\n            x: newItemPosition.x + startPointOffsetX,\n            y: newItemPosition.y + startPointOffsetY\n          },\n          {\n            x: newItemPosition.x + endPointOffsetX,\n            y: newItemPosition.y + endPointOffsetY\n          }\n        ] as IPointLike[],\n        ...(lineStyle as Partial<ILineGraphicAttribute>),\n        visible\n      });\n      this._decorativeLine.states = merge({}, DEFAULT_STATES, this.attribute.state?.line);\n    }\n  }\n\n  protected setTargetItemAttributes(targetItem: any, position: IPointLike) {\n    if (this._targetItem) {\n      this._targetItem.setAttributes({\n        x: position.x,\n        y: position.y,\n        visible: targetItem.visible ?? false,\n        size: targetItem.size,\n        ...targetItem.style\n      });\n      this._targetItem.states = merge({}, DEFAULT_STATES, this.attribute.state?.targetItem);\n    }\n  }\n\n  protected setAllOfItemsAttr(newPosition: Point, newItemPosition: Point) {\n    const { position, itemLine = {}, itemContent = {}, limitRect, targetSymbol } = this.attribute as MarkPointAttrs;\n    const { type = 'text', confine } = itemContent;\n    if (limitRect && confine) {\n      const { x, y, width, height } = limitRect;\n      const { dx, dy } = computeOffsetForlimit(this._item, {\n        x1: x,\n        y1: y,\n        x2: x + width,\n        y2: y + height\n      });\n      newItemPosition.x = newItemPosition.x + dx;\n      newItemPosition.y = newItemPosition.y + dy;\n    }\n    this.setTargetItemAttributes(targetSymbol, position);\n    this.setItemLineAttr(itemLine, newPosition, newItemPosition);\n    this.setItemAttributes(this._item, itemContent, newPosition, newItemPosition, type);\n    this.setDecorativeLineAttr(itemLine, newItemPosition, itemLine.decorativeLine?.visible);\n  }\n\n  protected computeNewPositionAfterTargetItem(position: Point) {\n    const { itemContent = {}, targetSymbol, itemLine } = this.attribute as MarkPointAttrs;\n    const { offsetX: itemContentOffsetX = 0, offsetY: itemContentOffsetY = 0 } = itemContent;\n    const {\n      offset: targetSymbolOffset = 0,\n      style: targetSymbolStyle,\n      visible: targetItemvisible = false,\n      size: targetSymbolSize\n    } = targetSymbol;\n    const targetSize = targetItemvisible ? (targetSymbolStyle.size ?? targetSymbolSize ?? 20) : 0;\n\n    let targetOffsetAngle;\n    if (itemLine.type === 'type-do') {\n      targetOffsetAngle = deltaXYToAngle(itemContentOffsetY, itemContentOffsetX / 2);\n    } else if (itemLine.type === 'type-po') {\n      targetOffsetAngle = deltaXYToAngle(0, itemContentOffsetX);\n    } else if (itemLine.type === 'type-op') {\n      targetOffsetAngle = deltaXYToAngle(itemContentOffsetY, 0);\n    } else {\n      targetOffsetAngle = deltaXYToAngle(itemContentOffsetY, itemContentOffsetX);\n    }\n\n    const newPosition: Point = {\n      x: position.x + (targetSize / 2 + targetSymbolOffset) * Math.cos(targetOffsetAngle),\n      y: position.y + (targetSize / 2 + targetSymbolOffset) * Math.sin(targetOffsetAngle)\n    };\n    const newItemPosition: Point = {\n      x: position.x + (targetSize / 2 + targetSymbolOffset) * Math.cos(targetOffsetAngle) + itemContentOffsetX, // 偏移量 = targetItem size + targetItem space + 用户配置offset\n      y: position.y + (targetSize / 2 + targetSymbolOffset) * Math.sin(targetOffsetAngle) + itemContentOffsetY // 偏移量 = targetItem size + targetItem space + 用户配置offset\n    };\n    return { newPosition, newItemPosition };\n  }\n\n  protected initMarker(container: IGroup) {\n    const { position, itemContent = {}, itemLine } = this.attribute as MarkPointAttrs;\n    const { type: itemLineType = 'type-s', arcRatio = 0.8 } = itemLine;\n    const { offsetX = 0, offsetY = 0 } = itemContent;\n\n    this._isStraightLine =\n      fuzzyEqualNumber(offsetX, 0, FUZZY_EQUAL_DELTA) || fuzzyEqualNumber(offsetY, 0, FUZZY_EQUAL_DELTA);\n    this._isArcLine = itemLineType === 'type-arc' && arcRatio !== 0 && !this._isStraightLine;\n\n    /** 根据targetItem计算新的弧线起点 */\n    const { newPosition, newItemPosition } = this.computeNewPositionAfterTargetItem(position);\n\n    /** itemline - 连接线 */\n\n    const lineConstructor = this._isArcLine ? ArcSegment : Segment;\n    const line = new lineConstructor({\n      points: [],\n      pickable: false, // 组件容器本身不参与拾取\n      center: { x: 0, y: 0 },\n      radius: 0,\n      startAngle: 0,\n      endAngle: 0\n    });\n\n    line.name = 'mark-point-line';\n    this._line = line;\n    container.add(line as unknown as INode);\n\n    /** decorativeLine - 装饰线 */\n    const decorativeLine = graphicCreator.line({\n      points: []\n    });\n    decorativeLine.name = 'mark-point-decorativeLine';\n    this._decorativeLine = decorativeLine;\n    container.add(decorativeLine as unknown as INode);\n\n    /** targetItem - 被标注的点上需要放置的内容 */\n    const targetItem = graphicCreator.symbol({});\n    targetItem.name = 'mark-point-targetItem';\n    this._targetItem = targetItem;\n    container.add(this._targetItem);\n\n    /** item - 标注的内容 */\n    // 为了强制将itemContent限制在limitRect内, 所以需要先绘制item, 然后根据item bounds 动态调整位置\n    const item = this.initItem(itemContent as any, newPosition, newItemPosition);\n    this._item = item;\n    container.add(item as unknown as INode);\n\n    /** 全部属性确定后, 给每个元素 set attr */\n    // 由于itemLine的指向也要变化, 所以需要对所有的内容进行渲染\n    this.setAllOfItemsAttr(newPosition, newItemPosition);\n  }\n\n  protected updateMarker() {\n    const { position, itemContent = {}, itemLine } = this.attribute as MarkPointAttrs;\n    const { type = 'text' } = itemContent;\n    const { type: itemLineType = 'type-s', arcRatio = 0.8 } = itemLine;\n    const { offsetX = 0, offsetY = 0 } = itemContent;\n\n    this._isStraightLine =\n      fuzzyEqualNumber(offsetX, 0, FUZZY_EQUAL_DELTA) || fuzzyEqualNumber(offsetY, 0, FUZZY_EQUAL_DELTA);\n    const isArcLine = itemLineType === 'type-arc' && arcRatio !== 0 && !this._isStraightLine;\n    /** 根据targetItem计算新的弧线起点 */\n    const { newPosition, newItemPosition } = this.computeNewPositionAfterTargetItem(position);\n\n    if (isArcLine !== this._isArcLine) {\n      // 如果曲线和直线相互切换了, 则需要重新绘制line\n      this._isArcLine = isArcLine;\n      this.reDrawLine(itemLine, {\n        points: [{ x: 0, y: 0 }],\n        pickable: false,\n        center: { x: 0, y: 0 },\n        radius: 0,\n        startAngle: 0,\n        endAngle: 0\n      });\n    } else {\n      this._isArcLine = isArcLine;\n    }\n\n    // 为了强制将itemContent限制在limitRect内, 所以需要先绘制item, 然后根据item bounds 动态调整位置\n    this.setItemAttributes(this._item, itemContent, newPosition, newItemPosition, type);\n    // 由于itemLine的指向也要变化, 所以需要对所有的内容进行渲染\n    this.setAllOfItemsAttr(newPosition, newItemPosition);\n  }\n\n  protected isValidPoints() {\n    const { position } = this.attribute as MarkPointAttrs;\n    if (isValidNumber(position.x) && isValidNumber(position.y)) {\n      return true;\n    }\n    return false;\n  }\n}\n"]}