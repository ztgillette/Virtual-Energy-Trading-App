{"version":3,"sources":["../src/common/merge.ts"],"names":[],"mappings":"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","file":"merge.js","sourcesContent":["import isArray from './isArray';\nimport isArrayLike from './isArrayLike';\nimport isPlainObject from './isPlainObject';\nimport isValid from './isValid';\n\nexport function baseMerge(target: any, source: any, shallowArray: boolean = false, skipTargetArray: boolean = false) {\n  if (source) {\n    if (target === source) {\n      return;\n    }\n    if (isValid(source) && typeof source === 'object') {\n      // baseFor\n      const iterable = Object(source);\n      const props = [];\n      // keysIn\n      for (const key in iterable) {\n        props.push(key);\n      }\n      let { length } = props;\n      let propIndex = -1;\n      while (length--) {\n        const key = props[++propIndex];\n        // skipArray 这个是vchart spec的特有逻辑\n        if (\n          isValid(iterable[key]) &&\n          typeof iterable[key] === 'object' &&\n          (!skipTargetArray || !isArray(target[key]))\n        ) {\n          baseMergeDeep(target, source, key, shallowArray, skipTargetArray);\n        } else {\n          assignMergeValue(target, key, iterable[key]);\n        }\n      }\n    }\n  }\n}\n\n// 由于目前 ChartSpace 内部对 spec 会先执行一次深拷贝，merge 暂时不考虑 source 中有环的问题\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction baseMergeDeep(\n  target: object,\n  source: object,\n  key: string,\n  shallowArray: boolean = false,\n  skipTargetArray: boolean = false\n) {\n  const objValue = target[key];\n  const srcValue = source[key];\n  let newValue = source[key];\n  let isCommon = true;\n  // 不考虑 buffer / typedArray 类型\n  if (isArray(srcValue)) {\n    if (shallowArray) {\n      // 依据参数对数组做浅拷贝\n      newValue = [];\n    } else if (isArray(objValue)) {\n      newValue = objValue;\n    } else if (isArrayLike(objValue)) {\n      // 如果 source 为数组，则 target 的 arrayLike 对象也视作为数组处理\n      newValue = new Array(objValue.length);\n      let index = -1;\n      const length = objValue.length;\n      while (++index < length) {\n        newValue[index] = objValue[index];\n      }\n    }\n  }\n  // else if (isArray(srcValue) && shallowArray) {\n  //   newValue = [];\n  // }\n  // 不考虑 argument 类型\n  else if (isPlainObject(srcValue)) {\n    newValue = objValue ?? {};\n    // 不考虑 prototype 的额外处理\n    if (typeof objValue === 'function' || typeof objValue !== 'object') {\n      newValue = {};\n    }\n  } else {\n    isCommon = false;\n  }\n  // 对 class 等复杂对象或者浅拷贝的 array 不做拷贝处理\n  if (isCommon) {\n    baseMerge(newValue, srcValue, shallowArray, skipTargetArray);\n  }\n  assignMergeValue(target, key, newValue);\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction assignMergeValue(target: object, key: string, value: any) {\n  if ((value !== undefined && !eq(target[key], value)) || (value === undefined && !(key in target))) {\n    // 不考虑 __proto__ 的赋值处理\n    target[key] = value;\n  }\n}\n\nfunction eq(value: any, other: any) {\n  return value === other || (Number.isNaN(value) && Number.isNaN(other));\n}\n\n// 与原生的 lodash merge 差异在于对数组是否应用最后一个 source 的结果\n// 例如 lineDash 等 spec 的 merge 使用这一操作更合适\nexport default function merge(target: any, ...sources: any[]): any {\n  let sourceIndex = -1;\n  const length = sources.length;\n  while (++sourceIndex < length) {\n    const source = sources[sourceIndex];\n    baseMerge(target, source, true);\n  }\n  return target;\n}\n"]}