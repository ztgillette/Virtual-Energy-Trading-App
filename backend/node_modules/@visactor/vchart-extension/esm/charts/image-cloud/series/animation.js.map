{"version":3,"sources":["../src/charts/image-cloud/series/animation.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,cAAc,EAAE,MAAM,2BAA2B,CAAC;AAC3D,OAAO,EAAE,aAAa,EAAE,MAAM,kBAAkB,CAAC;AAEjD,OAAO,EAAE,wBAAwB,EAAE,OAAO,EAAE,MAAM,kBAAkB,CAAC;AAErE,MAAM,OAAO,oBAAqB,SAAQ,cAAkB;IAM1D,YAAY,IAAS,EAAE,EAAO,EAAE,QAAgB,EAAE,MAAkB,EAAE,MAA6B;;QACjG,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAI,CAAC,UAAU,GAAG,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,QAAQ,mCAAI,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC;QAC5C,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;YACnC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;SACpB;IACH,CAAC;IAED,QAAQ,CAAC,GAAY,EAAE,KAAa,EAAE,GAAwB;;QAC5D,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACxB,OAAO;SACR;QAED,IAAI,GAAG,EAAE;YACP,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;YAC1B,OAAO;SACR;QAGD,MAAM,YAAY,GAAG,IAAI,CAAC,UAAU,GAAG,GAAG,GAAG,KAAK,CAAC;QACnD,MAAM,qBAAqB,GAAG,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;QAC7D,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,MAAA,IAAI,CAAC,OAAO,mCAAI,CAAC,CAAC,CAAC;QAC/E,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,GAAG,MAAM,CAAC;QACtC,IAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC;QACnC,IAAI,CAAC,MAAM,CAAC,0BAA0B,EAAE,CAAC;IAC3C,CAAC;CACF;AAQD,MAAM,UAAU,yBAAyB,CACvC,MAAkC,EAClC,MAAkC;IAElC,QAAQ,MAAM,EAAE;QACd,KAAK,aAAa;YAChB,OAAO;gBACL;oBACE,MAAM,EAAE,oBAAoB;oBAC5B,gBAAgB,EAAE;wBAChB,QAAQ,EAAE,CAAC;qBACZ;oBACD,QAAQ,EAAE,wBAAwB,CAAC,MAAM,CAAC,QAAQ;iBACnD;gBACD;oBACE,OAAO,EAAE;wBACP,CAAC,EAAE;4BACD,IAAI,EAAE,CAAC,KAAU,EAAE,OAAY,EAAE,EAAE;gCACjC,OAAO,MAAM,CAAC,MAAM,EAAE,GAAG,OAAO,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;4BACzD,CAAC;yBACF;wBACD,WAAW,EAAE;4BACX,IAAI,EAAE,CAAC;4BACP,EAAE,EAAE,CAAC;yBACN;qBACF;oBACD,MAAM,EAAE,WAAW;iBACpB;aACF,CAAC;QACJ,KAAK,QAAQ;YACX,OAAO;gBACL,OAAO,EAAE;oBACP,MAAM,EAAE;wBACN,IAAI,EAAE,CAAC;wBACP,EAAE,EAAE,CAAC;qBACN;oBACD,MAAM,EAAE;wBACN,IAAI,EAAE,CAAC;wBACP,EAAE,EAAE,CAAC;qBACN;oBACD,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE;oBACpC,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE;iBACrC;gBACD,QAAQ,EAAE,wBAAwB,CAAC,MAAM,CAAC,QAAQ;aACnD,CAAC;QACJ,KAAK,SAAS;YACZ,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,wBAAwB,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QACjF,KAAK,QAAQ,CAAC;QACd;YACE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,wBAAwB,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;KACnG;AACH,CAAC;AAED,MAAM,CAAC,MAAM,2BAA2B,GAAG,GAAG,EAAE;IAC9C,OAAO,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC,MAAkC,EAAE,MAAkC,EAAE,EAAE,CAAC,CAAC;QACnH,MAAM,EAAE,yBAAyB,CAAC,MAAM,EAAE,MAAM,CAAC;QACjD,KAAK,EAAE,yBAAyB,CAAC,MAAM,EAAE,MAAM,CAAC;QAChD,IAAI,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE;QACzB,SAAS,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE;KAC/B,CAAC,CAAC,CAAC;AACN,CAAC,CAAC","file":"animation.js","sourcesContent":["import type { EasingType } from '@visactor/vrender-core';\nimport { ACustomAnimate } from '@visactor/vrender-animate';\nimport { isValidNumber } from '@visactor/vutils';\nimport type { IAnimationConfig } from '@visactor/vchart';\nimport { DEFAULT_ANIMATION_CONFIG, Factory } from '@visactor/vchart';\n\nexport class AxialRotateAnimation extends ACustomAnimate<{}> {\n  declare valid: boolean;\n\n  private _rotations: number;\n  private _scaleX: number;\n\n  constructor(from: any, to: any, duration: number, easing: EasingType, params: { rotation?: number }) {\n    super(from, to, duration, easing, params);\n    this._rotations = params?.rotation ?? 1;\n  }\n\n  onBind(): void {\n    this._scaleX = this.target.attribute.scaleX;\n    if (!isValidNumber(this._rotations)) {\n      this.valid = false;\n    }\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>) {\n    if (this.valid === false) {\n      return;\n    }\n\n    if (end) {\n      out.scaleX = this._scaleX;\n      return;\n    }\n\n    // 计算当前的旋转角度\n    const currentAngle = this._rotations * 360 * ratio;\n    const currentAngleInRadians = (currentAngle * Math.PI) / 180;\n    const scaleX = Math.abs(Math.cos(currentAngleInRadians)) * (this._scaleX ?? 1);\n    this.target.attribute.scaleX = scaleX;\n    this.target.addUpdatePositionTag();\n    this.target.addUpdateShapeAndBoundsTag();\n  }\n}\n\nexport interface IImageCloudAnimationParams {\n  height: () => number;\n  center: () => { x: number; y: number };\n}\nexport type ImageCloudAppearPresetType = 'fadeIn' | 'scaleIn' | 'growIn' | 'axialRotate';\n\nexport function imageCloudPresetAnimation(\n  params: IImageCloudAnimationParams,\n  preset: ImageCloudAppearPresetType\n): IAnimationConfig | IAnimationConfig[] {\n  switch (preset) {\n    case 'axialRotate':\n      return [\n        {\n          custom: AxialRotateAnimation,\n          customParameters: {\n            rotation: 1\n          },\n          duration: DEFAULT_ANIMATION_CONFIG.appear.duration\n        },\n        {\n          channel: {\n            y: {\n              from: (datum: any, element: any) => {\n                return params.height() + element.getFinalAttribute().y;\n              }\n            },\n            fillOpacity: {\n              from: 0,\n              to: 1\n            }\n          },\n          easing: 'sineInOut'\n        }\n      ];\n    case 'growIn':\n      return {\n        channel: {\n          scaleX: {\n            from: 0,\n            to: 1\n          },\n          scaleY: {\n            from: 0,\n            to: 1\n          },\n          x: { from: () => params.center().x },\n          y: { from: () => params.center().y }\n        },\n        duration: DEFAULT_ANIMATION_CONFIG.appear.duration\n      };\n    case 'scaleIn':\n      return { type: 'scaleIn', duration: DEFAULT_ANIMATION_CONFIG.appear.duration };\n    case 'fadeIn':\n    default:\n      return { type: 'fadeIn', easing: 'linear', duration: DEFAULT_ANIMATION_CONFIG.appear.duration };\n  }\n}\n\nexport const registerImageCloudAnimation = () => {\n  Factory.registerAnimation('imageCloud', (params: IImageCloudAnimationParams, preset: ImageCloudAppearPresetType) => ({\n    appear: imageCloudPresetAnimation(params, preset),\n    enter: imageCloudPresetAnimation(params, preset),\n    exit: { type: 'fadeOut' },\n    disappear: { type: 'fadeOut' }\n  }));\n};\n"]}