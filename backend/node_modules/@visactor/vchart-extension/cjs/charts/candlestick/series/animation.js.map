{"version":3,"sources":["../src/charts/candlestick/series/animation.ts"],"names":[],"mappings":";;;AAGA,6CAAiD;AACjD,+DAA4E;AAY5E,MAAM,OAAO,GAAG,GAAkB,EAAE;IAClC,OAAO,CAAC,OAAe,EAAE,EAAE;QACzB,MAAM,cAAc,GAAG,OAAO,CAAC,iBAAiB,EAAE,CAAC;QACnD,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,cAAc,CAAC;QACxD,MAAM,iBAAiB,GAAQ,EAAE,IAAI,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;QAChE,IAAI,IAAA,sBAAa,EAAC,IAAI,CAAC,IAAI,IAAA,sBAAa,EAAC,KAAK,CAAC,EAAE;YAC/C,IAAI,IAAI,GAAG,KAAK,EAAE;gBAChB,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;gBAClC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjC,iBAAiB,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;gBACnC,iBAAiB,CAAC,EAAE,CAAC,KAAK,GAAG,KAAK,CAAC;gBACnC,IAAI,IAAA,sBAAa,EAAC,IAAI,CAAC,EAAE;oBACvB,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;oBAClC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;iBAClC;aACF;iBAAM;gBACL,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACnC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjC,iBAAiB,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;gBACpC,iBAAiB,CAAC,EAAE,CAAC,KAAK,GAAG,KAAK,CAAC;gBACnC,IAAI,IAAA,sBAAa,EAAC,GAAG,CAAC,EAAE;oBACtB,iBAAiB,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;oBAClC,iBAAiB,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG,CAAC;iBAChC;aACF;SACF;QACD,OAAO,iBAAiB,CAAC;IAC3B,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,QAAQ,GAAG,GAAkB,EAAE;IACnC,OAAO,CAAC,OAAe,EAAE,EAAE;QACzB,MAAM,cAAc,GAAG,OAAO,CAAC,iBAAiB,EAAE,CAAC;QACnD,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,cAAc,CAAC;QAExD,MAAM,iBAAiB,GAAQ,EAAE,IAAI,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;QAChE,IAAI,IAAA,sBAAa,EAAC,IAAI,CAAC,IAAI,IAAA,sBAAa,EAAC,KAAK,CAAC,EAAE;YAC/C,IAAI,IAAI,GAAG,KAAK,EAAE;gBAChB,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACnC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,GAAG,CAAC;gBAChC,iBAAiB,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;gBACrC,iBAAiB,CAAC,EAAE,CAAC,KAAK,GAAG,GAAG,CAAC;gBACjC,IAAI,IAAA,sBAAa,EAAC,IAAI,CAAC,EAAE;oBACvB,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;oBACnC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,GAAG,CAAC;iBACjC;aACF;iBAAM;gBACL,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;gBACnC,iBAAiB,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC;gBACjC,iBAAiB,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;gBACrC,iBAAiB,CAAC,EAAE,CAAC,KAAK,GAAG,IAAI,CAAC;gBAClC,IAAI,IAAA,sBAAa,EAAC,GAAG,CAAC,EAAE;oBACtB,iBAAiB,CAAC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;oBACjC,iBAAiB,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,CAAC;iBACjC;aACF;SACF;QACD,OAAO,iBAAiB,CAAC;IAC3B,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,MAAa,kBAAmB,SAAQ,gCAAsC;IAC5E,YAAY,IAAU,EAAE,EAAQ,EAAE,QAAgB,EAAE,MAAkB,EAAE,MAA0C;QAChH,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;IAC5C,CAAC;IAED,MAAM;QACJ,KAAK,CAAC,MAAM,EAAE,CAAC;QACf,MAAM,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC;QACvD,IAAI,cAAc,EAAE;YAClB,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;SAC3C;QACD,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC;QAC/D,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;IAED,gBAAgB;QACd,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC,IAAI,CAAC,MAAgB,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAChF,OAAO,IAAI,CAAC;IACd,CAAC;IAED,QAAQ,CAAC,GAAY,EAAE,KAAa,EAAE,GAAwB;QAC5D,MAAM,SAAS,GAAwB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;QAC7D,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;YAC1B,SAAS,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC;QAC5E,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IACvC,CAAC;CACF;AA/BD,gDA+BC;AAED,MAAa,mBAAoB,SAAQ,gCAAsC;IAC7E,YAAY,IAAU,EAAE,EAAQ,EAAE,QAAgB,EAAE,MAAkB,EAAE,MAA0C;QAChH,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;IAC5C,CAAC;IAED,MAAM;;QACJ,IAAI,MAAA,IAAI,CAAC,MAAM,0CAAE,SAAS,EAAE;YAC1B,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;SAClD;QACD,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC;QAC/D,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;IAED,gBAAgB;QACd,MAAM,IAAI,GAAG,QAAQ,EAAE,CAAC,IAAI,CAAC,MAAgB,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QACjF,OAAO,IAAI,CAAC;IACd,CAAC;IAED,QAAQ,CAAC,GAAY,EAAE,KAAa,EAAE,GAAwB;QAC5D,MAAM,SAAS,GAAwB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC;QAC7D,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;YAC1B,SAAS,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC;QAC5E,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IACvC,CAAC;CACF;AA7BD,kDA6BC;AAEM,MAAM,iCAAiC,GAAG,GAAG,EAAE;IACpD,iCAAe,CAAC,sBAAsB,CAAC,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;IACjF,iCAAe,CAAC,sBAAsB,CAAC,qBAAqB,EAAE,mBAAmB,CAAC,CAAC;AACrF,CAAC,CAAC;AAHW,QAAA,iCAAiC,qCAG5C","file":"animation.js","sourcesContent":["import type { EasingType } from '@visactor/vrender-core';\nimport type { IGlyph } from '@visactor/vrender-core';\nimport type { IAnimationParameters } from '@visactor/vchart';\nimport { isValidNumber } from '@visactor/vutils';\nimport { ACustomAnimate, AnimateExecutor } from '@visactor/vrender-animate';\n\nexport interface ICandlestickScaleAnimationOptions {\n  center?: number;\n}\n\ntype TypeAnimation = (\n  graphic: IGlyph,\n  options: ICandlestickScaleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => { from?: { [channel: string]: any }; to?: { [channel: string]: any } };\n\nconst scaleIn = (): TypeAnimation => {\n  return (graphic: IGlyph) => {\n    const finalAttribute = graphic.getFinalAttribute();\n    const { x, y, open, high, low, close } = finalAttribute;\n    const animateAttributes: any = { from: { x, y }, to: { x, y } };\n    if (isValidNumber(open) && isValidNumber(close)) {\n      if (open > close) {\n        animateAttributes.from.open = low;\n        animateAttributes.to.open = open;\n        animateAttributes.from.close = low;\n        animateAttributes.to.close = close;\n        if (isValidNumber(high)) {\n          animateAttributes.from.high = low;\n          animateAttributes.to.high = high;\n        }\n      } else {\n        animateAttributes.from.open = high;\n        animateAttributes.to.open = open;\n        animateAttributes.from.close = high;\n        animateAttributes.to.close = close;\n        if (isValidNumber(low)) {\n          animateAttributes.from.low = high;\n          animateAttributes.to.low = low;\n        }\n      }\n    }\n    return animateAttributes;\n  };\n};\n\nconst scaleOut = (): TypeAnimation => {\n  return (graphic: IGlyph) => {\n    const finalAttribute = graphic.getFinalAttribute();\n    const { x, y, open, high, low, close } = finalAttribute;\n\n    const animateAttributes: any = { from: { x, y }, to: { x, y } };\n    if (isValidNumber(open) && isValidNumber(close)) {\n      if (open > close) {\n        animateAttributes.from.open = open;\n        animateAttributes.to.open = low;\n        animateAttributes.from.close = close;\n        animateAttributes.to.close = low;\n        if (isValidNumber(high)) {\n          animateAttributes.from.high = high;\n          animateAttributes.to.high = low;\n        }\n      } else {\n        animateAttributes.from.open = open;\n        animateAttributes.to.open = high;\n        animateAttributes.from.close = close;\n        animateAttributes.to.close = high;\n        if (isValidNumber(low)) {\n          animateAttributes.from.low = low;\n          animateAttributes.to.low = high;\n        }\n      }\n    }\n    return animateAttributes;\n  };\n};\n\nexport class CandlestickScaleIn extends ACustomAnimate<Record<string, number>> {\n  constructor(from: null, to: null, duration: number, easing: EasingType, params?: ICandlestickScaleAnimationOptions) {\n    super(from, to, duration, easing, params);\n  }\n\n  onBind(): void {\n    super.onBind();\n    const finalAttribute = this.target.getFinalAttribute();\n    if (finalAttribute) {\n      this.target.setAttributes(finalAttribute);\n    }\n    const { from, to } = this.computeAttribute();\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n    this.animate.reSyncProps();\n    this.from = from;\n    this.to = to;\n    this.target.setAttributes(this.from);\n  }\n\n  computeAttribute() {\n    const attr = scaleIn()(this.target as IGlyph, this.params, this.params.options);\n    return attr;\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>): void {\n    const attribute: Record<string, any> = this.target.attribute;\n    this.propKeys.forEach(key => {\n      attribute[key] = this.from[key] + (this.to[key] - this.from[key]) * ratio;\n    });\n    this.target.setAttributes(attribute);\n  }\n}\n\nexport class CandlestickScaleOut extends ACustomAnimate<Record<string, number>> {\n  constructor(from: null, to: null, duration: number, easing: EasingType, params?: ICandlestickScaleAnimationOptions) {\n    super(from, to, duration, easing, params);\n  }\n\n  onBind(): void {\n    if (this.params?.diffAttrs) {\n      this.target.setAttributes(this.params.diffAttrs);\n    }\n    const { from, to } = this.computeAttribute();\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n    this.animate.reSyncProps();\n    this.from = from;\n    this.to = to;\n    this.target.setAttributes(this.from);\n  }\n\n  computeAttribute() {\n    const attr = scaleOut()(this.target as IGlyph, this.params, this.params.options);\n    return attr;\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>): void {\n    const attribute: Record<string, any> = this.target.attribute;\n    this.propKeys.forEach(key => {\n      attribute[key] = this.from[key] + (this.to[key] - this.from[key]) * ratio;\n    });\n    this.target.setAttributes(attribute);\n  }\n}\n\nexport const registerCandlestickScaleAnimation = () => {\n  AnimateExecutor.registerBuiltInAnimate('candlestickScaleIn', CandlestickScaleIn);\n  AnimateExecutor.registerBuiltInAnimate('candlestickScaleOut', CandlestickScaleOut);\n};\n"]}