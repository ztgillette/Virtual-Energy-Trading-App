{"version":3,"sources":["../src/charts/ranking-bar/ranking-bar-transformer.ts"],"names":[],"mappings":"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","file":"ranking-bar-transformer.js","sourcesContent":["import type { IRankingBarSpec } from './interface';\nimport type { ICartesianAxisSpec, ICommonChartSpec, ILabelSpec } from '@visactor/vchart';\nimport type { ITextGraphicAttribute } from '@visactor/vrender-core';\nimport { BaseChartSpecTransformer } from '@visactor/vchart';\nimport { isValid } from '@visactor/vutils';\n\nexport class RankingBarChartSpecTransformer<T extends ICommonChartSpec> extends BaseChartSpecTransformer<any> {\n  transformSpec(spec: T): void {\n    const { timeData, timeNodes } = processData(spec as unknown as IRankingBarSpec);\n    const {\n      interval: userInterval,\n      xField,\n      yField,\n      color,\n      icon,\n      iconPosition,\n      iconShape,\n      timeLabel,\n      label,\n      nameLabel,\n      xAxis,\n      yAxis\n    } = spec as unknown as IRankingBarSpec;\n\n    const interval = userInterval ? userInterval : 1000;\n    const exchangeDuration = Math.min(interval, 500);\n\n    spec.type = 'common';\n    spec.data = [\n      {\n        id: 'timeData',\n        values: timeData.get(timeNodes[0])\n      },\n      {\n        id: 'time',\n        values: [{ time: timeNodes[0] }]\n      }\n    ];\n\n    // @ts-ignore FIXME: type definition\n    spec.color = {\n      specified: {\n        ...color\n      }\n    };\n    spec.region = [{ clip: true }];\n    spec.series = [\n      {\n        type: 'bar',\n        id: 'ranking-bar',\n        dataId: 'timeData',\n        direction: 'horizontal',\n        yField,\n        xField,\n        seriesField: yField,\n        extensionMark: [],\n        label: labelSpec(label, { ...nameLabel, yField }) as any\n      }\n    ];\n    spec.axes = axisSpec(xAxis, yAxis);\n    spec.player = {\n      type: 'continuous',\n      auto: true,\n      loop: false,\n      interval,\n      specs: timeNodes.map(time => ({\n        data: [\n          { id: 'timeData', values: timeData.get(time) },\n          { id: 'time', values: [{ time }] }\n        ]\n      }))\n    };\n    spec.tooltip = { visible: false };\n    spec.customMark = [];\n\n    transformAnimationSpec(spec, { interval, exchangeDuration });\n\n    if (!timeLabel || timeLabel.visible !== false) {\n      spec.customMark.push(timeLabelSpec(timeLabel.style) as any);\n    }\n    if (icon) {\n      const icon = iconSpec(iconPosition, iconShape, { interval, exchangeDuration });\n      spec.series[0].extensionMark.push(icon as any);\n    }\n\n    super.transformSpec(spec);\n  }\n}\n\nexport function processData(spec: IRankingBarSpec) {\n  const { xField, yField, timeField, data, topN = 10, icon } = spec;\n\n  // 数据处理\n  const timeNodes = new Set<string>();\n  const timeData = new Map();\n\n  data.sort((d1, d2) => Number(d2[xField]) - Number(d1[xField]));\n\n  data.forEach(d => {\n    const time = d[timeField];\n    if (isValid(time)) {\n      timeNodes.add(time);\n    }\n    if (!timeData.has(time)) {\n      timeData.set(time, []);\n    }\n    const currentData = timeData.get(time);\n    if (currentData.length < topN) {\n      const _d = { ...d };\n      if (icon && icon[_d[yField]]) {\n        _d.icon = icon[_d[yField]];\n      }\n      currentData.push(_d);\n    }\n  });\n\n  return { timeData, timeNodes: Array.from(timeNodes).sort() };\n}\n\nfunction transformAnimationSpec(\n  spec: ICommonChartSpec,\n  { interval, exchangeDuration }: { interval: number; exchangeDuration: number }\n) {\n  (spec as any).animationAppear = false;\n  (spec as any).animationUpdate = {\n    bar: [\n      {\n        type: 'update',\n        options: { excludeChannels: ['y'] },\n        easing: 'linear',\n        duration: interval\n      },\n      {\n        channel: ['y'],\n        easing: 'circInOut',\n        duration: exchangeDuration\n      }\n    ],\n    axis: {\n      duration: interval,\n      easing: 'linear'\n    }\n  };\n  (spec as any).animationEnter = {\n    bar: [\n      {\n        type: 'moveIn',\n        duration: exchangeDuration,\n        easing: 'cubicInOut',\n        options: {\n          direction: 'y',\n          orient: 'negative',\n          point: (datum: any, element: any, param: any) => {\n            return {\n              y: param.groupHeight + element.getBounds().height()\n            };\n          }\n        }\n      }\n    ]\n  };\n  (spec as any).animationExit = {\n    bar: [\n      {\n        type: 'moveOut',\n        duration: exchangeDuration,\n        easing: 'cubicInOut',\n        options: {\n          direction: 'y',\n          orient: 'negative'\n        }\n      }\n    ]\n  };\n}\n\nfunction labelSpec(label: IRankingBarSpec['label'] = {}, nameLabel: IRankingBarSpec['nameLabel'] & { yField: string }) {\n  const spec: ILabelSpec[] = [];\n\n  if (label.visible !== false) {\n    spec.push({\n      visible: true,\n      overlap: false,\n      style: {\n        // @ts-ignore\n        fill: `rgb(64, 64, 64)`,\n        ...label.style\n      },\n      smartInvert: {\n        fillStrategy: label.style?.fill ? 'null' : undefined,\n        strokeStrategy: label.style?.stroke ? 'null' : undefined\n      }\n    });\n  }\n\n  if (nameLabel.visible) {\n    spec.push({\n      visible: true,\n      overlap: false,\n      // @ts-ignore\n      style: {\n        ...nameLabel.style\n      },\n      smartInvert: {\n        fillStrategy: nameLabel.style?.fill ? 'null' : undefined,\n        strokeStrategy: nameLabel.style?.stroke ? 'null' : undefined\n      },\n      position: nameLabel.position === 'bar-end' ? 'inside-right' : 'inside-left',\n      formatter: `{${nameLabel.yField}}`\n    });\n  }\n\n  return spec;\n}\n\nfunction axisSpec(xAxis: IRankingBarSpec['xAxis'] = {}, yAxis: IRankingBarSpec['yAxis'] = {}) {\n  const leftAxis: ICartesianAxisSpec = {\n    orient: 'left',\n    type: 'band',\n    inverse: true,\n    label: { style: yAxis.label as any },\n    domainLine: { style: yAxis.domainLine },\n    grid: { style: yAxis.grid as any }\n  };\n  const bottomAxis: ICartesianAxisSpec = {\n    orient: 'bottom',\n    type: 'linear',\n    nice: false,\n    animation: true,\n    label: { style: xAxis.label as any },\n    domainLine: { style: xAxis.domainLine },\n    grid: { style: xAxis.grid as any },\n    innerOffset: { right: '10%' }\n  };\n\n  if (xAxis.label) {\n    bottomAxis.label = xAxis.label;\n  }\n  return [leftAxis, bottomAxis];\n}\n\nfunction timeLabelSpec(textStyle: ITextGraphicAttribute = {}) {\n  return {\n    type: 'text',\n    dataId: 'time',\n    style: {\n      textBaseline: 'bottom',\n      fontSize: 200,\n      textAlign: 'end',\n      fontWeight: 600,\n      text: (datum: any) => datum.time,\n      x: (datum: any, ctx: any) => {\n        return ctx.vchart.getChart().getCanvasRect()?.width - 50;\n      },\n      y: (datum: any, ctx: any) => {\n        return ctx.vchart.getChart().getCanvasRect()?.height - 80;\n      },\n      fill: 'grey',\n      fillOpacity: 0.5,\n      ...textStyle\n    }\n  };\n}\n\nfunction iconSpec(\n  iconPosition: IRankingBarSpec['iconPosition'] = 'bar-end',\n  iconShape: IRankingBarSpec['iconShape'] = 'circle',\n  { interval, exchangeDuration }: any\n) {\n  return {\n    type: 'symbol',\n    dataId: 'timeData',\n    style: {\n      symbolType: iconShape,\n      stroke: 'white',\n      lineWidth: 1,\n      size: (data: any, ctx: any) => {\n        const vchart = ctx.vchart;\n        const series = vchart.getChart()?.getSeriesInIndex(0)[0];\n        if (vchart && series) {\n          const bandwidth = series.getYAxisHelper().getBandwidth(0) ?? 0;\n          return Math.max(bandwidth - 4, 0);\n        }\n        return 10;\n      },\n      background: (data: any) => data.icon,\n      // globalZIndex 有bug，会有动画闪烁和报错\n      // globalZIndex: 1, // 否则会被 region 区域 clip\n      x: (data: any, ctx: any) => {\n        const vchart = ctx.vchart;\n        const series = vchart.getChart()?.getSeriesInIndex(0)[0];\n        if (vchart && series) {\n          const bandwidth = series.getYAxisHelper().getBandwidth(0) ?? 0;\n          if (iconPosition === 'bar-start') {\n            return bandwidth / 2;\n          } else if (iconPosition === 'axis') {\n            return -bandwidth / 2;\n          }\n          return series.dataToPositionX(data) - bandwidth / 2;\n        }\n        return undefined;\n      },\n      y: (data: any, ctx: any) => {\n        const vchart = ctx.vchart;\n        const series = vchart.getChart()?.getSeriesInIndex(0)[0];\n        if (vchart && series) {\n          const bandwidth = series.getYAxisHelper().getBandwidth(0) ?? 0;\n          return series.dataToPositionY(data) + bandwidth / 2;\n        }\n        return undefined;\n      },\n      scaleY: iconShape === 'rect' ? 1.2 : 1\n    },\n    animationUpdate: customMarkUpdateAnimation(interval, exchangeDuration),\n    animationEnter: [\n      {\n        type: 'moveIn',\n        duration: exchangeDuration,\n        easing: 'cubicInOut',\n        options: {\n          direction: 'y',\n          orient: 'negative',\n          point: (datum: any, element: any, param: any) => {\n            return {\n              y: param.groupHeight + element.getBounds().height()\n            };\n          }\n        }\n      }\n    ],\n    animationExit: [\n      {\n        type: 'moveOut',\n        duration: exchangeDuration,\n        easing: 'cubicInOut',\n        options: {\n          direction: 'y',\n          orient: 'negative'\n        }\n      }\n    ]\n  };\n}\n\nfunction customMarkUpdateAnimation(duration: number, exchangeDuration: number) {\n  return [\n    {\n      duration: exchangeDuration,\n      easing: 'cubicInOut',\n      channel: ['y']\n    },\n    {\n      options: { excludeChannels: ['y'] },\n      channel: ['x', 'x2', 'x1'],\n      easing: 'linear',\n      duration\n    }\n  ];\n}\n"]}