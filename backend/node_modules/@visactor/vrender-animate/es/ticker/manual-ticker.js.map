{"version":3,"sources":["../src/ticker/manual-ticker.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAmC,MAAM,wBAAwB,CAAC;AACjF,OAAO,EAAE,aAAa,EAAE,MAAM,kBAAkB,CAAC;AAEjD,MAAM,iBAAiB;IAAvB;QACY,aAAQ,GAAY,KAAK,CAAC;QAC1B,gBAAW,GAAW,CAAC,CAAC,CAAC;IAyBrC,CAAC;IAvBC,IAAI,CAAC,QAAgB,EAAE,EAAmC;QACxD,IAAI,IAAI,CAAC,WAAW,GAAG,CAAC,EAAE;YACxB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;SACtB;QACD,IAAI,CAAC,WAAW,IAAI,QAAQ,CAAC;QAC7B,EAAE,CAAC,IAAI,CAAC,CAAC;IACX,CAAC;IAED,OAAO;QACL,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;IAED,MAAM,CAAC,IAAY,EAAE,EAAmC;QACtD,IAAI,IAAI,CAAC,WAAW,GAAG,CAAC,EAAE;YACxB,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;SACtB;QACD,MAAM,QAAQ,GAAG,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QACzC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IAC1B,CAAC;CACF;AAED,MAAM,OAAO,YAAa,SAAQ,aAAa;IAC7C,YAAY,KAAc;QACxB,KAAK,CAAC,KAAK,CAAC,CAAC;QAGb,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC;IAC/B,CAAC;IACS,gBAAgB;QACxB,MAAM,OAAO,GAAiB,IAAI,iBAAiB,EAAE,CAAC;QAGtD,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;SAC9B;QAED,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC;QAC7B,OAAO,IAAI,CAAC;IACd,CAAC;IAED,SAAS,CAAC,KAAa;QACrB,OAAO,KAAK,CAAC;IACf,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;IACtC,CAAC;IAED,MAAM,CAAC,IAAY;QACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAED,KAAK,CAAC,KAAK,GAAG,KAAK;QACjB,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC,OAAO,EAAE;YAClC,OAAO,KAAK,CAAC;SACd;QACD,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,OAAO,KAAK,CAAC;SACd;QACD,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC,KAAK,EAAE;gBAChC,OAAO,KAAK,CAAC;aACd;YACD,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;gBACpB,OAAO,KAAK,CAAC;aACd;SACF;QACD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC;QAC7B,OAAO,IAAI,CAAC;IACd,CAAC;CACF","file":"manual-ticker.js","sourcesContent":["import type { IStage } from '@visactor/vrender-core';\nimport { STATUS, type ITickHandler, type ITicker } from '@visactor/vrender-core';\nimport { DefaultTicker } from './default-ticker';\n\nclass ManualTickHandler implements ITickHandler {\n  protected released: boolean = false;\n  protected currentTime: number = -1;\n\n  tick(interval: number, cb: (handler: ITickHandler) => void): void {\n    if (this.currentTime < 0) {\n      this.currentTime = 0;\n    }\n    this.currentTime += interval;\n    cb(this);\n  }\n\n  release(): void {\n    this.released = true;\n  }\n\n  getTime(): number {\n    return this.currentTime;\n  }\n\n  tickTo(time: number, cb: (handler: ITickHandler) => void): void {\n    if (this.currentTime < 0) {\n      this.currentTime = 0;\n    }\n    const interval = time - this.currentTime;\n    this.tick(interval, cb);\n  }\n}\n\nexport class ManualTicker extends DefaultTicker implements ITicker {\n  constructor(stage?: IStage) {\n    super(stage);\n    // manualTicker 的 lastFrameTime 默认为 0\n    // status 默认为 STATUS.RUNNING（不需要启动）\n    this.lastFrameTime = 0;\n    this.status = STATUS.RUNNING;\n  }\n  protected setupTickHandler(): boolean {\n    const handler: ITickHandler = new ManualTickHandler();\n\n    // Destroy the previous tick handler\n    if (this.tickerHandler) {\n      this.tickerHandler.release();\n    }\n\n    this.tickerHandler = handler;\n    return true;\n  }\n\n  checkSkip(delta: number): boolean {\n    return false;\n  }\n\n  getTime(): number {\n    return this.tickerHandler.getTime();\n  }\n\n  tickAt(time: number): void {\n    this.tickTo(time);\n  }\n\n  start(force = false) {\n    if (this.status === STATUS.RUNNING) {\n      return false;\n    }\n    if (!this.tickerHandler) {\n      return false;\n    }\n    if (!force) {\n      if (this.status === STATUS.PAUSE) {\n        return false;\n      }\n      if (this.ifCanStop()) {\n        return false;\n      }\n    }\n    this.status = STATUS.RUNNING;\n    return true;\n  }\n}\n"]}