{"version":3,"sources":["../src/custom/growAngle.ts"],"names":[],"mappings":"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","file":"growAngle.js","sourcesContent":["import { type IGraphic, type IGroup, type EasingType } from '@visactor/vrender-core';\nimport { ACustomAnimate } from './custom-animate';\nimport { isNumber } from '@visactor/vutils';\n\ninterface IAnimationParameters {\n  width: number;\n  height: number;\n  group: IGroup;\n  elementIndex: number;\n  elementCount: number;\n  view: any;\n}\n\ntype TypeAnimation<T extends IGraphic> = (\n  graphic: T,\n  options: any,\n  animationParameters: IAnimationParameters\n) => { from?: { [channel: string]: any }; to?: { [channel: string]: any } };\n\nexport interface IGrowAngleAnimationOptions {\n  orient?: 'clockwise' | 'anticlockwise';\n  overall?: boolean | number;\n}\n\nconst growAngleInIndividual = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.getFinalAttribute();\n  if (options && options.orient === 'anticlockwise') {\n    return {\n      from: { startAngle: attrs?.endAngle },\n      to: { startAngle: attrs?.startAngle }\n    };\n  }\n  return {\n    from: { endAngle: attrs?.startAngle },\n    to: { endAngle: attrs?.endAngle }\n  };\n};\n\nconst growAngleInOverall = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.getFinalAttribute();\n\n  if (options && options.orient === 'anticlockwise') {\n    const overallValue = isNumber(options.overall) ? options.overall : Math.PI * 2;\n    return {\n      from: {\n        startAngle: overallValue,\n        endAngle: overallValue\n      },\n      to: {\n        startAngle: attrs?.startAngle,\n        endAngle: attrs?.endAngle\n      }\n    };\n  }\n  const overallValue = isNumber(options?.overall) ? options.overall : 0;\n  return {\n    from: {\n      startAngle: overallValue,\n      endAngle: overallValue\n    },\n    to: {\n      startAngle: attrs?.startAngle,\n      endAngle: attrs?.endAngle\n    }\n  };\n};\n\nexport const growAngleIn: TypeAnimation<IGraphic> = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  return (options?.overall ?? false) !== false\n    ? growAngleInOverall(graphic, options, animationParameters)\n    : growAngleInIndividual(graphic, options, animationParameters);\n};\n\nconst growAngleOutIndividual = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.attribute as any;\n\n  if (options && options.orient === 'anticlockwise') {\n    return {\n      from: { startAngle: attrs.startAngle },\n      to: { startAngle: attrs?.endAngle }\n    };\n  }\n  return {\n    from: { endAngle: attrs.endAngle },\n    to: { endAngle: attrs?.startAngle }\n  };\n};\n\nconst growAngleOutOverall = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.attribute as any;\n  if (options && options.orient === 'anticlockwise') {\n    const overallValue = isNumber(options.overall) ? options.overall : Math.PI * 2;\n    return {\n      from: {\n        startAngle: attrs.startAngle,\n        endAngle: attrs.endAngle\n      },\n      to: {\n        startAngle: overallValue,\n        endAngle: overallValue\n      }\n    };\n  }\n  const overallValue = isNumber(options?.overall) ? options.overall : 0;\n  return {\n    from: {\n      startAngle: attrs.startAngle,\n      endAngle: attrs.endAngle\n    },\n    to: {\n      startAngle: overallValue,\n      endAngle: overallValue\n    }\n  };\n};\n\nexport const growAngleOut: TypeAnimation<IGraphic> = (\n  graphic: IGraphic,\n  options: IGrowAngleAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  return (options?.overall ?? false) !== false\n    ? growAngleOutOverall(graphic, options, animationParameters)\n    : growAngleOutIndividual(graphic, options, animationParameters);\n};\n\nexport class GrowAngleBase extends ACustomAnimate<Record<string, number>> {\n  declare valid: boolean;\n\n  declare _updateFunction: (ratio: number) => void;\n\n  constructor(from: null, to: null, duration: number, easing: EasingType, params?: any) {\n    super(from, to, duration, easing, params);\n  }\n\n  determineUpdateFunction(): void {\n    if (!this.propKeys) {\n      this.valid = false;\n    } else if (this.propKeys && this.propKeys.length > 1) {\n      this._updateFunction = this.updateAngle;\n    } else if (this.propKeys[0] === 'startAngle') {\n      this._updateFunction = this.updateStartAngle;\n    } else if (this.propKeys[0] === 'endAngle') {\n      this._updateFunction = this.updateEndAngle;\n    } else {\n      this.valid = false;\n    }\n  }\n\n  /**\n   * 删除自身属性，会直接从props等内容里删除掉\n   */\n  deleteSelfAttr(key: string): void {\n    delete this.props[key];\n    // fromProps在动画开始时才会计算，这时可能不在\n    this.fromProps && delete this.fromProps[key];\n    const index = this.propKeys.indexOf(key);\n    if (index !== -1) {\n      this.propKeys.splice(index, 1);\n    }\n\n    if (this.propKeys && this.propKeys.length > 1) {\n      this._updateFunction = this.updateAngle;\n    } else if (this.propKeys[0] === 'startAngle') {\n      this._updateFunction = this.updateStartAngle;\n    } else if (this.propKeys[0] === 'endAngle') {\n      this._updateFunction = this.updateEndAngle;\n    } else {\n      this._updateFunction = null;\n    }\n  }\n\n  updateStartAngle(ratio: number): void {\n    (this.target.attribute as any).startAngle =\n      this.from.startAngle + (this.to.startAngle - this.from.startAngle) * ratio;\n  }\n\n  updateEndAngle(ratio: number): void {\n    (this.target.attribute as any).endAngle = this.from.endAngle + (this.to.endAngle - this.from.endAngle) * ratio;\n  }\n\n  updateAngle(ratio: number): void {\n    this.updateStartAngle(ratio);\n    this.updateEndAngle(ratio);\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>): void {\n    if (this._updateFunction) {\n      this._updateFunction(ratio);\n      this.target.addUpdateShapeAndBoundsTag();\n    }\n  }\n}\n\n/**\n * 增长渐入\n */\nexport class GrowAngleIn extends GrowAngleBase {\n  onBind(): void {\n    super.onBind();\n    const { from, to } = growAngleIn(this.target, this.params.options, this.params);\n    const fromAttrs = this.target.context?.lastAttrs ?? from;\n    this.props = to;\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n    this.from = fromAttrs;\n    this.to = to;\n\n    // 用于入场的时候设置属性（因为有动画的时候VChart不会再设置属性了）\n    const finalAttribute = this.target.getFinalAttribute();\n    if (finalAttribute) {\n      this.target.setAttributes(finalAttribute);\n    }\n\n    if (this.params.controlOptions?.immediatelyApply !== false) {\n      this.target.setAttributes(fromAttrs);\n    }\n    this.determineUpdateFunction();\n  }\n}\n\nexport class GrowAngleOut extends GrowAngleBase {\n  onBind(): void {\n    super.onBind();\n    const { from, to } = growAngleOut(this.target, this.params.options, this.params);\n    const fromAttrs = from;\n    this.props = to;\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n    this.from = fromAttrs ?? (this.target.attribute as any);\n    this.to = to;\n\n    // this.target.setAttributes(fromAttrs);\n    this.determineUpdateFunction();\n  }\n}\n"]}