{"version":3,"sources":["../src/custom/growCenter.ts"],"names":[],"mappings":"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","file":"growCenter.js","sourcesContent":["import type { IGraphic, IGroup, IAnimate, IStep, EasingType } from '@visactor/vrender-core';\nimport { isValid } from '@visactor/vutils';\nimport { ACustomAnimate } from './custom-animate';\n\ninterface IGrowCartesianAnimationOptions {\n  orient?: 'positive' | 'negative';\n  overall?: boolean | number;\n  direction?: 'x' | 'y' | 'xy';\n}\n\ninterface IAnimationParameters {\n  width: number;\n  height: number;\n  group: IGroup;\n  elementIndex: number;\n  elementCount: number;\n  view: any;\n}\n\ntype TypeAnimation<T extends IGraphic> = (\n  graphic: T,\n  options: any,\n  animationParameters: IAnimationParameters\n) => { from?: { [channel: string]: any }; to?: { [channel: string]: any } };\n\nconst growCenterIn: TypeAnimation<IGraphic> = (\n  graphic: IGraphic,\n  options: IGrowCartesianAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.getFinalAttribute();\n  switch (options?.direction) {\n    case 'x': {\n      const x = attrs.x;\n      const x1 = attrs.x1;\n      const width = attrs.width;\n\n      return {\n        from: isValid(width)\n          ? {\n              x: x + width / 2,\n              x1: undefined,\n              width: 0\n            }\n          : {\n              x: (x + x1) / 2,\n              x1: (x + x1) / 2,\n              width: undefined\n            },\n        to: { x, x1, width }\n      };\n    }\n    case 'y': {\n      const y = attrs.y;\n      const y1 = attrs.y1;\n      const height = attrs.height;\n\n      return {\n        from: isValid(height)\n          ? {\n              y: y + height / 2,\n              y1: undefined,\n              height: 0\n            }\n          : {\n              y: (y + y1) / 2,\n              y1: (y + y1) / 2,\n              height: undefined\n            },\n        to: { y, y1, height }\n      };\n    }\n    case 'xy':\n    default: {\n      const x = attrs.x;\n      const x1 = attrs.x1;\n      const width = attrs.width;\n      const y = attrs.y;\n      const y1 = attrs.y1;\n      const height = attrs.height;\n      const from: any = {};\n\n      if (isValid(width)) {\n        from.x = x + width / 2;\n        from.width = 0;\n        from.x1 = undefined;\n      } else {\n        from.x = (x + x1) / 2;\n        from.x1 = (x + x1) / 2;\n        from.width = undefined;\n      }\n\n      if (isValid(height)) {\n        from.y = y + height / 2;\n        from.height = 0;\n        from.y1 = undefined;\n      } else {\n        from.y = (y + y1) / 2;\n        from.y1 = (y + y1) / 2;\n        from.height = undefined;\n      }\n\n      return {\n        from,\n        to: { x, y, x1, y1, width, height }\n      };\n    }\n  }\n};\n\nconst growCenterOut: TypeAnimation<IGraphic> = (\n  graphic: IGraphic,\n  options: IGrowCartesianAnimationOptions,\n  animationParameters: IAnimationParameters\n) => {\n  const attrs = graphic.attribute as any;\n  switch (options?.direction) {\n    case 'x': {\n      const x = attrs.x;\n      const x1 = attrs.x1;\n      const width = attrs.width;\n\n      return {\n        to: isValid(width)\n          ? {\n              x: x + width / 2,\n              x1: undefined,\n              width: 0\n            }\n          : {\n              x: (x + x1) / 2,\n              x1: (x + x1) / 2,\n              width: undefined\n            }\n      };\n    }\n    case 'y': {\n      const y = attrs.y;\n      const y1 = attrs.y1;\n      const height = attrs.height;\n\n      return {\n        to: isValid(height)\n          ? {\n              y: y + height / 2,\n              y1: undefined,\n              height: 0\n            }\n          : {\n              y: (y + y1) / 2,\n              y1: (y + y1) / 2,\n              height: undefined\n            }\n      };\n    }\n    case 'xy':\n    default: {\n      const x = attrs.x;\n      const y = attrs.y;\n      const x1 = attrs.x1;\n      const y1 = attrs.y1;\n      const width = attrs.width;\n      const height = attrs.height;\n      const to: any = {};\n\n      if (isValid(width)) {\n        to.x = x + width / 2;\n        to.width = 0;\n        to.x1 = undefined;\n      } else {\n        to.x = (x + x1) / 2;\n        to.x1 = (x + x1) / 2;\n        to.width = undefined;\n      }\n\n      if (isValid(height)) {\n        to.y = y + height / 2;\n        to.height = 0;\n        to.y1 = undefined;\n      } else {\n        to.y = (y + y1) / 2;\n        to.y1 = (y + y1) / 2;\n        to.height = undefined;\n      }\n\n      return {\n        to\n      };\n    }\n  }\n};\n\n/**\n * 增长渐入\n */\nexport class GrowCenterIn extends ACustomAnimate<Record<string, number>> {\n  declare valid: boolean;\n\n  constructor(from: null, to: null, duration: number, easing: EasingType, params?: any) {\n    super(from, to, duration, easing, params);\n  }\n\n  onBind(): void {\n    super.onBind();\n    const { from, to } = growCenterIn(this.target, this.params.options, this.params);\n    const fromAttrs = this.target.context?.lastAttrs ?? from;\n    this.props = to;\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n    this.from = fromAttrs;\n    this.to = to;\n\n    // 用于入场的时候设置属性（因为有动画的时候VChart不会再设置属性了）\n    const finalAttribute = this.target.getFinalAttribute();\n    if (finalAttribute) {\n      this.target.setAttributes(finalAttribute);\n    }\n\n    if (this.params.controlOptions?.immediatelyApply !== false) {\n      this.target.setAttributes(fromAttrs);\n    }\n  }\n\n  onEnd(cb?: (animate: IAnimate, step: IStep) => void): void {\n    super.onEnd(cb);\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>): void {\n    const attribute: Record<string, any> = this.target.attribute;\n    this.propKeys.forEach(key => {\n      attribute[key] = this.from[key] + (this.to[key] - this.from[key]) * ratio;\n    });\n    this.target.addUpdatePositionTag();\n    this.target.addUpdateShapeAndBoundsTag();\n  }\n}\n\nexport class GrowCenterOut extends ACustomAnimate<Record<string, number>> {\n  declare valid: boolean;\n\n  constructor(from: null, to: null, duration: number, easing: EasingType, params?: any) {\n    super(from, to, duration, easing, params);\n  }\n\n  onBind(): void {\n    super.onBind();\n    const { from, to } = growCenterOut(this.target, this.params.options, this.params);\n    this.props = to;\n    this.propKeys = Object.keys(to).filter(key => to[key] != null);\n\n    this.from = from ?? (this.target.attribute as any);\n    this.to = to;\n    // this.target.setAttributes(from);\n  }\n\n  onEnd(cb?: (animate: IAnimate, step: IStep) => void): void {\n    super.onEnd(cb);\n  }\n\n  onUpdate(end: boolean, ratio: number, out: Record<string, any>): void {\n    const attribute: Record<string, any> = this.target.attribute;\n    this.propKeys.forEach(key => {\n      attribute[key] = this.from[key] + (this.to[key] - this.from[key]) * ratio;\n    });\n    this.target.addUpdatePositionTag();\n    this.target.addUpdateShapeAndBoundsTag();\n  }\n}\n"]}