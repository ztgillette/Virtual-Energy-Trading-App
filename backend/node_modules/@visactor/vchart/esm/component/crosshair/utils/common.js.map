{"version":3,"sources":["../src/component/crosshair/utils/common.ts"],"names":[],"mappings":"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","file":"common.js","sourcesContent":["import type { Tag } from '@visactor/vrender-components';\nimport type { IBoundsLike } from '@visactor/vutils';\nimport type { Datum } from '../../../typings';\nimport type { ICrosshairTheme } from '../interface';\n// eslint-disable-next-line no-duplicate-imports\nimport { array, isValid } from '@visactor/vutils';\nimport { isXAxis, isYAxis } from '../../axis/cartesian/util/common';\nimport { isDiscrete } from '@visactor/vscale';\nimport type { ICartesianAxisCommonSpec, IPolarAxisCommonSpec } from '../../axis';\nimport { getComponentThemeFromOption } from '../../util';\nimport { ComponentTypeEnum } from '../../interface/type';\nimport { isDiscreteAxis } from '../../axis/util';\nimport { mergeSpec } from '@visactor/vutils-extension';\n\nexport function limitTagInBounds(shape: Tag, bounds: IBoundsLike) {\n  const { x1: regionMinX, y1: regionMinY, x2: regionMaxX, y2: regionMaxY } = bounds;\n  const { x1, y1, x2, y2 } = shape.AABBBounds;\n  const { dx: originDx = 0, dy: originDy = 0 } = shape.attribute;\n\n  let dx = 0;\n  let dy = 0;\n  if (x1 < regionMinX) {\n    // 超出左侧\n    dx = regionMinX - x1;\n  }\n  if (y1 < regionMinY) {\n    // 超出顶部\n    dy = regionMinY - y1;\n  }\n\n  if (x2 > regionMaxX) {\n    // 超出右侧\n    dx = regionMaxX - x2;\n  }\n\n  if (y2 > regionMaxY) {\n    // 整体超出顶部\n    dy = regionMaxY - y2;\n  }\n  if (dx) {\n    shape.setAttribute('dx', dx + originDx);\n  }\n  if (dy) {\n    shape.setAttribute('dy', dy + originDy);\n  }\n}\n\n/**\n * 查找系列中的数据\n * @todo 待重构优化，和 `getDimensionData` 中的逻辑存在重合\n * @param data 系列数据\n * @param value 数据值\n * @param startField 开始值对应的字段\n * @param endField   结束值对应的字段\n * @returns 系列数据\n */\nexport function getDatumByValue(data: Datum[], value: number, startField: string, endField?: string): Datum | null {\n  for (let i = 0, len = data.length; i < len; i++) {\n    const record = data[i];\n\n    if (record) {\n      const startValue = record[startField];\n      const endValue = record[endField || startField];\n\n      if (startValue <= value && endValue >= value) {\n        return record;\n      }\n    }\n  }\n\n  return null;\n}\n\nexport const getCartesianCrosshairTheme = (getTheme: (...keys: string[]) => any, chartSpec: any): ICrosshairTheme => {\n  const axes: ICartesianAxisCommonSpec[] = array(chartSpec.axes ?? []);\n  const { bandField, linearField, xField, yField, trigger, triggerOff } =\n    getComponentThemeFromOption(ComponentTypeEnum.crosshair, getTheme) ?? {};\n\n  const xAxis = axes.find(axis => isXAxis(axis.orient));\n  let newXField;\n  if (isValid(xAxis)) {\n    newXField = mergeSpec({}, isDiscreteAxis(xAxis.type) ? bandField : linearField, xField);\n  } else {\n    newXField = xField;\n  }\n\n  const yAxis = axes.find(axis => isYAxis(axis.orient));\n  let newYField;\n  if (isValid(yAxis)) {\n    newYField = mergeSpec({}, isDiscrete(yAxis.type) ? bandField : linearField, yField);\n  } else {\n    newYField = yField;\n  }\n\n  // 返回主题配置，包括交互相关配置\n  return {\n    xField: newXField,\n    yField: newYField,\n    trigger,\n    triggerOff\n  };\n};\n\nexport const getPolarCrosshairTheme = (getTheme: (...keys: string[]) => any, chartSpec: any): ICrosshairTheme => {\n  const axes: IPolarAxisCommonSpec[] = array(chartSpec.axes ?? []);\n  const { bandField, linearField, categoryField, valueField, trigger, triggerOff } =\n    getComponentThemeFromOption(ComponentTypeEnum.crosshair, getTheme) ?? {};\n\n  const angleAxis = axes.find(axis => axis.orient === 'angle');\n  let newAngleField;\n  if (isValid(angleAxis)) {\n    newAngleField = mergeSpec({}, isDiscreteAxis(angleAxis.type) ? bandField : linearField, categoryField);\n  } else {\n    newAngleField = categoryField;\n  }\n\n  const radiusAxis = axes.find(axis => axis.orient === 'radius');\n  let newRadiusField;\n  if (isValid(radiusAxis)) {\n    newRadiusField = mergeSpec({}, isDiscrete(radiusAxis.type) ? bandField : linearField, valueField);\n  } else {\n    newRadiusField = valueField;\n  }\n\n  // 返回主题配置，包括交互相关配置\n  return {\n    categoryField: newAngleField,\n    valueField: newRadiusField,\n    trigger,\n    triggerOff\n  };\n};\n"]}