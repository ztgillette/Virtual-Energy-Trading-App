{"version":3,"sources":["../src/series/radar/radar.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,mBAAmB,EAAE,MAAM,qBAAqB,CAAC;AAE1D,OAAO,EAAE,kBAAkB,EAAE,MAAM,sBAAsB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAClD,OAAO,EAAE,0BAA0B,EAAE,MAAM,2BAA2B,CAAC;AAGvE,OAAO,EAAsB,cAAc,EAAE,MAAM,mBAAmB,CAAC;AACvE,OAAO,EAAE,cAAc,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,kBAAkB,CAAC;AAE3E,OAAO,EAAE,eAAe,EAAE,mBAAmB,EAAE,MAAM,uBAAuB,CAAC;AAC7E,OAAO,EAAE,sBAAsB,EAAE,MAAM,aAAa,CAAC;AACrD,OAAO,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAC;AAEpD,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAC;AACnD,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAC;AACnD,OAAO,EAAE,kBAAkB,EAAE,MAAM,mBAAmB,CAAC;AACvD,OAAO,EAAE,eAAe,EAAE,MAAM,YAAY,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,oBAAoB,CAAC;AAC7C,OAAO,EAAE,6BAA6B,EAAE,MAAM,iCAAiC,CAAC;AAChF,OAAO,EAAE,qBAAqB,EAAE,uBAAuB,EAAE,MAAM,4BAA4B,CAAC;AAC5F,OAAO,EAAE,KAAK,EAAE,MAAM,yCAAyC,CAAC;AAiBhE,MAAM,OAAO,WAA2D,SAAQ,cAAiB;IAAjG;;QAEE,SAAI,GAAG,cAAc,CAAC,KAAK,CAAC;QAKnB,2BAAsB,GAAG,6BAA6B,CAAC;QAGtD,oBAAe,GAAY,KAAK,CAAC;IAkL7C,CAAC;IAhLC,UAAU;IAEV,CAAC;IAED,OAAO;QACL,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC3B,CAAC;IAED,QAAQ;;QACN,MAAM,aAAa,GAAG,CAAA,MAAA,IAAI,CAAC,KAAK,CAAC,IAAI,0CAAE,OAAO,MAAK,KAAK,IAAI,CAAA,MAAA,MAAA,IAAI,CAAC,KAAK,CAAC,IAAI,0CAAE,KAAK,0CAAE,OAAO,MAAK,KAAK,CAAC;QACtG,MAAM,UAAU,GAAG,MAAA,IAAI,CAAC,KAAK,CAAC,UAAU,mCAAI,MAAM,CAAC;QACnD,IAAI,CAAC,YAAY,CAAC,aAAa,IAAI,UAAU,KAAK,MAAM,CAAC,CAAC;QAC1D,IAAI,CAAC,YAAY,CAAC,UAAU,KAAK,MAAM,IAAI,CAAC,UAAU,KAAK,MAAM,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;QACtF,IAAI,CAAC,cAAc,CAAC,UAAU,KAAK,OAAO,CAAC,CAAC;IAC9C,CAAC;IAED,aAAa;QACX,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YAChE,IAAI,IAAI,EAAE;gBACR,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE;oBACtB,MAAM,EAAE,GAAG,EAAE;;wBACX,OAAO,MAAA,IAAI,CAAC,eAAe,0CAAE,MAAM,EAAE,CAAC;oBACxC,CAAC;iBACF,CAAC,CAAC;aACJ;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,YAAY,CAAC,YAAqB;QAChC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE;YACvD,QAAQ,EAAE,IAAI,CAAC,YAAY;YAC3B,YAAY;SACb,CAAc,CAAC;IAClB,CAAC;IAED,iBAAiB;QACf,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,IAAI,QAAQ,EAAE;YACZ,IAAI,CAAC,YAAY,CACf,QAAQ,EACR;gBACE,CAAC,EAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClC,CAAC,EAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC;gBAClC,EAAE,EAAE,CAAC,KAAY,EAAE,EAAE;oBACnB,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;wBAC7D,OAAO,MAAM,CAAC,GAAG,CAAC;qBACnB;oBACD,OAAO,IAAI,CAAC,eAAe,CACzB,IAAI,CAAC,sBAAsB,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,EACpD,IAAI,CAAC,QAAQ,EAAE;wBACb,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,EAAE,IAAI,CAAC,iBAAiB,CAAC;wBAC5D,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CACjC,CAAC,CAAC,CAAC;gBACN,CAAC;gBACD,EAAE,EAAE,CAAC,KAAY,EAAE,EAAE;oBACnB,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;wBAC7D,OAAO,MAAM,CAAC,GAAG,CAAC;qBACnB;oBAED,MAAM,KAAK,GAAG,IAAI,CAAC,eAAe,CAChC,IAAI,CAAC,sBAAsB,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,EACpD,IAAI,CAAC,QAAQ,EAAE;wBACb,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK,EAAE,IAAI,CAAC,iBAAiB,CAAC;wBAC5D,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CACjC,CAAC,CAAC,CAAC;oBACJ,OAAO,KAAK,CAAC;gBACf,CAAC;gBACD,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE;gBAC9B,SAAS,EAAE,0BAA0B;gBACrC,SAAS,EAAE,IAAI;aAChB,EACD,QAAQ,EACR,cAAc,CAAC,MAAM,CACtB,CAAC;YAEF,IAAI,IAAI,CAAC,YAAY,KAAK,MAAM,EAAE;gBAChC,IAAI,CAAC,YAAY,CACf,QAAQ,EACR;oBACE,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC;oBAC3C,aAAa,EAAE,IAAI,CAAC,sBAAsB,EAAE;iBAC7C,EACD,QAAQ,EACR,cAAc,CAAC,MAAM,CACtB,CAAC;aACH;YACD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,UAAU,CAAC,wBAAwB,EAAE,EAAE,MAAM,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,KAAK,IAAI,EAAE,EAAE,GAAG,EAAE;gBACjG,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;SACJ;IACH,CAAC;IAES,WAAW;QACnB,KAAK,CAAC,WAAW,EAAE,CAAC;QACpB,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC;QAC7D,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC3B;QACD,IAAI,IAAI,CAAC,SAAS,EAAE;YAClB,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC3B;QACD,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC3B,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;SAC7B;IACH,CAAC;IAED,aAAa;;QACX,MAAM,eAAe,GAA0B;YAC7C,MAAM,EAAE,GAAG,EAAE,WAAC,OAAA,MAAA,IAAI,CAAC,eAAe,0CAAE,MAAM,EAAE,CAAA,EAAA;YAC5C,MAAM,EAAE,GAAG,EAAE;gBACX,MAAM,IAAI,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;gBAClC,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YAC3C,CAAC;YACD,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,kBAAkB;SACxG,CAAC;QACF,MAAM,YAAY,GAAG,CAAC,MAAA,MAAC,MAAA,IAAI,CAAC,KAAK,0CAAE,eAAwD,0CAAE,MAAM,mCACjG,QAAQ,CAAsB,CAAC;QAEjC,IAAI,YAAY,KAAK,QAAQ,EAAE;YAC7B,IAAI,IAAI,CAAC,SAAS,EAAE;gBAClB,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAC/B,eAAe,CACb,MAAA,OAAO,CAAC,iBAAiB,CAAC,YAAY,CAAC,0CAAG,eAAe,EAAE,YAAY,CAAC,EACxE,mBAAmB,UAA2B,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,qBAAqB,CAAC,CACtF,CACF,CAAC;aACH;SACF;QAGD,MAAM,gBAAgB,GAAsB;YAC1C,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;YACzB,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;YACzB,CAAC,IAAI,CAAC,WAAW,EAAE,aAAa,CAAC;SAClC,CAAC;QAGF,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,EAAE,EAAE;YAC7C,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;gBACjB,MAAM,YAAY,GAAG,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;gBAC1D,IAAI,CAAC,kBAAkB,CACrB,eAAe,CACb,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAG,eAAe,EAAE,YAAY,CAAC,EAC7C,mBAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,qBAAqB,CAAC,CACvE,CACF,CAAC;aACH;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,mBAAmB;QACjB,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,cAAc;QACZ,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;IAC5D,CAAC;IAED,cAAc,CAAC,KAAY;QACzB,OAAO,CAAC,SAAiB,EAAE,EAAE;;YAC3B,IAAI,MAAM,GAAG,MAAA,MAAA,IAAI,CAAC,WAAW,0CAAE,YAAY,CAAC,SAAgB,EAAE,KAAK,CAAC,mCAAI,SAAS,CAAC;YAClF,IAAI,SAAS,KAAK,MAAM,IAAI,CAAC,MAAM,EAAE;gBACnC,SAAS,GAAG,QAAQ,CAAC;gBACrB,MAAM,GAAG,MAAA,MAAA,IAAI,CAAC,WAAW,0CAAE,YAAY,CAAC,SAAS,EAAE,KAAK,CAAC,mCAAI,SAAS,CAAC;aACxE;YACD,IAAI,SAAS,KAAK,QAAQ,IAAI,OAAO,CAAC,MAAM,CAAC,EAAE;gBAC7C,OAAO,MAAM,CAAC,CAAC,CAAC,CAAC;aAClB;YACD,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC;IACJ,CAAC;;AA1Le,gBAAI,GAAW,cAAc,CAAC,KAAK,CAAC;AAGpC,gBAAI,GAAkB,eAAe,CAAC;AACtC,wBAAY,GAAG,EAAE,KAAK,EAAE,CAAC;AACzB,kCAAsB,GAAG,6BAAoC,CAAC;AAwLhF,KAAK,CAAC,WAAW,EAAE,mBAAmB,CAAC,CAAC;AAExC,MAAM,CAAC,MAAM,mBAAmB,GAAG,GAAG,EAAE;IACtC,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;IACtD,gBAAgB,EAAE,CAAC;IACnB,gBAAgB,EAAE,CAAC;IACnB,kBAAkB,EAAE,CAAC;IACrB,sBAAsB,EAAE,CAAC;IACzB,qBAAqB,EAAE,CAAC;IACxB,uBAAuB,EAAE,CAAC;AAC5B,CAAC,CAAC","file":"radar.js","sourcesContent":["/* eslint-disable no-duplicate-imports */\nimport { LineLikeSeriesMixin } from '../mixin/line-mixin';\nimport type { IAreaMark, ILineMark, IMark, IMarkProgressiveConfig } from '../../mark/interface';\nimport { POLAR_START_RADIAN } from '../../constant/polar';\nimport { AttributeLevel } from '../../constant/attribute';\nimport { ChartEvent } from '../../constant/event';\nimport { DEFAULT_LINEAR_INTERPOLATE } from '../../typings/interpolate';\nimport type { Datum } from '../../typings';\nimport type { SeriesMarkMap } from '../interface';\nimport { SeriesMarkNameEnum, SeriesTypeEnum } from '../interface/type';\nimport { degreeToRadian, isArray, mixin, isValid } from '@visactor/vutils';\nimport type { IRadarAnimationParams, IRadarSeriesSpec, RadarAppearPreset } from './interface';\nimport { animationConfig, userAnimationConfig } from '../../animation/utils';\nimport { registerRadarAnimation } from './animation';\nimport { RoseLikeSeries } from '../polar/rose-like';\nimport type { IStateAnimateSpec } from '../../animation/spec';\nimport { registerAreaMark } from '../../mark/area';\nimport { registerLineMark } from '../../mark/line';\nimport { registerSymbolMark } from '../../mark/symbol';\nimport { radarSeriesMark } from './constant';\nimport { Factory } from '../../core/factory';\nimport { LineLikeSeriesSpecTransformer } from '../mixin/line-mixin-transformer';\nimport { registerPolarBandAxis, registerPolarLinearAxis } from '../../component/axis/polar';\nimport { radar } from '../../theme/builtin/common/series/radar';\n\nexport interface RadarSeries<T extends IRadarSeriesSpec>\n  extends Pick<\n      LineLikeSeriesMixin,\n      | 'initLineMark'\n      | 'initSymbolMark'\n      | 'initLabelMarkStyle'\n      | 'initLineMarkStyle'\n      | 'initSymbolMarkStyle'\n      | 'encodeDefined'\n      | '_lineMark'\n      | '_symbolMark'\n      | 'addOverlapCompile'\n    >,\n    RoseLikeSeries<T> {}\n\nexport class RadarSeries<T extends IRadarSeriesSpec = IRadarSeriesSpec> extends RoseLikeSeries<T> {\n  static readonly type: string = SeriesTypeEnum.radar;\n  type = SeriesTypeEnum.radar;\n\n  static readonly mark: SeriesMarkMap = radarSeriesMark;\n  static readonly builtInTheme = { radar };\n  static readonly transformerConstructor = LineLikeSeriesSpecTransformer as any;\n  readonly transformerConstructor = LineLikeSeriesSpecTransformer;\n\n  private _areaMark: ILineMark;\n  protected _sortDataByAxis: boolean = false;\n\n  initGroups() {\n    // do nothing\n  }\n\n  compile(): void {\n    super.compile();\n    this.addOverlapCompile();\n  }\n\n  initMark(): void {\n    const isAreaVisible = this._spec.area?.visible !== false && this._spec.area?.style?.visible !== false;\n    const seriesMark = this._spec.seriesMark ?? 'area';\n    this.initAreaMark(isAreaVisible && seriesMark === 'area');\n    this.initLineMark(seriesMark === 'line' || (seriesMark === 'area' && !isAreaVisible));\n    this.initSymbolMark(seriesMark === 'point');\n  }\n\n  initMarkStyle(): void {\n    this.initAreaMarkStyle();\n    this.initLineMarkStyle();\n    this.initSymbolMarkStyle();\n    [this._lineMark, this._symbolMark, this._areaMark].forEach(mark => {\n      if (mark) {\n        this.setMarkStyle(mark, {\n          center: () => {\n            return this.angleAxisHelper?.center();\n          }\n        });\n      }\n    });\n  }\n\n  initAreaMark(isSeriesMark: boolean) {\n    this._areaMark = this._createMark(RadarSeries.mark.area, {\n      groupKey: this._seriesField,\n      isSeriesMark\n    }) as IAreaMark;\n  }\n\n  initAreaMarkStyle() {\n    const areaMark = this._areaMark;\n    if (areaMark) {\n      this.setMarkStyle(\n        areaMark,\n        {\n          x: this.dataToPositionX.bind(this),\n          y: this.dataToPositionY.bind(this),\n          x1: (datum: Datum) => {\n            if (!datum || !this.angleAxisHelper || !this.radiusAxisHelper) {\n              return Number.NaN;\n            }\n            return this.valueToPosition(\n              this.getDatumPositionValues(datum, this._angleField),\n              this.getStack()\n                ? this.getDatumPositionValues(datum, this._innerRadiusField)\n                : this.radiusScale.domain()[0]\n            ).x;\n          },\n          y1: (datum: Datum) => {\n            if (!datum || !this.angleAxisHelper || !this.radiusAxisHelper) {\n              return Number.NaN;\n            }\n\n            const value = this.valueToPosition(\n              this.getDatumPositionValues(datum, this._angleField),\n              this.getStack()\n                ? this.getDatumPositionValues(datum, this._innerRadiusField)\n                : this.radiusScale.domain()[0]\n            ).y;\n            return value;\n          },\n          fill: this.getColorAttribute(),\n          curveType: DEFAULT_LINEAR_INTERPOLATE,\n          closePath: true\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n\n      if (this._invalidType !== 'zero') {\n        this.setMarkStyle(\n          areaMark,\n          {\n            defined: this._getInvalidDefined.bind(this),\n            connectedType: this._getInvalidConnectType()\n          },\n          'normal',\n          AttributeLevel.Series\n        );\n      }\n      this.event.on(ChartEvent.viewDataStatisticsUpdate, { filter: param => param.model === this }, () => {\n        this.encodeDefined(areaMark, 'defined');\n      });\n    }\n  }\n\n  protected initTooltip() {\n    super.initTooltip();\n    const { group, mark } = this._tooltipHelper.activeTriggerSet;\n    if (this._lineMark) {\n      group.add(this._lineMark);\n    }\n    if (this._areaMark) {\n      group.add(this._areaMark);\n    }\n    if (this._symbolMark) {\n      mark.add(this._symbolMark);\n      group.add(this._symbolMark);\n    }\n  }\n\n  initAnimation() {\n    const animationParams: IRadarAnimationParams = {\n      center: () => this.angleAxisHelper?.center(),\n      radius: () => {\n        const rect = this.getLayoutRect();\n        return Math.min(rect.width, rect.height);\n      },\n      startAngle: isValid(this._spec.startAngle) ? degreeToRadian(this._spec.startAngle) : POLAR_START_RADIAN\n    };\n    const appearPreset = ((this._spec?.animationAppear as IStateAnimateSpec<RadarAppearPreset>)?.preset ??\n      'clipIn') as RadarAppearPreset;\n\n    if (appearPreset === 'clipIn') {\n      if (this._rootMark) {\n        this._rootMark.setAnimationConfig(\n          animationConfig(\n            Factory.getAnimationInKey('radarGroup')?.(animationParams, appearPreset),\n            userAnimationConfig(SeriesMarkNameEnum.group, this._spec, this._markAttributeContext)\n          )\n        );\n      }\n    }\n\n    // TODO: animationType\n    const markAnimationMap: [IMark, string][] = [\n      [this._areaMark, 'radar'],\n      [this._lineMark, 'radar'],\n      [this._symbolMark, 'radarSymbol']\n    ];\n\n    // 为 mark 添加动画\n    markAnimationMap.forEach(([mark, animation]) => {\n      if (isValid(mark)) {\n        const getAnimation = Factory.getAnimationInKey(animation);\n        mark.setAnimationConfig(\n          animationConfig(\n            getAnimation?.(animationParams, appearPreset),\n            userAnimationConfig(mark.name, this._spec, this._markAttributeContext)\n          )\n        );\n      }\n    });\n  }\n\n  getDefaultShapeType() {\n    return 'square';\n  }\n\n  getActiveMarks(): IMark[] {\n    return [this._areaMark, this._symbolMark, this._lineMark];\n  }\n\n  getSeriesStyle(datum: Datum) {\n    return (attribute: string) => {\n      let result = this._seriesMark?.getAttribute(attribute as any, datum) ?? undefined;\n      if (attribute === 'fill' && !result) {\n        attribute = 'stroke';\n        result = this._seriesMark?.getAttribute(attribute, datum) ?? undefined;\n      }\n      if (attribute === 'stroke' && isArray(result)) {\n        return result[0];\n      }\n      return result;\n    };\n  }\n}\n\nmixin(RadarSeries, LineLikeSeriesMixin);\n\nexport const registerRadarSeries = () => {\n  Factory.registerSeries(RadarSeries.type, RadarSeries);\n  registerAreaMark();\n  registerLineMark();\n  registerSymbolMark();\n  registerRadarAnimation();\n  registerPolarBandAxis();\n  registerPolarLinearAxis();\n};\n"]}