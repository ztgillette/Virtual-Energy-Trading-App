{"version":3,"sources":["../src/mark/component.ts"],"names":[],"mappings":"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","file":"component.js","sourcesContent":["import { Factory } from './../core/factory';\nimport type { ICommonSpec } from '../typings';\nimport { BaseMark } from './base/base-mark';\nimport type { IComponentMark, IMarkOption, IMarkStyle } from './interface';\n// eslint-disable-next-line no-duplicate-imports\nimport { MarkTypeEnum } from './interface/type';\nimport type { IGraphic, IGroupGraphicAttribute } from '@visactor/vrender-core';\nimport { isNil } from '@visactor/vutils';\nimport { HOOK_EVENT } from '../constant/event';\n\nexport class ComponentMark extends BaseMark<ICommonSpec> implements IComponentMark {\n  static readonly type = MarkTypeEnum.component;\n  type: string = 'component';\n\n  private _componentType: string;\n  private _component: IGraphic;\n  private _mode: '2d' | '3d';\n\n  constructor(name: string, option: IMarkOption) {\n    super(name, option);\n    // 这里需要将 type 指定为具体的组件名称，即调用 vgrammar 的 registerComponent API 注册的组件名称\n    this._componentType = option.componentType;\n\n    this._mode = option.mode;\n  }\n\n  protected _getDefaultStyle(): IMarkStyle<ICommonSpec> {\n    return {};\n  }\n\n  getComponent() {\n    return this._component;\n  }\n  clearComponent() {\n    if (this._component) {\n      if (this._component.parent) {\n        this._component.parent.removeChild(this._component);\n      }\n\n      this._component = null;\n    }\n  }\n\n  protected _getAttrsFromConfig(attrs: IGroupGraphicAttribute = {}) {\n    const configAttrs = super._getAttrsFromConfig(attrs);\n\n    if (!isNil(this._markConfig.interactive)) {\n      configAttrs.pickable = this._markConfig.interactive;\n    }\n    return attrs;\n  }\n\n  protected _attributesTransform: (attrs: any) => any;\n  setAttributeTransform(t: (attrs: any) => any) {\n    this._attributesTransform = t;\n  }\n\n  renderInner() {\n    const style = this._simpleStyle ?? this.getAttributesOfState({});\n\n    let attrs = this._getAttrsFromConfig(style as unknown as IGroupGraphicAttribute);\n\n    if (this._attributesTransform) {\n      attrs = this._attributesTransform(attrs);\n    }\n\n    if (this._animationConfig) {\n      attrs = {\n        ...attrs,\n        animation: true,\n        animationAppear: this._animationConfig.appear\n          ? Array.isArray(this._animationConfig.appear)\n            ? this._animationConfig.appear[0]\n            : this._animationConfig.appear\n          : undefined,\n        animationEnter: this._animationConfig.enter\n          ? Array.isArray(this._animationConfig.enter)\n            ? this._animationConfig.enter[0]\n            : this._animationConfig.enter\n          : undefined,\n        animationUpdate: this._animationConfig.update\n          ? Array.isArray(this._animationConfig.update)\n            ? this._animationConfig.update[0]\n            : this._animationConfig.update\n          : undefined,\n        animationExit: this._animationConfig.exit\n          ? Array.isArray(this._animationConfig.exit)\n            ? this._animationConfig.exit[0]\n            : this._animationConfig.exit\n          : undefined\n      } as any;\n    }\n\n    if (!this._component) {\n      this._component = Factory.createGraphicComponent(this._componentType, attrs, {\n        mode: this._mode,\n        skipDefault: this._markConfig.skipTheme\n      });\n      this._component && this._product.appendChild(this._component);\n    } else {\n      this._component.setAttributes(attrs as any);\n    }\n\n    if (this._component) {\n      this._component.context = this._getCommonContext();\n    }\n\n    if (this._markConfig.support3d && this._product) {\n      this._product.setMode('3d');\n    }\n\n    this.model.event.emit(HOOK_EVENT.AFTER_ELEMENT_ENCODE, {\n      mark: this,\n      model: this.model\n    });\n    this.needClear = true;\n  }\n\n  release() {\n    super.release();\n    this.removeProduct();\n  }\n}\n\nexport const registerComponentMark = () => {\n  Factory.registerMark(ComponentMark.type, ComponentMark);\n};\n"]}