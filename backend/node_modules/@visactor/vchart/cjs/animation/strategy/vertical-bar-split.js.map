{"version":3,"sources":["../src/animation/strategy/vertical-bar-split.ts"],"names":[],"mappings":";;;AAQA,MAAa,wBAAwB;IAArC;QACE,SAAI,GAAG,kBAAkB,CAAC;IAkD5B,CAAC;IAhDC,WAAW,CAAC,IAAmB,EAAE,OAAqB;;QAEpD,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,KAAK,MAAM,CAAC;QACxC,MAAM,UAAU,GAAG,CAAA,MAAC,IAAI,CAAC,KAAa,0CAAE,SAAS,MAAK,UAAU,CAAC;QAGjE,MAAM,SAAS,GAAG,CAAA,MAAA,OAAO,CAAC,OAAO,0CAAE,SAAS,KAAI,EAAE,CAAC;QACnD,MAAM,mBAAmB,GAAG,GAAG,IAAI,SAAS,IAAI,OAAO,IAAI,SAAS,IAAI,IAAI,IAAI,SAAS,CAAC;QAC1F,MAAM,eAAe,GAAG,GAAG,IAAI,SAAS,IAAI,QAAQ,IAAI,SAAS,IAAI,IAAI,IAAI,SAAS,CAAC;QAEvF,OAAO,UAAU,IAAI,UAAU,IAAI,mBAAmB,IAAI,eAAe,CAAC;IAC5E,CAAC;IAED,KAAK,CAAC,IAAmB,EAAE,OAAqB;;QAC9C,MAAM,SAAS,GAAG,CAAA,MAAA,OAAO,CAAC,OAAO,0CAAE,SAAS,KAAI,EAAE,CAAC;QACnD,MAAM,cAAc,GAAwB,EAAE,CAAC;QAC/C,MAAM,UAAU,GAAwB,EAAE,CAAC;QAG3C,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;YACjD,IAAI,GAAG,KAAK,GAAG,IAAI,GAAG,KAAK,OAAO,IAAI,GAAG,KAAK,IAAI,EAAE;gBAClD,cAAc,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;aAC7B;iBAAM,IAAI,GAAG,KAAK,GAAG,IAAI,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;gBAC1D,UAAU,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;aACzB;iBAAM;gBAEL,cAAc,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;aAC7B;QACH,CAAC,CAAC,CAAC;QAKH,MAAM,OAAO,GAAG,OAAO,CAAC,OAAc,CAAC;QACvC,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;QAC9B,MAAM,cAAc,GAAG,OAAO,CAAC,cAAc,CAAC;QAG9C,MAAM,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;QAC7D,MAAM,UAAU,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QAE/G,MAAM,WAAW,GAAG,UAAU,IAAI,SAAS,CAAC;QAE5C,OAAO;YACL,EAAE,KAAK,EAAE,cAAc,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;YACrD,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;SAClD,CAAC;IACJ,CAAC;CACF;AAnDD,4DAmDC","file":"vertical-bar-split.js","sourcesContent":["import type { IMarkGraphic } from '../../mark/interface';\nimport type { BaseMark } from '../../mark';\nimport type { IAnimationSplitStrategy } from '../interface';\n\n/**\n * 垂直柱状图拆分策略\n * 针对垂直柱状图，先更新x和width，再更新y和height\n */\nexport class VerticalBarSplitStrategy implements IAnimationSplitStrategy {\n  name = 'verticalBarSplit';\n\n  shouldApply(mark: BaseMark<any>, graphic: IMarkGraphic): boolean {\n    // 检查是否是柱状图且方向是垂直的\n    const isRectMark = mark.type === 'rect';\n    const isVertical = (mark.model as any)?.direction === 'vertical';\n\n    // 检查是否同时存在维度和值的变化\n    const diffAttrs = graphic.context?.diffAttrs || {};\n    const hasDimensionChanges = 'x' in diffAttrs || 'width' in diffAttrs || 'x1' in diffAttrs;\n    const hasValueChanges = 'y' in diffAttrs || 'height' in diffAttrs || 'y1' in diffAttrs;\n\n    return isRectMark && isVertical && hasDimensionChanges && hasValueChanges;\n  }\n\n  split(mark: BaseMark<any>, graphic: IMarkGraphic): Array<{ attrs: Record<string, any>; order: number }> {\n    const diffAttrs = graphic.context?.diffAttrs || {};\n    const dimensionAttrs: Record<string, any> = {};\n    const valueAttrs: Record<string, any> = {};\n\n    // 分配属性到对应的组\n    Object.entries(diffAttrs).forEach(([key, value]) => {\n      if (key === 'x' || key === 'width' || key === 'x1') {\n        dimensionAttrs[key] = value;\n      } else if (key === 'y' || key === 'height' || key === 'y1') {\n        valueAttrs[key] = value;\n      } else {\n        // 其他属性（如颜色、透明度等）与维度一起更新\n        dimensionAttrs[key] = value;\n      }\n    });\n\n    // 检查是从堆积变为分组还是从分组变为堆积\n    // 如果fieldX长度增加，说明是从堆积变为分组，先执行x/width\n    // 如果fieldX长度减少，说明是从分组变为堆积，先执行y/height\n    const context = graphic.context as any;\n    const fieldX = context.fieldX;\n    const originalFieldX = context.originalFieldX;\n\n    // 检查fieldX是否是数组（表示多维度）\n    const isGrouped = Array.isArray(fieldX) && fieldX.length > 1;\n    const wasStacked = originalFieldX ? !(Array.isArray(originalFieldX) && originalFieldX.length > 1) : !isGrouped;\n\n    const stack2group = wasStacked && isGrouped;\n    // 默认情况：先执行x/width，再执行y/height\n    return [\n      { attrs: dimensionAttrs, order: stack2group ? 1 : 2 }, // 先更新维度（x和width）\n      { attrs: valueAttrs, order: stack2group ? 2 : 1 } // 再更新值（y和height）\n    ];\n  }\n}\n"]}