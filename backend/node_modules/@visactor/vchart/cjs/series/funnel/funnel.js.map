{"version":3,"sources":["../src/series/funnel/funnel.ts"],"names":[],"mappings":"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","file":"funnel.js","sourcesContent":["/* eslint-disable no-duplicate-imports */\nimport type { IFunnelSeries, SeriesMarkMap } from '../interface';\nimport { SeriesMarkNameEnum } from '../interface/type';\nimport type { IOrientType, IPoint, TextAlign, TextBaseLine, Datum, StringOrNumber } from '../../typings';\nimport { SeriesTypeEnum } from '../interface/type';\nimport { BaseSeries } from '../base/base-series';\nimport { AttributeLevel } from '../../constant/attribute';\nimport { DEFAULT_DATA_KEY } from '../../constant/data';\nimport { PREFIX } from '../../constant/base';\nimport { registerDataSetInstanceTransform } from '../../data/register';\nimport { DataView } from '@visactor/vdataset';\nimport type { ILabelMark, IMark, IMarkGraphic, IPolygonMark, IRuleMark, ITextMark } from '../../mark/interface';\nimport { MarkTypeEnum } from '../../mark/interface/type';\nimport type { IFunnelOpt } from '../../data/transforms/funnel';\nimport { funnel, funnelTransform } from '../../data/transforms/funnel';\nimport {\n  FUNNEL_CURRENT_VALUE,\n  FUNNEL_HEIGHT_RATIO,\n  FUNNEL_LABEL_LINE_LENGTH,\n  FUNNEL_LABEL_SPACE_WIDTH,\n  FUNNEL_LAST_VALUE,\n  FUNNEL_LAST_VALUE_RATIO,\n  FUNNEL_MAX_SIZE,\n  FUNNEL_MIN_SIZE,\n  FUNNEL_NEXT_VALUE,\n  FUNNEL_NEXT_VALUE_RATIO,\n  FUNNEL_REACH_RATIO,\n  FUNNEL_TRANSFORM_LEVEL,\n  FUNNEL_TRANSFORM_RATIO,\n  FUNNEL_VALUE_RATIO\n} from '../../constant/funnel';\nimport { calcLayoutNumber } from '../../util/space';\nimport { field } from '../../util/object';\nimport type { FunnelAppearPreset, IFunnelSeriesSpec, IFunnelSeriesTheme } from './interface';\nimport { FunnelSeriesTooltipHelper } from './tooltip-helper';\nimport { isFunction, isValid, isNumber } from '@visactor/vutils';\nimport {\n  FadeInOutAnimation,\n  registerCartesianGroupClipAnimation,\n  registerFadeInOutAnimation\n} from '../../animation/config';\nimport { animationConfig, shouldMarkDoMorph, userAnimationConfig } from '../../animation/utils';\nimport type { IStateAnimateSpec } from '../../animation/spec';\nimport { registerPolygonMark } from '../../mark/polygon/polygon';\nimport { registerTextMark } from '../../mark/text';\nimport { registerRuleMark } from '../../mark/rule';\nimport { funnelSeriesMark } from './constant';\nimport type { LabelItem } from '@visactor/vrender-components';\nimport { Factory } from '../../core/factory';\nimport { FunnelSeriesSpecTransformer } from './funnel-transformer';\nimport type { ICompilableData } from '../../compile/data';\nimport { CompilableData } from '../../compile/data';\nimport { moveAfterInArray } from '../../util/array';\nimport { funnel as funnelTheme } from '../../theme/builtin/common/series/funnel';\n\nexport class FunnelSeries<T extends IFunnelSeriesSpec = IFunnelSeriesSpec>\n  extends BaseSeries<T>\n  implements IFunnelSeries\n{\n  static readonly type: string = SeriesTypeEnum.funnel;\n  type: string = SeriesTypeEnum.funnel;\n  protected _funnelMarkName: string = SeriesMarkNameEnum.funnel;\n  protected _funnelMarkType: string = MarkTypeEnum.polygon;\n  protected _transformMarkName: string = SeriesMarkNameEnum.transform;\n  protected _transformMarkType: string = MarkTypeEnum.polygon;\n\n  static readonly mark: SeriesMarkMap = funnelSeriesMark;\n  static readonly builtInTheme: Record<string, IFunnelSeriesTheme> = { funnel: funnelTheme };\n  static readonly transformerConstructor = FunnelSeriesSpecTransformer as any;\n  readonly transformerConstructor = FunnelSeriesSpecTransformer;\n\n  protected _categoryField!: string;\n  getCategoryField() {\n    return this._categoryField;\n  }\n  setCategoryField(f: string): string {\n    this._categoryField = f;\n    return this._categoryField;\n  }\n\n  protected _valueField!: string;\n  getValueField() {\n    return this._valueField;\n  }\n  setValueField(f: string): string {\n    this._valueField = f;\n    return this._valueField;\n  }\n\n  protected _viewDataTransform!: ICompilableData;\n\n  protected _funnelAlign: 'left' | 'center' | 'right' | 'top' | 'bottom';\n  protected _funnelOrient: IOrientType;\n  protected _shape: 'rect' | 'trapezoid';\n\n  protected _funnelMark: IPolygonMark | null = null;\n  protected _funnelTransformMark: IPolygonMark | null = null;\n  protected _labelMark: ILabelMark | null = null;\n  protected _transformLabelMark: ILabelMark | null = null;\n  protected _funnelOuterLabelMark: { label?: ITextMark; line?: IRuleMark } = {};\n\n  protected _minLabelLineWidth: number;\n\n  setAttrFromSpec(): void {\n    super.setAttrFromSpec();\n\n    this.setCategoryField(this._spec.categoryField);\n    this.setValueField(this._spec.valueField);\n\n    this._funnelOrient = this._spec.funnelOrient ?? 'top';\n    this._shape = this._spec.shape ?? 'trapezoid';\n    this._minLabelLineWidth = this._spec.outerLabel?.line?.minLength ?? FUNNEL_LABEL_LINE_LENGTH;\n\n    if (this._isHorizontal()) {\n      this._funnelAlign = ['top', 'bottom'].includes(this._spec.funnelAlign) ? this._spec.funnelAlign : 'center';\n    } else {\n      this._funnelAlign = ['left', 'right'].includes(this._spec.funnelAlign) ? this._spec.funnelAlign : 'center';\n    }\n\n    if (!this._seriesField && this._spec.categoryField) {\n      this.setSeriesField(this._spec.categoryField);\n    }\n  }\n\n  initData() {\n    super.initData();\n    if (!this._data) {\n      return;\n    }\n\n    registerDataSetInstanceTransform(this._dataSet, 'funnel', funnel);\n    registerDataSetInstanceTransform(this._dataSet, 'funnelTransform', funnelTransform);\n\n    const viewDataTransform = new DataView(this._dataSet, { name: `${PREFIX}_series_${this.id}_viewDataTransform` });\n    viewDataTransform.parse([this.getViewData()], {\n      type: 'dataview'\n    });\n\n    this._viewDataTransform = new CompilableData(this._option, viewDataTransform);\n  }\n\n  compile() {\n    super.compile();\n\n    if (this._funnelOuterLabelMark) {\n      this._funnelOuterLabelMark.label?.compile({\n        group: this._rootMark.getProduct()\n      });\n      this._funnelOuterLabelMark.line?.compile({\n        group: this._rootMark.getProduct()\n      });\n    }\n  }\n\n  compileData() {\n    super.compileData();\n    this._viewDataTransform?.compile();\n  }\n\n  getStatisticFields() {\n    const fields: { key: string; operations: Array<'max' | 'min' | 'values'> }[] = [];\n    fields.push({ key: this._categoryField, operations: ['values'] });\n    fields.push({ key: this._valueField, operations: ['max', 'min'] });\n    return fields;\n  }\n\n  protected _statisticViewData(): void {\n    super._statisticViewData();\n    this._data.getDataView().transform({\n      type: 'funnel',\n      options: {\n        valueField: this.getValueField(),\n        isCone: this._spec.isCone,\n        // heightVisual: true,\n        asCurrentValue: FUNNEL_CURRENT_VALUE,\n        asTransformRatio: FUNNEL_TRANSFORM_RATIO,\n        asReachRatio: FUNNEL_REACH_RATIO,\n        asHeightRatio: FUNNEL_HEIGHT_RATIO,\n        asValueRatio: FUNNEL_VALUE_RATIO,\n        asNextValueRatio: FUNNEL_NEXT_VALUE_RATIO,\n        asLastValueRatio: FUNNEL_LAST_VALUE_RATIO,\n        asLastValue: FUNNEL_LAST_VALUE,\n        asNextValue: FUNNEL_NEXT_VALUE,\n        range: {\n          min: this._spec.range?.min ?? this.getViewDataStatistics().latestData?.[this.getValueField()]?.min,\n          max: this._spec.range?.max ?? this.getViewDataStatistics().latestData?.[this.getValueField()]?.max\n        }\n      } as IFunnelOpt\n    });\n\n    this._viewDataTransform.getDataView()?.transform({\n      type: 'funnelTransform',\n      options: { asIsTransformLevel: FUNNEL_TRANSFORM_LEVEL }\n    });\n  }\n\n  initMark() {\n    this._funnelMark = this._createMark(\n      {\n        ...FunnelSeries.mark.funnel,\n        name: this._funnelMarkName,\n        type: this._funnelMarkType\n      },\n      {\n        themeSpec: this._theme?.funnel,\n        groupKey: this._seriesField,\n        isSeriesMark: true,\n        noSeparateStyle: true\n      },\n      {\n        morph: shouldMarkDoMorph(this._spec, this._funnelMarkName),\n        morphElementKey: this._seriesField\n      }\n    ) as IPolygonMark;\n\n    if (this._spec.isTransform) {\n      this._funnelTransformMark = this._createMark(\n        {\n          ...FunnelSeries.mark.transform,\n          name: this._transformMarkName,\n          type: this._transformMarkType\n        },\n        {\n          themeSpec: this._theme?.transform,\n          noSeparateStyle: true\n        }\n      );\n      if (this._funnelTransformMark) {\n        this._funnelTransformMark.setData(this._viewDataTransform);\n      }\n    }\n\n    if (this._spec?.outerLabel?.visible) {\n      const { line } = this._spec.outerLabel ?? {};\n      const { line: lineTheme } = this._theme?.outerLabel ?? {};\n\n      this._funnelOuterLabelMark.label = this._createMark(FunnelSeries.mark.outerLabel, {\n        themeSpec: this._theme?.outerLabel,\n        markSpec: this._spec.outerLabel,\n        noSeparateStyle: true,\n        parent: false\n      }) as ITextMark;\n      this._funnelOuterLabelMark.line = this._createMark(FunnelSeries.mark.outerLabelLine, {\n        themeSpec: lineTheme,\n        markSpec: line,\n        noSeparateStyle: true,\n        parent: false\n      }) as IRuleMark;\n    }\n  }\n\n  protected initTooltip() {\n    this._tooltipHelper = new FunnelSeriesTooltipHelper(this);\n    this._funnelMark && this._tooltipHelper.activeTriggerSet.mark.add(this._funnelMark);\n    this._funnelTransformMark && this._tooltipHelper.activeTriggerSet.mark.add(this._funnelTransformMark);\n  }\n\n  getDimensionField(): string[] {\n    return this._seriesField ? [this._seriesField] : [];\n  }\n  getMeasureField(): string[] {\n    return [this._valueField];\n  }\n\n  getGroupFields(): string[] {\n    return null;\n  }\n\n  initMarkStyle() {\n    const funnelMark = this._funnelMark;\n    if (funnelMark) {\n      this.setMarkStyle(\n        funnelMark,\n        {\n          points: (datum: Datum) => this.getPoints(datum),\n          visible: (datum: Datum) => isValid(datum[this._valueField]),\n          fill: this.getColorAttribute()\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n    }\n\n    const funnelTransformMark = this._funnelTransformMark;\n    if (funnelTransformMark) {\n      this.setMarkStyle(\n        funnelTransformMark,\n        { points: (datum: Datum) => this.getPoints(datum) },\n        'normal',\n        AttributeLevel.Series\n      );\n    }\n\n    const outerLabelMark = this._funnelOuterLabelMark.label;\n    if (outerLabelMark) {\n      this.setMarkStyle(\n        outerLabelMark,\n        {\n          text: (datum: Datum) => `${datum[this.getCategoryField()]}`,\n          x: (datum: Datum) => this._computeOuterLabelPosition(datum).x,\n          y: (datum: Datum) => this._computeOuterLabelPosition(datum).y,\n          textAlign: (datum: Datum) => this._computeOuterLabelPosition(datum).align,\n          textBaseline: (datum: Datum) => this._computeOuterLabelPosition(datum).textBaseline,\n          maxLineWidth: (datum: Datum) => this._computeOuterLabelLimit(datum),\n          /** 不设置 width/height 会导致 richtext 有默认宽高, case: richtext-bounds */\n          /** width 和 height 对 text 标签不影响 */\n          width: 0,\n          height: 0\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      if (isFunction(this._spec.outerLabel.formatMethod)) {\n        this.setMarkStyle(\n          outerLabelMark,\n          {\n            text: (datum: Datum) => {\n              return this._spec.outerLabel.formatMethod(`${datum[this.getCategoryField()]}`, datum) as any;\n            }\n          },\n          'normal',\n          AttributeLevel.User_Mark\n        );\n      }\n    }\n    const outerLabelLineMark = this._funnelOuterLabelMark.line;\n    if (outerLabelLineMark && outerLabelMark) {\n      this.setMarkStyle(\n        outerLabelLineMark,\n        {\n          x: (datum: Datum) => this._computeOuterLabelLinePosition(datum).x1,\n          y: (datum: Datum) => this._computeOuterLabelLinePosition(datum).y1,\n          x1: (datum: Datum) => this._computeOuterLabelLinePosition(datum).x2,\n          y1: (datum: Datum) => this._computeOuterLabelLinePosition(datum).y2\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n      const visible = this._spec.outerLabel?.line?.visible ?? this._spec.outerLabel?.visible;\n      if (isValid(visible)) {\n        outerLabelLineMark.setVisible(visible);\n      }\n    }\n  }\n\n  initLabelMarkStyle(labelMark?: ILabelMark) {\n    if (!labelMark) {\n      return;\n    }\n\n    const target = labelMark.getTarget();\n    const component = labelMark.getComponent();\n\n    if (target === this._funnelMark) {\n      this._labelMark = labelMark;\n      this.setMarkStyle(\n        labelMark,\n        {\n          text: (datum: Datum) => `${datum[this.getCategoryField()]} ${datum[this.getValueField()]}`,\n          x: (datum: Datum) => this._computeLabelPosition(datum).x,\n          y: (datum: Datum) => this._computeLabelPosition(datum).y,\n          maxLineWidth: (datum: Datum) => this._computeLabelLimit(datum, this._spec.label),\n          stroke: this.getColorAttribute()\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n\n      const rootMarks = this.getCompiler().getRootMarks();\n\n      // 调整在rootMarks中的顺序，这个会影响最终渲染的顺序\n      if (this._funnelOuterLabelMark.label) {\n        moveAfterInArray(rootMarks, this._funnelOuterLabelMark.label, component);\n      }\n      if (this._funnelOuterLabelMark.line) {\n        moveAfterInArray(rootMarks, this._funnelOuterLabelMark.line, this._funnelOuterLabelMark.label ?? component);\n      }\n      // component.model.event.on(HOOK_EVENT.AFTER_ELEMENT_ENCODE, this.handleLabelComponentUpdate);\n    } else if (this._funnelTransformMark && target === this._funnelTransformMark) {\n      this._transformLabelMark = labelMark;\n      this.setMarkStyle(\n        labelMark,\n        {\n          text: (datum: Datum) => {\n            const ratio = field(FUNNEL_REACH_RATIO).bind(this)(datum) as number;\n            return `${(ratio * 100).toFixed(1)}%`;\n          },\n          x: (datum: Datum) => this._computeLabelPosition(datum).x,\n          y: (datum: Datum) => this._computeLabelPosition(datum).y,\n          maxLineWidth: (datum: Datum) => this._computeLabelLimit(datum, this._spec.transformLabel)\n        },\n        'normal',\n        AttributeLevel.Series\n      );\n    }\n  }\n\n  initAnimation() {\n    const appearPreset = (this._spec?.animationAppear as IStateAnimateSpec<FunnelAppearPreset>)?.preset ?? 'clipIn';\n    if (appearPreset === 'clipIn') {\n      if (this._rootMark) {\n        this._rootMark.setAnimationConfig(\n          animationConfig(\n            Factory.getAnimationInKey('cartesianGroupClip')?.(\n              {\n                direction: () => (this._isHorizontal() ? 'x' : 'y'),\n                width: () => {\n                  const rootMark = this.getRootMark().getProduct();\n                  if (rootMark) {\n                    const { x1, x2 } = rootMark.AABBBounds;\n                    return Math.max(x1, x2); // rootMark.x === 0, so need to find largest bound x instead of bounds width\n                  }\n                  return this.getLayoutRect().width;\n                },\n                height: () => {\n                  const rootMark = this.getRootMark().getProduct();\n                  if (rootMark) {\n                    const { y1, y2 } = rootMark.AABBBounds;\n                    return Math.max(y1, y2);\n                  }\n                  return this.getLayoutRect().height;\n                },\n                orient: () => (this._isReverse() ? 'negative' : 'positive')\n              },\n              appearPreset\n            ),\n            userAnimationConfig(SeriesMarkNameEnum.group, this._spec, this._markAttributeContext)\n          )\n        );\n      }\n    }\n    [this._funnelOuterLabelMark?.label].forEach(m => {\n      if (m) {\n        m.setAnimationConfig(\n          animationConfig(\n            Factory.getAnimationInKey('fadeInOut')(),\n            userAnimationConfig(m.name, this._spec, this._markAttributeContext)\n          )\n        );\n      }\n    });\n\n    [this._funnelMark, this._funnelTransformMark].forEach(m => {\n      if (m) {\n        m.setAnimationConfig(\n          animationConfig(\n            Factory.getAnimationInKey('funnel')({}, appearPreset),\n            userAnimationConfig(m.name, this._spec, this._markAttributeContext)\n          )\n        );\n      }\n    });\n\n    if (this._funnelOuterLabelMark?.line) {\n      this._funnelOuterLabelMark.line.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('fadeInOut')?.(),\n          userAnimationConfig(SeriesMarkNameEnum.outerLabelLine, this._spec, this._markAttributeContext)\n        )\n      );\n    }\n  }\n  // hack group\n  initGroups() {\n    // do nothing\n  }\n\n  // handle stack\n  getStackGroupFields(): string[] {\n    return [];\n  }\n\n  getStackValueField(): string {\n    // hack\n    return null;\n  }\n\n  /** event */\n  protected initEvent() {\n    super.initEvent();\n    // 同步更新转化层数据\n    this._viewDataTransform.getDataView()?.target.addListener('change', (d: DataView) => {\n      this._viewDataTransform.updateData();\n    });\n  }\n\n  /**\n   *\n   *   P0 ----------- P1       P2 ------ P3\n   *      \\         /           /        \\\n   *     P3 ------ P2        P1 ---------- P0\n   *\n   *         P1                     P0\n   *           |\\ P2           P3 /|\n   *           | |               | |\n   *           |/ P3           P2 \\|\n   *         P0                     P1\n   */\n  getPoints(datum: Datum) {\n    // 对特殊数据层不进行绘制\n    const isTransformLevel = this.isTransformLevel(datum);\n\n    const heightHalf = this._getMainAxisLength(isTransformLevel) / 2;\n    let upperLeft;\n    let lowerLeft;\n    if (isTransformLevel) {\n      upperLeft =\n        this._shape === 'rect'\n          ? this._getSecondaryAxisLength(datum[FUNNEL_LAST_VALUE_RATIO]) / 2\n          : this._getSecondaryAxisLength(datum[FUNNEL_VALUE_RATIO]) / 2;\n      lowerLeft = this._getSecondaryAxisLength(datum[FUNNEL_VALUE_RATIO]) / 2;\n    } else {\n      upperLeft = this._getSecondaryAxisLength(datum[FUNNEL_VALUE_RATIO]) / 2;\n      lowerLeft = this._shape === 'rect' ? upperLeft : this._getSecondaryAxisLength(datum[FUNNEL_NEXT_VALUE_RATIO]) / 2;\n    }\n\n    const { x, y } = this._getPositionByData(datum);\n\n    const points = this._getPolygonPoints([x, y], upperLeft, lowerLeft, upperLeft, lowerLeft, heightHalf);\n\n    if (this._funnelAlign !== 'center') {\n      this._adjustPoints(points);\n    }\n    return points;\n  }\n\n  isTransformLevel(datum: Datum) {\n    return !!datum?.[FUNNEL_TRANSFORM_LEVEL];\n  }\n\n  protected _buildMarkAttributeContext() {\n    super._buildMarkAttributeContext();\n    this._markAttributeContext.valueToPosition = this.valueToPosition.bind(this);\n    this._markAttributeContext.getPoints = this.getPoints.bind(this);\n    this._markAttributeContext.isTransformLevel = this.isTransformLevel.bind(this);\n  }\n\n  valueToPosition(category: StringOrNumber) {\n    const innerDatum = this.getViewData()?.latestData?.find?.((d: Datum) => d[this._categoryField] === category);\n    if (!isValid(innerDatum)) {\n      return null;\n    }\n    return this._getPolygonCenter(this.getPoints(innerDatum));\n  }\n\n  dataToPosition(datum: any, checkInViewData?: boolean) {\n    if (checkInViewData && !this.isDatumInViewData(datum)) {\n      return null;\n    }\n    return this.valueToPosition(datum[this._categoryField]);\n  }\n\n  dataToPositionX(datum: any) {\n    return this.dataToPosition(datum)?.x;\n  }\n\n  dataToPositionY(datum: any) {\n    return this.dataToPosition(datum)?.y;\n  }\n\n  dataToPositionZ(datum: any) {\n    return 0;\n  }\n\n  private _getMainAxisLength(isTransform = false) {\n    const funnelCount = this.getViewData().latestData.length;\n    const viewHeight = this._isHorizontal() ? this.getLayoutRect().width : this.getLayoutRect().height;\n\n    const hasTransform = !!this._spec.isTransform;\n    const gap = hasTransform ? 0 : this._spec.gap ?? 0;\n    const transformCount = hasTransform ? Math.max(0, funnelCount - 1) : 0;\n    const heightRatio = this._spec.heightRatio || 0.5;\n    const funnelHeight =\n      (viewHeight - gap * Math.max(0, funnelCount - 1)) / (funnelCount + heightRatio * transformCount);\n    if (isTransform) {\n      return hasTransform ? funnelHeight * heightRatio : 0;\n    }\n    return funnelHeight;\n  }\n\n  private _getSecondaryAxisLength(ratio: number) {\n    const validRatio = Number.isNaN(ratio) || !Number.isFinite(ratio) ? 0 : ratio;\n    const maxSize = this._computeMaxSize();\n    const minSize = this._computeMinSize();\n    return minSize + (maxSize - minSize) * validRatio;\n  }\n\n  /**\n   * 根据数据计算主轴中心点\n   * @param datum\n   * @returns\n   */\n  private _getPositionByData(datum: Datum) {\n    const index = this.getViewData().latestData?.findIndex(\n      (d: Datum) =>\n        d[this._categoryField] === datum[this._categoryField] && d[DEFAULT_DATA_KEY] === datum[DEFAULT_DATA_KEY]\n    );\n    if (!isValid(index) || index < 0) {\n      return {};\n    }\n    const isTransform = this.isTransformLevel(datum);\n    const isHorizontal = this._isHorizontal();\n    const viewWidth = isHorizontal ? this.getLayoutRect().height : this.getLayoutRect().width;\n    const viewHeight = isHorizontal ? this.getLayoutRect().width : this.getLayoutRect().height;\n    const centerX = viewWidth / 2;\n\n    let centerY = 0;\n    const funnelHeight = this._getMainAxisLength();\n    const transformHeight = this._getMainAxisLength(true);\n    const offset = funnelHeight + transformHeight;\n\n    centerY += index * offset;\n    centerY += isTransform ? -transformHeight / 2 : funnelHeight / 2;\n    if (!this._spec.isTransform && this._spec.gap) {\n      centerY += this._spec.gap * index;\n    }\n\n    this._isReverse() && (centerY = viewHeight - centerY);\n\n    return this._isHorizontal() ? { x: centerY, y: centerX } : { x: centerX, y: centerY };\n  }\n\n  private _getPolygonPoints(\n    center: [number, number],\n    upperLeft: number,\n    lowerLeft: number,\n    upperRight: number,\n    lowerRight: number,\n    heightHalf: number\n  ) {\n    const x = center[0];\n    const y = center[1];\n    switch (this._funnelOrient) {\n      case 'left':\n        return [\n          { x: x - heightHalf, y: y + upperLeft },\n          { x: x - heightHalf, y: y - upperRight },\n          { x: x + heightHalf, y: y - lowerRight },\n          { x: x + heightHalf, y: y + lowerLeft }\n        ];\n      case 'right':\n        return [\n          { x: x + heightHalf, y: y - upperRight },\n          { x: x + heightHalf, y: y + upperRight },\n          { x: x - heightHalf, y: y + lowerLeft },\n          { x: x - heightHalf, y: y - lowerLeft }\n        ];\n      case 'bottom':\n        return [\n          { x: x + upperLeft, y: y + heightHalf },\n          { x: x - upperRight, y: y + heightHalf },\n          { x: x - lowerRight, y: y - heightHalf },\n          { x: x + lowerLeft, y: y - heightHalf }\n        ];\n      default:\n        // top\n        return [\n          { x: x - upperLeft, y: y - heightHalf },\n          { x: x + upperRight, y: y - heightHalf },\n          { x: x + lowerRight, y: y + heightHalf },\n          { x: x - lowerLeft, y: y + heightHalf }\n        ];\n    }\n  }\n\n  /** 计算梯形中位线的中点\n   * @param points\n   * @returns\n   */\n  private _getPolygonCenter(points: IPoint[]) {\n    if (this._isHorizontal()) {\n      const p0_x = (points[0].x + points[3].x) / 2;\n      const p0_y = (points[0].y + points[3].y) / 2;\n      const p1_x = (points[1].x + points[2].x) / 2;\n      const p1_y = (points[1].y + points[2].y) / 2;\n      return {\n        x: (p0_x + p1_x) / 2,\n        y: (p0_y + p1_y) / 2\n      };\n    }\n\n    // 梯形中位线坐标\n    const p0_x = (points[0].x + points[3].x) / 2;\n    const p0_y = (points[0].y + points[3].y) / 2;\n    const p1_x = (points[1].x + points[2].x) / 2;\n    const p1_y = (points[1].y + points[2].y) / 2;\n    return {\n      x: (p0_x + p1_x) / 2,\n      y: (p0_y + p1_y) / 2\n    };\n  }\n\n  /**\n   * 调整点的偏移量，满足align效果\n   * @param points\n   * @returns\n   */\n  private _adjustPoints(points: IPoint[]) {\n    let upperOffset;\n    let lowerOffset;\n    let dirKey;\n    if (this._isHorizontal()) {\n      dirKey = 'y';\n      if (this._funnelOrient === 'left') {\n        upperOffset = this._funnelAlign === 'bottom' ? -points[1].y : points[1].y;\n        lowerOffset = this._funnelAlign === 'bottom' ? -points[2].y : points[2].y;\n      } else {\n        upperOffset = this._funnelAlign === 'bottom' ? -points[0].y : points[0].y;\n        lowerOffset = this._funnelAlign === 'bottom' ? -points[3].y : points[3].y;\n      }\n    } else {\n      dirKey = 'x';\n      if (this._funnelOrient === 'top') {\n        upperOffset = this._funnelAlign === 'left' ? points[0].x : -points[0].x;\n        lowerOffset = this._funnelAlign === 'left' ? points[3].x : -points[3].x;\n      } else {\n        upperOffset = this._funnelAlign === 'left' ? points[1].x : -points[1].x;\n        lowerOffset = this._funnelAlign === 'left' ? points[2].x : -points[2].x;\n      }\n    }\n    (points[0][dirKey] -= upperOffset), (points[1][dirKey] -= upperOffset);\n    (points[2][dirKey] -= lowerOffset), (points[3][dirKey] -= lowerOffset);\n    return points;\n  }\n\n  private _computeLabelPosition(datum: Datum) {\n    const points = this.getPoints(datum);\n    return this._getPolygonCenter(points);\n  }\n\n  // label 相关\n  private _computeLabelLimit(datum: Datum, labelSpec: IFunnelSeriesSpec['label']) {\n    const limit = labelSpec?.limit;\n\n    if (isNumber(limit)) {\n      return limit;\n    }\n\n    const points = this.getPoints(datum);\n\n    if (limit === 'shapeSize') {\n      if (this._isHorizontal()) {\n        return Math.abs(points[3].x - points[0].x);\n      }\n\n      return (Math.abs(points[0].x - points[1].x) + Math.abs(points[2].x - points[3].x)) / 2;\n    }\n\n    if (this._isHorizontal()) {\n      return Math.abs(points[3].x - points[0].x);\n    }\n\n    // return this._computeMaxSize();\n    // FIXME: 待 vrender 修复 maxLineWidth 在 bound 计算的 bug 后可以恢复注释\n    return undefined;\n  }\n\n  private _computeOuterLabelPosition(datum: Datum) {\n    let x;\n    let y;\n    let position: IOrientType = this._spec.outerLabel?.position;\n    let textAlign: TextAlign = 'center';\n    let textBaseline: TextBaseLine = 'middle';\n    if (this._isHorizontal()) {\n      position = ['top', 'bottom'].includes(position) ? position : this._funnelAlign === 'bottom' ? 'top' : 'bottom';\n    } else {\n      position = ['left', 'right'].includes(position) ? position : this._funnelAlign === 'left' ? 'right' : 'left';\n    }\n\n    if (this._spec.outerLabel?.alignLabel !== false) {\n      ({ x, y } = this._getPositionByData(datum));\n      if (position === 'left') {\n        (x = 0), (textAlign = 'left');\n      } else if (position === 'right') {\n        (x = this.getLayoutRect().width), (textAlign = 'right');\n      } else if (position === 'top') {\n        (y = 0), (textBaseline = 'top');\n      } else if (position === 'bottom') {\n        (y = this.getLayoutRect().height), (textBaseline = 'bottom');\n      }\n    } else {\n      const { x2, y2 } = this._computeOuterLabelLinePosition(datum);\n      (x = x2), (y = y2);\n      if (position === 'left') {\n        (x -= FUNNEL_LABEL_SPACE_WIDTH), (textAlign = 'right');\n      } else if (position === 'right') {\n        (x += FUNNEL_LABEL_SPACE_WIDTH), (textAlign = 'left');\n      } else if (position === 'top') {\n        (y -= FUNNEL_LABEL_SPACE_WIDTH), (textBaseline = 'bottom');\n      } else if (position === 'bottom') {\n        (y += FUNNEL_LABEL_SPACE_WIDTH), (textBaseline = 'top');\n      }\n    }\n    return { x, y, align: textAlign, textBaseline };\n  }\n\n  private _computeOuterLabelLimit(datum: Datum) {\n    if (this._isHorizontal()) {\n      return this._getMainAxisLength(this.isTransformLevel(datum));\n    }\n\n    // 垂直方向上的limit计算逻辑\n    const points = this.getPoints(datum);\n    const shapeMiddleWidth = (Math.abs(points[0].x - points[1].x) + Math.abs(points[2].x - points[3].x)) / 2;\n    const categoryField = this.getCategoryField();\n\n    const funnelLabelBounds = (this._labelMark?.getComponent()?.getComponent() as any)?.find(\n      ({ attribute, type }: { attribute: LabelItem; type: string }) => {\n        return type === 'text' && attribute.data?.[categoryField] === datum[categoryField];\n      },\n      true\n    )?.AABBBounds;\n\n    const funnelLabelWidth = funnelLabelBounds ? funnelLabelBounds.x2 - funnelLabelBounds.x1 : 0;\n    const outerLineSpace = this._funnelOuterLabelMark.line ? this._minLabelLineWidth : 0;\n\n    let space = this.getLayoutRect().width - Math.max(shapeMiddleWidth, funnelLabelWidth);\n    if (this._funnelAlign === 'center') {\n      space /= 2;\n    }\n    return space - outerLineSpace - (this._spec.outerLabel?.spaceWidth ?? FUNNEL_LABEL_SPACE_WIDTH);\n  }\n\n  private _computeOuterLabelLinePosition(datum: Datum) {\n    const categoryField = this.getCategoryField();\n    const outerLabelMarkBounds = this._funnelOuterLabelMark?.label\n      ?.getGraphics()\n      ?.find((g: IMarkGraphic) => g.context.data[0]?.[categoryField] === datum[categoryField])?.AABBBounds;\n    const labelComponent = this._labelMark?.getComponent()?.getComponent();\n\n    const labelMarkBounds = (labelComponent as any)?.find(\n      ({ attribute, type }: { attribute: LabelItem; type: string }) => {\n        return type === 'text' && attribute.data?.[categoryField] === datum[categoryField];\n      },\n      true\n    )?.AABBBounds;\n    const outerLabelSpec = this._spec.outerLabel ?? {};\n    let x1;\n    let x2;\n    let y1;\n    let y2;\n    if (this._isHorizontal()) {\n      const spaceWidth = outerLabelSpec.spaceWidth ?? FUNNEL_LABEL_SPACE_WIDTH;\n      const points = this.getPoints(datum);\n      const shapeMiddleHeight = (Math.abs(points[0].y - points[1].y) + Math.abs(points[2].y - points[3].y)) / 2;\n      if (this._spec.outerLabel.position === 'top' || this._funnelAlign === 'bottom') {\n        y1 = this._getPolygonCenter(points).y - shapeMiddleHeight / 2 - spaceWidth;\n        y2 = outerLabelSpec.alignLabel !== false ? outerLabelMarkBounds?.y2 + spaceWidth : y1 - spaceWidth;\n        x1 = this._getPolygonCenter(points).x;\n        y1 - y2 < this._minLabelLineWidth && (y2 = y1 - this._minLabelLineWidth);\n        x2 = x1;\n      } else {\n        y1 = this._getPolygonCenter(points).y + shapeMiddleHeight / 2 + spaceWidth;\n        y2 = outerLabelSpec.alignLabel !== false ? outerLabelMarkBounds?.y1 - spaceWidth : y1 + spaceWidth;\n        x1 = this._getPolygonCenter(points).x;\n        y2 - y1 < this._minLabelLineWidth && (y2 = y1 + this._minLabelLineWidth);\n        x2 = x1;\n      }\n      return { x1, x2, y1, y2 };\n    }\n    const points = this.getPoints(datum);\n    const shapeMiddleWidth = (Math.abs(points[0].x - points[1].x) + Math.abs(points[2].x - points[3].x)) / 2;\n    const labelWidth = labelMarkBounds?.x2 - labelMarkBounds?.x1 || 0;\n\n    const spaceWidth = outerLabelSpec.spaceWidth ?? FUNNEL_LABEL_SPACE_WIDTH;\n    if (this._spec.outerLabel.position === 'right' || this._funnelAlign === 'left') {\n      x1 = this._getPolygonCenter(points).x + Math.max(labelWidth / 2, shapeMiddleWidth / 2) + spaceWidth;\n      x2 = outerLabelSpec.alignLabel !== false ? outerLabelMarkBounds?.x1 - spaceWidth : x1 + spaceWidth;\n      y1 = this._getPolygonCenter(points).y;\n      x2 - x1 < this._minLabelLineWidth && (x2 = x1 + this._minLabelLineWidth);\n      y2 = y1;\n    } else {\n      x1 = this._getPolygonCenter(points).x - Math.max(labelWidth / 2, shapeMiddleWidth / 2) - spaceWidth;\n      x2 = outerLabelSpec.alignLabel !== false ? outerLabelMarkBounds?.x2 + spaceWidth : x1 - spaceWidth;\n      y1 = this._getPolygonCenter(points).y;\n      x1 - x2 < this._minLabelLineWidth && (x2 = x1 - this._minLabelLineWidth);\n      y2 = y1;\n    }\n    return { x1, x2, y1, y2 };\n  }\n\n  protected _computeMaxSize() {\n    const size = this._isHorizontal() ? this.getLayoutRect().height : this.getLayoutRect().width;\n    const maxSize = this._spec.maxSize ?? FUNNEL_MAX_SIZE;\n    return calcLayoutNumber(maxSize, size);\n  }\n\n  protected _computeMinSize() {\n    const size = this._isHorizontal() ? this.getLayoutRect().height : this.getLayoutRect().width;\n    const minSize = this._spec.minSize ?? FUNNEL_MIN_SIZE;\n    return calcLayoutNumber(minSize, size);\n  }\n\n  protected _isHorizontal() {\n    return this._funnelOrient === 'left' || this._funnelOrient === 'right';\n  }\n\n  private _isReverse() {\n    return this._funnelOrient === 'bottom' || this._funnelOrient === 'right';\n  }\n\n  getDefaultShapeType(): string {\n    return 'square';\n  }\n\n  getActiveMarks(): IMark[] {\n    return [this._funnelMark];\n  }\n}\n\nexport const registerFunnelSeries = () => {\n  registerPolygonMark();\n  registerTextMark();\n  registerRuleMark();\n  Factory.registerSeries(FunnelSeries.type, FunnelSeries);\n  Factory.registerAnimation('funnel', (params: any, preset: FunnelAppearPreset) => ({\n    appear: preset === 'clipIn' ? undefined : { type: 'fadeIn' },\n    ...FadeInOutAnimation\n  }));\n  registerCartesianGroupClipAnimation();\n  registerFadeInOutAnimation();\n};\n"]}