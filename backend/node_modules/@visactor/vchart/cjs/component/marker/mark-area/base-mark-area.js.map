{"version":3,"sources":["../src/component/marker/mark-area/base-mark-area.ts"],"names":[],"mappings":"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","file":"base-mark-area.js","sourcesContent":["import type { IMarkArea, IMarkAreaSpec } from './interface';\nimport {\n  computeClipRange,\n  transformLabelAttributes,\n  transformState,\n  transformStyle,\n  getMarkAreaProcessInfo\n} from '../utils';\nimport type { MarkArcAreaAttrs, MarkAreaAttrs } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport type { MarkArea as MarkAreaComponent, MarkArcArea as MarkArcAreaComponent } from '@visactor/vrender-components';\nimport { transformToGraphic } from '../../../util/style';\nimport { BaseMarker } from '../base-marker';\nimport { LayoutZIndex } from '../../../constant/layout';\nimport type { IGroup } from '@visactor/vrender-core';\nimport { array } from '@visactor/vutils';\nexport abstract class BaseMarkArea extends BaseMarker<IMarkAreaSpec> implements IMarkArea {\n  static specKey = 'markArea';\n  specKey = 'markArea';\n\n  layoutZIndex: number = LayoutZIndex.MarkArea;\n\n  // eslint-disable-next-line max-len\n  protected abstract _newMarkAreaComponent(\n    attr: MarkAreaAttrs | MarkArcAreaAttrs\n  ): MarkAreaComponent | MarkArcAreaComponent;\n  protected abstract _computePointsAttr(): any;\n\n  static _getMarkerCoordinateType(markerSpec: any): string {\n    const { doAngleProcess, doRadiusProcess, doRadAngProcess } = getMarkAreaProcessInfo(markerSpec);\n\n    if (markerSpec.coordinateType === 'polar' || doAngleProcess || doRadiusProcess || doRadAngProcess) {\n      return 'polar';\n    }\n    return 'cartesian';\n  }\n\n  protected _createMarkerComponent() {\n    const label = array(this._spec.label ?? {});\n    const markAreaAttrs: MarkAreaAttrs | MarkArcAreaAttrs = {\n      zIndex: this.layoutZIndex,\n      interactive: this._spec.interactive ?? true,\n      hover: this._spec.interactive ?? true,\n      select: this._spec.interactive ?? true,\n      points: [\n        {\n          x: 0,\n          y: 0\n        }\n      ],\n      center: {\n        x: 0,\n        y: 0\n      },\n      innerRadius: 0,\n      outerRadius: 0,\n      startAngle: 0,\n      endAngle: 0,\n      areaStyle: transformStyle(\n        transformToGraphic(this._spec.area?.style),\n        this._markerData,\n        this._markAttributeContext\n      ),\n      clipInRange: this._spec.clip ?? false,\n      label: label.map((labelItem: any) => {\n        return transformLabelAttributes(labelItem, this._markerData, this._markAttributeContext);\n      }),\n      state: {\n        area: transformState(this._spec.area?.state, this._markerData, this._markAttributeContext),\n        label: label.map((labelItem: any) => {\n          return transformState(labelItem.state, this._markerData, this._markAttributeContext);\n        }),\n        labelBackground: label.map((labelItem: any) => {\n          return transformState(labelItem.labelBackground?.state, this._markerData, this._markAttributeContext);\n        })\n      },\n      animation: this._spec.animation ?? false,\n      animationEnter: this._spec.animationEnter,\n      animationExit: this._spec.animationExit,\n      animationUpdate: this._spec.animationUpdate\n    };\n\n    const markArea = this._newMarkAreaComponent(markAreaAttrs);\n    return markArea as unknown as IGroup;\n  }\n\n  protected _markerLayout() {\n    const spec = this._spec as any;\n    const data = this._markerData;\n    const startRelativeSeries = this._startRelativeSeries;\n    const endRelativeSeries = this._endRelativeSeries;\n    const relativeSeries = this._relativeSeries;\n\n    const pointsAttr = this._computePointsAttr();\n\n    const seriesData = this._getRelativeDataView().latestData;\n    const dataPoints = data\n      ? data.latestData[0] && data.latestData[0].latestData\n        ? data.latestData[0].latestData\n        : data.latestData\n      : seriesData;\n\n    let limitRect;\n    if (spec.clip || array(spec.label).some(labelCfg => labelCfg?.confine)) {\n      const { minX, maxX, minY, maxY } = computeClipRange([\n        startRelativeSeries.getRegion(),\n        endRelativeSeries.getRegion(),\n        relativeSeries.getRegion()\n      ]);\n      limitRect = {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      };\n    }\n\n    if (this._markerComponent) {\n      const prevLabelAttrs = array(this._markerComponent.attribute?.label);\n      const specLabels = array(this._spec.label);\n\n      this._markerComponent.setAttributes({\n        ...pointsAttr,\n        label: prevLabelAttrs.map((prevLabel, index) => {\n          const specLabel = specLabels[index] || {};\n          return {\n            ...prevLabel,\n            text: specLabel.formatMethod\n              ? // type error here will be fixed in components\n                (specLabel.formatMethod(dataPoints, seriesData) as any)\n              : prevLabel?.text\n          };\n        }),\n        limitRect,\n        dx: this._layoutOffsetX,\n        dy: this._layoutOffsetY\n      } as any);\n    }\n  }\n\n  protected _initDataView(): void {\n    const spec = this._spec as any;\n    const {\n      doXProcess,\n      doYProcess,\n      doXYProcess,\n      doAngleProcess,\n      doRadiusProcess,\n      doRadAngProcess,\n      doCoordinatesProcess\n    } = getMarkAreaProcessInfo(spec);\n    if (\n      !doXProcess &&\n      !doYProcess &&\n      !doXYProcess &&\n      !doAngleProcess &&\n      !doRadiusProcess &&\n      !doRadAngProcess &&\n      !doCoordinatesProcess\n    ) {\n      return null;\n    }\n\n    this._initCommonDataView();\n  }\n}\n"]}