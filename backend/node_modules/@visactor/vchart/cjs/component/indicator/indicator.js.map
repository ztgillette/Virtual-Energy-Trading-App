{"version":3,"sources":["../src/component/indicator/indicator.ts"],"names":[],"mappings":"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","file":"indicator.js","sourcesContent":["import { DataView } from '@visactor/vdataset';\nimport { LayoutLevel, LayoutZIndex } from '../../constant/layout';\n// eslint-disable-next-line no-duplicate-imports\nimport { ComponentTypeEnum } from '../interface/type';\nimport { BaseComponent } from '../base/base-component';\nimport type { IRegion } from '../../region/interface';\nimport type { IIndicator, IIndicatorItemSpec, IIndicatorSpec } from './interface';\nimport type { Datum, Maybe } from '../../typings';\nimport { mergeSpec } from '@visactor/vutils-extension';\nimport { transformIndicatorStyle } from '../../util/style';\nimport { getActualNumValue } from '../../util/space';\nimport { isEqual, isValid, isFunction, array, pickWithout } from '@visactor/vutils';\nimport { indicatorMapper } from './util';\nimport type { IModelSpecInfo } from '../../model/interface';\nimport { registerDataSetInstanceTransform } from '../../data/register';\nimport { CompilableData } from '../../compile/data/compilable-data';\nimport { Indicator as IndicatorComponents } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport type { IndicatorAttributes } from '@visactor/vrender-components';\nimport type { IGraphic, INode, IGroup } from '@visactor/vrender-core';\nimport type { FunctionType } from '../../typings/visual';\nimport { Factory } from '../../core/factory';\n// eslint-disable-next-line no-duplicate-imports\nimport type { IRichTextCharacter } from '@visactor/vrender-core';\nimport { getSpecInfo } from '../util';\nimport { getDatumOfGraphic } from '../../util/mark';\nimport type { IMarkGraphic } from '../../mark/interface';\nimport { indicator } from '../../theme/builtin/common/component/indicator';\n\nexport class Indicator<T extends IIndicatorSpec> extends BaseComponent<T> implements IIndicator {\n  static type = ComponentTypeEnum.indicator;\n  type = ComponentTypeEnum.indicator;\n  name: string = ComponentTypeEnum.indicator;\n\n  static readonly builtInTheme = {\n    indicator\n  };\n  static specKey = 'indicator';\n  specKey = 'indicator';\n\n  layoutType: 'none' = 'none';\n  layoutZIndex: number = LayoutZIndex.Indicator;\n  layoutLevel: number = LayoutLevel.Indicator;\n\n  private _gap: number = 0;\n\n  private _activeDatum: any = null;\n  private _displayData!: CompilableData;\n\n  private _title: IIndicatorItemSpec;\n  private _content: IIndicatorItemSpec[];\n\n  private _indicatorComponent: IndicatorComponents;\n  private _cacheAttrs: IndicatorAttributes;\n\n  static getSpecInfo(chartSpec: any): Maybe<IModelSpecInfo[]> {\n    return getSpecInfo<IIndicatorSpec>(chartSpec, this.specKey, this.type, (s: IIndicatorSpec) => {\n      return s && s.visible !== false;\n    });\n  }\n\n  created() {\n    super.created();\n    // data\n    this.initData();\n    // event\n    this.initEvent();\n  }\n\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n    this._gap = this._spec.gap || 0;\n    this._title = this._spec.title;\n    this._content = array(this._spec.content);\n    this._regions = this._option.getRegionsInUserIdOrIndex(array(this._spec.regionId), array(this._spec.regionIndex));\n  }\n\n  // event\n  protected initEvent() {\n    if (this._option.disableTriggerEvent) {\n      return;\n    }\n    const trigger = this._spec.trigger;\n    if (trigger === 'none') {\n      return;\n    }\n\n    if (this._spec.trigger === 'hover') {\n      this.event.on('element-highlight:start', (params: any) => {\n        const g = params.graphics[0];\n\n        if (this.isRelativeModel(g)) {\n          this.updateDatum(getDatumOfGraphic(g) as Datum[]);\n        }\n      });\n      this.event.on('element-highlight:reset', (params: any) => {\n        if (this._activeDatum) {\n          this.updateDatum(null);\n        }\n      });\n    } else {\n      this.event.on('element-select:start', (params: any) => {\n        const g = params.graphics[0];\n\n        if (this.isRelativeModel(g)) {\n          this.updateDatum(getDatumOfGraphic(g) as Datum[]);\n        }\n      });\n      this.event.on('element-select:reset', (params: any) => {\n        if (this._activeDatum) {\n          this.updateDatum(null);\n        }\n      });\n    }\n  }\n\n  updateDatum(datum: any) {\n    this._activeDatum = datum;\n    this._displayData.updateData();\n    const attrs = this._getIndicatorAttrs();\n    this._createOrUpdateIndicatorComponent(attrs);\n  }\n\n  // data\n  private initData() {\n    registerDataSetInstanceTransform(this._option.dataSet, 'indicatorFilter', indicatorMapper);\n    const displayData = new DataView(this._option.dataSet, { name: `${this.type}_${this.id}_data` });\n    displayData.transform({\n      type: 'indicatorFilter',\n      options: {\n        title: this._title,\n        content: this._content,\n        datum: () => this._activeDatum\n      }\n    });\n\n    displayData.target.addListener('change', this.updateDatum.bind(this));\n\n    this._displayData = new CompilableData(this._option, displayData);\n  }\n\n  updateLayoutAttribute(): void {\n    const attrs = this._getIndicatorAttrs();\n    this._createOrUpdateIndicatorComponent(attrs);\n\n    super.updateLayoutAttribute();\n  }\n\n  private _getIndicatorAttrs() {\n    if (this._spec.visible === false || (this._spec.fixed === false && this._activeDatum === null)) {\n      return {\n        visible: false\n      } as IndicatorAttributes;\n    }\n\n    const region = this._regions[0];\n    const { width, height } = region.getLayoutRect();\n    const { x, y } = region.getLayoutStartPoint();\n    const { content, offsetX, offsetY, limitRatio, title, ...restSpec } = this._spec;\n\n    const contentComponentSpec: IIndicatorItemSpec[] = [];\n    array(content).forEach((eachItem: IIndicatorItemSpec) => {\n      const contentSpec = mergeSpec({}, this._theme.content, eachItem);\n      contentComponentSpec.push({\n        visible: contentSpec.visible !== false && (contentSpec.field ? this._activeDatum !== null : true),\n        space: contentSpec.space || this._gap,\n        autoLimit: contentSpec.autoLimit,\n        autoFit: contentSpec.autoFit,\n        fitPercent: contentSpec.fitPercent,\n        fitStrategy: contentSpec.fitStrategy,\n        style: {\n          ...transformIndicatorStyle(pickWithout(contentSpec.style, ['text']), this._activeDatum),\n          text: this._createText(contentSpec.field, contentSpec.style.text)\n        }\n      });\n    });\n\n    return {\n      visible: true,\n      size: {\n        width: width,\n        height: height\n      },\n      zIndex: this.layoutZIndex,\n      x: x,\n      y: y,\n      dx: offsetX ? getActualNumValue(offsetX, this._computeLayoutRadius()) : 0,\n      dy: offsetY ? getActualNumValue(offsetY, this._computeLayoutRadius()) : 0,\n      limitRatio: limitRatio || Infinity,\n      title: {\n        visible: title.visible !== false && (!isValid(title.field) || this._activeDatum !== null),\n        space: title.space || this._gap,\n        autoLimit: title.autoLimit,\n        autoFit: title.autoFit,\n        fitPercent: title.fitPercent,\n        fitStrategy: title.fitStrategy,\n        style: {\n          ...transformIndicatorStyle(pickWithout(title.style, ['text']), this._activeDatum),\n          text: this._createText(title.field, title.style.text as any) // FIXME: type\n        }\n      },\n      content: contentComponentSpec,\n      ...(restSpec as unknown as IndicatorAttributes)\n    } as IndicatorAttributes;\n  }\n\n  private _createOrUpdateIndicatorComponent(attrs: IndicatorAttributes) {\n    if (attrs.visible === false) {\n      // 按照vrender-component 的设置，只切换visible: false，并不会更新组件，所以强制删掉节点\n      if (this._indicatorComponent && this._indicatorComponent.parent) {\n        this._indicatorComponent.parent.removeChild(this._indicatorComponent);\n      }\n      this._indicatorComponent = null;\n      return;\n    }\n\n    if (this._indicatorComponent) {\n      if (!isEqual(attrs, this._cacheAttrs)) {\n        this._indicatorComponent.setAttributes(attrs);\n      }\n    } else {\n      const container = this.getContainer();\n      //FIXME:类型“IndicatorAttributes”的参数不能赋给类型“Required<IndicatorAttributes>”的参数\n      const indicator = new IndicatorComponents(attrs as any);\n      indicator.name = 'indicator';\n      container.add(indicator as unknown as INode);\n      this._indicatorComponent = indicator;\n      this._indicatorComponent.on('*', (event: any, type: string) =>\n        this._delegateEvent(this._indicatorComponent as unknown as IGraphic, event, type)\n      );\n    }\n    this._cacheAttrs = attrs;\n  }\n\n  private _createText(\n    field: string | undefined,\n    text:\n      | string\n      | number\n      | string[]\n      | number[]\n      | IRichTextCharacter[]\n      | FunctionType<number | number[] | string | string[] | IRichTextCharacter[]>\n  ) {\n    if (field) {\n      return this._activeDatum ? this._activeDatum[field] : '';\n    }\n    if (isFunction(text)) {\n      return text(this._activeDatum, undefined) ?? '';\n    }\n    return text ?? '';\n  }\n\n  private _computeLayoutRadius() {\n    const region = this._regions[0];\n    const { width, height } = region.getLayoutRect();\n    return Math.min(width / 2, height / 2);\n  }\n\n  private isRelativeModel(g: IMarkGraphic) {\n    return this._regions.some(region => !!region.getSeriesInId(g.context.modelId));\n  }\n\n  protected _getNeedClearVRenderComponents(): IGraphic[] {\n    return [this._indicatorComponent] as unknown as IGroup[];\n  }\n\n  clear(): void {\n    this._cacheAttrs = null;\n    super.clear();\n  }\n\n  getIndicatorComponent(): IndicatorComponents {\n    return this._indicatorComponent;\n  }\n}\n\nexport const registerIndicator = () => {\n  Factory.registerComponent(Indicator.type, Indicator);\n};\n"]}